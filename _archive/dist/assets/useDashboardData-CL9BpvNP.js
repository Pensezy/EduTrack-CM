import{r as n}from"./react-vendor-CFDIsUAY.js";import{s as P}from"./services-CdXttHtG.js";import{p as I}from"./productionDataService-T6uUAzM-.js";const F=(e=null)=>{const[a,L]=n.useState(null),[d,j]=n.useState(!0),[O,$]=n.useState({metrics:[],classAverages:[],attendance:[],payments:[],personnel:[],students:[],schoolStats:{},schoolDetails:null,classes:[]}),[b,y]=n.useState({metrics:!1,classAverages:!1,attendance:!1,payments:!1,personnel:!1,students:!1,schoolStats:!1,schoolDetails:!1,classes:!1}),[u,U]=n.useState({});n.useEffect(()=>{(async()=>{try{const{data:{user:l},error:c}=await P.auth.getUser();if(c)throw c;L(l)}catch(l){console.error("Erreur rÃ©cupÃ©ration utilisateur:",l)}finally{j(!1)}})()},[]);const r=async(s,l,...c)=>{if(!d){y(t=>({...t,[s]:!0})),U(t=>({...t,[s]:null}));try{if(I.setUserContext){let o,i;if(e!=null&&e.director_user_id&&(e!=null&&e.id))o=e.director_user_id,i=e.id;else if(a!=null&&a.id){o=a.id;const{data:E}=await P.from("users").select("school_id").eq("id",a.id).single();i=E==null?void 0:E.school_id}o&&i?(console.log(`ðŸ” Initialisation contexte sÃ©curisÃ©: User=${o}, School=${i}`),I.setUserContext(o,i)):(console.warn("âš ï¸ Impossible d'initialiser le contexte sÃ©curisÃ©"),console.warn("  - userId:",o),console.warn("  - schoolId:",i))}const t=(e==null?void 0:e.id)||null,w=t?[t,...c]:c,v=await I[l](...w);if(v.error)throw v.error;$(o=>({...o,[s]:v.data}))}catch(t){console.error(`Erreur lors du chargement de ${s}:`,t),U(w=>({...w,[s]:t}))}finally{y(t=>({...t,[s]:!1}))}}},f=()=>r("metrics","getDashboardMetrics"),g=(s={})=>r("classAverages","getClassAverages",s),m=(s="week")=>r("attendance","getAttendanceData",s),p=()=>r("payments","getPaymentData"),S=()=>r("personnel","getPersonnel"),B=(s={})=>r("students","getStudents",s),D=()=>r("schoolStats","getSchoolStats"),h=()=>{const s=a==null?void 0:a.id;return r("schoolDetails","getSchoolDetails",null,s)},A=()=>r("classes","getClasses"),_=()=>{f(),g(),m(),p(),S(),D(),h(),A()};return n.useEffect(()=>{!d&&a&&(console.log("ðŸš€ Chargement des donnÃ©es depuis Supabase"),Promise.all([h(),f()]).then(()=>{Promise.all([D(),A(),S(),g(),m(),p()])}))},[d,a]),{data:O,loading:b,errors:u,user:a,userLoading:d,loadMetrics:f,loadClassAverages:g,loadAttendance:m,loadPayments:p,loadPersonnel:S,loadStudents:B,loadSchoolStats:D,loadSchoolDetails:h,loadClasses:A,loadAllData:_,refresh:_,isAnyLoading:Object.values(b).some(Boolean),hasErrors:Object.values(u).some(Boolean),allErrors:Object.entries(u).filter(([s,l])=>l).map(([s,l])=>({key:s,error:l}))}};export{F as u};
//# sourceMappingURL=useDashboardData-CL9BpvNP.js.map
