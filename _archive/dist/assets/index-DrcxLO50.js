import{j as e,u as fs}from"./contexts-fbpOeTmm.js";import{r as c,R as rs,i as bs}from"./react-vendor-CFDIsUAY.js";import{s as Z}from"./services-CdXttHtG.js";import{H as js,S as Ns}from"./Sidebar-Q0ML3SY6.js";import{a as K,I as a,B as j,S as oe,c as We}from"./index-BPV3rumr.js";import{I as He}from"./AppImage-yaNzDrl6.js";import{d as vs,M as ys,X as Re,I as ws,T as ls,e as Cs,f as ms,E as Ss,D as Qe,P as _s,g as Ue,F as Es,S as ks,R as Ds,h as xs,i as us,j as Ye,k as as,l as zs,m as ns,n as Ps,o as As,U as Ts}from"./ui-vendor-BrXTGbgA.js";import ss from"./purify.es-B9ZVCkUG.js";import{d as Ge}from"./documentService-BNZuJcP9.js";import"./supabase-CIvuJI4W.js";import"./pdf-vendor-wz8qypYI.js";const ds={async searchExistingParents(g){try{const l=g.toLowerCase(),{data:s,error:o}=await Z.from("parents").select(`
          id,
          first_name,
          last_name,
          email,
          phone,
          address,
          profession,
          user_id,
          created_at
        `).or(`first_name.ilike.%${g}%,last_name.ilike.%${g}%,email.ilike.%${g}%,phone.ilike.%${g}%`).limit(10);return o?(console.error("Erreur recherche Supabase parents:",o),[]):await Promise.all((s||[]).map(async t=>{const{data:i,error:E}=await Z.from("students").select(`
              id,
              first_name,
              last_name,
              current_class,
              school_id,
              schools (
                id,
                name,
                city,
                type
              )
            `).eq("parent_id",t.id).eq("is_active",!0);E&&console.error("Erreur chargement Ã©lÃ¨ves:",E);const T=(i||[]).map(k=>({student:{id:k.id,firstName:k.first_name,lastName:k.last_name,className:k.current_class},school:k.schools?{id:k.schools.id,name:k.schools.name,city:k.schools.city||"Non renseignÃ©",type:k.schools.type}:null}));return{id:t.id,globalParentId:t.id,firstName:t.first_name,lastName:t.last_name,email:t.email,phone:t.phone,address:t.address,profession:t.profession,userId:t.user_id,createdAt:t.created_at,studentRelations:T}}))}catch(l){return console.error("Erreur lors de la recherche de parents:",l),[]}},async checkExistingParent(g,l){try{let s=Z.from("parents").select(`
        id,
        first_name,
        last_name,
        email,
        phone,
        address,
        profession,
        user_id,
        created_at
      `);const o=[];if(g&&o.push(`email.eq.${g}`),l&&o.push(`phone.eq.${l}`),o.length===0)return null;const{data:n,error:t}=await s.or(o.join(","));if(t)return console.error("Erreur vÃ©rification parent:",t),null;if(!n||n.length===0)return null;const i=n[0],{data:E}=await Z.from("students").select(`
          id,
          first_name,
          last_name,
          current_class,
          school_id,
          schools (
            id,
            name,
            city,
            type
          )
        `).eq("parent_id",i.id).eq("is_active",!0),T=(E||[]).map(k=>({student:{id:k.id,firstName:k.first_name,lastName:k.last_name,className:k.current_class},school:k.schools?{id:k.schools.id,name:k.schools.name,city:k.schools.city||"Non renseignÃ©",type:k.schools.type}:null}));return{id:i.id,globalParentId:i.id,firstName:i.first_name,lastName:i.last_name,email:i.email,phone:i.phone,address:i.address,profession:i.profession,userId:i.user_id,createdAt:i.created_at,studentRelations:T}}catch(s){return console.error("Exception lors de la vÃ©rification du parent:",s),null}}},Ms=({onParentSelect:g,onCreateNew:l,selectedParent:s,searchTerm:o,onSearchChange:n})=>{const[t,i]=c.useState([]),[E,T]=c.useState(!1),[k,u]=c.useState(!1);c.useEffect(()=>{o&&o.length>=2?D(o):(i([]),u(!1))},[o]);const D=async P=>{T(!0);try{const b=await ds.searchExistingParents(P);i(b),u(!0)}catch(b){console.error("Erreur lors de la recherche:",b)}finally{T(!1)}},C=async(P,b)=>{try{const I=await ds.checkExistingParent(P,b);return I?{isDuplicate:!0,parent:I,message:`Un parent existe dÃ©jÃ  avec ces informations:
${I.firstName} ${I.lastName}
Email: ${I.email}
TÃ©lÃ©phone: ${I.phone}

Enfants dans ${I.studentRelations.length} Ã©tablissement(s)`}:{isDuplicate:!1}}catch(I){return console.error("Erreur lors de la vÃ©rification:",I),{isDuplicate:!1}}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(K,{placeholder:"Rechercher un parent existant (nom, email, tÃ©lÃ©phone)...",value:o,onChange:P=>n(P.target.value),className:"w-full"})}),E&&e.jsxs("div",{className:"flex items-center text-blue-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),e.jsx("span",{className:"text-sm",children:"Recherche..."})]})]}),k&&t.length>0&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:[e.jsx("div",{className:"p-3 bg-blue-50 border-b border-blue-200",children:e.jsxs("p",{className:"text-sm font-medium text-blue-800",children:[t.length," parent(s) trouvÃ©(s)"]})}),t.map(P=>e.jsxs("div",{onClick:()=>{g(P),u(!1)},className:"p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:[P.firstName," ",P.lastName]}),e.jsx("p",{className:"text-sm text-gray-600",children:P.email}),e.jsx("p",{className:"text-sm text-gray-600",children:P.phone}),e.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:[e.jsx(a,{name:"School",size:12,className:"inline mr-1"}),P.studentRelations.length," relation(s) Ã©cole"]})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["ID: ",P.globalParentId.slice(0,8),"..."]})]}),P.studentRelations.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-100",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Enfants actuels:"}),P.studentRelations.map((b,I)=>e.jsxs("div",{className:"text-xs text-gray-600",children:["â€¢ ",b.student.firstName," ",b.student.lastName,b.student.className&&` - ${b.student.className}`,b.school&&` - ${b.school.name} (${b.school.city})`]},I))]})]},P.id))]}),k&&t.length===0&&o.length>=2&&!E&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(a,{name:"Search",size:24,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Aucun parent trouvÃ©"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Vous pouvez crÃ©er un nouveau parent"})]})})]}),s&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-green-800",children:["Parent sÃ©lectionnÃ©: ",s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-sm text-green-700",children:s.email}),e.jsx("p",{className:"text-sm text-green-700",children:s.phone}),e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:[e.jsx(a,{name:"Globe",size:12,className:"inline mr-1"}),"ID Global: ",s.globalParentId]}),s.studentRelations&&s.studentRelations.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-xs text-green-700 font-medium",children:["Enfants inscrits (",s.studentRelations.length,") :"]}),s.studentRelations.map((P,b)=>e.jsxs("div",{className:"text-xs text-green-600",children:["â€¢ ",P.student.firstName," ",P.student.lastName,P.student.className&&` - ${P.student.className}`,P.school&&` Ã  ${P.school.name} (${P.school.city})`]},b))]}),s.studentRelations&&s.studentRelations.length===0&&e.jsx("div",{className:"mt-2",children:e.jsxs("p",{className:"text-xs text-green-600",children:[e.jsx(a,{name:"Info",size:12,className:"inline mr-1"}),"Aucun enfant inscrit actuellement"]})})]}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>{g(null),n(""),u(!1)},className:"text-green-700 hover:text-green-800",children:e.jsx(a,{name:"X",size:16})})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(j,{variant:"outline",onClick:()=>l(),className:"flex-1",children:[e.jsx(a,{name:"UserPlus",size:16,className:"mr-2"}),"CrÃ©er Nouveau Parent"]}),o&&o.length>=2&&e.jsxs(j,{variant:"ghost",onClick:async()=>{const P=await C(o,"");P.isDuplicate?(alert(`âš ï¸ ATTENTION - DOUBLON DÃ‰TECTÃ‰!

${P.message}

Voulez-vous utiliser ce parent existant?`),g(P.parent)):alert("âœ… Aucun doublon dÃ©tectÃ© pour cette information")},className:"text-orange-600 hover:text-orange-700",children:[e.jsx(a,{name:"AlertTriangle",size:16,className:"mr-2"}),"VÃ©rifier Doublon"]})]})]})},Is=()=>{var A,le,we,Ce,Ne;const[g,l]=c.useState(""),[s,o]=c.useState(""),[n,t]=c.useState(""),[i,E]=c.useState(!1),[T,k]=c.useState(!1),[u,D]=c.useState(!1),[C,P]=c.useState(null),[b,I]=c.useState(!0),[N,v]=c.useState(null),[O,p]=c.useState([]),[z,R]=c.useState(1),[L,U]=c.useState("new"),[B,M]=c.useState(null),[w,x]=c.useState(""),[d,_]=c.useState({parent:{firstName:"",lastName:"",email:"",phone:"",address:"",occupation:"",username:"",password:"",userId:""},students:[{firstName:"",lastName:"",class:"",dateOfBirth:"",placeOfBirth:"",photo:"/public/assets/images/no_image.png",username:"",password:"",studentId:""}]}),[J,ae]=c.useState({name:"",class:"",parentName:"",parentPhone:"",parentEmail:"",photo:"/public/assets/images/no_image.png"}),[V,X]=c.useState([]);c.useEffect(()=>{S(),r()},[]);const S=async()=>{try{const y=localStorage.getItem("edutrack-user"),H=y?JSON.parse(y):null,se=H==null?void 0:H.current_school_id;if(!se){console.warn("âš ï¸ Pas d'Ã©cole associÃ©e");return}const{data:re,error:me}=await Z.from("schools").select("id, name, type, available_classes").eq("id",se).single();if(me){console.error("âŒ Erreur chargement Ã©cole:",me);return}if(v({id:re.id,name:re.name,type:re.type}),console.log("âœ… Ã‰cole chargÃ©e pour les Ã©lÃ¨ves:",re.name),console.log("ðŸ“‹ Classes disponibles:",re.available_classes),re.available_classes&&Array.isArray(re.available_classes)&&re.available_classes.length>0){const he=re.available_classes.map((fe,h)=>({id:`class-${h}`,name:fe,level:fe}));p(he),console.log(`âœ… ${he.length} classe(s) chargÃ©e(s) depuis available_classes pour les Ã©lÃ¨ves`)}else{console.warn("âš ï¸ Aucune classe dans available_classes, utilisation des classes par dÃ©faut");const he=Q(re.type);p(he)}}catch(y){console.error("Exception chargement donnÃ©es Ã©cole:",y)}},Q=y=>y==="Maternelle"?[{id:"default-ps",name:"Petite Section",level:"PS"},{id:"default-ms",name:"Moyenne Section",level:"MS"},{id:"default-gs",name:"Grande Section",level:"GS"}]:y==="Primaire"?[{id:"default-cp",name:"CP",level:"CP"},{id:"default-ce1",name:"CE1",level:"CE1"},{id:"default-ce2",name:"CE2",level:"CE2"},{id:"default-cm1",name:"CM1",level:"CM1"},{id:"default-cm2",name:"CM2",level:"CM2"}]:y==="CollÃ¨ge"?[{id:"default-6eme",name:"6Ã¨me",level:"6Ã¨me"},{id:"default-5eme",name:"5Ã¨me",level:"5Ã¨me"},{id:"default-4eme",name:"4Ã¨me",level:"4Ã¨me"},{id:"default-3eme",name:"3Ã¨me",level:"3Ã¨me"}]:y==="LycÃ©e"?[{id:"default-2nde",name:"2nde",level:"2nde"},{id:"default-1ere",name:"1Ã¨re",level:"1Ã¨re"},{id:"default-tle",name:"Terminale",level:"Terminale"}]:[],r=async()=>{try{I(!0);const y=localStorage.getItem("edutrack-user"),H=y?JSON.parse(y):null,se=H==null?void 0:H.current_school_id;if(!se){console.warn("âš ï¸ Pas d'Ã©cole associÃ©e"),X([]),I(!1);return}console.log("ðŸ” Chargement des Ã©lÃ¨ves pour l'Ã©cole:",se);const{data:re,error:me}=await Z.from("students").select("*").eq("school_id",se).order("created_at",{ascending:!1});if(me)console.error("âŒ Erreur chargement Ã©lÃ¨ves:",me),console.error("âŒ DÃ©tails:",me.message,me.details,me.hint),X([]);else if(console.log("ðŸ“Š DonnÃ©es brutes Ã©lÃ¨ves reÃ§ues:",re),console.log(`ðŸ“ˆ Nombre d'Ã©lÃ¨ves trouvÃ©s: ${(re==null?void 0:re.length)||0}`),!re||re.length===0)console.warn("âš ï¸ Aucune donnÃ©e d'Ã©lÃ¨ve trouvÃ©e dans la base pour school_id:",se),X([]);else{const he=re.map($=>$.parent_id).filter($=>$!=null);console.log("ðŸ” Parent IDs Ã  charger:",he);let fe={};if(he.length>0){const{data:$,error:te}=await Z.from("parents").select("id, user_id, first_name, last_name, email, phone").in("id",he);te?console.error("âš ï¸ Erreur chargement parents:",te):$&&(console.log("ðŸ“Š DonnÃ©es parents reÃ§ues:",$),fe=$.reduce((ie,pe)=>(ie[pe.id]=pe,ie),{}))}const h=re.map($=>{console.log("ðŸ”„ Formatage Ã©lÃ¨ve:",$.first_name,$.last_name);const te=fe[$.parent_id];return{id:$.id,name:`${$.first_name} ${$.last_name}`,class:$.current_class||$.class_name||"Non assignÃ©",enrollmentStatus:$.is_active?"active":"transferred",photo:$.photo_url||$.photo||"/public/assets/images/no_image.png",parentName:te?`${te.first_name} ${te.last_name}`:"Non renseignÃ©",parentPhone:(te==null?void 0:te.phone)||"Non renseignÃ©",parentEmail:(te==null?void 0:te.email)||"Non renseignÃ©",enrollmentDate:$.enrollment_date?new Date($.enrollment_date).toLocaleDateString("fr-FR"):"Non renseignÃ©e",studentId:$.user_id||`STU${$.id.substring(0,6)}`}});X(h),console.log(`âœ… ${h.length} Ã©lÃ¨ve(s) chargÃ©(s) et formatÃ©(s)`),console.log("ðŸ‘¥ Liste finale:",h)}}catch(y){console.error("Exception chargement Ã©lÃ¨ves:",y),X([])}finally{I(!1)}},f=[{value:"",label:"Toutes les classes"},...O.map(y=>({value:y.name,label:y.name}))],W=[{value:"",label:"Tous les statuts"},{value:"active",label:"Actif"},{value:"pending",label:"En attente"},{value:"transferred",label:"TransfÃ©rÃ©"}],G=()=>{const y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@$!%*?&";let H="";H+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*26)],H+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)],H+="0123456789"[Math.floor(Math.random()*10)],H+="@$!%*?&"[Math.floor(Math.random()*7)];for(let se=4;se<8;se++)H+=y[Math.floor(Math.random()*y.length)];return H.split("").sort(()=>.5-Math.random()).join("")},q=(y,H,se,re,me="parent")=>{const he=be=>be.toLowerCase().replace(/[^a-z0-9]/g,"");let fe="",h="",$="";se&&se.includes("@")&&(fe=se.toLowerCase()),re&&re.includes("+237")&&(h=re.replace(/\D/g,""));const te=me==="parent"?"parent":"eleve",ie=he(y),pe=he(H),ve=Math.floor(100+Math.random()*900);return $=`${te}${ie.charAt(0)}${pe}${ve}`,{primaryLogin:fe,secondaryLogin:h,customUsername:$,canLoginWithEmail:!!fe,canLoginWithPhone:!!h}},m=(y="parent")=>{const H=y==="parent"?"PAR":"STU",se=String(Math.floor(1e3+Math.random()*9e3));return`${H}${se}`},F=()=>{z<3&&R(z+1)},Y=()=>{z>1&&R(z-1)},ne=()=>{R(1),U("new"),M(null),x(""),_({parent:{firstName:"",lastName:"",email:"",phone:"",address:"",occupation:"",username:"",password:"",userId:""},students:[{firstName:"",lastName:"",class:"",dateOfBirth:"",placeOfBirth:"",photo:"/public/assets/images/no_image.png",username:"",password:"",studentId:""}]})},de=()=>{_(y=>({...y,students:[...y.students,{firstName:"",lastName:"",class:"",dateOfBirth:"",placeOfBirth:"",photo:"/public/assets/images/no_image.png",username:"",password:"",studentId:""}]}))},Ee=y=>{d.students.length>1&&_(H=>({...H,students:H.students.filter((se,re)=>re!==y)}))},Te=()=>{if(L==="new"&&!d.parent.email){const H=d.parent.phone.replace(/\s+/g,"").replace(/\+/g,"");d.parent.email=`parent${H}@edutrack.cm`,console.log("ðŸ“§ Email gÃ©nÃ©rÃ© automatiquement pour parent:",d.parent.email)}const y=d.students.map(H=>{const se=q(H.firstName,H.lastName,"","","student");return{...H,primaryLogin:se.primaryLogin||se.customUsername,secondaryLogin:se.secondaryLogin,customUsername:se.customUsername,password:G(),studentId:m("student"),canLoginWithEmail:se.canLoginWithEmail,canLoginWithPhone:se.canLoginWithPhone}});if(L==="new"){const H=q(d.parent.firstName,d.parent.lastName,d.parent.email,d.parent.phone,"parent"),se=G(),re=m("parent");_(me=>({...me,parent:{...me.parent,email:d.parent.email,primaryLogin:H.primaryLogin||H.customUsername,secondaryLogin:H.secondaryLogin,customUsername:H.customUsername,password:se,userId:re,canLoginWithEmail:H.canLoginWithEmail,canLoginWithPhone:H.canLoginWithPhone},students:y}))}else _(H=>({...H,students:y}))},ke=y=>{const H={active:{label:"Actif",className:"bg-success/10 text-success"},pending:{label:"En attente",className:"bg-warning/10 text-warning"},transferred:{label:"TransfÃ©rÃ©",className:"bg-muted text-muted-foreground"}},se=(H==null?void 0:H[y])||(H==null?void 0:H.active);return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-caption font-caption-normal ${se==null?void 0:se.className}`,children:se==null?void 0:se.label})},ue=V==null?void 0:V.filter(y=>{var me,he,fe,h,$,te;const H=((he=(me=y==null?void 0:y.name)==null?void 0:me.toLowerCase())==null?void 0:he.includes(g==null?void 0:g.toLowerCase()))||((h=(fe=y==null?void 0:y.parentName)==null?void 0:fe.toLowerCase())==null?void 0:h.includes(g==null?void 0:g.toLowerCase()))||((te=($=y==null?void 0:y.studentId)==null?void 0:$.toLowerCase())==null?void 0:te.includes(g==null?void 0:g.toLowerCase())),se=!s||(y==null?void 0:y.class)===s,re=!n||(y==null?void 0:y.enrollmentStatus)===n;return H&&se&&re}),De=y=>{const H=V.find(se=>se.id===y);H&&(P(H),D(!0))},ee=y=>{const H=V.find(se=>se.id===y);H&&(P(H),k(!0))},ce=()=>{ne(),E(!0)},je=(y,H)=>{X(V.map(se=>se.id===y?{...se,enrollmentStatus:H}:se))},ze=()=>{C&&(je(C.id,"transferred"),D(!1),P(null))};return b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"Chargement des Ã©lÃ¨ves..."})]})}):e.jsxs("div",{className:"space-y-6",children:[V.length===0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(a,{name:"Info",size:20,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-body font-body-semibold text-blue-900 mb-1",children:"Aucun Ã©lÃ¨ve enregistrÃ©"}),e.jsx("p",{className:"text-sm text-blue-700",children:`Aucun Ã©lÃ¨ve n'a encore Ã©tÃ© inscrit. Cliquez sur "Nouvel Ã‰lÃ¨ve" pour commencer les inscriptions.`})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-bold text-xl text-text-primary",children:"Gestion des Ã‰lÃ¨ves"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary mt-1",children:"GÃ©rez les inscriptions et profils des Ã©lÃ¨ves"})]}),e.jsx(j,{variant:"default",iconName:"UserPlus",iconPosition:"left",onClick:ce,children:"Nouvel Ã‰lÃ¨ve"})]}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(K,{type:"search",placeholder:"Rechercher par nom, parent ou ID...",value:g,onChange:y=>{var H;return l((H=y==null?void 0:y.target)==null?void 0:H.value)},className:"w-full"}),e.jsx(oe,{placeholder:"Filtrer par classe",options:f,value:s,onChange:o}),e.jsx(oe,{placeholder:"Filtrer par statut",options:W,value:n,onChange:t})]})}),e.jsxs("div",{className:"bg-card rounded-lg border border-border overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Ã‰lÃ¨ve"}),e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Classe"}),e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Parent/Tuteur"}),e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Statut"}),e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Date d'inscription"}),e.jsx("th",{className:"text-right p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Actions"})]})}),e.jsx("tbody",{children:ue==null?void 0:ue.map(y=>e.jsxs("tr",{className:"border-t border-border hover:bg-muted/50 transition-micro",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-muted",children:e.jsx(He,{src:y==null?void 0:y.photo,alt:y==null?void 0:y.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-semibold text-sm text-text-primary",children:y==null?void 0:y.name}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["ID: ",y==null?void 0:y.studentId]})]})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"font-body font-body-normal text-sm text-text-primary",children:y==null?void 0:y.class})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-semibold text-sm text-text-primary",children:y==null?void 0:y.parentName}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:y==null?void 0:y.parentPhone}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:y==null?void 0:y.parentEmail})]})}),e.jsx("td",{className:"p-4",children:ke(y==null?void 0:y.enrollmentStatus)}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"font-body font-body-normal text-sm text-text-primary",children:y==null?void 0:y.enrollmentDate})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>ee(y==null?void 0:y.id),title:"Voir le profil",iconName:"Eye"}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>De(y==null?void 0:y.id),title:"TransfÃ©rer l'Ã©lÃ¨ve",iconName:"ArrowRightLeft"})]})})]},y==null?void 0:y.id))})]})}),(ue==null?void 0:ue.length)===0&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(a,{name:"Users",size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary",children:"Aucun Ã©lÃ¨ve trouvÃ© avec les critÃ¨res de recherche"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-success/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"UserCheck",size:20,className:"text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:(A=V==null?void 0:V.filter(y=>(y==null?void 0:y.enrollmentStatus)==="active"))==null?void 0:A.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Ã‰lÃ¨ves actifs"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-warning/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Clock",size:20,className:"text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:(le=V==null?void 0:V.filter(y=>(y==null?void 0:y.enrollmentStatus)==="pending"))==null?void 0:le.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"En attente"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Users",size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:V==null?void 0:V.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Total Ã©lÃ¨ves"})]})]})})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-5xl w-full max-h-[95vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center backdrop-blur-sm",children:e.jsx(a,{name:"UserPlus",size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Nouvelle Inscription Ã‰lÃ¨ve"}),e.jsxs("p",{className:"text-blue-100 text-sm mt-1",children:[z===1&&"Informations du parent/tuteur",z===2&&"Informations de l'Ã©lÃ¨ve",z===3&&"VÃ©rification et crÃ©ation des comptes"]})]})]}),e.jsx("button",{onClick:()=>{E(!1),ne()},className:"w-10 h-10 rounded-lg bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors",children:e.jsx(a,{name:"X",size:20,className:"text-white"})})]})}),e.jsx("div",{className:"px-6 py-6 bg-gray-50 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between max-w-2xl mx-auto",children:[{num:1,label:"Parent",icon:"User"},{num:2,label:"Ã‰lÃ¨ve",icon:"GraduationCap"},{num:3,label:"Validation",icon:"CheckCircle"}].map((y,H)=>e.jsxs(rs.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:`relative w-14 h-14 rounded-full flex items-center justify-center transition-all duration-300 ${y.num===z?"bg-blue-600 text-white shadow-lg shadow-blue-300 scale-110":y.num<z?"bg-green-500 text-white shadow-md":"bg-gray-200 text-gray-400"}`,children:[y.num<z?e.jsx(a,{name:"Check",size:24,className:"animate-scaleIn"}):e.jsx(a,{name:y.icon,size:24}),y.num===z&&e.jsx("div",{className:"absolute inset-0 rounded-full bg-blue-600 animate-ping opacity-20"})]}),e.jsx("span",{className:`mt-2 text-sm font-medium transition-colors ${y.num===z?"text-blue-600":y.num<z?"text-green-600":"text-gray-400"}`,children:y.label})]}),H<2&&e.jsx("div",{className:"flex-1 h-1 mx-4 mb-8 rounded-full overflow-hidden bg-gray-200",children:e.jsx("div",{className:`h-full transition-all duration-500 ${y.num<z?"bg-green-500 w-full":"bg-gray-200 w-0"}`})})]},y.num))})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-8",children:[z===1&&e.jsxs("div",{className:"space-y-8 max-w-4xl mx-auto",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Type d'inscription"}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"SÃ©lectionnez le type de parent pour cette inscription"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx("button",{onClick:()=>U("new"),className:`group relative overflow-hidden rounded-xl p-6 text-left transition-all duration-300 ${L==="new"?"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-500 shadow-lg shadow-blue-200":"bg-white border-2 border-gray-200 hover:border-blue-300 hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center transition-colors ${L==="new"?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-600 group-hover:bg-blue-100 group-hover:text-blue-600"}`,children:e.jsx(a,{name:"UserPlus",size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h5",{className:"font-semibold text-gray-900 mb-1 flex items-center",children:["Nouveau Parent",L==="new"&&e.jsx(a,{name:"CheckCircle",size:18,className:"ml-2 text-blue-600"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"CrÃ©er un nouveau compte parent pour cette famille"}),e.jsxs("div",{className:"mt-3 text-xs text-gray-500 flex items-center",children:[e.jsx(a,{name:"Info",size:14,className:"mr-1"}),"Premier enfant de la famille"]})]})]})}),e.jsx("button",{onClick:()=>U("existing"),className:`group relative overflow-hidden rounded-xl p-6 text-left transition-all duration-300 ${L==="existing"?"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-500 shadow-lg shadow-green-200":"bg-white border-2 border-gray-200 hover:border-green-300 hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center transition-colors ${L==="existing"?"bg-green-600 text-white shadow-md":"bg-gray-100 text-gray-600 group-hover:bg-green-100 group-hover:text-green-600"}`,children:e.jsx(a,{name:"Users",size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h5",{className:"font-semibold text-gray-900 mb-1 flex items-center",children:["Parent Existant",L==="existing"&&e.jsx(a,{name:"CheckCircle",size:18,className:"ml-2 text-green-600"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Associer l'Ã©lÃ¨ve Ã  un parent dÃ©jÃ  inscrit"}),e.jsxs("div",{className:"mt-3 text-xs text-gray-500 flex items-center",children:[e.jsx(a,{name:"Info",size:14,className:"mr-1"}),"FrÃ¨re/sÅ“ur d'un Ã©lÃ¨ve existant"]})]})]})})]})]}),L==="new"&&e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(a,{name:"User",size:20,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-1",children:"Informations du Parent/Tuteur"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Ces informations seront utilisÃ©es pour crÃ©er le compte parent. Le parent pourra se connecter avec son email ou son tÃ©lÃ©phone."}),e.jsx("div",{className:"bg-white/60 rounded-lg p-3 border border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(a,{name:"Info",size:16,className:"text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-xs text-gray-700",children:[e.jsx("strong",{children:"ðŸ“§ Email optionnel :"})," Si le parent n'a pas d'email, un email technique sera gÃ©nÃ©rÃ© automatiquement au format ",e.jsx("span",{className:"font-mono bg-blue-100 px-1 rounded",children:"parent[tÃ©lÃ©phone]@edutrack.cm"})]})]})})]})]})}),e.jsx("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["PrÃ©nom du parent ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(K,{placeholder:"Ex: Jean",value:d.parent.firstName,onChange:y=>_(H=>({...H,parent:{...H.parent,firstName:y.target.value}})),className:"h-11",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nom de famille ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(K,{placeholder:"Ex: Mbarga",value:d.parent.lastName,onChange:y=>_(H=>({...H,parent:{...H.parent,lastName:y.target.value}})),className:"h-11",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(a,{name:"Mail",size:18,className:"text-gray-400"})}),e.jsx(K,{type:"email",placeholder:"jean.mbarga@email.com (optionnel)",value:d.parent.email,onChange:y=>_(H=>({...H,parent:{...H.parent,email:y.target.value}})),className:"h-11 pl-10"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ðŸ’¡ Si non fourni, un email technique sera gÃ©nÃ©rÃ© automatiquement"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["TÃ©lÃ©phone ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(a,{name:"Phone",size:18,className:"text-gray-400"})}),e.jsx(K,{placeholder:"+237 6XX XX XX XX",value:d.parent.phone,onChange:y=>_(H=>({...H,parent:{...H.parent,phone:y.target.value}})),className:"h-11 pl-10",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adresse"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(a,{name:"MapPin",size:18,className:"text-gray-400"})}),e.jsx(K,{placeholder:"Quartier, Ville",value:d.parent.address,onChange:y=>_(H=>({...H,parent:{...H.parent,address:y.target.value}})),className:"h-11 pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Profession"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(a,{name:"Briefcase",size:18,className:"text-gray-400"})}),e.jsx(K,{placeholder:"Ex: Enseignant, CommerÃ§ant...",value:d.parent.occupation,onChange:y=>_(H=>({...H,parent:{...H.parent,occupation:y.target.value}})),className:"h-11 pl-10"})]})]})]})})]}),L==="existing"&&e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(a,{name:"Search",size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-1",children:"SystÃ¨me Multi-Ã‰tablissements"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Recherchez si le parent existe dÃ©jÃ  dans le systÃ¨me global pour Ã©viter les doublons."}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full bg-green-100 text-green-700 font-medium",children:[e.jsx(a,{name:"CheckCircle",size:14,className:"mr-1"}),"Un parent = Un compte"]}),e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full bg-blue-100 text-blue-700 font-medium",children:[e.jsx(a,{name:"Building",size:14,className:"mr-1"}),"Plusieurs Ã©tablissements"]}),e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full bg-purple-100 text-purple-700 font-medium",children:[e.jsx(a,{name:"Users",size:14,className:"mr-1"}),"Plusieurs enfants"]})]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-6",children:e.jsx(Ms,{onParentSelect:y=>{M(y),y&&_(H=>({...H,parent:{firstName:y.firstName,lastName:y.lastName,email:y.email,phone:y.phone,address:y.address||"",occupation:y.profession||"",username:"",password:"",userId:y.id}}))},onCreateNew:()=>{U("new"),M(null),x("")},selectedParent:B,searchTerm:w,onSearchChange:x})})]})]}),z===2&&e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 text-center border border-blue-200",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-3 shadow-lg shadow-blue-200",children:e.jsx(a,{name:"GraduationCap",size:32,className:"text-white"})}),e.jsx("h4",{className:"font-heading font-heading-semibold text-xl text-gray-900 mb-1",children:"Informations des Ã‰lÃ¨ves"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Ajoutez un ou plusieurs enfants Ã  inscrire dans cet Ã©tablissement",N&&e.jsxs("span",{className:"block mt-1 font-medium text-blue-700",children:["ðŸ“ ",N.name]})]})]}),O.length===0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(a,{name:"AlertTriangle",size:20,className:"text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-yellow-900 mb-1",children:"Aucune classe disponible"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Aucune classe n'a Ã©tÃ© configurÃ©e pour cet Ã©tablissement. Contactez l'administrateur pour configurer les classes disponibles."})]})]})}),d.students.map((y,H)=>e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 space-y-5 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"User",size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-heading font-heading-semibold text-base text-gray-900",children:["Ã‰lÃ¨ve ",H+1]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Informations scolaires"})]})]}),d.students.length>1&&e.jsxs("button",{onClick:()=>Ee(H),className:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(a,{name:"Trash2",size:14,className:"mr-1"}),"Supprimer"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["PrÃ©nom de l'Ã©lÃ¨ve ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(a,{name:"User",size:18,className:"text-gray-400"})}),e.jsx(K,{placeholder:"Ex: Marie",value:y.firstName,onChange:se=>{const re=[...d.students];re[H].firstName=se.target.value,_(me=>({...me,students:re}))},className:"h-11 pl-10",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nom de famille ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(a,{name:"User",size:18,className:"text-gray-400"})}),e.jsx(K,{placeholder:"Ex: Mbarga",value:y.lastName,onChange:se=>{const re=[...d.students];re[H].lastName=se.target.value,_(me=>({...me,students:re}))},className:"h-11 pl-10",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Classe ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none z-10",children:e.jsx(a,{name:"BookOpen",size:18,className:"text-gray-400"})}),e.jsx(oe,{options:O.map(se=>({value:se.name,label:se.name})),value:y.class,onChange:se=>{const re=[...d.students];re[H].class=se,_(me=>({...me,students:re}))},className:"h-11 pl-10",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Date de naissance ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(a,{name:"Calendar",size:18,className:"text-gray-400"})}),e.jsx(K,{type:"date",value:y.dateOfBirth,onChange:se=>{const re=[...d.students];re[H].dateOfBirth=se.target.value,_(me=>({...me,students:re}))},className:"h-11 pl-10",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Lieu de naissance ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(a,{name:"MapPin",size:18,className:"text-gray-400"})}),e.jsx(K,{type:"text",value:y.placeOfBirth||"",onChange:se=>{const re=[...d.students];re[H].placeOfBirth=se.target.value,_(me=>({...me,students:re}))},placeholder:"Ex: Douala, YaoundÃ©...",className:"h-11 pl-10",required:!0})]})]})]})]},`student-${H}-${y.firstName||"new"}`)),e.jsxs("button",{onClick:de,className:"w-full inline-flex items-center justify-center px-6 py-3.5 text-sm font-semibold text-blue-600 bg-blue-50 border-2 border-blue-200 border-dashed rounded-xl hover:bg-blue-100 hover:border-blue-300 transition-all duration-200",children:[e.jsx(a,{name:"Plus",size:18,className:"mr-2"}),"Ajouter un autre Ã©lÃ¨ve"]})]}),z===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(a,{name:"Shield",size:48,className:"text-success mx-auto mb-2"}),e.jsx("h4",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:"RÃ©capitulatif et CrÃ©ation des Comptes"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"VÃ©rifiez les informations et gÃ©nÃ©rez les comptes d'accÃ¨s"})]}),!((we=d.students[0])!=null&&we.customUsername)&&e.jsx("div",{className:"text-center",children:e.jsx(j,{onClick:Te,size:"lg",className:"mb-6",iconName:"Key",iconPosition:"left",children:L==="new"?"GÃ©nÃ©rer les Identifiants de Connexion":"GÃ©nÃ©rer les Identifiants des Ã‰lÃ¨ves"})}),((Ce=d.students[0])==null?void 0:Ce.customUsername)&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`border rounded-lg p-4 ${L==="new"?"bg-success/5 border-success/20":"bg-blue/5 border-blue/20"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${L==="new"?"bg-success/10":"bg-blue/10"}`,children:e.jsx(a,{name:"User",size:20,className:L==="new"?"text-success":"text-blue"})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-heading font-heading-medium text-base text-text-primary",children:L==="new"?"Nouveau Compte Parent":"Parent Existant"}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[d.parent.firstName," ",d.parent.lastName,L==="existing"&&B&&e.jsxs("span",{className:"ml-2 text-xs bg-blue/10 text-blue px-2 py-1 rounded",children:["DÃ©jÃ  inscrit â€¢ ",B.children.length," enfant(s)"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-background/50 rounded-lg p-3",children:[e.jsxs("h6",{className:"font-medium text-text-primary mb-2 flex items-center",children:[e.jsx(a,{name:"Key",size:16,className:"mr-2"}),"Options de Connexion"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[d.parent.canLoginWithEmail&&e.jsxs("div",{className:"flex items-center space-x-2 text-success",children:[e.jsx(a,{name:"Mail",size:14}),e.jsxs("span",{children:["Email: ",d.parent.primaryLogin]})]}),d.parent.canLoginWithPhone&&e.jsxs("div",{className:"flex items-center space-x-2 text-success",children:[e.jsx(a,{name:"Phone",size:14}),e.jsxs("span",{children:["TÃ©l: ",d.parent.phone]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-primary",children:[e.jsx(a,{name:"User",size:14}),e.jsxs("span",{children:["Username: ",d.parent.customUsername]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-text-secondary",children:"ID Utilisateur:"}),e.jsx("p",{className:"font-mono bg-background p-2 rounded border mt-1",children:d.parent.userId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-text-secondary",children:L==="new"?"Nouveau mot de passe:":"Mot de passe:"}),e.jsx("p",{className:"font-mono bg-background p-2 rounded border mt-1",children:L==="new"?d.parent.password:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}),L==="existing"&&e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Le parent utilisera son mot de passe existant"})]})]}),e.jsxs("div",{className:"bg-info/5 border border-info/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-text-primary font-medium mb-1",children:"ðŸ’¡ Comment se connecter :"}),e.jsxs("ul",{className:"text-xs text-text-secondary space-y-1",children:[d.parent.canLoginWithEmail&&e.jsxs("li",{children:["â€¢ Peut utiliser son ",e.jsx("strong",{children:"email"})," + mot de passe"]}),d.parent.canLoginWithPhone&&e.jsxs("li",{children:["â€¢ Peut utiliser son ",e.jsx("strong",{children:"numÃ©ro de tÃ©lÃ©phone"})," + mot de passe"]}),e.jsxs("li",{children:["â€¢ Peut utiliser le ",e.jsx("strong",{children:"nom d'utilisateur"})," personnalisÃ© + mot de passe"]})]})]})]})]}),d.students.map((y,H)=>e.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"User",size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-heading font-heading-medium text-base text-text-primary",children:["Compte Ã‰lÃ¨ve ",H+1]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[y.firstName," ",y.lastName," - ",y.class]}),(y.dateOfBirth||y.placeOfBirth)&&e.jsxs("p",{className:"text-xs text-text-secondary mt-1",children:[y.dateOfBirth&&`NÃ©(e) le ${new Date(y.dateOfBirth).toLocaleDateString("fr-FR")}`,y.dateOfBirth&&y.placeOfBirth&&" Ã  ",y.placeOfBirth]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-background/50 rounded-lg p-3",children:[e.jsxs("h6",{className:"font-medium text-text-primary mb-2 flex items-center",children:[e.jsx(a,{name:"Key",size:16,className:"mr-2"}),"Identifiant de Connexion"]}),e.jsxs("div",{className:"flex items-center space-x-2 text-primary text-sm",children:[e.jsx(a,{name:"User",size:14}),e.jsx("span",{className:"font-mono",children:y.customUsername})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-text-secondary",children:"ID Ã‰lÃ¨ve:"}),e.jsx("p",{className:"font-mono bg-background p-2 rounded border mt-1",children:y.studentId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-text-secondary",children:"Mot de passe:"}),e.jsx("p",{className:"font-mono bg-background p-2 rounded border mt-1",children:y.password})]})]}),e.jsxs("div",{className:"bg-info/5 border border-info/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-text-primary font-medium mb-1",children:"ðŸŽ’ Comment l'Ã©lÃ¨ve se connecte :"}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["Utiliser le ",e.jsx("strong",{children:"nom d'utilisateur personnalisÃ©"})," ci-dessus + le mot de passe"]})]})]})]},H)),e.jsx("div",{className:"bg-warning/5 border border-warning/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(a,{name:"AlertTriangle",size:20,className:"text-warning mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-text-primary mb-2",children:"ðŸ“‹ Instructions Importantes :"}),e.jsxs("div",{className:"text-sm text-text-secondary space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-text-primary",children:"Pour le Parent :"}),e.jsxs("ul",{className:"text-xs space-y-1 ml-4",children:[d.parent.canLoginWithEmail&&e.jsxs("li",{children:["â€¢ Peut se connecter avec son ",e.jsx("strong",{children:"email"})," + mot de passe"]}),d.parent.canLoginWithPhone&&e.jsxs("li",{children:["â€¢ Peut se connecter avec son ",e.jsx("strong",{children:"numÃ©ro de tÃ©lÃ©phone"})," + mot de passe"]}),e.jsxs("li",{children:["â€¢ Peut utiliser le ",e.jsx("strong",{children:"nom d'utilisateur personnalisÃ©"})," + mot de passe"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-text-primary",children:"Pour l'Ã‰lÃ¨ve :"}),e.jsxs("ul",{className:"text-xs space-y-1 ml-4",children:[e.jsxs("li",{children:["â€¢ Utilise uniquement le ",e.jsx("strong",{children:"nom d'utilisateur personnalisÃ©"})," + mot de passe"]}),e.jsx("li",{children:"â€¢ Identifiants spÃ©cialement crÃ©Ã©s pour les enfants"})]})]}),e.jsxs("p",{className:"bg-background p-2 rounded border text-xs",children:["ðŸ’¡ ",e.jsx("strong",{children:"Conseil :"})," Imprimez ou envoyez ces identifiants par email au parent. Les parents ont plusieurs options de connexion, les Ã©lÃ¨ves utilisent leur nom d'utilisateur personnalisÃ©."]})]})]})]})})]})]})]})}),e.jsx("div",{className:"bg-gray-50 border-t border-gray-200 px-8 py-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:z>1?e.jsxs("button",{onClick:Y,className:"inline-flex items-center px-5 py-2.5 text-sm font-medium text-gray-700 bg-white border-2 border-gray-300 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all duration-200",children:[e.jsx(a,{name:"ChevronLeft",size:18,className:"mr-2"}),"PrÃ©cÃ©dent"]}):e.jsxs("button",{onClick:()=>{E(!1),ne()},className:"inline-flex items-center px-5 py-2.5 text-sm font-medium text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(a,{name:"X",size:18,className:"mr-2"}),"Annuler"]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[z>1&&e.jsx("button",{onClick:()=>{E(!1),ne()},className:"px-5 py-2.5 text-sm font-medium text-gray-600 hover:text-gray-800 transition-colors",children:"Annuler"}),z<3?e.jsxs("button",{onClick:F,disabled:z===1&&(L==="new"&&(!d.parent.firstName||!d.parent.lastName||!d.parent.phone)||L==="existing"&&!B)||z===2&&d.students.some(y=>!y.firstName||!y.lastName||!y.class),className:"inline-flex items-center px-6 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg shadow-blue-200 hover:shadow-xl disabled:shadow-none",children:["Continuer",e.jsx(a,{name:"ChevronRight",size:18,className:"ml-2"})]}):e.jsxs("button",{onClick:()=>{alert("Famille inscrite avec succÃ¨s ! Les comptes ont Ã©tÃ© crÃ©Ã©s."),E(!1),ne()},disabled:!((Ne=d.students[0])!=null&&Ne.customUsername),className:"inline-flex items-center px-6 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-green-600 to-emerald-600 rounded-lg hover:from-green-700 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg shadow-green-200 hover:shadow-xl disabled:shadow-none",children:[e.jsx(a,{name:"CheckCircle",size:18,className:"mr-2"}),"Finaliser l'Inscription"]})]})]})})]})}),T&&C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsxs("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:["Profil de ",C.name]}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>k(!1),iconName:"X"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-muted/30 rounded-lg",children:[e.jsx(He,{src:C.photo,alt:C.name,className:"w-16 h-16 rounded-full object-cover",fallback:"/public/assets/images/no_image.png"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:C.name}),e.jsxs("p",{className:"font-body font-body-normal text-sm text-text-secondary",children:["ID: ",C.studentId," â€¢ Classe: ",C.class]}),e.jsx("div",{className:"mt-2",children:ke(C.enrollmentStatus)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-heading font-heading-semibold text-md text-text-primary",children:"Informations Parent/Tuteur"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-muted/20 rounded-lg",children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary mb-1",children:"Nom"}),e.jsx("p",{className:"font-body font-body-medium text-sm text-text-primary",children:C.parentName})]}),e.jsxs("div",{className:"p-3 bg-muted/20 rounded-lg",children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary mb-1",children:"TÃ©lÃ©phone"}),e.jsx("p",{className:"font-body font-body-medium text-sm text-text-primary",children:C.parentPhone})]}),e.jsxs("div",{className:"md:col-span-2 p-3 bg-muted/20 rounded-lg",children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary mb-1",children:"Email"}),e.jsx("p",{className:"font-body font-body-medium text-sm text-text-primary",children:C.parentEmail})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-heading font-heading-semibold text-md text-text-primary",children:"Actions rapides"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[C.enrollmentStatus==="pending"&&e.jsx(j,{variant:"outline",size:"sm",iconName:"CheckCircle",onClick:()=>{je(C.id,"active"),P({...C,enrollmentStatus:"active"})},children:"Valider inscription"}),e.jsx(j,{variant:"outline",size:"sm",iconName:"Phone",onClick:()=>window.open(`tel:${C.parentPhone}`,"_self"),children:"Appeler parent"}),e.jsx(j,{variant:"outline",size:"sm",iconName:"Mail",onClick:()=>window.open(`mailto:${C.parentEmail}`,"_self"),children:"Envoyer email"})]})]})]}),e.jsx("div",{className:"flex gap-3 p-6 border-t border-border",children:e.jsx(j,{variant:"outline",onClick:()=>k(!1),children:"Fermer"})})]})}),u&&C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:"Confirmer le transfert"}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>D(!1),iconName:"X"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-warning/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"AlertTriangle",size:24,className:"text-warning"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-body font-body-medium text-sm text-text-primary",children:["TransfÃ©rer ",C.name," ?"]}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:`L'Ã©lÃ¨ve sera marquÃ© comme "TransfÃ©rÃ©"`})]})]}),e.jsx("div",{className:"bg-muted/30 rounded-lg p-4",children:e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"âš ï¸ Cette action marquera l'Ã©lÃ¨ve comme transfÃ©rÃ© vers une autre Ã©cole. L'Ã©lÃ¨ve n'apparaÃ®tra plus dans les listes actives."})})]}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-border",children:[e.jsx(j,{variant:"default",onClick:ze,children:"Confirmer le transfert"}),e.jsx(j,{variant:"outline",onClick:()=>D(!1),children:"Annuler"})]})]})})]})},Rs=({onTeacherSelect:g,onCreateNew:l,selectedTeacher:s})=>{const[o,n]=c.useState([]),[t,i]=c.useState(!0);c.useEffect(()=>{(async()=>{i(!0);try{const{data:D,error:C}=await Z.from("users").select(`
            id,
            full_name,
            email,
            phone,
            role
          `).eq("role","teacher").order("full_name",{ascending:!0});if(C){console.error("Erreur chargement enseignants:",C),n([]);return}const P=(D||[]).map(b=>{var I,N;return{id:b.id,fullName:b.full_name||"Nom inconnu",firstName:((I=b.full_name)==null?void 0:I.split(" ")[0])||"",lastName:((N=b.full_name)==null?void 0:N.split(" ").slice(1).join(" "))||"",email:b.email||"",phone:b.phone||"",specializations:[],assignments:[],totalSchools:0,totalWeeklyHours:0,availableHours:40}});n(P),console.log(`âœ… ${P.length} enseignant(s) chargÃ©(s)`)}catch(D){console.error("Exception chargement enseignants:",D),n([])}finally{i(!1)}})()},[]);const E=u=>{const D=u.target.value;if(!D){g(null);return}const C=o.find(P=>P.id===D);C&&g(C)},T=u=>!u||u.length===0?null:u.map((D,C)=>e.jsx("span",{className:"inline-block px-2 py-1 bg-primary/10 text-primary text-xs rounded-full mr-1 mb-1",children:D},C)),k=u=>!u.assignments||u.assignments.length===0?"Aucune assignation active":(u.assignments.map(D=>D.school.name).join(", "),`${u.assignments.length} Ã©tablissement(s) â€¢ ${u.totalWeeklyHours}h/semaine`);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-text-primary mb-2",children:"SÃ©lectionner un enseignant"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:(s==null?void 0:s.id)||"",onChange:E,disabled:t,className:"w-full px-4 py-3 pr-10 border border-border rounded-xl bg-background text-text-primary focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:t?"Chargement des enseignants...":"-- Choisir un enseignant --"}),o.map(u=>e.jsxs("option",{value:u.id,children:[u.fullName," ",u.email?`(${u.email})`:""]},u.id))]}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:t?e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-primary border-t-transparent rounded-full"}):e.jsx(a,{name:"ChevronDown",size:20,className:"text-muted-foreground"})})]}),!t&&e.jsxs("p",{className:"text-xs text-text-tertiary flex items-center gap-1",children:[e.jsx(a,{name:"Users",size:12}),o.length," enseignant(s) disponible(s)"]})]}),s&&e.jsxs("div",{className:"bg-success/5 border border-success/20 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-success/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"UserCheck",size:24,className:"text-success"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-base text-text-primary",children:s.fullName||`${s.firstName} ${s.lastName}`}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[s.email," ",s.phone&&`â€¢ ${s.phone}`]}),s.specializations&&s.specializations.length>0&&e.jsx("div",{className:"mt-2",children:T(s.specializations)}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:k(s)})]})]}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>g(null),className:"text-muted-foreground hover:text-text-primary",children:e.jsx(a,{name:"X",size:16})})]}),s.assignments&&s.assignments.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-success/20",children:[e.jsx("h5",{className:"font-medium text-sm text-text-primary mb-2",children:"Assignations actuelles :"}),e.jsx("div",{className:"space-y-2",children:s.assignments.map((u,D)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:u.school.name}),e.jsxs("span",{className:"text-text-secondary ml-2",children:["(",u.classes.join(", "),")"]})]}),e.jsxs("span",{className:"bg-background px-2 py-1 rounded text-text-secondary",children:[u.weeklyHours,"h/sem"]})]},D))}),e.jsxs("div",{className:"mt-3 p-2 bg-background/50 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:"DisponibilitÃ© restante :"}),e.jsxs("span",{className:`font-medium ${s.availableHours>10?"text-success":s.availableHours>5?"text-warning":"text-error"}`,children:[s.availableHours,"h/semaine"]})]}),e.jsx("div",{className:"w-full bg-border rounded-full h-2 mt-1",children:e.jsx("div",{className:`h-2 rounded-full ${s.availableHours>10?"bg-success":s.availableHours>5?"bg-warning":"bg-error"}`,style:{width:`${s.availableHours/40*100}%`}})})]})]})]}),!t&&o.length===0&&e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 text-center",children:[e.jsx(a,{name:"UserX",size:48,className:"text-muted-foreground mx-auto mb-3"}),e.jsx("h4",{className:"font-heading font-heading-semibold text-base text-text-primary mb-2",children:"Aucun enseignant disponible"}),e.jsx("p",{className:"text-sm text-text-secondary mb-4",children:"Il n'y a pas encore d'enseignant enregistrÃ© dans le systÃ¨me"}),e.jsx(j,{variant:"outline",onClick:l,className:"w-full",iconName:"UserPlus",iconPosition:"left",children:"CrÃ©er un nouveau compte enseignant"})]}),e.jsx("div",{className:"bg-blue/5 border border-blue/20 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(a,{name:"Info",size:16,className:"text-blue mt-0.5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium text-text-primary mb-1",children:"ðŸ« SystÃ¨me Multi-Ã‰tablissements"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Un enseignant peut travailler dans plusieurs Ã©tablissements avec un seul compte. SÃ©lectionnez un enseignant existant pour l'assigner Ã  votre Ã©tablissement."})]})]})})]})},qe=rs.forwardRef(({className:g,id:l,checked:s,indeterminate:o=!1,disabled:n=!1,required:t=!1,label:i,description:E,error:T,size:k="default",...u},D)=>{var b,I;const C=l||`checkbox-${(I=(b=Math.random())==null?void 0:b.toString(36))==null?void 0:I.substr(2,9)}`,P={sm:"h-4 w-4",default:"h-4 w-4",lg:"h-5 w-5"};return e.jsxs("div",{className:We("flex items-start space-x-2",g),children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"checkbox",ref:D,id:C,checked:s,disabled:n,required:t,className:"sr-only",...u}),e.jsxs("label",{htmlFor:C,className:We("peer shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground cursor-pointer transition-colors",P==null?void 0:P[k],s&&"bg-primary text-primary-foreground border-primary",o&&"bg-primary text-primary-foreground border-primary",T&&"border-destructive",n&&"cursor-not-allowed opacity-50"),children:[s&&!o&&e.jsx(vs,{className:"h-3 w-3 text-current flex items-center justify-center"}),o&&e.jsx(ys,{className:"h-3 w-3 text-current flex items-center justify-center"})]})]}),(i||E||T)&&e.jsxs("div",{className:"flex-1 space-y-1",children:[i&&e.jsxs("label",{htmlFor:C,className:We("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",T?"text-destructive":"text-foreground"),children:[i,t&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),E&&!T&&e.jsx("p",{className:"text-sm text-muted-foreground",children:E}),T&&e.jsx("p",{className:"text-sm text-destructive",children:T})]})]})});qe.displayName="Checkbox";const qs=rs.forwardRef(({className:g,children:l,label:s,description:o,error:n,required:t=!1,disabled:i=!1,...E},T)=>e.jsxs("fieldset",{ref:T,disabled:i,className:We("space-y-3",g),...E,children:[s&&e.jsxs("legend",{className:We("text-sm font-medium",n?"text-destructive":"text-foreground"),children:[s,t&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),o&&!n&&e.jsx("p",{className:"text-sm text-muted-foreground",children:o}),e.jsx("div",{className:"space-y-2",children:l}),n&&e.jsx("p",{className:"text-sm text-destructive",children:n})]}));qs.displayName="CheckboxGroup";const Ls=({teacher:g,currentSchool:l,onAssignmentComplete:s,onCancel:o})=>{const[n,t]=c.useState([]),[i,E]=c.useState([]),[T,k]=c.useState(!1),[u,D]=c.useState(""),[C,P]=c.useState({subjects:[],classes:[],weeklyHours:0,startDate:new Date().toISOString().split("T")[0],endDate:"2025-06-30"}),[b,I]=c.useState({}),[N,v]=c.useState(!1);c.useEffect(()=>{(async()=>{if(l!=null&&l.id)try{const{data:d,error:_}=await Z.from("schools").select("available_classes, type, custom_subjects").eq("id",l.id).single();if(_){console.error("Erreur chargement donnÃ©es Ã©cole:",_);return}if(d!=null&&d.available_classes&&Array.isArray(d.available_classes)){const{data:S,error:Q}=await Z.from("students").select("current_class, class_name").eq("school_id",l.id).eq("is_active",!0);Q&&console.error("Erreur chargement Ã©lÃ¨ves:",Q);const r={};S&&S.forEach(W=>{const G=W.class_name||W.current_class;G&&(r[G]=(r[G]||0)+1)});const f=d.available_classes.map((W,G)=>({id:`class-${G}`,name:W,studentsCount:r[W]||0}));t(f),console.log(`âœ… ${f.length} classe(s) chargÃ©e(s)`),console.log("ðŸ“Š Comptage Ã©lÃ¨ves par classe:",r)}const J=O(d.type),ae=(d.custom_subjects||[]).map(S=>({id:`custom-${S}`,name:S})),V=new Map;[...J,...ae].forEach(S=>{V.has(S.name)||V.set(S.name,S)});const X=Array.from(V.values());E(X),console.log(`âœ… ${X.length} matiÃ¨re(s) disponible(s) (sans doublons)`)}catch(d){console.error("Exception chargement donnÃ©es Ã©cole:",d)}})()},[l==null?void 0:l.id]);const O=x=>{const d={Maternelle:["Ã‰veil","PsychomotricitÃ©","Langage","Arts plastiques","Musique","Jeux Ã©ducatifs"],Primaire:["MathÃ©matiques","FranÃ§ais","Lecture","Ã‰criture","Histoire","GÃ©ographie","Sciences","Ã‰ducation Civique et Morale","Arts Plastiques","Musique","Ã‰ducation Physique et Sportive","Anglais","Informatique","Travaux Manuels","HygiÃ¨ne et SantÃ©","BibliothÃ¨que"],CollÃ¨ge:["MathÃ©matiques","FranÃ§ais","Anglais","Histoire-GÃ©ographie","Sciences de la Vie et de la Terre","Physique-Chimie","Technologie","Ã‰ducation Physique et Sportive","Arts Plastiques","Musique","Ã‰ducation Civique","Espagnol","Allemand","Informatique"],"LycÃ©e GÃ©nÃ©ral":["MathÃ©matiques","FranÃ§ais","Philosophie","Histoire-GÃ©ographie","Anglais","Espagnol","Allemand","Physique-Chimie","Sciences de la Vie et de la Terre","Sciences Ã‰conomiques et Sociales","Ã‰ducation Physique et Sportive","Arts Plastiques","Musique","NSI (NumÃ©rique et Sciences Informatiques)","SI (Sciences de l'IngÃ©nieur)","HGGSP","HLP","LLCER","Biologie-Ã‰cologie","MathÃ©matiques Expertes"],"LycÃ©e Technique":["MathÃ©matiques","FranÃ§ais","Anglais","Histoire-GÃ©ographie","Physique-Chimie","Ã‰lectrotechnique","MÃ©canique","GÃ©nie Civil","Informatique","Ã‰conomie-Gestion","Construction","CAO/DAO","Automatisme","Sciences de l'IngÃ©nieur","TÃ©lÃ©communications","Maintenance","Ã‰nergie","Ã‰ducation Physique et Sportive"],"LycÃ©e Professionnel":["MathÃ©matiques","FranÃ§ais","Anglais","Histoire-GÃ©ographie","Commerce","Vente","ComptabilitÃ©","SecrÃ©tariat","Cuisine","HÃ´tellerie","Coiffure","EsthÃ©tique","MÃ©canique Auto","Ã‰lectricitÃ©","Menuiserie","Soudure","Mode","Agriculture"]};return(d[x]||d.CollÃ¨ge).map((J,ae)=>({id:`default-${ae}`,name:J}))};c.useEffect(()=>{(()=>{let d=0;C.subjects.forEach(_=>{const J=b[_]||2;d+=C.classes.length*J}),P(_=>({..._,weeklyHours:d}))})()},[C.subjects,C.classes,b]);const p=(x,d)=>{P(_=>({..._,subjects:d?[..._.subjects,x]:_.subjects.filter(J=>J!==x)})),d&&!b[x]&&I(_=>({..._,[x]:2}))},z=(x,d)=>{const _=parseInt(d)||0;I(J=>({...J,[x]:_}))},R=(x,d)=>{P(_=>({..._,classes:d?[..._.classes,x]:_.classes.filter(J=>J!==x)}))},L=async()=>{if(!u.trim()){alert("Veuillez entrer le nom de la matiÃ¨re");return}if(i.some(x=>x.name.toLowerCase()===u.trim().toLowerCase())){alert("Cette matiÃ¨re existe dÃ©jÃ ");return}try{const{data:x,error:d}=await Z.from("schools").select("custom_subjects").eq("id",l.id).single();if(d){console.error("âŒ Erreur rÃ©cupÃ©ration matiÃ¨res:",d),alert("Erreur lors de la rÃ©cupÃ©ration des matiÃ¨res");return}const J=[...x.custom_subjects||[],u.trim()],{error:ae}=await Z.from("schools").update({custom_subjects:J}).eq("id",l.id);if(ae){console.error("âŒ Erreur sauvegarde matiÃ¨re:",ae),alert("Erreur lors de la sauvegarde de la matiÃ¨re");return}const V={id:`custom-${Date.now()}`,name:u.trim()};E([...i,V]),D(""),k(!1),console.log("âœ… MatiÃ¨re ajoutÃ©e et sauvegardÃ©e:",V.name)}catch(x){console.error("Exception ajout matiÃ¨re:",x),alert("Erreur lors de l'ajout de la matiÃ¨re")}},U=async()=>{var x,d;if(C.subjects.length===0||C.classes.length===0){alert("Veuillez sÃ©lectionner au moins une matiÃ¨re et une classe.");return}v(!0);try{let _=g.id;if(g.isNew){const{data:f,error:W}=await Z.auth.signUp({email:g.email,password:g.password||"TempPass123!",options:{data:{full_name:g.fullName,role:"teacher"}}});if(W){console.error("Erreur crÃ©ation compte Auth:",W),alert("Erreur lors de la crÃ©ation du compte: "+W.message),v(!1);return}_=f.user.id;const{error:G}=await Z.from("users").insert({id:_,email:g.email,full_name:g.fullName,phone:g.phone,role:"teacher",created_at:new Date().toISOString()});if(G){console.error("Erreur crÃ©ation utilisateur:",G),alert("Erreur lors de la crÃ©ation de l'utilisateur: "+G.message),v(!1);return}const{data:q,error:m}=await Z.from("teachers").insert({user_id:_,school_id:l.id,first_name:g.fullName.split(" ")[0],last_name:g.fullName.split(" ").slice(1).join(" ")||g.fullName.split(" ")[0],is_active:!0,hire_date:C.startDate}).select("id").single();if(m){console.error("Erreur crÃ©ation enseignant dans teachers:",m),alert("Erreur lors de la crÃ©ation de l'enseignant: "+m.message),v(!1);return}_=q.id,console.log("âœ… Enseignant crÃ©Ã© dans teachers avec ID:",_),console.log("âœ… Nouvel enseignant crÃ©Ã© avec l'ID:",_)}const{data:J,error:ae}=await Z.from("academic_years").select("id").eq("school_id",l.id).eq("is_current",!0).single();if(ae||!J){console.warn("âš ï¸ Aucune annÃ©e acadÃ©mique active trouvÃ©e, crÃ©ation sans annÃ©e acadÃ©mique"),alert("Aucune annÃ©e acadÃ©mique active trouvÃ©e pour cet Ã©tablissement. Veuillez d'abord configurer l'annÃ©e acadÃ©mique."),v(!1);return}const V=J.id;if(console.log("âœ… AnnÃ©e acadÃ©mique:",V),!g.isNew){const{data:f,error:W}=await Z.from("teachers").select("id").eq("user_id",_).maybeSingle();if(!f&&!W){console.log("âš ï¸ Enseignant existant mais pas dans la table teachers, crÃ©ation...");const{data:G,error:q}=await Z.from("teachers").insert({user_id:_,school_id:l.id,first_name:((x=g.fullName)==null?void 0:x.split(" ")[0])||"PrÃ©nom",last_name:((d=g.fullName)==null?void 0:d.split(" ").slice(1).join(" "))||"Nom",is_active:!0,hire_date:C.startDate}).single();if(q){console.error("Erreur crÃ©ation enseignant:",q),alert("Erreur: Cet enseignant doit d'abord Ãªtre enregistrÃ© dans la table teachers."),v(!1);return}_=G.id,console.log("âœ… Enseignant ajoutÃ© Ã  la table teachers avec ID:",_)}else f&&(_=f.id,console.log("âœ… Enseignant trouvÃ© dans teachers avec ID:",_))}const X=[],S=f=>b[f]||2;for(const f of C.classes)for(const W of C.subjects)X.push({teacher_id:_,school_id:l.id,academic_year_id:V,class_id:null,subject_id:null,class_name:f,subject_name:W,is_active:!0,start_date:C.startDate,end_date:C.endDate,schedule:{weekly_hours:S(W)}});const{data:Q,error:r}=await Z.from("teacher_assignments").insert(X).select();if(r){console.error("Erreur crÃ©ation assignation:",r),alert("Erreur lors de la crÃ©ation de l'assignation: "+r.message),v(!1);return}console.log("âœ… Assignation(s) crÃ©Ã©e(s):",Q.length),s({...C,teacher_id:_,school_id:l.id,assignments:Q})}catch(_){console.error("Exception:",_),alert("Une erreur est survenue: "+_.message)}finally{v(!1)}},B=()=>{const x=n.filter(_=>C.classes.includes(_.name)),d=x.reduce((_,J)=>_+J.studentsCount,0);return{selectedClasses:x,totalStudents:d}},{selectedClasses:M,totalStudents:w}=B();return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"User",size:24,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-base text-text-primary",children:g.fullName||`${g.firstName||""} ${g.lastName||""}`.trim()}),e.jsxs("p",{className:"text-sm text-text-secondary",children:[g.email," ",g.phone&&`â€¢ ${g.phone}`]}),(g.subjects||g.specializations)&&(g.subjects||g.specializations).length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:(g.subjects||g.specializations||[]).map((x,d)=>e.jsx("span",{className:"bg-primary/10 text-primary text-xs px-2 py-1 rounded-full",children:x},d))})]})]})}),e.jsx("div",{className:"bg-background-secondary border border-border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-secondary/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Building",size:20,className:"text-secondary"})}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-heading font-heading-semibold text-sm text-text-primary",children:"Ã‰tablissement de rattachement"}),e.jsx("p",{className:"text-sm text-text-secondary",children:(l==null?void 0:l.name)||"Ã‰tablissement non dÃ©fini"}),e.jsx("p",{className:"text-xs text-text-tertiary",children:"L'enseignant sera assignÃ© Ã  votre Ã©tablissement"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h5",{className:"font-heading font-heading-semibold text-md text-text-primary",children:"PÃ©riode d'assignation"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(K,{label:"Date de dÃ©but",type:"date",value:C.startDate,onChange:x=>P(d=>({...d,startDate:x.target.value})),required:!0}),e.jsx(K,{label:"Date de fin",type:"date",value:C.endDate,onChange:x=>P(d=>({...d,endDate:x.target.value})),required:!0})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h5",{className:"font-heading font-heading-semibold text-md text-text-primary",children:"RÃ©sumÃ© de la charge"}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-text-secondary",children:"Classes assignÃ©es:"}),e.jsx("span",{className:"font-medium text-text-primary",children:C.classes.length})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-text-secondary",children:"MatiÃ¨res enseignÃ©es:"}),e.jsx("span",{className:"font-medium text-text-primary",children:C.subjects.length})]}),C.subjects.length>0&&e.jsxs("div",{className:"border-t border-border pt-2",children:[e.jsx("p",{className:"text-xs text-text-secondary mb-2",children:"Heures par matiÃ¨re (par classe):"}),e.jsx("div",{className:"space-y-1",children:C.subjects.map((x,d)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-text-secondary",children:[x,":"]}),e.jsxs("span",{className:"font-medium text-text-primary",children:[b[x]||2,"h Ã— ",C.classes.length," classe(s) = ",(b[x]||2)*C.classes.length,"h"]})]},d))})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-text-secondary",children:"Total Ã©lÃ¨ves:"}),e.jsx("span",{className:"font-medium text-text-primary",children:w})]}),e.jsx("div",{className:"border-t border-border pt-2",children:e.jsxs("div",{className:"flex justify-between text-base",children:[e.jsx("span",{className:"font-medium text-text-primary",children:"Total heures/semaine:"}),e.jsxs("span",{className:"font-bold text-primary",children:[C.weeklyHours,"h"]})]})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-text-secondary",children:"Charge de travail"}),e.jsx("span",{className:`${C.weeklyHours>25?"text-error":C.weeklyHours>15?"text-warning":"text-success"}`,children:C.weeklyHours>25?"Ã‰levÃ©e":C.weeklyHours>15?"ModÃ©rÃ©e":"LÃ©gÃ¨re"})]}),e.jsx("div",{className:"w-full bg-border rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${C.weeklyHours>25?"bg-error":C.weeklyHours>15?"bg-warning":"bg-success"}`,style:{width:`${Math.min(C.weeklyHours/40*100,100)}%`}})})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-heading font-heading-semibold text-md text-text-primary mb-3 flex items-center gap-2",children:[e.jsx(a,{name:"BookOpen",size:18,className:"text-primary"}),"MatiÃ¨res Ã  enseigner"]}),e.jsx("p",{className:"text-xs text-text-tertiary mb-3",children:"SÃ©lectionnez les matiÃ¨res et dÃ©finissez le nombre d'heures par semaine pour chaque matiÃ¨re"}),e.jsx("div",{className:"space-y-2",children:i.map((x,d)=>e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border transition-all ${C.subjects.includes(x.name)?"bg-primary/5 border-primary/30":"bg-muted/20 border-border hover:border-primary/20"}`,children:[e.jsx(qe,{id:`subject-${x.id||d}`,checked:C.subjects.includes(x.name),onChange:_=>p(x.name,_.target.checked)}),e.jsx("label",{htmlFor:`subject-${x.id||d}`,className:"flex-1 text-sm font-medium text-text-primary cursor-pointer",children:x.name}),C.subjects.includes(x.name)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{type:"number",min:"1",max:"10",value:b[x.name]||2,onChange:_=>z(x.name,_.target.value),className:"w-16 text-center text-sm",placeholder:"2"}),e.jsx("span",{className:"text-xs text-text-secondary whitespace-nowrap",children:"h/sem"})]})]},x.id||d))}),C.subjects.length>0&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(a,{name:"Info",size:14,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-xs text-blue-700",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Heures configurÃ©es :"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.subjects.map((x,d)=>e.jsxs("span",{className:"bg-blue-100 px-2 py-0.5 rounded",children:[x,": ",b[x]||2,"h"]},d))})]})]})}),i.length===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-text-secondary",children:"Aucune matiÃ¨re disponible pour cet Ã©tablissement"})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-heading font-heading-semibold text-md text-text-primary mb-3",children:"Classes Ã  enseigner"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:n.map((x,d)=>e.jsx("div",{className:`border border-border rounded-lg p-3 cursor-pointer transition-colors ${C.classes.includes(x.name)?"bg-primary/5 border-primary/30":"hover:bg-muted/30"}`,onClick:()=>R(x.name,!C.classes.includes(x.name)),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(qe,{id:`class-${d}`,checked:C.classes.includes(x.name),onChange:_=>R(x.name,_.target.checked)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-text-primary",children:x.name}),e.jsxs("p",{className:"text-xs text-text-secondary",children:[x.studentsCount," Ã©lÃ¨ves"]})]})]}),C.classes.includes(x.name)&&e.jsx(a,{name:"Check",size:16,className:"text-primary"})]})},d))}),n.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(a,{name:"School",size:48,className:"text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Aucune classe disponible pour cet Ã©tablissement"})]})]}),M.length>0&&e.jsxs("div",{className:"bg-success/5 border border-success/20 rounded-lg p-4",children:[e.jsxs("h5",{className:"font-medium text-sm text-text-primary mb-3 flex items-center",children:[e.jsx(a,{name:"CheckCircle",size:16,className:"text-success mr-2"}),"Classes sÃ©lectionnÃ©es (",M.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:M.map((x,d)=>e.jsxs("div",{className:"bg-background/50 rounded p-2 text-center",children:[e.jsx("p",{className:"font-medium text-xs text-text-primary",children:x.name}),e.jsxs("p",{className:"text-xs text-text-secondary",children:[x.studentsCount," Ã©lÃ¨ves"]})]},d))})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-border",children:[e.jsx(j,{onClick:U,disabled:N||C.subjects.length===0||C.classes.length===0,iconName:"Check",iconPosition:"left",children:N?"CrÃ©ation en cours...":"CrÃ©er l'assignation"}),e.jsx(j,{variant:"outline",onClick:o,disabled:N,children:"Annuler"})]}),C.weeklyHours>25&&e.jsx("div",{className:"bg-warning/5 border border-warning/20 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(a,{name:"AlertTriangle",size:16,className:"text-warning mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-text-primary",children:"âš ï¸ Charge de travail Ã©levÃ©e"}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["Cette assignation reprÃ©sente ",C.weeklyHours,"h/semaine, ce qui peut Ãªtre considÃ©rÃ© comme une charge Ã©levÃ©e."]})]})]})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-card rounded-lg border border-border w-full max-w-md",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-xl text-text-primary",children:"Ajouter une matiÃ¨re"}),e.jsx("button",{onClick:()=>{k(!1),D("")},className:"text-text-secondary hover:text-text-primary",children:e.jsx(a,{name:"X",size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-body font-body-medium text-text-secondary mb-2",children:"Nom de la matiÃ¨re *"}),e.jsx(K,{type:"text",placeholder:"Ex: Informatique, Biologie, etc.",value:u,onChange:x=>D(x.target.value),onKeyPress:x=>{x.key==="Enter"&&L()}}),e.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:"Cette matiÃ¨re sera ajoutÃ©e Ã  la liste des matiÃ¨res disponibles"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(a,{name:"Info",size:16,className:"text-blue-600 mt-0.5"}),e.jsxs("p",{className:"text-xs text-blue-700",children:[e.jsx("strong",{children:"Note :"})," Cette matiÃ¨re sera disponible pour tous les enseignants de votre Ã©tablissement."]})]})})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx(j,{variant:"outline",onClick:()=>{k(!1),D("")},className:"flex-1",children:"Annuler"}),e.jsx(j,{onClick:L,className:"flex-1",iconName:"Plus",iconPosition:"left",children:"Ajouter"})]})]})})})]})},$s=()=>{var y,H,se,re,me,he,fe;const[g,l]=c.useState(""),[s,o]=c.useState(""),[n,t]=c.useState(""),[i,E]=c.useState(!0),[T,k]=c.useState(!1),[u,D]=c.useState(!1),[C,P]=c.useState(null),[b,I]=c.useState(!1),[N,v]=c.useState(1),[O,p]=c.useState("existing"),[z,R]=c.useState(null),[L,U]=c.useState(""),[B,M]=c.useState(null),[w,x]=c.useState([]),[d,_]=c.useState([]),[J,ae]=c.useState(!1),[V,X]=c.useState(""),[S,Q]=c.useState({fullName:"",email:"",phone:"",subjects:[],classes:[],password:"",confirmPassword:""}),[r,f]=c.useState([]);c.useEffect(()=>{W(),m()},[]);const W=async()=>{try{const h=localStorage.getItem("edutrack-user"),$=h?JSON.parse(h):null,te=$==null?void 0:$.current_school_id;if(!te){console.warn("âš ï¸ Pas d'Ã©cole associÃ©e");return}const{data:ie,error:pe}=await Z.from("schools").select("id, name, type, available_classes, custom_subjects").eq("id",te).single();if(pe){console.error("âŒ Erreur chargement Ã©cole:",pe);return}if(M({id:ie.id,name:ie.name,type:ie.type}),console.log("âœ… Ã‰cole chargÃ©e:",ie.name),console.log("ðŸ“‹ Classes disponibles dans l'Ã©cole:",ie.available_classes),ie.available_classes&&Array.isArray(ie.available_classes)&&ie.available_classes.length>0){const Pe=ie.available_classes.map((Me,Ke)=>({id:`class-${Ke}`,name:Me,level:Me}));x(Pe),console.log(`âœ… ${Pe.length} classe(s) chargÃ©e(s) depuis available_classes`)}else{console.warn("âš ï¸ Aucune classe dans available_classes, utilisation des classes par dÃ©faut");const Pe=G(ie.type);x(Pe)}console.log("ðŸ“š Chargement des matiÃ¨res pour le type:",ie.type);const ve=q(ie.type);let be=[];ie.custom_subjects&&Array.isArray(ie.custom_subjects)&&ie.custom_subjects.length>0&&(be=ie.custom_subjects.map((Pe,Me)=>({id:`custom-${Me}`,name:Pe})),console.log(`âœ… ${be.length} matiÃ¨re(s) personnalisÃ©e(s) chargÃ©e(s)`));const Le=[...ve,...be];_(Le),console.log(`âœ… Total: ${Le.length} matiÃ¨re(s) disponibles (${ve.length} par dÃ©faut + ${be.length} personnalisÃ©es)`)}catch(h){console.error("Exception chargement donnÃ©es Ã©cole:",h)}},G=h=>h==="Maternelle"?[{id:"default-ps",name:"Petite Section",level:"PS"},{id:"default-ms",name:"Moyenne Section",level:"MS"},{id:"default-gs",name:"Grande Section",level:"GS"}]:h==="Primaire"?[{id:"default-cp",name:"CP",level:"CP"},{id:"default-ce1",name:"CE1",level:"CE1"},{id:"default-ce2",name:"CE2",level:"CE2"},{id:"default-cm1",name:"CM1",level:"CM1"},{id:"default-cm2",name:"CM2",level:"CM2"}]:h==="CollÃ¨ge"?[{id:"default-6eme",name:"6Ã¨me",level:"6Ã¨me"},{id:"default-5eme",name:"5Ã¨me",level:"5Ã¨me"},{id:"default-4eme",name:"4Ã¨me",level:"4Ã¨me"},{id:"default-3eme",name:"3Ã¨me",level:"3Ã¨me"}]:h==="LycÃ©e"?[{id:"default-2nde",name:"2nde",level:"2nde"},{id:"default-1ere",name:"1Ã¨re",level:"1Ã¨re"},{id:"default-tle",name:"Terminale",level:"Terminale"}]:[],q=h=>h==="Primaire"||h==="Maternelle"?[{id:"default-math",name:"MathÃ©matiques"},{id:"default-french",name:"FranÃ§ais"},{id:"default-reading",name:"Lecture"},{id:"default-writing",name:"Ã‰criture"},{id:"default-oral",name:"Expression Orale"},{id:"default-grammar",name:"Grammaire"},{id:"default-vocabulary",name:"Vocabulaire"},{id:"default-english",name:"Anglais"},{id:"default-science",name:"DÃ©couverte du Monde"},{id:"default-history",name:"Histoire"},{id:"default-geography",name:"GÃ©ographie"},{id:"default-civics",name:"Ã‰ducation Civique et Morale"},{id:"default-arts",name:"Arts Plastiques"},{id:"default-music",name:"Ã‰ducation Musicale"},{id:"default-pe",name:"Ã‰ducation Physique et Sportive"},{id:"default-ict",name:"Informatique"}]:h==="CollÃ¨ge"?[{id:"default-math",name:"MathÃ©matiques"},{id:"default-french",name:"FranÃ§ais"},{id:"default-english",name:"Anglais LV1"},{id:"default-german",name:"Allemand LV2"},{id:"default-spanish",name:"Espagnol LV2"},{id:"default-hg",name:"Histoire-GÃ©ographie"},{id:"default-emc",name:"Enseignement Moral et Civique (EMC)"},{id:"default-svt",name:"Sciences de la Vie et de la Terre (SVT)"},{id:"default-pc",name:"Physique-Chimie"},{id:"default-tech",name:"Technologie"},{id:"default-arts",name:"Arts Plastiques"},{id:"default-music",name:"Ã‰ducation Musicale"},{id:"default-pe",name:"Ã‰ducation Physique et Sportive (EPS)"},{id:"default-ict",name:"Informatique et NumÃ©rique"}]:h==="LycÃ©e GÃ©nÃ©ral"?[{id:"default-math",name:"MathÃ©matiques"},{id:"default-french",name:"FranÃ§ais"},{id:"default-literature",name:"LittÃ©rature"},{id:"default-english",name:"Anglais LV1"},{id:"default-german",name:"Allemand LV2"},{id:"default-spanish",name:"Espagnol LV2"},{id:"default-hg",name:"Histoire-GÃ©ographie"},{id:"default-emc",name:"Enseignement Moral et Civique (EMC)"},{id:"default-svt",name:"Sciences de la Vie et de la Terre (SVT)"},{id:"default-pc",name:"Physique-Chimie"},{id:"default-philo",name:"Philosophie"},{id:"default-ses",name:"Sciences Ã‰conomiques et Sociales (SES)"},{id:"default-nsi",name:"NumÃ©rique et Sciences Informatiques (NSI)"},{id:"default-si",name:"Sciences de l'IngÃ©nieur (SI)"},{id:"default-hggsp",name:"Histoire-GÃ©ographie, GÃ©opolitique et Sciences Politiques"},{id:"default-hlp",name:"HumanitÃ©s, LittÃ©rature et Philosophie"},{id:"default-llcer",name:"Langues, LittÃ©ratures et Cultures Ã‰trangÃ¨res"},{id:"default-arts",name:"Arts Plastiques"},{id:"default-music",name:"Musique"},{id:"default-pe",name:"Ã‰ducation Physique et Sportive (EPS)"}]:h==="LycÃ©e Technique"?[{id:"default-math",name:"MathÃ©matiques"},{id:"default-french",name:"FranÃ§ais"},{id:"default-english",name:"Anglais"},{id:"default-hg",name:"Histoire-GÃ©ographie"},{id:"default-pc",name:"Physique-Chimie"},{id:"default-tech-draw",name:"Dessin Technique"},{id:"default-cao",name:"Conception AssistÃ©e par Ordinateur (CAO)"},{id:"default-elec",name:"Ã‰lectrotechnique"},{id:"default-electronics",name:"Ã‰lectronique"},{id:"default-meca",name:"MÃ©canique"},{id:"default-auto",name:"MÃ©canique Automobile"},{id:"default-info",name:"Informatique"},{id:"default-network",name:"RÃ©seaux et TÃ©lÃ©communications"},{id:"default-construction",name:"Construction et BÃ¢timent"},{id:"default-industrial",name:"GÃ©nie Industriel"},{id:"default-energy",name:"Ã‰nergies et Environnement"},{id:"default-si",name:"Sciences de l'IngÃ©nieur"},{id:"default-pe",name:"Ã‰ducation Physique et Sportive (EPS)"}]:h==="LycÃ©e Professionnel"?[{id:"default-math",name:"MathÃ©matiques"},{id:"default-french",name:"FranÃ§ais"},{id:"default-english",name:"Anglais Professionnel"},{id:"default-hg",name:"Histoire-GÃ©ographie"},{id:"default-pro-tech",name:"Enseignement Professionnel"},{id:"default-eco-gestion",name:"Ã‰conomie-Gestion"},{id:"default-eco-droit",name:"Ã‰conomie-Droit"},{id:"default-commerce",name:"Techniques de Vente et Commerce"},{id:"default-comptability",name:"ComptabilitÃ©"},{id:"default-secretariat",name:"SecrÃ©tariat et Bureautique"},{id:"default-cuisine",name:"Arts Culinaires et Restauration"},{id:"default-hotellerie",name:"HÃ´tellerie et Tourisme"},{id:"default-coiffure",name:"Coiffure et EsthÃ©tique"},{id:"default-mode",name:"Mode et Couture"},{id:"default-menuiserie",name:"Menuiserie et Ã‰bÃ©nisterie"},{id:"default-pse",name:"PrÃ©vention SantÃ© Environnement (PSE)"},{id:"default-arts-appliques",name:"Arts AppliquÃ©s"},{id:"default-pe",name:"Ã‰ducation Physique et Sportive (EPS)"}]:[{id:"default-math",name:"MathÃ©matiques"},{id:"default-french",name:"FranÃ§ais"},{id:"default-english",name:"Anglais"},{id:"default-science",name:"Sciences"},{id:"default-history",name:"Histoire"},{id:"default-geography",name:"GÃ©ographie"},{id:"default-arts",name:"Arts"},{id:"default-pe",name:"Ã‰ducation Physique et Sportive"}],m=async()=>{try{E(!0);const h=localStorage.getItem("edutrack-user"),$=h?JSON.parse(h):null,te=$==null?void 0:$.current_school_id;if(!te){console.warn("âš ï¸ Pas d'Ã©cole associÃ©e"),f([]),E(!1);return}console.log("ðŸ” Recherche assignations pour school_id:",te);const{data:ie,error:pe}=await Z.from("teacher_assignments").select("id, teacher_id, class_name, subject_name, schedule, start_date, is_active").eq("school_id",te).eq("is_active",!0).order("created_at",{ascending:!1});if(console.log("ðŸ“Š RÃ©sultat assignations:",{assignments:ie,error:pe}),pe){console.error("âŒ Erreur chargement assignations:",pe),f([]),E(!1);return}if(!ie||ie.length===0){console.log("âš ï¸ Aucune assignation trouvÃ©e pour cette Ã©cole"),console.log("ðŸ’¡ VÃ©rification: y a-t-il des enseignants dans la table teachers ?");const{data:xe,error:Oe}=await Z.from("teachers").select("id, user_id, school_id").eq("school_id",te);if(console.log("ðŸ‘¨â€ðŸ« Enseignants dans la table teachers:",xe),xe&&xe.length>0){const es=xe.map($e=>$e.user_id),{data:ye,error:Xe}=await Z.from("users").select("id, email, phone, full_name").in("id",es).eq("role","teacher");console.log("ðŸ‘¤ Utilisateurs enseignants:",ye);const Ze=xe.map($e=>{const Ie=ye==null?void 0:ye.find(gs=>gs.id===$e.user_id);return{id:$e.id,fullName:(Ie==null?void 0:Ie.full_name)||"Nom inconnu",email:(Ie==null?void 0:Ie.email)||"Non renseignÃ©",phone:(Ie==null?void 0:Ie.phone)||"Non renseignÃ©",subjects:["Aucune matiÃ¨re assignÃ©e"],classes:["Aucune classe assignÃ©e"],status:"active",teacherId:`PROF${String($e.id).padStart(3,"0")}`,avatar:"/public/assets/images/no_image.png"}});f(Ze),console.log("âœ… Enseignants chargÃ©s sans assignation:",Ze.length)}else f([]);E(!1);return}const ve=[...new Set(ie.map(xe=>xe.teacher_id))],{data:be,error:Le}=await Z.from("teachers").select("id, user_id").in("id",ve);Le&&console.error("Erreur chargement teachers:",Le);const Pe=new Map;(be||[]).forEach(xe=>{Pe.set(xe.id,xe.user_id)});const Me=[...new Set((be==null?void 0:be.map(xe=>xe.user_id))||[])],{data:Ke,error:is}=await Z.from("users").select("id, email, phone, full_name").in("id",Me).eq("role","teacher");is&&console.error("Erreur chargement utilisateurs:",is);const os=new Map;(Ke||[]).forEach(xe=>{os.set(xe.id,xe)});const Je=new Map;ie.forEach(xe=>{var $e;const Oe=xe.teacher_id,es=Pe.get(Oe),ye=os.get(es);Je.has(Oe)||Je.set(Oe,{id:Oe,fullName:(ye==null?void 0:ye.full_name)||"Nom inconnu",email:(ye==null?void 0:ye.email)||"Non renseignÃ©",phone:(ye==null?void 0:ye.phone)||"Non renseignÃ©",subjects:[],classes:[],totalHours:0,status:"active",joinDate:xe.start_date?new Date(xe.start_date).toLocaleDateString("fr-FR"):"Non renseignÃ©e",teacherId:Oe.substring(0,8),avatar:"/public/assets/images/no_image.png"});const Xe=Je.get(Oe);xe.subject_name&&!Xe.subjects.includes(xe.subject_name)&&Xe.subjects.push(xe.subject_name),xe.class_name&&!Xe.classes.includes(xe.class_name)&&Xe.classes.push(xe.class_name);const Ze=(($e=xe.schedule)==null?void 0:$e.weekly_hours)||0;Xe.totalHours+=Ze});const cs=Array.from(Je.values()).map(xe=>({...xe,subject:xe.subjects.join(", ")||"Non assignÃ©",className:xe.classes.join(", ")||"Non assignÃ©"}));f(cs),console.log(`âœ… ${cs.length} enseignant(s) chargÃ©(s)`)}catch(h){console.error("Exception chargement enseignants:",h),f([])}finally{E(!1)}},F=[{value:"",label:"Toutes les matiÃ¨res"},...d.map(h=>({value:h.name,label:h.name}))],Y=[{value:"",label:"Tous les statuts"},{value:"active",label:"Actif"},{value:"inactive",label:"Inactif"},{value:"pending",label:"En attente"}];[...w.map(h=>({value:h.name,label:h.name}))];const ne=()=>{v(1),p("existing"),R(null),U("")},de=()=>{N<3&&v(N+1)},Ee=()=>{N>1&&v(N-1)},Te=()=>{ne(),I(!0)},ke=h=>{const $={active:{label:"Actif",className:"bg-success/10 text-success"},inactive:{label:"Inactif",className:"bg-error/10 text-error"},pending:{label:"En attente",className:"bg-warning/10 text-warning"}},te=($==null?void 0:$[h])||($==null?void 0:$.active);return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-caption font-caption-normal ${te==null?void 0:te.className}`,children:te==null?void 0:te.label})},ue=r==null?void 0:r.filter(h=>{var pe,ve,be,Le,Pe,Me;const $=((ve=(pe=h==null?void 0:h.fullName)==null?void 0:pe.toLowerCase())==null?void 0:ve.includes(g==null?void 0:g.toLowerCase()))||((Le=(be=h==null?void 0:h.email)==null?void 0:be.toLowerCase())==null?void 0:Le.includes(g==null?void 0:g.toLowerCase()))||((Me=(Pe=h==null?void 0:h.teacherId)==null?void 0:Pe.toLowerCase())==null?void 0:Me.includes(g==null?void 0:g.toLowerCase())),te=!s||(h==null?void 0:h.subject)===s,ie=!n||(h==null?void 0:h.status)===n;return $&&te&&ie}),De=h=>{const $=r.find(te=>te.id===h);$&&(P($),Q({fullName:$.fullName,email:$.email,phone:$.phone,subjects:Array.isArray($.subject)?$.subject:[$.subject],classes:Array.isArray($.className)?$.className:[$.className],password:"",confirmPassword:""}),k(!0))},ee=()=>{if(C&&S.fullName&&S.email&&S.subjects.length>0&&S.classes.length>0){if(S.password){if(!A(S.password)){alert("Le mot de passe doit contenir au moins 8 caractÃ¨res avec : une majuscule, une minuscule, un chiffre et un caractÃ¨re spÃ©cial");return}if(S.password!==S.confirmPassword){alert("Les mots de passe ne correspondent pas");return}}f(r.map(h=>h.id===C.id?{...h,fullName:S.fullName,email:S.email,phone:S.phone,subject:S.subjects.join(", "),className:S.classes.join(", "),subjects:S.subjects,classes:S.classes}:h)),k(!1),P(null),Q({fullName:"",email:"",phone:"",subjects:[],classes:[],password:"",confirmPassword:""})}},ce=h=>{const $=r.find(te=>te.id===h);$&&(P($),D(!0))},je=()=>{C&&(f(r.filter(h=>h.id!==C.id)),D(!1),P(null))},ze=h=>{f(r.map($=>$.id===h?{...$,status:$.status==="active"?"inactive":"active"}:$))},A=h=>!(h.length<8||!/(?=.*[a-z])/.test(h)||!/(?=.*[A-Z])/.test(h)||!/(?=.*\d)/.test(h)||!/(?=.*[@$!%*?&])/.test(h)),le=()=>{const h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@$!%*?&";let $="";$+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*26)],$+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)],$+="0123456789"[Math.floor(Math.random()*10)],$+="@$!%*?&"[Math.floor(Math.random()*7)];for(let te=4;te<8;te++)$+=h[Math.floor(Math.random()*h.length)];$=$.split("").sort(()=>.5-Math.random()).join(""),Q(te=>({...te,password:$,confirmPassword:$}))},we=async()=>{if(!V.trim()){alert("Veuillez entrer le nom de la matiÃ¨re");return}if(d.some(h=>h.name.toLowerCase()===V.trim().toLowerCase())){alert("Cette matiÃ¨re existe dÃ©jÃ ");return}try{const{data:h,error:$}=await Z.from("schools").select("custom_subjects").eq("id",B.id).single();if($){console.error("âŒ Erreur rÃ©cupÃ©ration matiÃ¨res:",$),alert("Erreur lors de la rÃ©cupÃ©ration des matiÃ¨res");return}const ie=[...h.custom_subjects||[],V.trim()],{error:pe}=await Z.from("schools").update({custom_subjects:ie}).eq("id",B.id);if(pe){console.error("âŒ Erreur sauvegarde matiÃ¨re:",pe),alert("Erreur lors de la sauvegarde de la matiÃ¨re");return}const ve={id:`custom-${Date.now()}`,name:V.trim()};_([...d,ve]),X(""),ae(!1),console.log("âœ… MatiÃ¨re ajoutÃ©e et sauvegardÃ©e:",ve.name)}catch(h){console.error("Exception ajout matiÃ¨re:",h),alert("Erreur lors de l'ajout de la matiÃ¨re")}},Ce=h=>{Q($=>{const te=$.subjects||[];return te.includes(h)?{...$,subjects:te.filter(ie=>ie!==h)}:{...$,subjects:[...te,h]}})},Ne=h=>{Q($=>{const te=$.classes||[];return te.includes(h)?{...$,classes:te.filter(ie=>ie!==h)}:{...$,classes:[...te,h]}})};return i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"Chargement des enseignants..."})]})}):e.jsxs("div",{className:"space-y-6",children:[B&&e.jsx("div",{className:"bg-gradient-to-r from-primary/10 to-secondary/10 border border-primary/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Building",size:20,className:"text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-text-primary mb-1",children:B.name}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-text-secondary",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(a,{name:"School",size:14,className:"text-primary"}),"Type: ",B.type]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(a,{name:"Users",size:14,className:"text-primary"}),w.length," classe(s)"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(a,{name:"BookOpen",size:14,className:"text-primary"}),d.length," matiÃ¨re(s)"]}),e.jsx(j,{variant:"ghost",size:"sm",iconName:"Plus",onClick:()=>ae(!0),className:"text-xs",children:"Ajouter une matiÃ¨re"})]})]})]})}),r.length===0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(a,{name:"Info",size:20,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-body font-body-semibold text-blue-900 mb-1",children:"Aucun enseignant"}),e.jsx("p",{className:"text-sm text-blue-700",children:`Aucun enseignant n'a encore Ã©tÃ© crÃ©Ã©. Cliquez sur "Assigner Enseignant" pour commencer.`})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-bold text-xl text-text-primary",children:"Gestion des Enseignants"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary mt-1",children:"GÃ©rez les comptes et affectations des enseignants"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(j,{variant:"default",iconName:"School",iconPosition:"left",onClick:Te,children:"Assigner Enseignant"})})]}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(K,{type:"search",placeholder:"Rechercher par nom, email ou ID...",value:g,onChange:h=>{var $;return l(($=h==null?void 0:h.target)==null?void 0:$.value)},className:"w-full"}),e.jsx(oe,{placeholder:"Filtrer par matiÃ¨re",options:F,value:s,onChange:o}),e.jsx(oe,{placeholder:"Filtrer par statut",options:Y,value:n,onChange:t})]})}),e.jsxs("div",{className:"bg-card rounded-lg border border-border overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Enseignant"}),e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"MatiÃ¨re"}),e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Classe"}),e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Contact"}),e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Statut"}),e.jsx("th",{className:"text-right p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Actions"})]})}),e.jsx("tbody",{children:ue==null?void 0:ue.map(h=>e.jsxs("tr",{className:"border-t border-border hover:bg-muted/30",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(He,{src:h==null?void 0:h.avatar,alt:h==null?void 0:h.fullName,className:"w-10 h-10 rounded-full object-cover",fallback:"/public/assets/images/no_image.png"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-medium text-sm text-text-primary",children:h==null?void 0:h.fullName}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["ID: ",h==null?void 0:h.teacherId]})]})]})}),e.jsx("td",{className:"p-4",children:e.jsx("p",{className:"font-body font-body-normal text-sm text-text-primary",children:h==null?void 0:h.subject})}),e.jsx("td",{className:"p-4",children:e.jsx("p",{className:"font-body font-body-normal text-sm text-text-primary",children:h==null?void 0:h.className})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-normal text-sm text-text-primary",children:h==null?void 0:h.email}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:h==null?void 0:h.phone})]})}),e.jsx("td",{className:"p-4",children:ke(h==null?void 0:h.status)}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>ze(h==null?void 0:h.id),title:(h==null?void 0:h.status)==="active"?"DÃ©sactiver":"Activer",children:e.jsx(a,{name:(h==null?void 0:h.status)==="active"?"UserX":"UserCheck",size:16})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>De(h==null?void 0:h.id),title:"Modifier",children:e.jsx(a,{name:"Edit",size:16})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>ce(h==null?void 0:h.id),title:"Supprimer",children:e.jsx(a,{name:"Trash2",size:16})})]})})]},h==null?void 0:h.id))})]})}),(ue==null?void 0:ue.length)===0&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(a,{name:"Users",size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary",children:"Aucun enseignant trouvÃ© avec les critÃ¨res de recherche"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-success/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"UserCheck",size:20,className:"text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:(y=r==null?void 0:r.filter(h=>(h==null?void 0:h.status)==="active"))==null?void 0:y.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Enseignants actifs"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-warning/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Clock",size:20,className:"text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:(H=r==null?void 0:r.filter(h=>(h==null?void 0:h.status)==="pending"))==null?void 0:H.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"En attente"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-error/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"UserX",size:20,className:"text-error"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:(se=r==null?void 0:r.filter(h=>(h==null?void 0:h.status)==="inactive"))==null?void 0:se.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Inactifs"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Users",size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:r==null?void 0:r.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Total enseignants"})]})]})})]}),T&&C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsxs("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:["Modifier ",C.fullName]}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>{k(!1),P(null),Q({fullName:"",email:"",phone:"",subject:"",className:"",password:"",confirmPassword:""})},children:e.jsx(a,{name:"X",size:20})})]}),e.jsx("div",{className:"p-6 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(K,{label:"Nom complet",placeholder:"Ex: Marie Nguema",value:S.fullName,onChange:h=>Q($=>({...$,fullName:h.target.value})),required:!0}),e.jsx(K,{label:"Email",type:"email",placeholder:"marie.nguema@school.cm",value:S.email,onChange:h=>Q($=>({...$,email:h.target.value})),required:!0}),e.jsx(K,{label:"TÃ©lÃ©phone",placeholder:"+237 6XX XX XX XX",value:S.phone,onChange:h=>Q($=>({...$,phone:h.target.value}))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-body font-body-medium text-text-secondary",children:"MatiÃ¨res enseignÃ©es *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto border border-border rounded-lg p-3",children:d.map(h=>{var $;return e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-muted p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:($=S.subjects)==null?void 0:$.includes(h.name),onChange:()=>Ce(h.name),className:"w-4 h-4 text-primary border-border rounded focus:ring-primary"}),e.jsx("span",{className:"text-sm text-text-primary",children:h.name})]},h.id)})}),((re=S.subjects)==null?void 0:re.length)>0&&e.jsxs("p",{className:"text-xs text-text-tertiary",children:[S.subjects.length," matiÃ¨re(s) sÃ©lectionnÃ©e(s): ",S.subjects.join(", ")]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-body font-body-medium text-text-secondary",children:"Classes assignÃ©es *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto border border-border rounded-lg p-3",children:w.map(h=>{var $;return e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-muted p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:($=S.classes)==null?void 0:$.includes(h.name),onChange:()=>Ne(h.name),className:"w-4 h-4 text-primary border-border rounded focus:ring-primary"}),e.jsx("span",{className:"text-sm text-text-primary",children:h.name})]},h.id)})}),((me=S.classes)==null?void 0:me.length)>0&&e.jsxs("p",{className:"text-xs text-text-tertiary",children:[S.classes.length," classe(s) sÃ©lectionnÃ©e(s): ",S.classes.join(", ")]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-200",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Modifier le mot de passe (optionnel)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{label:"Nouveau mot de passe",type:"password",placeholder:"Minimum 8 caractÃ¨res",value:S.password,onChange:h=>Q($=>({...$,password:h.target.value}))}),e.jsx(j,{variant:"outline",size:"sm",onClick:le,className:"mt-6",children:"GÃ©nÃ©rer"})]}),e.jsx(K,{label:"Confirmer le nouveau mot de passe",type:"password",placeholder:"RÃ©pÃ©ter le mot de passe",value:S.confirmPassword,onChange:h=>Q($=>({...$,confirmPassword:h.target.value}))}),S.password&&!A(S.password)&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:"Le mot de passe doit contenir au moins 8 caractÃ¨res avec : une majuscule, une minuscule, un chiffre et un caractÃ¨re spÃ©cial (@$!%*?&)"}),S.password&&S.confirmPassword&&S.password!==S.confirmPassword&&e.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:"Les mots de passe ne correspondent pas"})]})]})}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-border",children:[e.jsx(j,{variant:"default",onClick:ee,children:"Sauvegarder"}),e.jsx(j,{variant:"outline",onClick:()=>{k(!1),P(null),Q({fullName:"",email:"",phone:"",subject:"",className:"",password:"",confirmPassword:""})},children:"Annuler"})]})]})}),u&&C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:"Supprimer l'enseignant"}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>{D(!1),P(null)},children:e.jsx(a,{name:"X",size:20})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-error/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"AlertTriangle",size:24,className:"text-error"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-body font-body-medium text-sm text-text-primary",children:["Supprimer ",C.fullName," ?"]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:[C.subject," - ",C.className]})]})]}),e.jsx("div",{className:"bg-error/10 rounded-lg p-4",children:e.jsx("p",{className:"font-caption font-caption-normal text-xs text-error",children:"âš ï¸ Cette action est irrÃ©versible. L'enseignant sera dÃ©finitivement supprimÃ© du systÃ¨me."})})]}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-border",children:[e.jsx(j,{variant:"destructive",onClick:je,children:"Supprimer dÃ©finitivement"}),e.jsx(j,{variant:"outline",onClick:()=>{D(!1),P(null)},children:"Annuler"})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-card rounded-2xl border border-border/50 shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden animate-in slide-in-from-bottom-4 duration-300",children:[e.jsx("div",{className:"relative bg-gradient-to-r from-primary/10 via-primary/5 to-secondary/10 border-b border-border/50",children:e.jsxs("div",{className:"flex items-center justify-between p-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-xl flex items-center justify-center ring-2 ring-primary/30",children:e.jsx(a,{name:"School",size:24,className:"text-primary"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-heading font-heading-bold text-xl text-text-primary flex items-center gap-2",children:["Assignation Multi-Ã‰tablissements",e.jsx("span",{className:"px-2 py-0.5 bg-primary/10 text-primary text-xs rounded-full font-medium",children:"Nouveau"})]}),e.jsxs("p",{className:"text-sm text-text-secondary mt-0.5 flex items-center gap-1",children:[e.jsx(a,{name:"Circle",size:8,className:"text-primary fill-current"}),"Ã‰tape ",N," sur 3 - ",N===1?"Type d'assignation":N===2?"SÃ©lection enseignant":"Configuration finale"]})]})]}),e.jsx("button",{onClick:()=>{I(!1),ne()},className:"w-10 h-10 rounded-lg hover:bg-muted/50 transition-all duration-200 flex items-center justify-center group",children:e.jsx(a,{name:"X",size:20,className:"text-text-secondary group-hover:text-text-primary transition-colors"})})]})}),e.jsx("div",{className:"px-6 py-6 bg-muted/30",children:e.jsx("div",{className:"flex items-center justify-between max-w-2xl mx-auto",children:[1,2,3].map((h,$)=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsxs("div",{className:`relative w-12 h-12 rounded-xl flex items-center justify-center text-sm font-bold transition-all duration-300 ${h===N?"bg-gradient-to-br from-primary to-primary/80 text-white shadow-lg scale-110 ring-4 ring-primary/20":h<N?"bg-gradient-to-br from-success to-success/80 text-white shadow-md":"bg-muted/50 text-muted-foreground border border-border"}`,children:[h<N?e.jsx(a,{name:"Check",size:20,className:"animate-in zoom-in duration-200"}):e.jsx("span",{className:"transition-all duration-200",children:h}),h===N&&e.jsx("span",{className:"absolute inset-0 rounded-xl bg-primary animate-ping opacity-20"})]}),e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("span",{className:`text-xs font-semibold block transition-colors duration-200 ${h===N?"text-primary":h<N?"text-success":"text-text-secondary"}`,children:h===1?"Type":h===2?"Enseignant":"Assignation"}),e.jsx("span",{className:"text-xs text-text-tertiary block mt-0.5",children:h===1?"Choisir":h===2?"SÃ©lectionner":"Configurer"})]})]}),h<3&&e.jsxs("div",{className:"flex-1 h-1 mx-2 -mt-8 relative",children:[e.jsx("div",{className:"absolute inset-0 bg-border rounded-full"}),e.jsx("div",{className:`absolute inset-0 bg-gradient-to-r from-primary to-success rounded-full transition-all duration-500 ${h<N?"w-full":"w-0"}`})]})]},h))})}),e.jsxs("div",{className:"p-8 overflow-y-auto max-h-[calc(90vh-240px)]",children:[N===1&&e.jsxs("div",{className:"space-y-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center space-y-3 animate-in fade-in slide-in-from-bottom-2 duration-500",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-2xl mb-2",children:e.jsx(a,{name:"School",size:32,className:"text-primary"})}),e.jsx("h4",{className:"font-heading font-heading-bold text-2xl text-text-primary",children:"Type d'Assignation"}),e.jsx("p",{className:"text-base text-text-secondary max-w-md mx-auto",children:"Choisissez si vous souhaitez assigner un enseignant existant ou crÃ©er un nouveau profil"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 animate-in fade-in slide-in-from-bottom-4 duration-500 delay-100",children:[e.jsxs("div",{onClick:()=>p("existing"),className:`group relative overflow-hidden rounded-2xl p-6 cursor-pointer transition-all duration-300 ${O==="existing"?"bg-gradient-to-br from-primary/10 to-primary/5 border-2 border-primary shadow-xl shadow-primary/10 scale-105":"bg-card border-2 border-border hover:border-primary/50 hover:shadow-lg hover:scale-102"}`,children:[O==="existing"&&e.jsx("div",{className:"absolute top-4 right-4 w-8 h-8 bg-primary rounded-full flex items-center justify-center animate-in zoom-in duration-300",children:e.jsx(a,{name:"Check",size:16,className:"text-white"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsx("div",{className:`w-14 h-14 rounded-xl flex items-center justify-center transition-all duration-300 ${O==="existing"?"bg-primary text-white shadow-lg":"bg-muted/50 text-muted-foreground group-hover:bg-primary/10 group-hover:text-primary"}`,children:e.jsx(a,{name:"Users",size:28,className:"transition-transform group-hover:scale-110"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"font-heading font-heading-bold text-lg text-text-primary",children:"Enseignant Existant"}),e.jsx("p",{className:"text-sm text-text-secondary leading-relaxed",children:"Recherchez et assignez un enseignant dÃ©jÃ  enregistrÃ© dans le systÃ¨me global"})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-tertiary",children:[e.jsx(a,{name:"Check",size:14,className:"text-success"}),e.jsx("span",{children:"Processus rapide"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-tertiary",children:[e.jsx(a,{name:"Check",size:14,className:"text-success"}),e.jsx("span",{children:"Profil dÃ©jÃ  configurÃ©"})]})]})]})]}),e.jsxs("div",{onClick:()=>p("new"),className:`group relative overflow-hidden rounded-2xl p-6 cursor-pointer transition-all duration-300 ${O==="new"?"bg-gradient-to-br from-success/10 to-success/5 border-2 border-success shadow-xl shadow-success/10 scale-105":"bg-card border-2 border-border hover:border-success/50 hover:shadow-lg hover:scale-102"}`,children:[O==="new"&&e.jsx("div",{className:"absolute top-4 right-4 w-8 h-8 bg-success rounded-full flex items-center justify-center animate-in zoom-in duration-300",children:e.jsx(a,{name:"Check",size:16,className:"text-white"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsx("div",{className:`w-14 h-14 rounded-xl flex items-center justify-center transition-all duration-300 ${O==="new"?"bg-success text-white shadow-lg":"bg-muted/50 text-muted-foreground group-hover:bg-success/10 group-hover:text-success"}`,children:e.jsx(a,{name:"UserPlus",size:28,className:"transition-transform group-hover:scale-110"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"font-heading font-heading-bold text-lg text-text-primary",children:"Nouvel Enseignant"}),e.jsx("p",{className:"text-sm text-text-secondary leading-relaxed",children:"CrÃ©ez un nouveau compte enseignant et assignez-le Ã  votre Ã©tablissement"})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-tertiary",children:[e.jsx(a,{name:"Check",size:14,className:"text-success"}),e.jsx("span",{children:"Personnalisation complÃ¨te"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-tertiary",children:[e.jsx(a,{name:"Check",size:14,className:"text-success"}),e.jsx("span",{children:"Nouveau dans le systÃ¨me"})]})]})]})]})]}),e.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500 delay-200",children:e.jsx("div",{className:"bg-gradient-to-r from-primary/5 via-primary/3 to-secondary/5 border border-primary/20 rounded-xl p-5 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-xl flex items-center justify-center shrink-0",children:e.jsx(a,{name:"Building",size:24,className:"text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h5",{className:"font-heading font-heading-bold text-base text-text-primary",children:"Ã‰tablissement de destination"}),e.jsx("span",{className:"px-2 py-0.5 bg-primary/10 text-primary text-xs rounded-full font-medium",children:"Actif"})]}),e.jsx("p",{className:"text-base font-semibold text-primary mb-1",children:(B==null?void 0:B.name)||"Chargement..."}),e.jsxs("p",{className:"text-xs text-text-tertiary flex items-center gap-1",children:[e.jsx(a,{name:"Info",size:12}),"Vous assignez les enseignants uniquement Ã  votre Ã©tablissement"]})]})]})})})]}),N===2&&e.jsx("div",{className:"space-y-6",children:O==="existing"?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8 animate-in fade-in slide-in-from-bottom-2 duration-500",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-primary/20 to-primary/10 rounded-2xl mb-3",children:e.jsx(a,{name:"Users",size:32,className:"text-primary"})}),e.jsx("h5",{className:"font-heading font-heading-bold text-2xl text-text-primary mb-2",children:"SÃ©lectionner un Enseignant"}),e.jsx("p",{className:"text-base text-text-secondary max-w-xl mx-auto",children:"Choisissez un enseignant dans la liste. Les enseignants peuvent Ãªtre assignÃ©s Ã  plusieurs Ã©tablissements."})]}),e.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500 delay-100",children:e.jsx(Rs,{onTeacherSelect:h=>{R(h)},onCreateNew:()=>{p("new"),R(null)},selectedTeacher:z})})]}):e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8 animate-in fade-in slide-in-from-bottom-2 duration-500",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-success/20 to-success/10 rounded-2xl mb-3",children:e.jsx(a,{name:"UserPlus",size:32,className:"text-success"})}),e.jsx("h5",{className:"font-heading font-heading-bold text-2xl text-text-primary mb-2",children:"CrÃ©er un Nouveau Compte"}),e.jsx("p",{className:"text-base text-text-secondary max-w-xl mx-auto",children:"Remplissez les informations pour crÃ©er un nouveau profil enseignant dans le systÃ¨me"})]}),e.jsxs("div",{className:"bg-card rounded-2xl border border-border shadow-lg p-8 animate-in fade-in slide-in-from-bottom-4 duration-500 delay-100",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h6",{className:"font-heading font-heading-bold text-lg text-text-primary mb-1 flex items-center gap-2",children:[e.jsx(a,{name:"User",size:20,className:"text-primary"}),"Informations Personnelles"]}),e.jsx("p",{className:"text-sm text-text-tertiary mb-4",children:"DonnÃ©es de base de l'enseignant"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx(K,{label:"Nom complet",placeholder:"Ex: Marie Nguema",value:S.fullName,onChange:h=>Q($=>({...$,fullName:h.target.value})),required:!0,className:"transition-all duration-200 focus-within:shadow-sm"}),e.jsx(K,{label:"Email",type:"email",placeholder:"marie.nguema@school.cm",value:S.email,onChange:h=>Q($=>({...$,email:h.target.value})),required:!0,className:"transition-all duration-200 focus-within:shadow-sm"}),e.jsx(K,{label:"TÃ©lÃ©phone",placeholder:"+237 6XX XX XX XX",value:S.phone,onChange:h=>Q($=>({...$,phone:h.target.value})),required:!0,className:"transition-all duration-200 focus-within:shadow-sm"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h6",{className:"font-heading font-heading-bold text-lg text-text-primary mb-1 flex items-center gap-2",children:[e.jsx(a,{name:"BookOpen",size:20,className:"text-primary"}),"MatiÃ¨res EnseignÃ©es"]}),e.jsx("p",{className:"text-sm text-text-tertiary mb-4",children:"SÃ©lectionnez une ou plusieurs matiÃ¨res"}),e.jsx("div",{className:"bg-muted/30 border border-border rounded-xl p-4 max-h-64 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:d.map(h=>{var $,te,ie;return e.jsxs("label",{className:`relative flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-all duration-200 ${($=S.subjects)!=null&&$.includes(h.name)?"bg-primary/10 border-2 border-primary shadow-sm":"bg-card border border-border hover:border-primary/50 hover:bg-muted/50"}`,children:[e.jsx("input",{type:"checkbox",checked:(te=S.subjects)==null?void 0:te.includes(h.name),onChange:()=>Ce(h.name),className:"w-4 h-4 text-primary border-border rounded focus:ring-primary focus:ring-2"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:h.name}),((ie=S.subjects)==null?void 0:ie.includes(h.name))&&e.jsx("div",{className:"absolute top-1 right-1 w-5 h-5 bg-primary rounded-full flex items-center justify-center",children:e.jsx(a,{name:"Check",size:12,className:"text-white"})})]},h.id)})})}),((he=S.subjects)==null?void 0:he.length)>0&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm",children:[e.jsx(a,{name:"CheckCircle",size:16,className:"text-success"}),e.jsxs("span",{className:"text-text-secondary",children:[e.jsx("span",{className:"font-semibold text-primary",children:S.subjects.length})," matiÃ¨re(s) sÃ©lectionnÃ©e(s)"]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h6",{className:"font-heading font-heading-bold text-lg text-text-primary mb-1 flex items-center gap-2",children:[e.jsx(a,{name:"Users",size:20,className:"text-primary"}),"Classes AssignÃ©es"]}),e.jsx("p",{className:"text-sm text-text-tertiary mb-4",children:"SÃ©lectionnez les classes Ã  gÃ©rer"}),e.jsx("div",{className:"bg-muted/30 border border-border rounded-xl p-4 max-h-64 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:w.map(h=>{var $,te,ie;return e.jsxs("label",{className:`relative flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-all duration-200 ${($=S.classes)!=null&&$.includes(h.name)?"bg-success/10 border-2 border-success shadow-sm":"bg-card border border-border hover:border-success/50 hover:bg-muted/50"}`,children:[e.jsx("input",{type:"checkbox",checked:(te=S.classes)==null?void 0:te.includes(h.name),onChange:()=>Ne(h.name),className:"w-4 h-4 text-success border-border rounded focus:ring-success focus:ring-2"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:h.name}),((ie=S.classes)==null?void 0:ie.includes(h.name))&&e.jsx("div",{className:"absolute top-1 right-1 w-5 h-5 bg-success rounded-full flex items-center justify-center",children:e.jsx(a,{name:"Check",size:12,className:"text-white"})})]},h.id)})})}),((fe=S.classes)==null?void 0:fe.length)>0&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm",children:[e.jsx(a,{name:"CheckCircle",size:16,className:"text-success"}),e.jsxs("span",{className:"text-text-secondary",children:[e.jsx("span",{className:"font-semibold text-success",children:S.classes.length})," classe(s) sÃ©lectionnÃ©e(s)"]})]})]}),e.jsxs("div",{children:[e.jsxs("h6",{className:"font-heading font-heading-bold text-lg text-text-primary mb-1 flex items-center gap-2",children:[e.jsx(a,{name:"Lock",size:20,className:"text-primary"}),"SÃ©curitÃ© du Compte"]}),e.jsx("p",{className:"text-sm text-text-tertiary mb-4",children:"DÃ©finissez un mot de passe sÃ©curisÃ©"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{label:"Mot de passe",type:"password",placeholder:"Minimum 8 caractÃ¨res",value:S.password,onChange:h=>Q($=>({...$,password:h.target.value})),required:!0,className:"flex-1 transition-all duration-200 focus-within:shadow-sm"}),e.jsx(j,{variant:"outline",size:"sm",onClick:le,className:"mt-6 hover:bg-primary/10 hover:text-primary transition-all duration-200",iconName:"RefreshCw",children:"GÃ©nÃ©rer"})]})}),e.jsx(K,{label:"Confirmer le mot de passe",type:"password",placeholder:"RÃ©pÃ©ter le mot de passe",value:S.confirmPassword,onChange:h=>Q($=>({...$,confirmPassword:h.target.value})),required:!0,className:"transition-all duration-200 focus-within:shadow-sm"})]}),S.password&&!A(S.password)&&e.jsx("div",{className:"mt-4 bg-error/10 border border-error/30 rounded-lg p-3 animate-in fade-in duration-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(a,{name:"AlertCircle",size:16,className:"text-error mt-0.5"}),e.jsxs("div",{className:"text-sm text-error",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Mot de passe trop faible"}),e.jsx("p",{className:"text-xs",children:"Le mot de passe doit contenir au moins 8 caractÃ¨res avec : une majuscule, une minuscule, un chiffre et un caractÃ¨re spÃ©cial (@$!%*?&)"})]})]})}),S.password&&S.confirmPassword&&S.password!==S.confirmPassword&&e.jsx("div",{className:"mt-4 bg-error/10 border border-error/30 rounded-lg p-3 animate-in fade-in duration-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{name:"AlertCircle",size:16,className:"text-error"}),e.jsx("p",{className:"text-sm text-error font-medium",children:"Les mots de passe ne correspondent pas"})]})})]})]})]})}),N===3&&z&&e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8 animate-in fade-in slide-in-from-bottom-2 duration-500",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-success/20 to-success/10 rounded-2xl mb-3",children:e.jsx(a,{name:"Settings",size:32,className:"text-success"})}),e.jsx("h5",{className:"font-heading font-heading-bold text-2xl text-text-primary mb-2",children:"Configuration de l'Assignation"}),e.jsx("p",{className:"text-base text-text-secondary max-w-xl mx-auto",children:"DÃ©finissez les classes et matiÃ¨res que cet enseignant gÃ©rera dans votre Ã©tablissement"})]}),e.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500 delay-100",children:e.jsx(Ls,{teacher:z,currentSchool:B,onAssignmentComplete:h=>{alert("Assignation crÃ©Ã©e avec succÃ¨s !"),I(!1),ne(),m()},onCancel:()=>{I(!1),ne()}})})]}),N<3&&e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-border/50 bg-muted/20",children:[e.jsx("div",{className:"flex gap-3",children:N>1&&e.jsx(j,{variant:"outline",onClick:Ee,iconName:"ChevronLeft",iconPosition:"left",className:"px-6 hover:bg-muted/50 transition-all duration-200",children:"PrÃ©cÃ©dent"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(j,{variant:"outline",onClick:()=>{I(!1),ne()},className:"px-6 hover:bg-error/10 hover:text-error hover:border-error/50 transition-all duration-200",children:"Annuler"}),e.jsx(j,{onClick:()=>{var h,$;if(N===2&&O==="new")if(S.fullName&&S.email&&((h=S.subjects)==null?void 0:h.length)>0&&(($=S.classes)==null?void 0:$.length)>0&&S.password&&S.confirmPassword){if(!A(S.password)){alert("Le mot de passe doit contenir au moins 8 caractÃ¨res avec : une majuscule, une minuscule, un chiffre et un caractÃ¨re spÃ©cial");return}if(S.password!==S.confirmPassword){alert("Les mots de passe ne correspondent pas");return}const te={id:`temp-${Date.now()}`,fullName:S.fullName,email:S.email,phone:S.phone,subjects:S.subjects,classes:S.classes,password:S.password,isNew:!0};R(te),de()}else alert("Veuillez remplir tous les champs obligatoires");else de()},disabled:N===1&&!O||N===2&&O==="existing"&&!z,iconName:"ChevronRight",iconPosition:"right",className:"px-6 bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary shadow-lg hover:shadow-primary/30 transition-all duration-200",children:N===2&&O==="new"?"CrÃ©er et Continuer":"Suivant"})]})]})]})]})}),J&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-card rounded-2xl border border-border/50 shadow-2xl w-full max-w-md animate-in slide-in-from-bottom-4 duration-300",children:[e.jsx("div",{className:"relative bg-gradient-to-r from-primary/10 via-primary/5 to-secondary/10 p-6 border-b border-border/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/20 rounded-xl flex items-center justify-center",children:e.jsx(a,{name:"BookOpen",size:20,className:"text-primary"})}),e.jsx("h3",{className:"font-heading font-heading-bold text-xl text-text-primary",children:"Ajouter une matiÃ¨re"})]}),e.jsx("button",{onClick:()=>{ae(!1),X("")},className:"w-8 h-8 rounded-lg hover:bg-muted/50 transition-all duration-200 flex items-center justify-center",children:e.jsx(a,{name:"X",size:18,className:"text-text-secondary"})})]})}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-text-primary",children:"Nom de la matiÃ¨re *"}),e.jsx(K,{type:"text",placeholder:"Ex: Informatique, Biologie, Arts plastiques...",value:V,onChange:h=>X(h.target.value),onKeyPress:h=>{h.key==="Enter"&&we()},className:"transition-all duration-200 focus-within:shadow-md"}),e.jsxs("p",{className:"text-xs text-text-tertiary flex items-center gap-1",children:[e.jsx(a,{name:"Info",size:12}),"Cette matiÃ¨re sera ajoutÃ©e Ã  la liste des matiÃ¨res disponibles"]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-blue-50/50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center shrink-0",children:e.jsx(a,{name:"Info",size:16,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Note importante"}),e.jsx("p",{className:"text-xs text-blue-700 leading-relaxed",children:"Cette matiÃ¨re sera disponible uniquement pour votre Ã©tablissement et restera enregistrÃ©e pour les prochaines assignations."})]})]})})]}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-border/50 bg-muted/20",children:[e.jsx(j,{variant:"outline",onClick:()=>{ae(!1),X("")},className:"flex-1 hover:bg-muted/50 transition-all duration-200",children:"Annuler"}),e.jsx(j,{onClick:we,className:"flex-1 bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary shadow-lg hover:shadow-primary/30 transition-all duration-200",disabled:!V.trim(),iconName:"Plus",iconPosition:"left",children:"Ajouter"})]})]})})]})},ge=async()=>{var g;try{const l=localStorage.getItem("edutrack-user");if(l){const t=JSON.parse(l);if(t.current_school_id)return t.current_school_id}const{data:{user:s}}=await Z.auth.getUser();if(!s)return console.warn("âš ï¸ Utilisateur non authentifiÃ©"),null;const{data:o,error:n}=await Z.from("users").select("current_school_id, schools:current_school_id(id, name)").eq("id",s.id).single();return n?(console.error("âŒ Erreur rÃ©cupÃ©ration Ã©cole utilisateur:",n),null):o!=null&&o.current_school_id?(console.log("âœ… Ã‰cole trouvÃ©e:",o.current_school_id,(g=o.schools)==null?void 0:g.name),o.current_school_id):(console.warn("âš ï¸ Aucune Ã©cole associÃ©e Ã  l'utilisateur"),null)}catch(l){return console.error("âŒ Erreur getCurrentSchoolId:",l),null}},Fe={getAllCards:async()=>{try{const g=await ge();if(!g)throw new Error("Pas d'Ã©cole associÃ©e");const{data:l,error:s}=await Z.from("student_cards").select(`
          id,
          card_number,
          issue_date,
          expiry_date,
          status,
          created_at,
          updated_at,
          student_id,
          students:student_id (
            id,
            user_id,
            first_name,
            last_name,
            date_of_birth,
            users:user_id (
              photo
            )
          )
        `).eq("school_id",g).order("created_at",{ascending:!1});if(s)throw s;const o=l.map(i=>i.student_id).filter(Boolean);let n={};if(o.length>0){const{data:i}=await Z.from("attendances").select(`
            student_id,
            classes:class_id (
              name
            )
          `).in("student_id",o).order("date",{ascending:!1}).limit(o.length);i&&i.forEach(E=>{var T;!n[E.student_id]&&((T=E.classes)!=null&&T.name)&&(n[E.student_id]=E.classes.name)})}return l.map(i=>{var E,T,k,u,D,C,P;return{id:i.id,studentId:((E=i.students)==null?void 0:E.user_id)||((T=i.students)==null?void 0:T.id),studentName:`${((k=i.students)==null?void 0:k.first_name)||""} ${((u=i.students)==null?void 0:u.last_name)||""}`.trim(),class:n[i.student_id]||"Non assignÃ©",photo:((C=(D=i.students)==null?void 0:D.users)==null?void 0:C.photo)||"/assets/images/no_image.png",cardNumber:i.card_number,issueDate:i.issue_date?new Date(i.issue_date).toLocaleDateString("fr-FR"):"",expiryDate:i.expiry_date?new Date(i.expiry_date).toLocaleDateString("fr-FR"):"",status:i.status,dateOfBirth:(P=i.students)!=null&&P.date_of_birth?new Date(i.students.date_of_birth).toLocaleDateString("fr-FR"):"",parentName:"Non renseignÃ©",emergencyContact:"Non renseignÃ©",bloodType:"Non renseignÃ©",medicalNotes:"Aucune"}})}catch(g){throw console.error("âŒ Erreur chargement cartes Supabase:",g),console.error("Code erreur:",g.code),console.error("Message:",g.message),console.error("Details:",g.details),g}}},Fs=({isOpen:g,onClose:l,onCardGenerated:s})=>{const[o,n]=c.useState(1),[t,i]=c.useState(""),[E,T]=c.useState([]),[k,u]=c.useState(null),[D,C]=c.useState(!1),[P,b]=c.useState(!1),[I,N]=c.useState("");c.useEffect(()=>{g&&o===1&&v()},[g,o,t]);const v=async()=>{try{C(!0),N("");const L=await Fe.searchAvailableStudents(t);T(L)}catch(L){N("Erreur lors de la recherche des Ã©tudiants"),console.error("Erreur:",L)}finally{C(!1)}},O=L=>{u(L),n(2)},p=async()=>{if(k)try{b(!0),N("");const L=await Fe.generateCard(k.id);s&&s(L),z()}catch(L){N(L.message||"Erreur lors de la gÃ©nÃ©ration de la carte")}finally{b(!1)}},z=()=>{n(1),i(""),u(null),N(""),C(!1),b(!1),l()},R=()=>{n(1),u(null),N("")};return g?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:o===1?"SÃ©lectionner un Ã‰tudiant":"Confirmer la GÃ©nÃ©ration"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary mt-1",children:o===1?"Choisissez un Ã©tudiant pour gÃ©nÃ©rer sa carte scolaire":"VÃ©rifiez les informations avant de gÃ©nÃ©rer la carte"})]}),e.jsx(j,{variant:"ghost",size:"icon",onClick:z,children:e.jsx(a,{name:"X",size:20})})]}),I&&e.jsx("div",{className:"mx-6 mt-4 p-3 bg-error/10 border border-error/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:"AlertCircle",size:16,className:"text-error"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-error",children:I})]})}),o===1&&e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx(K,{type:"search",placeholder:"Rechercher par nom, ID ou classe...",value:t,onChange:L=>i(L.target.value),className:"w-full"})}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:D?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"font-body font-body-normal text-sm text-text-secondary",children:"Recherche en cours..."})]})}):E.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(a,{name:"Users",size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary",children:t?"Aucun Ã©tudiant trouvÃ© avec ces critÃ¨res":"Aucun Ã©tudiant disponible pour la gÃ©nÃ©ration de carte"})]}):E.map(L=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg hover:bg-muted/30 cursor-pointer transition-colors",onClick:()=>O(L),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(He,{src:L.photo,alt:L.name,className:"w-12 h-12 rounded-full object-cover",fallback:"/public/assets/images/no_image.png"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-body font-body-medium text-sm text-text-primary",children:L.name}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["ID: ",L.id]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["Classe: ",L.class]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[L.hasCard?e.jsx("span",{className:"px-2 py-1 bg-warning/10 text-warning rounded-full text-xs font-caption font-caption-normal",children:"Carte existante"}):e.jsx("span",{className:"px-2 py-1 bg-success/10 text-success rounded-full text-xs font-caption font-caption-normal",children:"Disponible"}),e.jsx(a,{name:"ChevronRight",size:16,className:"text-muted-foreground"})]})]},L.id))})]}),o===2&&k&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-muted/20 rounded-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx(He,{src:k.photo,alt:k.name,className:"w-16 h-16 rounded-lg object-cover",fallback:"/public/assets/images/no_image.png"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:k.name}),e.jsxs("p",{className:"font-body font-body-normal text-sm text-text-secondary",children:[k.id," â€¢ Classe ",k.class]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary mb-1",children:"Parent/Tuteur"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-primary",children:k.parentName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary mb-1",children:"Contact d'urgence"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-primary",children:k.emergencyContact})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary mb-1",children:"Groupe sanguin"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-primary",children:k.bloodType})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary mb-1",children:"Notes mÃ©dicales"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-primary",children:k.medicalNotes||"Aucune"})]})]})]}),e.jsxs("div",{className:"bg-primary/5 rounded-lg p-4 mb-6",children:[e.jsx("h5",{className:"font-heading font-heading-semibold text-sm text-text-primary mb-3",children:"Informations de la carte"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Date d'Ã©mission"}),e.jsx("p",{className:"font-body font-body-normal text-text-primary",children:new Date().toLocaleDateString("fr-FR")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Date d'expiration"}),e.jsxs("p",{className:"font-body font-body-normal text-text-primary",children:["30/06/",new Date().getFullYear()+(new Date().getMonth()>=8?1:0)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Statut initial"}),e.jsx("p",{className:"font-body font-body-normal text-text-primary",children:"Brouillon (nÃ©cessite validation)"})]})]})]})]}),e.jsx("div",{className:"flex gap-3 p-6 border-t border-border",children:o===1?e.jsx(j,{variant:"outline",onClick:z,children:"Annuler"}):e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"outline",onClick:R,children:"Retour"}),e.jsx(j,{variant:"default",onClick:p,disabled:P,iconName:P?void 0:"CreditCard",iconPosition:"left",children:P?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"GÃ©nÃ©ration..."})]}):"GÃ©nÃ©rer la Carte"})]})})]})}):null},Us=()=>{var r,f,W,G,q;const[g,l]=c.useState(""),[s,o]=c.useState(""),[n,t]=c.useState(""),[i,E]=c.useState([]),[T,k]=c.useState(!1),[u,D]=c.useState(null),[C,P]=c.useState(!1),[b,I]=c.useState([]),[N,v]=c.useState(!0),[O,p]=c.useState(""),[z,R]=c.useState("");c.useEffect(()=>{L()},[]);const L=async()=>{var m,F;try{v(!0),p("");const Y=await Fe.getAllCards();I(Y)}catch(Y){console.error("Erreur chargement cartes:",Y),(m=Y.message)!=null&&m.includes("relation")||Y.code==="42P01"?p("âš ï¸ Table student_cards non trouvÃ©e. Veuillez exÃ©cuter la migration SQL dans Supabase."):(F=Y.message)!=null&&F.includes("Ã©cole")?p("âŒ Aucune Ã©cole associÃ©e Ã  votre compte."):p(`Erreur: ${Y.message||"Impossible de charger les cartes"}`)}finally{v(!1)}};c.useEffect(()=>{if(z){const m=setTimeout(()=>{R("")},5e3);return()=>clearTimeout(m)}},[z]);const U=[{value:"",label:"Toutes les classes"},{value:"CP",label:"CP"},{value:"CE1",label:"CE1"},{value:"CE2",label:"CE2"},{value:"CM1",label:"CM1"},{value:"CM2",label:"CM2"}],B=[{value:"",label:"Tous les statuts"},{value:"draft",label:"Brouillon"},{value:"pending_validation",label:"En attente de validation"},{value:"issued",label:"Ã‰mise"},{value:"printed",label:"ImprimÃ©e"},{value:"expired",label:"ExpirÃ©e"}],M=m=>{const F={draft:{label:"Brouillon",className:"bg-muted text-muted-foreground"},pending_validation:{label:"En validation",className:"bg-warning/10 text-warning"},issued:{label:"Ã‰mise",className:"bg-success/10 text-success"},printed:{label:"ImprimÃ©e",className:"bg-primary/10 text-primary"},expired:{label:"ExpirÃ©e",className:"bg-error/10 text-error"}},Y=(F==null?void 0:F[m])||(F==null?void 0:F.draft);return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-caption font-caption-normal ${Y==null?void 0:Y.className}`,children:Y==null?void 0:Y.label})},w=b==null?void 0:b.filter(m=>{var de,Ee,Te,ke,ue,De;const F=((Ee=(de=m==null?void 0:m.studentName)==null?void 0:de.toLowerCase())==null?void 0:Ee.includes(g==null?void 0:g.toLowerCase()))||((ke=(Te=m==null?void 0:m.cardNumber)==null?void 0:Te.toLowerCase())==null?void 0:ke.includes(g==null?void 0:g.toLowerCase()))||((De=(ue=m==null?void 0:m.studentId)==null?void 0:ue.toLowerCase())==null?void 0:De.includes(g==null?void 0:g.toLowerCase())),Y=!s||(m==null?void 0:m.class)===s,ne=!n||(m==null?void 0:m.status)===n;return F&&Y&&ne}),x=()=>{P(!0)},d=m=>{I(F=>[...F,m]),R(`Carte gÃ©nÃ©rÃ©e avec succÃ¨s pour ${m.studentName}`)},_=async m=>{try{const F=await Fe.validateCard(m);I(Y=>Y.map(ne=>ne.id===m?F:ne)),R("Carte validÃ©e avec succÃ¨s")}catch(F){p(F.message||"Erreur lors de la validation")}},J=async m=>{try{const F=await Fe.printCard(m);I(Y=>Y.map(ne=>ne.id===m?F:ne)),R("Carte imprimÃ©e avec succÃ¨s")}catch(F){p(F.message||"Erreur lors de l'impression")}},ae=async()=>{if(i.length!==0)try{const m=await Fe.bulkPrintCards(i);I(F=>F.map(Y=>m.find(de=>de.id===Y.id)||Y)),E([]),R(`${m.length} carte(s) imprimÃ©e(s) avec succÃ¨s`)}catch(m){p(m.message||"Erreur lors de l'impression en lot")}},V=async m=>{try{const F=await Fe.regenerateCard(m);I(Y=>Y.map(ne=>ne.studentId===m&&ne.status!=="expired"?{...ne,status:"expired"}:ne).concat(F)),R("Carte rÃ©gÃ©nÃ©rÃ©e avec succÃ¨s")}catch(F){p(F.message||"Erreur lors de la rÃ©gÃ©nÃ©ration")}},X=async()=>{const m=i.filter(F=>{const Y=b.find(ne=>ne.id===F);return Y&&["draft","pending_validation"].includes(Y.status)});if(m.length===0){p("Aucune carte sÃ©lectionnÃ©e ne peut Ãªtre validÃ©e");return}try{const F=await Fe.bulkValidateCards(m);I(Y=>Y.map(ne=>F.find(Ee=>Ee.id===ne.id)||ne)),E([]),R(`${F.length} carte(s) validÃ©e(s) avec succÃ¨s`)}catch(F){p(F.message||"Erreur lors de la validation en lot")}},S=m=>{D(m),k(!0)},Q=m=>{E(F=>F.includes(m)?F.filter(Y=>Y!==m):[...F,m])};return N?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"Chargement des cartes scolaires..."})]})}):e.jsxs("div",{className:"space-y-6",children:[b.length===0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(a,{name:"Info",size:20,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-body font-body-semibold text-blue-900 mb-1",children:"Aucune carte scolaire"}),e.jsx("p",{className:"text-sm text-blue-700",children:`Aucune carte n'a encore Ã©tÃ© gÃ©nÃ©rÃ©e. Utilisez le bouton "Nouvelle Carte" pour crÃ©er des cartes scolaires pour vos Ã©lÃ¨ves.`})]})]})}),O&&e.jsx("div",{className:"p-3 bg-error/10 border border-error/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:"AlertCircle",size:16,className:"text-error"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-error",children:O}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>p(""),className:"ml-auto",children:e.jsx(a,{name:"X",size:16})})]})}),z&&e.jsx("div",{className:"p-3 bg-success/10 border border-success/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:"CheckCircle",size:16,className:"text-success"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-success",children:z}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>R(""),className:"ml-auto",children:e.jsx(a,{name:"X",size:16})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-bold text-xl text-text-primary",children:"Cartes Scolaires"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary mt-1",children:"GÃ©rez la gÃ©nÃ©ration et validation des cartes d'identitÃ© Ã©tudiante"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"outline",iconName:"CheckCircle",iconPosition:"left",onClick:X,disabled:i.length===0,children:["Valider sÃ©lection (",i.length,")"]}),e.jsxs(j,{variant:"outline",iconName:"Printer",iconPosition:"left",onClick:ae,disabled:i.length===0,children:["Imprimer sÃ©lection (",i.length,")"]}),e.jsx(j,{variant:"default",iconName:"CreditCard",iconPosition:"left",onClick:x,children:"Nouvelle Carte"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-card rounded-lg border border-border p-6 cursor-pointer hover:bg-muted/30 transition-colors",onClick:x,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"CreditCard",size:24,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary mb-1",children:"GÃ©nÃ©ration rapide"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary",children:"CrÃ©er une nouvelle carte pour un Ã©lÃ¨ve"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-6 cursor-pointer hover:bg-muted/30 transition-colors",onClick:X,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-warning/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"CheckCircle",size:24,className:"text-warning"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary mb-1",children:["Validation en lot",i.length>0&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-warning/20 text-warning rounded-full text-xs",children:i.length})]}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary",children:"Valider plusieurs cartes simultanÃ©ment"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-6 cursor-pointer hover:bg-muted/30 transition-colors",onClick:ae,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-success/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Printer",size:24,className:"text-success"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary mb-1",children:["Impression",i.length>0&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-success/20 text-success rounded-full text-xs",children:i.length})]}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary",children:"Imprimer les cartes validÃ©es"})]})]})})]}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(K,{type:"search",placeholder:"Rechercher par nom, numÃ©ro de carte...",value:g,onChange:m=>{var F;return l((F=m==null?void 0:m.target)==null?void 0:F.value)},className:"w-full"}),e.jsx(oe,{placeholder:"Filtrer par classe",options:U,value:s,onChange:o}),e.jsx(oe,{placeholder:"Filtrer par statut",options:B,value:n,onChange:t})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border overflow-hidden",children:N?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"font-body font-body-normal text-text-secondary",children:"Chargement des cartes..."})]})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 w-12",children:e.jsx(qe,{checked:i.length===w.length,onChange:m=>{m.target.checked?E(w.map(F=>F.id)):E([])}})}),e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Ã‰lÃ¨ve"}),e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"NumÃ©ro de carte"}),e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Classe"}),e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Dates"}),e.jsx("th",{className:"text-left p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Statut"}),e.jsx("th",{className:"text-right p-4 font-heading font-heading-semibold text-sm text-text-primary",children:"Actions"})]})}),e.jsx("tbody",{children:w==null?void 0:w.map(m=>e.jsxs("tr",{className:"border-t border-border hover:bg-muted/30",children:[e.jsx("td",{className:"p-4",children:e.jsx(qe,{checked:i.includes(m.id),onChange:()=>Q(m.id)})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(He,{src:m==null?void 0:m.photo,alt:m==null?void 0:m.studentName,className:"w-10 h-10 rounded-full object-cover",fallback:"/public/assets/images/no_image.png"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-medium text-sm text-text-primary",children:m==null?void 0:m.studentName}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["ID: ",m==null?void 0:m.studentId]})]})]})}),e.jsx("td",{className:"p-4",children:e.jsx("p",{className:"font-body font-body-normal text-sm text-text-primary font-mono",children:m==null?void 0:m.cardNumber})}),e.jsx("td",{className:"p-4",children:e.jsx("p",{className:"font-body font-body-normal text-sm text-text-primary",children:m==null?void 0:m.class})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-body font-body-normal text-sm text-text-primary",children:["Ã‰mise: ",m==null?void 0:m.issueDate]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["Expire: ",m==null?void 0:m.expiryDate]})]})}),e.jsx("td",{className:"p-4",children:M(m==null?void 0:m.status)}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>S(m),title:"AperÃ§u",children:e.jsx(a,{name:"Eye",size:16})}),(m==null?void 0:m.status)==="pending_validation"&&e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>_(m==null?void 0:m.id),title:"Valider",children:e.jsx(a,{name:"CheckCircle",size:16})}),((m==null?void 0:m.status)==="issued"||(m==null?void 0:m.status)==="printed")&&e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>J(m==null?void 0:m.id),title:"Imprimer",children:e.jsx(a,{name:"Printer",size:16})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>V(m==null?void 0:m.studentId),title:"RÃ©gÃ©nÃ©rer",children:e.jsx(a,{name:"RotateCcw",size:16})})]})})]},m==null?void 0:m.id))})]}),(w==null?void 0:w.length)===0&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(a,{name:"CreditCard",size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary",children:"Aucune carte trouvÃ©e avec les critÃ¨res de recherche"})]})]})}),T&&u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:"AperÃ§u Carte Scolaire"}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>k(!1),children:e.jsx(a,{name:"X",size:20})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-primary to-primary/80 rounded-lg p-6 text-white shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading font-heading-bold text-lg",children:"EduTrack-CM"}),e.jsx("p",{className:"font-caption font-caption-normal text-sm opacity-90",children:"Ã‰cole Primaire"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-mono text-sm",children:u==null?void 0:u.cardNumber}),e.jsx("p",{className:"font-caption font-caption-normal text-xs opacity-90",children:"AnnÃ©e 2024-2025"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx(He,{src:u==null?void 0:u.photo,alt:u==null?void 0:u.studentName,className:"w-16 h-16 rounded-lg object-cover border-2 border-white",fallback:"/public/assets/images/no_image.png"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-heading font-heading-semibold text-lg",children:u==null?void 0:u.studentName}),e.jsxs("p",{className:"font-body font-body-normal text-sm opacity-90",children:["Classe: ",u==null?void 0:u.class]})]})]}),e.jsxs("div",{className:"border-t border-white/20 pt-3 mt-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs opacity-75",children:"Groupe sanguin"}),e.jsx("p",{className:"font-body font-body-medium",children:u==null?void 0:u.bloodType})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs opacity-75",children:"Urgence"}),e.jsx("p",{className:"font-body font-body-medium text-xs",children:u==null?void 0:u.emergencyContact})]})]}),(u==null?void 0:u.medicalNotes)&&(u==null?void 0:u.medicalNotes)!=="Aucune"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs opacity-75",children:"Notes mÃ©dicales"}),e.jsx("p",{className:"font-body font-body-normal text-xs",children:u==null?void 0:u.medicalNotes})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-3 border-t border-white/20",children:[e.jsxs("p",{className:"font-caption font-caption-normal text-xs opacity-75",children:["Valide jusqu'au ",u==null?void 0:u.expiryDate]}),e.jsx("div",{className:"w-8 h-8 bg-white rounded flex items-center justify-center",children:e.jsx(a,{name:"Shield",size:16,className:"text-primary"})})]})]})}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-border",children:[e.jsx(j,{variant:"default",onClick:()=>J(u==null?void 0:u.id),children:"Imprimer"}),e.jsx(j,{variant:"outline",onClick:()=>k(!1),children:"Fermer"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-muted/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"FileEdit",size:20,className:"text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:(r=b==null?void 0:b.filter(m=>(m==null?void 0:m.status)==="draft"))==null?void 0:r.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Brouillons"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-warning/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Clock",size:20,className:"text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:(f=b==null?void 0:b.filter(m=>(m==null?void 0:m.status)==="pending_validation"))==null?void 0:f.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"En validation"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-success/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"CheckCircle",size:20,className:"text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:(W=b==null?void 0:b.filter(m=>(m==null?void 0:m.status)==="issued"))==null?void 0:W.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Ã‰mises"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Printer",size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:(G=b==null?void 0:b.filter(m=>(m==null?void 0:m.status)==="printed"))==null?void 0:G.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"ImprimÃ©es"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-error/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"AlertCircle",size:20,className:"text-error"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:(q=b==null?void 0:b.filter(m=>(m==null?void 0:m.status)==="expired"))==null?void 0:q.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"ExpirÃ©es"})]})]})})]}),e.jsx(Fs,{isOpen:C,onClose:()=>P(!1),onCardGenerated:d})]})},Ae={getAllAbsences:async()=>{try{const g=await ge();if(!g)throw new Error("Pas d'Ã©cole associÃ©e");const{data:l,error:s}=await Z.from("students").select(`
          id,
          first_name,
          last_name,
          user_id,
          created_at
        `).eq("school_id",g).eq("is_active",!0).order("created_at",{ascending:!1}).limit(20);if(s)throw s;return l.map((n,t)=>({id:t+1,studentId:n.user_id||n.id,studentName:`${n.first_name} ${n.last_name}`,class:"Non assignÃ©",date:new Date().toISOString().split("T")[0],period:["Matin","AprÃ¨s-midi"][t%2],status:["reported","contacted","justified_received"][t%3],reason:"Ã€ prÃ©ciser",parentName:"Ã€ renseigner",parentPhone:"Ã€ renseigner",parentEmail:"Ã€ renseigner",notificationSent:t%2===0,lastContact:new Date().toISOString().split("T")[0],justificationReceived:t%3===0,justificationDocument:null,createdAt:n.created_at}))}catch(g){return console.error("Erreur chargement absences:",g),[]}},searchStudents:async(g="")=>{try{const l=await ge();if(!l)throw new Error("Pas d'Ã©cole associÃ©e");let s=Z.from("students").select(`
          id,
          user_id,
          first_name,
          last_name
        `).eq("school_id",l).eq("is_active",!0);g&&g.trim()!==""&&(s=s.or(`
          first_name.ilike.%${g}%,
          last_name.ilike.%${g}%
        `));const{data:o,error:n}=await s.order("first_name").limit(50);if(n)throw n;return o.map(i=>({id:i.user_id||i.id,name:`${i.first_name} ${i.last_name}`,class:"Non assignÃ©",parentName:"Ã€ renseigner",parentPhone:"Ã€ renseigner",parentEmail:"Ã€ renseigner"}))}catch(l){return console.error("Erreur recherche Ã©tudiants:",l),[]}},getAllNotificationHistory:async()=>{try{const g=await ge();if(!g)return[];const{data:l,error:s}=await Z.from("students").select("id, user_id, first_name, last_name, created_at").eq("school_id",g).eq("is_active",!0).order("created_at",{ascending:!1}).limit(10);if(s)throw s;if(!l||l.length===0)return[];const o=[];return l.forEach((n,t)=>{const i=["sms","email","call"],E=["sent","successful","failed"],T=["Rappel d'absence non justifiÃ©e","Demande de justificatif","Information retard rÃ©pÃ©tÃ©","Convocation des parents"],k=Math.floor(Math.random()*3)+1;for(let u=0;u<k;u++){const D=new Date;D.setDate(D.getDate()-(t*3+u+1)),o.push({id:o.length+1,date:D.toISOString().split("T")[0],type:i[u%i.length],status:E[Math.floor(Math.random()*E.length)],message:T[u%T.length],studentName:`${n.first_name} ${n.last_name}`,absenceDate:D.toISOString().split("T")[0],absenceType:["absence","late"][u%2],recipientName:"Parent/Tuteur",recipientContact:`+237 6XX XX XX ${(t+10).toString().padStart(2,"0")}`,duration:i[u%i.length]==="call"?`${Math.floor(Math.random()*5)+1} min`:void 0})}}),o.sort((n,t)=>new Date(t.date)-new Date(n.date)),o}catch(g){return console.error("Erreur getAllNotificationHistory:",g),[]}}},Os=({isOpen:g,onClose:l,absence:s,onAbsenceUpdated:o})=>{const[n,t]=c.useState(""),[i,E]=c.useState(""),[T,k]=c.useState([]),[u,D]=c.useState(!1),[C,P]=c.useState(""),b=[{value:"medical",label:"Rendez-vous mÃ©dical"},{value:"illness",label:"Maladie"},{value:"family",label:"Raisons familiales"},{value:"transport",label:"ProblÃ¨me de transport"},{value:"emergency",label:"Urgence familiale"},{value:"appointment",label:"Rendez-vous administratif"},{value:"travel",label:"Voyage prÃ©vu"},{value:"custom",label:"Autre raison..."}];c.useEffect(()=>{g&&s&&(t(s.justification?"custom":""),E(s.justification||""),k([]),P(""))},[g,s]);const I=async z=>{var R;if(z.preventDefault(),!n){P("Veuillez sÃ©lectionner une raison");return}if(n==="custom"&&!i.trim()){P("Veuillez prÃ©ciser la raison personnalisÃ©e");return}try{D(!0),P("");const U={reason:n==="custom"?i.trim():(R=b.find(M=>M.value===n))==null?void 0:R.label,documents:T},B=await Ae.justifyAbsence(s.id,U);o&&o(B),N()}catch(L){P(L.message||"Erreur lors de la justification")}finally{D(!1)}},N=()=>{t(""),E(""),k([]),P(""),D(!1),l()},v=z=>{const L=Array.from(z.target.files).map(U=>({id:Date.now()+Math.random(),name:U.name,size:U.size,type:U.type,uploadDate:new Date().toISOString()}));k(U=>[...U,...L])},O=z=>{k(R=>R.filter(L=>L.id!==z))},p=z=>{if(z===0)return"0 B";const R=1024,L=["B","KB","MB"],U=Math.floor(Math.log(z)/Math.log(R));return parseFloat((z/Math.pow(R,U)).toFixed(1))+" "+L[U]};return!g||!s?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:"Justifier l'Absence"}),e.jsxs("p",{className:"font-body font-body-normal text-sm text-text-secondary mt-1",children:[s.studentName," - ",s.absenceDate]})]}),e.jsx(j,{variant:"ghost",size:"icon",onClick:N,children:e.jsx(a,{name:"X",size:20})})]}),C&&e.jsx("div",{className:"mx-6 mt-4 p-3 bg-error/10 border border-error/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:"AlertCircle",size:16,className:"text-error"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-error",children:C})]})}),e.jsxs("form",{onSubmit:I,className:"p-6",children:[e.jsxs("div",{className:"bg-muted/20 rounded-lg p-4 mb-6",children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-sm text-text-primary mb-3",children:"DÃ©tails de l'absence"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Ã‰lÃ¨ve"}),e.jsxs("p",{className:"font-body font-body-normal text-text-primary",children:[s.studentName," (",s.class,")"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Type"}),e.jsx("p",{className:"font-body font-body-normal text-text-primary",children:s.type==="absence"?"Absence":"Retard"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Date"}),e.jsx("p",{className:"font-body font-body-normal text-text-primary",children:s.absenceDate})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"DurÃ©e"}),e.jsx("p",{className:"font-body font-body-normal text-text-primary",children:s.duration})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"Raison de l'absence *"}),e.jsx(oe,{options:b,value:n,onChange:t,placeholder:"SÃ©lectionnez une raison",className:"w-full"})]}),n==="custom"&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"PrÃ©cisez la raison *"}),e.jsx("textarea",{value:i,onChange:z=>E(z.target.value),placeholder:"DÃ©crivez la raison de l'absence...",className:"w-full px-3 py-2 border border-border rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary",rows:3,maxLength:500}),e.jsxs("p",{className:"text-xs text-text-secondary mt-1",children:[i.length,"/500 caractÃ¨res"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"Documents justificatifs (optionnel)"}),e.jsx("div",{className:"border-2 border-dashed border-border rounded-lg p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(a,{name:"Upload",size:32,className:"text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary mb-2",children:"Glissez vos fichiers ici ou cliquez pour sÃ©lectionner"}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:v,className:"hidden",id:"file-upload"}),e.jsx(j,{type:"button",variant:"outline",size:"sm",onClick:()=>document.getElementById("file-upload").click(),children:"SÃ©lectionner des fichiers"})]})}),T.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("p",{className:"font-body font-body-medium text-sm text-text-primary",children:"Documents ajoutÃ©s:"}),T.map(z=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:"File",size:16,className:"text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-normal text-sm text-text-primary",children:z.name}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:p(z.size)})]})]}),e.jsx(j,{type:"button",variant:"ghost",size:"icon",onClick:()=>O(z.id),children:e.jsx(a,{name:"Trash",size:16})})]},z.id))]})]}),e.jsx("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(a,{name:"Info",size:16,className:"text-primary mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-medium text-sm text-primary mb-1",children:"Information importante"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary",children:"Cette justification sera enregistrÃ©e dans le dossier de l'Ã©lÃ¨ve et les parents seront automatiquement notifiÃ©s de l'acceptation."})]})]})})]}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-border",children:[e.jsx(j,{variant:"outline",onClick:N,disabled:u,children:"Annuler"}),e.jsx(j,{type:"submit",variant:"default",onClick:I,disabled:u,iconName:u?void 0:"CheckCircle",iconPosition:"left",children:u?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Justification..."})]}):"Justifier l'Absence"})]})]})})},Bs=({isOpen:g,onClose:l,onAbsenceCreated:s})=>{const[o,n]=c.useState(1),[t,i]=c.useState(""),[E,T]=c.useState([]),[k,u]=c.useState(null),[D,C]=c.useState({date:new Date().toISOString().split("T")[0],type:"absence",duration:"",notes:""}),[P,b]=c.useState(!1),[I,N]=c.useState(!1),[v,O]=c.useState(""),p=[{value:"absence",label:"Absence"},{value:"late",label:"Retard"}],z={absence:[{value:"MatinÃ©e",label:"MatinÃ©e"},{value:"AprÃ¨s-midi",label:"AprÃ¨s-midi"},{value:"JournÃ©e complÃ¨te",label:"JournÃ©e complÃ¨te"}],late:[{value:"15 minutes",label:"15 minutes"},{value:"30 minutes",label:"30 minutes"},{value:"45 minutes",label:"45 minutes"},{value:"1 heure",label:"1 heure"},{value:"Plus d'1 heure",label:"Plus d'1 heure"}]};c.useEffect(()=>{g&&o===1&&R()},[g,o,t]);const R=async()=>{try{b(!0),O("");const x=await Ae.searchStudents(t);T(x)}catch(x){O("Erreur lors de la recherche des Ã©tudiants"),console.error("Erreur:",x)}finally{b(!1)}},L=x=>{u(x),n(2)},U=(x,d)=>{C(_=>({..._,[x]:d})),x==="type"&&C(_=>({..._,duration:""}))},B=async x=>{if(x.preventDefault(),!k){O("Veuillez sÃ©lectionner un Ã©tudiant");return}if(!D.date){O("Veuillez sÃ©lectionner une date");return}if(!D.duration){O("Veuillez sÃ©lectionner une durÃ©e");return}try{N(!0),O("");const d={studentId:k.id,date:new Date(D.date).toLocaleDateString("fr-FR"),type:D.type,duration:D.duration,notes:D.notes.trim()},_=await Ae.createAbsence(d);s&&s(_),M()}catch(d){O(d.message||"Erreur lors de la crÃ©ation de l'absence")}finally{N(!1)}},M=()=>{n(1),i(""),u(null),C({date:new Date().toISOString().split("T")[0],type:"absence",duration:"",notes:""}),O(""),b(!1),N(!1),l()},w=()=>{n(1),u(null),O("")};return g?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:o===1?"SÃ©lectionner un Ã‰tudiant":"Enregistrer une Absence"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary mt-1",children:o===1?"Choisissez l'Ã©tudiant pour lequel enregistrer une absence":"Saisissez les dÃ©tails de l'absence"})]}),e.jsx(j,{variant:"ghost",size:"icon",onClick:M,children:e.jsx(a,{name:"X",size:20})})]}),v&&e.jsx("div",{className:"mx-6 mt-4 p-3 bg-error/10 border border-error/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:"AlertCircle",size:16,className:"text-error"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-error",children:v})]})}),o===1&&e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx(K,{type:"search",placeholder:"Rechercher par nom, ID ou classe...",value:t,onChange:x=>i(x.target.value),className:"w-full",iconName:"Search",iconPosition:"left"})}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:P?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"font-body font-body-normal text-sm text-text-secondary",children:"Recherche en cours..."})]})}):E.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(a,{name:"Users",size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary",children:t?"Aucun Ã©tudiant trouvÃ© avec ces critÃ¨res":"Aucun Ã©tudiant disponible"})]}):E.map(x=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg hover:bg-muted/30 cursor-pointer transition-colors",onClick:()=>L(x),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(a,{name:"User",size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-body font-body-medium text-sm text-text-primary",children:x.name}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["ID: ",x.id]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["Classe: ",x.class]})]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["Parent: ",x.parentName]})]})]}),e.jsx(a,{name:"ChevronRight",size:16,className:"text-muted-foreground"})]},x.id))})]}),o===2&&k&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-muted/20 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(a,{name:"User",size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-sm text-text-primary",children:k.name}),e.jsxs("p",{className:"font-body font-body-normal text-xs text-text-secondary",children:[k.id," â€¢ Classe ",k.class]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Parent/Tuteur"}),e.jsx("p",{className:"font-body font-body-normal text-text-primary",children:k.parentName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Contact"}),e.jsx("p",{className:"font-body font-body-normal text-text-primary",children:k.parentPhone})]})]})]}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"Date de l'absence *"}),e.jsx(K,{type:"date",value:D.date,onChange:x=>U("date",x.target.value),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"Type *"}),e.jsx(oe,{options:p,value:D.type,onChange:x=>U("type",x),placeholder:"SÃ©lectionnez le type",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"DurÃ©e *"}),e.jsx(oe,{options:z[D.type]||[],value:D.duration,onChange:x=>U("duration",x),placeholder:"SÃ©lectionnez la durÃ©e",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"Notes supplÃ©mentaires (optionnel)"}),e.jsx("textarea",{value:D.notes,onChange:x=>U("notes",x.target.value),placeholder:"Informations complÃ©mentaires sur l'absence...",className:"w-full px-3 py-2 border border-border rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary",rows:3,maxLength:300}),e.jsxs("p",{className:"text-xs text-text-secondary mt-1",children:[D.notes.length,"/300 caractÃ¨res"]})]}),e.jsx("div",{className:"bg-warning/5 border border-warning/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(a,{name:"AlertTriangle",size:16,className:"text-warning mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-medium text-sm text-warning mb-1",children:"Information importante"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary",children:'Cette absence sera enregistrÃ©e comme "En attente de justification" et les parents seront automatiquement notifiÃ©s.'})]})]})})]})]}),e.jsx("div",{className:"flex gap-3 p-6 border-t border-border",children:o===1?e.jsx(j,{variant:"outline",onClick:M,children:"Annuler"}):e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"outline",onClick:w,children:"Retour"}),e.jsx(j,{variant:"default",onClick:B,disabled:I,iconName:I?void 0:"UserX",iconPosition:"left",children:I?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Enregistrement..."})]}):"Enregistrer l'Absence"})]})})]})}):null},Hs=({isOpen:g,onClose:l,absence:s=null})=>{const[o,n]=c.useState([]),[t,i]=c.useState(!1);c.useEffect(()=>{g&&E()},[g,s]);const E=async()=>{try{i(!0);let D=[];s?D=await Ae.getNotificationHistory(s.id):D=await Ae.getAllNotificationHistory(),n(D)}catch(D){console.error("Erreur chargement historique:",D),n([{id:1,date:new Date().toISOString(),type:"sms",status:"sent",message:"Rappel d'absence envoyÃ©",studentName:"Historique indisponible",recipientName:"SystÃ¨me",recipientContact:"N/A"}])}finally{i(!1)}},T=D=>{switch(D){case"sms":return"MessageSquare";case"email":return"Mail";case"call":return"Phone";default:return"Bell"}},k=D=>{switch(D){case"sms":return"text-blue-600";case"email":return"text-green-600";case"call":return"text-purple-600";default:return"text-gray-600"}},u=D=>{const C={sent:{label:"EnvoyÃ©",className:"bg-success/10 text-success"},successful:{label:"RÃ©ussi",className:"bg-success/10 text-success"},failed:{label:"Ã‰chec",className:"bg-error/10 text-error"},pending:{label:"En attente",className:"bg-warning/10 text-warning"}},P=C[D]||C.pending;return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-caption ${P.className}`,children:P.label})};return g?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:"Historique des Notifications"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary mt-1",children:s?`${s.studentName} - ${s.absenceDate}`:"Toutes les notifications"})]}),e.jsx(j,{variant:"ghost",size:"icon",onClick:l,children:e.jsx(a,{name:"X",size:20})})]}),e.jsx("div",{className:"p-6",children:t?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"font-body font-body-normal text-sm text-text-secondary",children:"Chargement de l'historique..."})]})}):o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(a,{name:"Bell",size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("h4",{className:"font-heading font-heading-semibold text-lg text-text-primary mb-2",children:"Aucune notification"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary",children:"Aucune notification n'a Ã©tÃ© envoyÃ©e pour cette absence."})]}):e.jsx("div",{className:"space-y-4",children:o.map((D,C)=>e.jsxs("div",{className:"flex items-start space-x-4 p-4 bg-muted/20 rounded-lg",children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-muted flex items-center justify-center ${k(D.type)}`,children:e.jsx(a,{name:T(D.type),size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h5",{className:"font-body font-body-medium text-sm text-text-primary",children:D.type==="sms"?"SMS":D.type==="email"?"Email":D.type==="call"?"Appel tÃ©lÃ©phonique":"Notification"}),u(D.status)]}),!s&&D.studentName&&e.jsxs("p",{className:"font-body font-body-medium text-sm text-primary mb-1",children:["ðŸ‘¤ ",D.studentName," ",D.absenceDate&&`(${D.absenceDate})`]}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary mb-2",children:D.message}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-text-secondary",children:[e.jsxs("span",{children:["ðŸ“… ",D.date]}),D.recipientName&&e.jsxs("span",{children:["ðŸ‘¤ ",D.recipientName]}),D.recipientContact&&e.jsxs("span",{children:["ðŸ“ž ",D.recipientContact]}),D.duration&&e.jsxs("span",{children:["â±ï¸ ",D.duration]}),D.subject&&e.jsxs("span",{children:["ðŸ“ ",D.subject]})]})]})]},C))})}),e.jsx("div",{className:"flex justify-end p-6 border-t border-border",children:e.jsx(j,{variant:"outline",onClick:l,children:"Fermer"})})]})}):null},Xs=()=>{var W,G,q;const[g,l]=c.useState((q=(G=(W=new Date)==null?void 0:W.toISOString())==null?void 0:G.split("T"))==null?void 0:q[0]),[s,o]=c.useState(""),[n,t]=c.useState(""),[i,E]=c.useState([]),[T,k]=c.useState([]),[u,D]=c.useState(!0),[C,P]=c.useState(""),[b,I]=c.useState(""),[N,v]=c.useState(!1),[O,p]=c.useState(!1),[z,R]=c.useState(!1),[L,U]=c.useState(null),B=[{value:"",label:"Tous les statuts"},{value:"reported",label:"SignalÃ©e"},{value:"contacted",label:"Parents contactÃ©s"},{value:"justified_received",label:"Justificatif reÃ§u"},{value:"transmitted",label:"Transmis Ã  la direction"},{value:"late",label:"Retard"}];c.useEffect(()=>{M()},[]);const M=async()=>{try{D(!0),P("");const m=await Ae.getAllAbsences("production");E(m)}catch(m){P("Erreur lors du chargement des absences"),console.error("Erreur:",m)}finally{D(!1)}};c.useEffect(()=>{if(b){const m=setTimeout(()=>{I("")},5e3);return()=>clearTimeout(m)}},[b]);const w=m=>{const F={pending:{label:"En attente",className:"bg-warning/10 text-warning border-warning/20",icon:"Clock"},justified:{label:"JustifiÃ©e",className:"bg-success/10 text-success border-success/20",icon:"CheckCircle"},unjustified:{label:"Non justifiÃ©e",className:"bg-error/10 text-error border-error/20",icon:"AlertTriangle"}};return(F==null?void 0:F[m])||(F==null?void 0:F.pending)},x=m=>{const F={absence:{label:"Absence",className:"bg-primary/10 text-primary",icon:"UserX"},late:{label:"Retard",className:"bg-orange-100 text-orange-600",icon:"Clock"}};return(F==null?void 0:F[m])||(F==null?void 0:F.absence)},d=i.filter(m=>{const F=m.studentName.toLowerCase().includes(n.toLowerCase())||m.parentName.toLowerCase().includes(n.toLowerCase()),Y=s===""||m.status===s;return F&&Y}),_=async m=>{try{const F={successful:!0,duration:"3 min",notes:"Appel effectuÃ© concernant l'absence"},Y=await Ae.callParent(m,F);E(ne=>ne.map(de=>de.id===m?Y:de)),I("Appel parent enregistrÃ© avec succÃ¨s")}catch(F){P(F.message||"Erreur lors de l'enregistrement de l'appel")}},J=m=>{U(m),v(!0)},ae=m=>{E(F=>F.map(Y=>Y.id===m.id?m:Y)),I("Absence mise Ã  jour avec succÃ¨s")},V=m=>{E(F=>[...F,m]),I(`Absence enregistrÃ©e pour ${m.studentName}`)},X=async(m,F="sms")=>{try{const Y="Rappel concernant l'absence de votre enfant. Merci de nous contacter.";F==="sms"?await Ae.sendSMSReminder(m,Y):await Ae.sendEmailReminder(m,{subject:"Absence de votre enfant",message:Y}),M(),I(`Rappel ${F} envoyÃ© avec succÃ¨s`)}catch(Y){P(Y.message||"Erreur lors de l'envoi du rappel")}},S=async()=>{if(T.length===0){P("Veuillez sÃ©lectionner au moins une absence");return}try{await Ae.bulkSendReminders(T,"sms","Rappel concernant l'absence de votre enfant."),M(),k([]),I(`Rappels envoyÃ©s pour ${T.length} absence(s)`)}catch(m){P(m.message||"Erreur lors de l'envoi des rappels")}},Q=async()=>{const m=T.filter(F=>{const Y=i.find(ne=>ne.id===F);return Y&&Y.status!=="justified"});if(m.length===0){P("Aucune absence sÃ©lectionnÃ©e ne peut Ãªtre justifiÃ©e");return}try{await Ae.bulkJustifyAbsences(m,"Justification groupÃ©e par l'administration"),M(),k([]),I(`${m.length} absence(s) justifiÃ©e(s)`)}catch(F){P(F.message||"Erreur lors de la justification groupÃ©e")}},r=m=>{k(F=>F.includes(m)?F.filter(Y=>Y!==m):[...F,m])},f={pending:i.filter(m=>m.status==="pending").length,unjustified:i.filter(m=>m.status==="unjustified").length,toCall:i.filter(m=>!m.notifiedParent&&m.status==="pending").length,late:i.filter(m=>m.type==="late").length};return e.jsxs("div",{className:"space-y-6",children:[C&&e.jsx("div",{className:"p-3 bg-error/10 border border-error/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:"AlertCircle",size:16,className:"text-error"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-error",children:C}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>P(""),className:"ml-auto",children:e.jsx(a,{name:"X",size:16})})]})}),b&&e.jsx("div",{className:"p-3 bg-success/10 border border-success/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:"CheckCircle",size:16,className:"text-success"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-success",children:b}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>I(""),className:"ml-auto",children:e.jsx(a,{name:"X",size:16})})]})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-bold text-2xl text-text-primary",children:"Gestion des Absences"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary mt-1",children:"Suivi des absences et retards, justifications et relances parents"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"default",iconName:"Plus",iconPosition:"left",onClick:()=>p(!0),children:"Nouvelle Absence"}),e.jsx(j,{variant:"outline",iconName:"History",iconPosition:"left",onClick:()=>R(!0),children:"Historique"})]})]}),T.length>0&&e.jsx("div",{className:"bg-accent/5 border border-accent/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a,{name:"CheckSquare",size:20,className:"text-accent"}),e.jsxs("span",{className:"font-body font-body-medium text-text-primary",children:[T.length," absence(s) sÃ©lectionnÃ©e(s)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",size:"sm",iconName:"CheckCircle",iconPosition:"left",onClick:Q,children:"Justifier la sÃ©lection"}),e.jsx(j,{variant:"outline",size:"sm",iconName:"Mail",iconPosition:"left",onClick:S,children:"Envoyer des rappels"}),e.jsx(j,{variant:"ghost",size:"sm",iconName:"X",onClick:()=>k([]),title:"DÃ©sÃ©lectionner tout"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-warning/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Clock",size:24,className:"text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-bold text-2xl text-text-primary",children:f.pending}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-text-secondary",children:"En attente justification"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-error/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"AlertTriangle",size:24,className:"text-error"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-bold text-2xl text-text-primary",children:f.unjustified}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-text-secondary",children:"Non justifiÃ©es"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Phone",size:24,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-bold text-2xl text-text-primary",children:f.toCall}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-text-secondary",children:"Parents Ã  appeler"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Clock",size:24,className:"text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-bold text-2xl text-text-primary",children:f.late}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-text-secondary",children:"Retards"})]})]})})]}),e.jsxs("div",{className:"bg-card rounded-lg border border-border p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(K,{placeholder:"Rechercher un Ã©lÃ¨ve ou parent...",value:n,onChange:m=>t(m.target.value),iconName:"Search",iconPosition:"left"}),e.jsx(oe,{options:B,value:s,onChange:o,placeholder:"Filtrer par statut"}),e.jsx(K,{type:"date",value:g,onChange:m=>l(m.target.value),iconName:"Calendar",iconPosition:"left"})]}),d.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t border-border",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:"SÃ©lection :"}),e.jsx(j,{variant:"ghost",size:"xs",onClick:()=>{const m=d.map(F=>F.id);k(m)},children:"Tout sÃ©lectionner"}),e.jsx(j,{variant:"ghost",size:"xs",onClick:()=>k([]),children:"Tout dÃ©sÃ©lectionner"}),e.jsxs("span",{className:"text-sm text-text-secondary ml-2",children:[d.length," absence(s) affichÃ©e(s)"]})]})]}),e.jsxs("div",{className:"bg-card rounded-lg border border-border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:["Absences et Retards (",d.length,")"]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(j,{variant:"ghost",size:"sm",children:[e.jsx(a,{name:"Download",size:16,className:"mr-2"}),"Exporter"]})})]}),u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"font-body font-body-normal text-text-secondary",children:"Chargement des absences..."})]})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left py-3 px-4 w-12",children:e.jsx(qe,{checked:T.length===d.length,onChange:m=>{m.target.checked?k(d.map(F=>F.id)):k([])}})}),e.jsx("th",{className:"text-left py-3 px-4 font-body font-body-semibold text-sm text-text-secondary",children:"Ã‰lÃ¨ve"}),e.jsx("th",{className:"text-left py-3 px-4 font-body font-body-semibold text-sm text-text-secondary",children:"Date / Type"}),e.jsx("th",{className:"text-left py-3 px-4 font-body font-body-semibold text-sm text-text-secondary",children:"DurÃ©e"}),e.jsx("th",{className:"text-left py-3 px-4 font-body font-body-semibold text-sm text-text-secondary",children:"Statut"}),e.jsx("th",{className:"text-left py-3 px-4 font-body font-body-semibold text-sm text-text-secondary",children:"Justification"}),e.jsx("th",{className:"text-left py-3 px-4 font-body font-body-semibold text-sm text-text-secondary",children:"Actions"})]})}),e.jsx("tbody",{children:d.map(m=>{const F=w(m.status),Y=x(m.type);return e.jsxs("tr",{className:"border-b border-border hover:bg-muted/50 transition-micro",children:[e.jsx("td",{className:"py-4 px-4",children:e.jsx(qe,{checked:T.includes(m.id),onChange:()=>r(m.id)})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-body font-body-semibold text-sm text-text-primary",children:m.studentName}),e.jsxs("div",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:[m.class," - ",m.studentId]}),e.jsxs("div",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:[m.parentName," - ",m.parentPhone]})]})}),e.jsxs("td",{className:"py-4 px-4",children:[e.jsx("div",{className:"font-body font-body-normal text-sm text-text-primary",children:m.absenceDate}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${Y.className}`,children:[e.jsx(a,{name:Y.icon,size:12,className:"mr-1"}),Y.label]})]}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("div",{className:"font-body font-body-normal text-sm text-text-primary",children:m.duration})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${F.className}`,children:[e.jsx(a,{name:F.icon,size:12,className:"mr-1"}),F.label]})}),e.jsxs("td",{className:"py-4 px-4",children:[e.jsx("div",{className:"font-body font-body-normal text-sm text-text-primary",children:m.justification||"-"}),m.justificationDate&&e.jsxs("div",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["Le ",m.justificationDate]})]}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[m.status==="pending"&&e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>_(m.id),title:"Appeler parent",children:e.jsx(a,{name:"Phone",size:16})}),m.status!=="justified"&&e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>J(m),title:"Justifier",children:e.jsx(a,{name:"CheckCircle",size:16})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>X(m.id,"sms"),title:"SMS",children:e.jsx(a,{name:"MessageSquare",size:16})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>X(m.id,"email"),title:"Email",children:e.jsx(a,{name:"Mail",size:16})}),m.notificationHistory&&m.notificationHistory.length>0&&e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>{U(m),R(!0)},title:"Historique des notifications",children:e.jsx(a,{name:"History",size:16})})]})})]},m.id)})})]}),d.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(a,{name:"CheckCircle",size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary mb-2",children:"Aucune absence trouvÃ©e"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary",children:"Aucune absence ne correspond Ã  vos critÃ¨res de recherche."})]})]})]}),e.jsx(Os,{isOpen:N,onClose:()=>v(!1),absence:L,onAbsenceUpdated:ae}),e.jsx(Bs,{isOpen:O,onClose:()=>p(!1),onAbsenceCreated:V}),e.jsx(Hs,{isOpen:z,onClose:()=>R(!1),absence:L})]})},Gs=({message:g,type:l="success",duration:s=5e3,onClose:o})=>{const[n,t]=c.useState(!0),[i,E]=c.useState(!1);c.useEffect(()=>{const C=setTimeout(()=>{E(!0),setTimeout(()=>{t(!1),o&&o()},300)},s);return()=>clearTimeout(C)},[s,o]);const T=()=>{E(!0),setTimeout(()=>{t(!1),o&&o()},300)},k=C=>{const P={success:{icon:ms,className:"bg-green-50 border-green-200 text-green-800",iconColor:"text-green-500"},error:{icon:Cs,className:"bg-red-50 border-red-200 text-red-800",iconColor:"text-red-500"},warning:{icon:ls,className:"bg-yellow-50 border-yellow-200 text-yellow-800",iconColor:"text-yellow-500"},info:{icon:ws,className:"bg-blue-50 border-blue-200 text-blue-800",iconColor:"text-blue-500"}};return P[C]||P.success};if(!n)return null;const u=k(l),D=u.icon;return e.jsx("div",{className:`fixed top-4 left-1/2 transform -translate-x-1/2 z-50 transition-all duration-300 ${i?"translate-y-[-100px] opacity-0":"translate-y-0 opacity-100"}`,children:e.jsxs("div",{className:`
        flex items-center p-4 rounded-lg border shadow-lg max-w-md
        ${u.className}
        transform transition-all duration-300
      `,children:[e.jsx(D,{className:`w-5 h-5 mr-3 ${u.iconColor}`}),e.jsx("p",{className:"text-sm font-medium flex-1",children:g}),e.jsx("button",{onClick:T,className:"ml-3 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Re,{className:"w-4 h-4"})})]})})},hs=({toasts:g,removeToast:l})=>e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 space-y-2 w-full max-w-md",children:g.map(s=>e.jsx(Gs,{message:s.message,type:s.type,duration:s.duration,onClose:()=>l(s.id)},s.id))}),ps=()=>{const[g,l]=c.useState([]),s=(n,t="success",i=5e3)=>{const E=Date.now()+Math.random(),T={id:E,message:n,type:t,duration:i};l(k=>[...k,T]),setTimeout(()=>{o(E)},i+300)},o=n=>{l(t=>t.filter(i=>i.id!==n))};return{toasts:g,addToast:s,removeToast:o,showSuccess:(n,t=6e3)=>s(n,"success",t),showError:(n,t=8e3)=>s(n,"error",t),showWarning:(n,t=7e3)=>s(n,"warning",t),showInfo:(n,t=5e3)=>s(n,"info",t)}},Se={getAllPayments:async()=>{try{const g=await ge();if(!g)throw new Error("Pas d'Ã©cole associÃ©e");const{data:l,error:s}=await Z.from("students").select(`
          id,
          user_id,
          first_name,
          last_name,
          school_id,
          is_active,
          created_at
        `).eq("school_id",g).eq("is_active",!0).order("created_at",{ascending:!1}).limit(15);if(s)throw s;if(!l||l.length===0)return{payments:[],statistics:{total:0,collected:0,overdue:0,outstanding:0}};const o=l.map((t,i)=>{const E=2e4+i%3*5e3,T=["completed","pending","overdue","partial"],k=T[i%T.length],u=k==="completed"?E:k==="partial"?Math.floor(E*.6):0;return{id:i+1,student:{studentId:t.user_id||t.id,firstName:t.first_name,lastName:t.last_name,class:"Non assignÃ©",parentName:"Ã€ renseigner",parentPhone:"Ã€ renseigner",parentEmail:"Ã€ renseigner"},feeType:["Frais de scolaritÃ©","Transport","Cantine","Uniforme"][i%4],period:"Novembre 2024",description:"Paiement mensuel",totalAmount:E,amountPaid:u,remainingBalance:E-u,status:k,dueDate:"2024-11-15",paymentDate:k==="completed"||k==="partial"?"2024-11-10":null,paymentMethod:k==="completed"||k==="partial"?["Mobile Money","EspÃ¨ces","Virement"][i%3]:null,receiptId:k==="completed"||k==="partial"?`REC${(i+1).toString().padStart(3,"0")}`:null,paymentHistory:k==="completed"||k==="partial"?[{date:"2024-11-10",amount:u,method:["Mobile Money","EspÃ¨ces","Virement"][i%3],reference:`REF${i+1}`,receivedBy:"SecrÃ©taire"}]:[],createdAt:t.created_at}}),n=o.reduce((t,i)=>(t.total+=i.totalAmount||0,t.collected+=i.amountPaid||0,i.status==="overdue"&&(t.overdue+=i.totalAmount-(i.amountPaid||0)),t),{total:0,collected:0,overdue:0});return n.outstanding=n.total-n.collected,{payments:o,statistics:n}}catch(g){return console.error("Erreur chargement paiements:",g),{payments:[],statistics:{total:0,collected:0,overdue:0,outstanding:0}}}},searchStudents:async(g="")=>{try{const l=await ge();if(!l)return[];let s=Z.from("students").select("id, user_id, first_name, last_name").eq("school_id",l).eq("is_active",!0);g&&g.trim()!==""&&(s=s.or(`first_name.ilike.%${g}%, last_name.ilike.%${g}%`));const{data:o,error:n}=await s.order("first_name").limit(50);if(n)throw n;return(o==null?void 0:o.map(t=>({id:t.user_id||t.id,name:`${t.first_name} ${t.last_name}`,class:"Non assignÃ©",parentName:"Ã€ renseigner",parentPhone:"Ã€ renseigner",parentEmail:"Ã€ renseigner"})))||[]}catch(l){return console.error("Erreur searchStudents:",l),[]}}},Vs=({isOpen:g,onClose:l,onPaymentRecorded:s,selectedPayment:o=null})=>{const[n,t]=c.useState(1),[i,E]=c.useState(""),[T,k]=c.useState([]),[u,D]=c.useState([]),[C,P]=c.useState(null),[b,I]=c.useState({feeType:"",period:"",amount:"",totalAmount:"",paymentMethod:"",reference:"",description:"",dueDate:new Date().toISOString().split("T")[0]}),[N,v]=c.useState(!1),[O,p]=c.useState(!1),[z,R]=c.useState(""),L=[{value:"cash",label:"EspÃ¨ces"},{value:"mobile_money",label:"Mobile Money"},{value:"bank_transfer",label:"Virement bancaire"},{value:"check",label:"ChÃ¨que"},{value:"card",label:"Carte bancaire"}],U=new Date().toLocaleDateString("fr-FR",{month:"long",year:"numeric"}),B=[{value:U,label:U},{value:"Octobre 2024",label:"Octobre 2024"},{value:"Septembre 2024",label:"Septembre 2024"},{value:"AoÃ»t 2024",label:"AoÃ»t 2024"}];c.useEffect(()=>{g&&(M(),o&&w())},[g,o]);const M=async()=>{try{v(!0);const[S,Q]=await Promise.all([Se.searchStudents(i),Se.getFeeTypes()]);k(S),D(Q)}catch{R("Erreur lors du chargement des donnÃ©es")}finally{v(!1)}},w=()=>{o&&(P({id:o.studentId,name:o.studentName,class:o.class,parentName:o.parentName,parentPhone:o.parentPhone}),I({feeType:o.feeType,period:o.period,amount:(o.amount-o.paidAmount).toString(),totalAmount:o.amount.toString(),paymentMethod:"",reference:"",description:o.description,dueDate:o.dueDate.split("/").reverse().join("-")}),t(2))};c.useEffect(()=>{if(n===1&&i!==""){const S=setTimeout(()=>{x()},300);return()=>clearTimeout(S)}},[i]);const x=async()=>{try{v(!0);const S=await Se.searchStudents(i);k(S)}catch{R("Erreur lors de la recherche")}finally{v(!1)}},d=S=>{P(S),t(2)},_=(S,Q)=>{if(I(r=>({...r,[S]:Q})),S==="feeType"&&Q){const r=u.find(f=>f.id===Q);r&&!b.totalAmount&&I(f=>({...f,totalAmount:r.amount.toString(),amount:r.amount.toString(),description:r.name}))}},J=()=>C?b.feeType?b.period?!b.amount||parseFloat(b.amount)<=0?(R("Veuillez saisir un montant valide"),!1):b.paymentMethod?parseFloat(b.amount)>parseFloat(b.totalAmount||b.amount)?(R("Le montant payÃ© ne peut pas dÃ©passer le montant total"),!1):!0:(R("Veuillez sÃ©lectionner le mode de paiement"),!1):(R("Veuillez sÃ©lectionner la pÃ©riode"),!1):(R("Veuillez sÃ©lectionner le type de frais"),!1):(R("Veuillez sÃ©lectionner un Ã©tudiant"),!1),ae=async S=>{if(S.preventDefault(),!!J())try{p(!0),R("");const Q={studentId:C.id,feeType:b.feeType,period:b.period,amount:parseFloat(b.amount),totalAmount:parseFloat(b.totalAmount||b.amount),paymentMethod:b.paymentMethod,reference:b.reference.trim(),description:b.description.trim(),dueDate:new Date(b.dueDate).toLocaleDateString("fr-FR")},r=await Se.recordPayment(Q);s&&s(r),V()}catch(Q){R(Q.message||"Erreur lors de l'enregistrement du paiement")}finally{p(!1)}},V=()=>{t(1),E(""),P(null),I({feeType:"",period:"",amount:"",totalAmount:"",paymentMethod:"",reference:"",description:"",dueDate:new Date().toISOString().split("T")[0]}),R(""),v(!1),p(!1),l()},X=()=>{t(1),P(null),R("")};return g?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:o?"ComplÃ©ter le Paiement":n===1?"SÃ©lectionner un Ã‰tudiant":"Enregistrer un Paiement"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary mt-1",children:o?`Paiement pour ${o.studentName}`:n===1?"Choisissez l'Ã©tudiant pour lequel enregistrer un paiement":"Saisissez les dÃ©tails du paiement reÃ§u"})]}),e.jsx(j,{variant:"ghost",size:"icon",onClick:V,children:e.jsx(a,{name:"X",size:20})})]}),z&&e.jsx("div",{className:"mx-6 mt-4 p-3 bg-error/10 border border-error/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:"AlertCircle",size:16,className:"text-error"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-error",children:z})]})}),n===1&&!o&&e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx(K,{type:"search",placeholder:"Rechercher par nom, ID ou classe...",value:i,onChange:S=>E(S.target.value),className:"w-full",iconName:"Search",iconPosition:"left"})}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:N?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"font-body font-body-normal text-sm text-text-secondary",children:"Recherche en cours..."})]})}):T.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(a,{name:"Users",size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary",children:i?"Aucun Ã©tudiant trouvÃ© avec ces critÃ¨res":"Saisissez un nom pour rechercher un Ã©tudiant"})]}):T.map(S=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-border rounded-lg hover:bg-muted/30 cursor-pointer transition-colors",onClick:()=>d(S),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(a,{name:"User",size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-body font-body-medium text-sm text-text-primary",children:S.name}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["ID: ",S.id]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["Classe: ",S.class]})]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["Parent: ",S.parentName]})]})]}),e.jsx(a,{name:"ChevronRight",size:16,className:"text-muted-foreground"})]},S.id))})]}),(n===2||o)&&C&&e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"bg-muted/20 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(a,{name:"User",size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-sm text-text-primary",children:C.name}),e.jsxs("p",{className:"font-body font-body-normal text-xs text-text-secondary",children:[C.id," â€¢ Classe ",C.class]})]})]})}),e.jsxs("form",{onSubmit:ae,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"Type de frais *"}),e.jsx(oe,{options:u.map(S=>({value:S.id,label:S.name})),value:b.feeType,onChange:S=>_("feeType",S),placeholder:"SÃ©lectionnez le type de frais",disabled:!!o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"PÃ©riode *"}),e.jsx(oe,{options:B,value:b.period,onChange:S=>_("period",S),placeholder:"SÃ©lectionnez la pÃ©riode",disabled:!!o})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"Montant total (FCFA) *"}),e.jsx(K,{type:"number",value:b.totalAmount,onChange:S=>_("totalAmount",S.target.value),placeholder:"0",disabled:!!o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"Montant payÃ© (FCFA) *"}),e.jsx(K,{type:"number",value:b.amount,onChange:S=>_("amount",S.target.value),placeholder:"0"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"Mode de paiement *"}),e.jsx(oe,{options:L,value:b.paymentMethod,onChange:S=>_("paymentMethod",S),placeholder:"SÃ©lectionnez le mode"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"RÃ©fÃ©rence (optionnel)"}),e.jsx(K,{value:b.reference,onChange:S=>_("reference",S.target.value),placeholder:"NumÃ©ro de transaction, chÃ¨que..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary mb-2",children:"Description"}),e.jsx(K,{value:b.description,onChange:S=>_("description",S.target.value),placeholder:"Description du paiement"})]}),b.amount&&b.totalAmount&&e.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:[e.jsx("h5",{className:"font-heading font-heading-semibold text-sm text-primary mb-2",children:"RÃ©sumÃ© du paiement"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-text-secondary",children:"Montant payÃ©:"}),e.jsxs("p",{className:"font-semibold text-text-primary",children:[parseInt(b.amount).toLocaleString()," FCFA"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-text-secondary",children:"Solde restant:"}),e.jsxs("p",{className:"font-semibold text-text-primary",children:[Math.max(0,parseInt(b.totalAmount||b.amount)-parseInt(b.amount)).toLocaleString()," FCFA"]})]})]})]})]})]}),e.jsx("div",{className:"flex gap-3 p-6 border-t border-border",children:n===1&&!o?e.jsx(j,{variant:"outline",onClick:V,children:"Annuler"}):e.jsxs(e.Fragment,{children:[!o&&e.jsx(j,{variant:"outline",onClick:X,children:"Retour"}),e.jsx(j,{variant:"outline",onClick:V,children:"Annuler"}),e.jsx(j,{variant:"default",onClick:ae,disabled:O,iconName:O?void 0:"DollarSign",iconPosition:"left",children:O?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Enregistrement..."})]}):"Enregistrer le Paiement"})]})})]})}):null},Ws=({isOpen:g,onClose:l,paymentId:s,studentData:o})=>{const[n,t]=c.useState(null),[i,E]=c.useState(!1),[T,k]=c.useState(""),u=c.useRef();c.useEffect(()=>{g&&s&&D()},[g,s]);const D=async()=>{E(!0),k("");try{const N=await Se.generateReceipt(s);t(N)}catch(N){k("Erreur lors du chargement du reÃ§u"),console.error("Erreur chargement reÃ§u:",N)}finally{E(!1)}},C=()=>{if(u.current){const N=ss.sanitize(u.current.innerHTML,{ALLOWED_TAGS:["div","span","p","h1","h2","h3","h4","table","thead","tbody","tr","th","td","strong","em","br","ul","ol","li","hr"],ALLOWED_ATTR:["class"]}),v=window.open("","_blank");v.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <title>ReÃ§u de Paiement</title>
            <style>
              * { margin: 0; padding: 0; box-sizing: border-box; }
              body { font-family: Arial, sans-serif; padding: 20px; }
              @media print { body { padding: 0; } }
            </style>
          </head>
          <body>
            ${N}
          </body>
        </html>
      `),v.document.close(),v.focus(),setTimeout(()=>{v.print(),v.close()},250)}},P=()=>{if(n){const N=ss.sanitize(u.current.innerHTML,{ALLOWED_TAGS:["div","span","p","h1","h2","h3","h4","table","thead","tbody","tr","th","td","strong","em","br","ul","ol","li","hr"],ALLOWED_ATTR:["class"]}),v=new Blob([N],{type:"text/html"}),O=URL.createObjectURL(v),p=document.createElement("a");p.href=O,p.download=`recu_${ss.sanitize(n.receiptNumber)}.html`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(O)}},b=N=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XAF",minimumFractionDigits:0}).format(N),I=N=>new Date(N).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return g?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ss,{className:"w-5 h-5"}),"ReÃ§u de Paiement"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:P,className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"TÃ©lÃ©charger"]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:C,className:"flex items-center gap-2",children:[e.jsx(_s,{className:"w-4 h-4"}),"Imprimer"]})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Re,{className:"w-6 h-6"})})]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:[i&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Chargement du reÃ§u..."})]}),T&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-red-600",children:T})}),n&&e.jsxs("div",{ref:u,className:"bg-white",children:[e.jsxs("div",{className:"text-center mb-8 border-b pb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Ã‰TABLISSEMENT SCOLAIRE"}),e.jsx("p",{className:"text-gray-600",children:"EduTrack-CM - SystÃ¨me de Gestion Scolaire"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Adresse de l'Ã©tablissement â€¢ TÃ©lÃ©phone â€¢ Email"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Informations du ReÃ§u"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"NÂ° ReÃ§u:"}),e.jsx("span",{className:"font-medium",children:n.receiptNumber})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium",children:I(n.date)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"ReÃ§u par:"}),e.jsx("span",{className:"font-medium",children:n.receivedBy})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Informations Ã‰lÃ¨ve"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Nom:"}),e.jsxs("span",{className:"font-medium",children:[n.student.firstName," ",n.student.lastName]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Matricule:"}),e.jsx("span",{className:"font-medium",children:n.student.studentId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Classe:"}),e.jsx("span",{className:"font-medium",children:n.student.class})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Parent:"}),e.jsx("span",{className:"font-medium",children:n.student.parentName})]})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"DÃ©tails du Paiement"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Type de frais:"}),e.jsx("p",{className:"font-medium",children:n.payment.feeType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"PÃ©riode:"}),e.jsx("p",{className:"font-medium",children:n.payment.period})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Mode de paiement:"}),e.jsx("p",{className:"font-medium",children:n.payment.paymentMethod})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"RÃ©fÃ©rence:"}),e.jsx("p",{className:"font-medium",children:n.payment.reference||"N/A"})]})]}),n.payment.description&&e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Description:"}),e.jsx("p",{className:"font-medium",children:n.payment.description})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"DÃ©tail des Montants"}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-gray-700",children:"Montant"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:"Montant dÃ»"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:b(n.payment.totalAmount)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:"Montant payÃ©"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-medium text-green-600",children:b(n.payment.amountPaid)})]}),e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:"Solde restant"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-medium",children:b(n.payment.remainingBalance)})]})]})]})})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-800",children:"Statut du Paiement"}),e.jsx("p",{className:"text-sm text-green-600 mt-1",children:n.payment.status==="completed"?"Paiement complet":"Paiement partiel"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:b(n.payment.amountPaid)})]})})}),e.jsxs("div",{className:"border-t pt-6 mt-8",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Signature de l'Ã©lÃ¨ve/Parent:"}),e.jsx("div",{className:"border-b border-gray-300 h-12"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Signature du SecrÃ©taire:"}),e.jsx("div",{className:"border-b border-gray-300 h-12"})]})]}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Ce reÃ§u est gÃ©nÃ©rÃ© automatiquement par EduTrack-CM â€¢ Conservez ce reÃ§u comme preuve de paiement"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["GÃ©nÃ©rÃ© le ",I(new Date().toISOString())]})]})]})]})]})]})}):null},Ys=({isOpen:g,onClose:l,studentId:s,studentName:o,onViewReceipt:n})=>{const[t,i]=c.useState([]),[E,T]=c.useState([]),[k,u]=c.useState(!1),[D,C]=c.useState(""),[P,b]=c.useState({total:0,paid:0,pending:0,overdue:0}),[I,N]=c.useState({period:"",feeType:"",status:"",dateFrom:"",dateTo:"",searchTerm:""}),[v,O]=c.useState(!1);c.useEffect(()=>{g&&s&&p()},[g,s]),c.useEffect(()=>{z()},[t,I]);const p=async()=>{u(!0),C("");try{const d=await Se.getPaymentHistory(s);i(d.payments||[]),b(d.summary||P)}catch(d){C("Erreur lors du chargement de l'historique"),console.error("Erreur chargement historique:",d)}finally{u(!1)}},z=()=>{let d=[...t];if(I.period&&(d=d.filter(_=>_.period===I.period)),I.feeType&&(d=d.filter(_=>_.feeType===I.feeType)),I.status&&(d=d.filter(_=>_.status===I.status)),I.dateFrom&&(d=d.filter(_=>new Date(_.dueDate)>=new Date(I.dateFrom))),I.dateTo&&(d=d.filter(_=>new Date(_.dueDate)<=new Date(I.dateTo))),I.searchTerm){const _=I.searchTerm.toLowerCase();d=d.filter(J=>{var ae,V;return J.feeType.toLowerCase().includes(_)||((ae=J.description)==null?void 0:ae.toLowerCase().includes(_))||((V=J.reference)==null?void 0:V.toLowerCase().includes(_))})}T(d)},R=(d,_)=>{N(J=>({...J,[d]:_}))},L=()=>{N({period:"",feeType:"",status:"",dateFrom:"",dateTo:"",searchTerm:""})},U=()=>{const d=[["Date","Type de frais","PÃ©riode","Montant dÃ»","Montant payÃ©","Solde","Statut","Date de paiement"].join(","),...E.map(V=>[M(V.dueDate),V.feeType,V.period,V.totalAmount,V.amountPaid||0,V.remainingBalance,w(V.status),V.paymentDate?M(V.paymentDate):"Non payÃ©"].join(","))].join(`
`),_=new Blob([d],{type:"text/csv"}),J=URL.createObjectURL(_),ae=document.createElement("a");ae.href=J,ae.download=`historique_paiements_${o.replace(/\s+/g,"_")}.csv`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(J)},B=d=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XAF",minimumFractionDigits:0}).format(d),M=d=>new Date(d).toLocaleDateString("fr-FR"),w=d=>({pending:"En attente",partial:"Partiel",completed:"PayÃ©",overdue:"En retard"})[d]||d,x=d=>({pending:"bg-yellow-100 text-yellow-800",partial:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",overdue:"bg-red-100 text-red-800"})[d]||"bg-gray-100 text-gray-800";return g?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Historique des Paiements"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Ã‰lÃ¨ve: ",e.jsx("span",{className:"font-medium",children:o})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>O(!v),className:"flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4"}),"Filtres"]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:U,className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Exporter"]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Re,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"p-6 bg-gray-50 border-b",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total dÃ»"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:B(P.total)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"PayÃ©"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:B(P.paid)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"En attente"}),e.jsx("p",{className:"text-xl font-bold text-yellow-600",children:B(P.pending)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"En retard"}),e.jsx("p",{className:"text-xl font-bold text-red-600",children:B(P.overdue)})]})]})}),v&&e.jsxs("div",{className:"p-6 bg-gray-50 border-b",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rechercher"}),e.jsxs("div",{className:"relative",children:[e.jsx(ks,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(K,{type:"text",placeholder:"Type de frais, description...",value:I.searchTerm,onChange:d=>R("searchTerm",d.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PÃ©riode"}),e.jsxs(oe,{value:I.period,onChange:d=>R("period",d.target.value),children:[e.jsx("option",{value:"",children:"Toutes les pÃ©riodes"}),e.jsx("option",{value:"2024-2025",children:"2024-2025"}),e.jsx("option",{value:"Trimestre 1",children:"Trimestre 1"}),e.jsx("option",{value:"Trimestre 2",children:"Trimestre 2"}),e.jsx("option",{value:"Trimestre 3",children:"Trimestre 3"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type de frais"}),e.jsxs(oe,{value:I.feeType,onChange:d=>R("feeType",d.target.value),children:[e.jsx("option",{value:"",children:"Tous les types"}),e.jsx("option",{value:"Frais de scolaritÃ©",children:"Frais de scolaritÃ©"}),e.jsx("option",{value:"Frais d'inscription",children:"Frais d'inscription"}),e.jsx("option",{value:"Frais d'examen",children:"Frais d'examen"}),e.jsx("option",{value:"Frais d'activitÃ©s",children:"Frais d'activitÃ©s"}),e.jsx("option",{value:"Frais de transport",children:"Frais de transport"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Statut"}),e.jsxs(oe,{value:I.status,onChange:d=>R("status",d.target.value),children:[e.jsx("option",{value:"",children:"Tous les statuts"}),e.jsx("option",{value:"pending",children:"En attente"}),e.jsx("option",{value:"partial",children:"Partiel"}),e.jsx("option",{value:"completed",children:"PayÃ©"}),e.jsx("option",{value:"overdue",children:"En retard"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date dÃ©but"}),e.jsx(K,{type:"date",value:I.dateFrom,onChange:d=>R("dateFrom",d.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date fin"}),e.jsx(K,{type:"date",value:I.dateTo,onChange:d=>R("dateTo",d.target.value)})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(j,{variant:"outline",onClick:L,className:"w-full",children:"Effacer filtres"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[k&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Chargement de l'historique..."})]}),D&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-red-600",children:D})}),!k&&!D&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[E.length," paiement(s) trouvÃ©(s)"]})}),E.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ue,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Aucun paiement trouvÃ©"})]}):e.jsx("div",{className:"bg-white rounded-lg border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date d'Ã©chÃ©ance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type de frais"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"PÃ©riode"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Montant dÃ»"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Montant payÃ©"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Solde"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:E.map(d=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:M(d.dueDate)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:d.feeType}),d.description&&e.jsx("div",{className:"text-sm text-gray-500",children:d.description})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:d.period}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:B(d.totalAmount)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:B(d.amountPaid||0)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:B(d.remainingBalance)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${x(d.status)}`,children:w(d.status)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:d.status!=="pending"&&d.receiptId&&e.jsx("button",{onClick:()=>n(d.receiptId),className:"text-blue-600 hover:text-blue-900 transition-colors",title:"Voir le reÃ§u",children:e.jsx(Ds,{className:"w-4 h-4"})})})})]},d.id))})]})})})]})]})]})}):null},Js=({isOpen:g,onClose:l})=>{const[s,o]=c.useState(new Date),[n,t]=c.useState([]),[i,E]=c.useState(!1),[T,k]=c.useState(null),[u,D]=c.useState("month");c.useEffect(()=>{g&&C()},[g,s]);const C=async()=>{E(!0);try{const U=await Se.getAllPayments();t(U.payments||[])}catch(U){console.error("Erreur chargement paiements:",U)}finally{E(!1)}},P=U=>{const B=U.getFullYear(),M=U.getMonth(),w=new Date(B,M,1);new Date(B,M+1,0).getDate();const d=new Date(w);d.setDate(d.getDate()-w.getDay());const _=[];for(let J=0;J<42;J++){const ae=new Date(d);ae.setDate(d.getDate()+J),_.push(ae)}return _},b=U=>{const B=U.toISOString().split("T")[0];return n.filter(M=>new Date(M.dueDate).toISOString().split("T")[0]===B)},I=U=>{const B={completed:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",overdue:"bg-red-100 text-red-800 border-red-200",partial:"bg-blue-100 text-blue-800 border-blue-200"};return B[U]||B.pending},N=U=>{const M={completed:ms,pending:Ye,overdue:ls,partial:Ye}[U]||Ye;return e.jsx(M,{className:"w-3 h-3"})},v=U=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XAF",minimumFractionDigits:0}).format(U),O=U=>{const B=new Date(s);B.setMonth(s.getMonth()+U),o(B)},p=["Janvier","FÃ©vrier","Mars","Avril","Mai","Juin","Juillet","AoÃ»t","Septembre","Octobre","Novembre","DÃ©cembre"],z=["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"];if(!g)return null;const R=P(s),L=new Date;return L.setHours(0,0,0,0),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Calendrier des Ã‰chÃ©ances de Paiement"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[p[s.getMonth()]," ",s.getFullYear()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>O(-1),className:"h-8 w-8 p-0",children:e.jsx(xs,{className:"w-4 h-4"})}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>o(new Date),children:"Aujourd'hui"}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>O(1),className:"h-8 w-8 p-0",children:e.jsx(us,{className:"w-4 h-4"})}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors ml-2",children:e.jsx(Re,{className:"w-6 h-6"})})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 p-4",children:[i&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Chargement du calendrier..."})]}),!i&&e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[z.map(U=>e.jsx("div",{className:"text-center font-medium text-gray-700 py-2 text-sm",children:U},U)),R.map((U,B)=>{const M=U.getMonth()===s.getMonth(),w=U.getTime()===L.getTime(),x=b(U),d=T&&U.getTime()===T.getTime();return e.jsxs("div",{className:`
                        min-h-[80px] p-1 border border-gray-200 cursor-pointer
                        hover:bg-gray-50 transition-colors
                        ${M?"bg-white":"bg-gray-50 text-gray-400"}
                        ${w?"bg-blue-50 border-blue-300":""}
                        ${d?"ring-2 ring-blue-500":""}
                      `,onClick:()=>k(U),children:[e.jsx("div",{className:`
                        text-sm font-medium mb-1
                        ${w?"text-blue-600":""}
                      `,children:U.getDate()}),e.jsxs("div",{className:"space-y-1",children:[x.slice(0,3).map((_,J)=>e.jsx("div",{className:`
                              text-xs p-1 rounded border
                              ${I(_.status)}
                              truncate
                            `,title:`${_.student.firstName} ${_.student.lastName} - ${v(_.totalAmount)}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[N(_.status),e.jsxs("span",{className:"truncate",children:[_.student.firstName," ",_.student.lastName]})]})},J)),x.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["+",x.length-3," autres"]})]})]},B)})]})]}),T&&e.jsxs("div",{className:"w-80 border-l bg-gray-50 p-4 overflow-y-auto",children:[e.jsxs("h3",{className:"font-medium text-gray-900 mb-3",children:["Paiements du ",T.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})]}),(()=>{const U=b(T);return U.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ue,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Aucun paiement prÃ©vu"})]}):e.jsx("div",{className:"space-y-3",children:U.map(B=>e.jsxs("div",{className:`
                          p-3 rounded-lg border
                          ${I(B.status)}
                        `,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-sm",children:[B.student.firstName," ",B.student.lastName]}),e.jsxs("p",{className:"text-xs opacity-75",children:[B.student.class," â€¢ ",B.student.studentId]})]}),N(B.status)]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Type:"}),e.jsx("span",{className:"font-medium",children:B.feeType})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Montant:"}),e.jsx("span",{className:"font-medium",children:v(B.totalAmount)})]}),B.amountPaid>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"PayÃ©:"}),e.jsx("span",{className:"font-medium text-green-600",children:v(B.amountPaid)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Statut:"}),e.jsx("span",{className:"font-medium",children:B.status==="completed"?"PayÃ©":B.status==="pending"?"En attente":B.status==="overdue"?"En retard":"Partiel"})]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-current border-opacity-20",children:[e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"font-medium",children:"Parent:"})," ",B.student.parentName]}),B.student.parentPhone&&e.jsxs("p",{className:"text-xs",children:[e.jsx("span",{className:"font-medium",children:"TÃ©l:"})," ",B.student.parentPhone]})]})]},B.id))})})()]})]}),e.jsx("div",{className:"border-t p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-100 border border-green-200 rounded"}),e.jsx("span",{children:"PayÃ©"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-100 border border-yellow-200 rounded"}),e.jsx("span",{children:"En attente"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-100 border border-red-200 rounded"}),e.jsx("span",{children:"En retard"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-100 border border-blue-200 rounded"}),e.jsx("span",{children:"Partiel"})]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Cliquez sur une date pour voir les dÃ©tails"})]})})]})})},Zs=({isOpen:g,onClose:l})=>{const[s,o]=c.useState([]),[n,t]=c.useState(!1),[i,E]=c.useState(null),[T,k]=c.useState("month"),[u,D]=c.useState("");c.useEffect(()=>{g&&C()},[g,T,u]);const C=async()=>{t(!0);try{const p=await Se.getAllPayments();o(p.payments||[]),P(p.payments||[])}catch(p){console.error("Erreur chargement analytics:",p)}finally{t(!1)}},P=p=>{const z=u?p.filter(f=>{var W;return((W=f.student)==null?void 0:W.class)===u}):p,R=new Date,L=new Date;switch(T){case"week":L.setDate(R.getDate()-7);break;case"month":L.setMonth(R.getMonth()-1);break;case"quarter":L.setMonth(R.getMonth()-3);break;case"year":L.setFullYear(R.getFullYear()-1);break;default:L.setMonth(R.getMonth()-1)}const U=z.filter(f=>new Date(f.dueDate)>=L),B=U.reduce((f,W)=>f+W.totalAmount,0),M=U.reduce((f,W)=>f+(W.amountPaid||0),0),w=B-M,x=U.filter(f=>f.status==="completed").length,d=U.filter(f=>f.status==="pending").length,_=U.filter(f=>f.status==="overdue").length,J=U.filter(f=>f.status==="partial").length,ae={};U.forEach(f=>{f.paymentMethod&&f.status!=="pending"&&(ae[f.paymentMethod]=(ae[f.paymentMethod]||0)+(f.amountPaid||0))});const V={};U.forEach(f=>{V[f.feeType]=(V[f.feeType]||0)+f.totalAmount});const X={};U.forEach(f=>{var G;const W=((G=f.student)==null?void 0:G.class)||"Non dÃ©fini";X[W]||(X[W]={total:0,paid:0,count:0}),X[W].total+=f.totalAmount,X[W].paid+=f.amountPaid||0,X[W].count+=1});const S=B>0?M/B*100:0,Q=U.filter(f=>f.status!=="completed"||!f.paymentDate?!1:new Date(f.paymentDate)<=new Date(f.dueDate)).length,r=x>0?Q/x*100:0;E({period:T,totalPayments:U.length,totalAmount:B,totalPaid:M,totalOutstanding:w,completedPayments:x,pendingPayments:d,overduePayments:_,partialPayments:J,collectionRate:S,punctualityRate:r,paymentMethods:ae,feeTypes:V,classAnalysis:X,averagePayment:U.length>0?B/U.length:0})},b=p=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XAF",minimumFractionDigits:0}).format(p),I=()=>{if(!i)return;const z=[["RAPPORT D'ANALYSE DES PAIEMENTS"],[""],["PÃ©riode:",N()],["Classe:",u||"Toutes les classes"],["Date de gÃ©nÃ©ration:",new Date().toLocaleDateString("fr-FR")],[""],["RÃ‰SUMÃ‰ GÃ‰NÃ‰RAL"],["Nombre total de paiements:",i.totalPayments],["Montant total attendu:",b(i.totalAmount)],["Montant total collectÃ©:",b(i.totalPaid)],["Montant en attente:",b(i.totalOutstanding)],["Taux de recouvrement:",`${i.collectionRate.toFixed(1)}%`],["Taux de ponctualitÃ©:",`${i.punctualityRate.toFixed(1)}%`],[""],["RÃ‰PARTITION PAR STATUT"],["Paiements complÃ©tÃ©s:",i.completedPayments],["Paiements en attente:",i.pendingPayments],["Paiements en retard:",i.overduePayments],["Paiements partiels:",i.partialPayments],[""],["ANALYSE PAR MÃ‰THODE DE PAIEMENT"],...Object.entries(i.paymentMethods).map(([B,M])=>[B,b(M)]),[""],["ANALYSE PAR TYPE DE FRAIS"],...Object.entries(i.feeTypes).map(([B,M])=>[B,b(M)])].map(B=>B.join(",")).join(`
`),R=new Blob([z],{type:"text/csv;charset=utf-8;"}),L=URL.createObjectURL(R),U=document.createElement("a");U.href=L,U.download=`analyse_paiements_${T}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(L)},N=()=>({week:"DerniÃ¨re semaine",month:"Dernier mois",quarter:"Dernier trimestre",year:"DerniÃ¨re annÃ©e"})[T]||"Dernier mois",v=[{value:"week",label:"DerniÃ¨re semaine"},{value:"month",label:"Dernier mois"},{value:"quarter",label:"Dernier trimestre"},{value:"year",label:"DerniÃ¨re annÃ©e"}],O=[{value:"",label:"Toutes les classes"},{value:"CE1",label:"CE1"},{value:"CE2",label:"CE2"},{value:"CM1",label:"CM1"},{value:"CM2",label:"CM2"}];return g?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5"}),"Analyses FinanciÃ¨res"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Statistiques et analyses des paiements scolaires"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:I,disabled:!i,className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Exporter"]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Re,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"p-4 border-b bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PÃ©riode d'analyse"}),e.jsx(oe,{value:T,onChange:k,options:v})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Classe"}),e.jsx(oe,{value:u,onChange:D,options:O})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[n&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Calcul des analyses..."})]}),!n&&i&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["RÃ©sumÃ© - ",N()]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Total Attendu"}),e.jsx("p",{className:"text-xl font-bold text-blue-900",children:b(i.totalAmount)})]}),e.jsx(zs,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600",children:"Total CollectÃ©"}),e.jsx("p",{className:"text-xl font-bold text-green-900",children:b(i.totalPaid)})]}),e.jsx(ns,{className:"w-8 h-8 text-green-500"})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-4 border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600",children:"En Attente"}),e.jsx("p",{className:"text-xl font-bold text-red-900",children:b(i.totalOutstanding)})]}),e.jsx(Ps,{className:"w-8 h-8 text-red-500"})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600",children:"Taux Recouvrement"}),e.jsxs("p",{className:"text-xl font-bold text-purple-900",children:[i.collectionRate.toFixed(1),"%"]})]}),e.jsx(as,{className:"w-8 h-8 text-purple-500"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"RÃ©partition par Statut"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ComplÃ©tÃ©s"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${i.completedPayments/i.totalPayments*100}%`}})}),e.jsx("span",{className:"text-sm font-medium",children:i.completedPayments})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"En attente"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-500 h-2 rounded-full",style:{width:`${i.pendingPayments/i.totalPayments*100}%`}})}),e.jsx("span",{className:"text-sm font-medium",children:i.pendingPayments})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"En retard"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-2 rounded-full",style:{width:`${i.overduePayments/i.totalPayments*100}%`}})}),e.jsx("span",{className:"text-sm font-medium",children:i.overduePayments})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Partiels"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${i.partialPayments/i.totalPayments*100}%`}})}),e.jsx("span",{className:"text-sm font-medium",children:i.partialPayments})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"MÃ©thodes de Paiement"}),e.jsxs("div",{className:"space-y-2",children:[Object.entries(i.paymentMethods).map(([p,z])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:p}),e.jsx("span",{className:"text-sm font-medium",children:b(z)})]},p)),Object.keys(i.paymentMethods).length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Aucune mÃ©thode de paiement enregistrÃ©e pour cette pÃ©riode"})]})]})]}),Object.keys(i.classAnalysis).length>0&&e.jsxs("div",{className:"bg-white rounded-lg border p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Analyse par Classe"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium text-gray-700",children:"Classe"}),e.jsx("th",{className:"text-right p-2 font-medium text-gray-700",children:"Nb Paiements"}),e.jsx("th",{className:"text-right p-2 font-medium text-gray-700",children:"Total Attendu"}),e.jsx("th",{className:"text-right p-2 font-medium text-gray-700",children:"Total PayÃ©"}),e.jsx("th",{className:"text-right p-2 font-medium text-gray-700",children:"Taux"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:Object.entries(i.classAnalysis).map(([p,z])=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 font-medium",children:p}),e.jsx("td",{className:"p-2 text-right",children:z.count}),e.jsx("td",{className:"p-2 text-right",children:b(z.total)}),e.jsx("td",{className:"p-2 text-right",children:b(z.paid)}),e.jsx("td",{className:"p-2 text-right",children:e.jsxs("span",{className:`px-2 py-1 rounded text-xs ${z.paid/z.total*100>=80?"bg-green-100 text-green-800":z.paid/z.total*100>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[(z.paid/z.total*100).toFixed(1),"%"]})})]},p))})]})})]})]})]})]})}):null},Qs=()=>{const{toasts:g,showSuccess:l,showError:s,showInfo:o,removeToast:n}=ps(),[t,i]=c.useState(""),[E,T]=c.useState(""),[k,u]=c.useState(""),[D,C]=c.useState(""),[P,b]=c.useState([]),[I,N]=c.useState(!1),[v,O]=c.useState(!1),[p,z]=c.useState(""),[R,L]=c.useState({total:0,collected:0,outstanding:0,overdue:0}),[U,B]=c.useState(!1),[M,w]=c.useState(!1),[x,d]=c.useState(!1),[_,J]=c.useState(!1),[ae,V]=c.useState(!1),[X,S]=c.useState(null),[Q,r]=c.useState(null),[f,W]=c.useState(null);c.useEffect(()=>{G()},[]);const G=async()=>{N(!0),z("");try{const A=await Se.getAllPayments("production");b(A.payments||[]),L(A.statistics||R)}catch(A){z("Erreur lors du chargement des paiements"),s("Erreur lors du chargement des paiements"),console.error("Erreur chargement paiements:",A)}finally{N(!1)}},q=[{value:"",label:"Toutes les classes"},{value:"CE1",label:"CE1"},{value:"CE2",label:"CE2"},{value:"CM1",label:"CM1"},{value:"CM2",label:"CM2"}],m=[{value:"",label:"Tous les statuts"},{value:"completed",label:"PayÃ©"},{value:"pending",label:"En attente"},{value:"overdue",label:"En retard"},{value:"partial",label:"Partiel"}],F=[{value:"",label:"Toutes les pÃ©riodes"},{value:"2024-2025",label:"AnnÃ©e 2024-2025"},{value:"Trimestre 1",label:"Trimestre 1"},{value:"Trimestre 2",label:"Trimestre 2"},{value:"Trimestre 3",label:"Trimestre 3"}],Y=A=>{const le={completed:{label:"PayÃ©",className:"bg-success/10 text-success",icon:"CheckCircle"},pending:{label:"En attente",className:"bg-warning/10 text-warning",icon:"Clock"},overdue:{label:"En retard",className:"bg-error/10 text-error",icon:"AlertTriangle"},partial:{label:"Partiel",className:"bg-primary/10 text-primary",icon:"Minus"}};return(le==null?void 0:le[A])||(le==null?void 0:le.pending)},ne=P==null?void 0:P.filter(A=>{var y,H,se,re,me,he,fe,h,$,te,ie,pe,ve,be;const le=((se=(H=(y=A==null?void 0:A.student)==null?void 0:y.firstName)==null?void 0:H.toLowerCase())==null?void 0:se.includes(t==null?void 0:t.toLowerCase()))||((he=(me=(re=A==null?void 0:A.student)==null?void 0:re.lastName)==null?void 0:me.toLowerCase())==null?void 0:he.includes(t==null?void 0:t.toLowerCase()))||(($=(h=(fe=A==null?void 0:A.student)==null?void 0:fe.parentName)==null?void 0:h.toLowerCase())==null?void 0:$.includes(t==null?void 0:t.toLowerCase()))||((pe=(ie=(te=A==null?void 0:A.student)==null?void 0:te.studentId)==null?void 0:ie.toLowerCase())==null?void 0:pe.includes(t==null?void 0:t.toLowerCase())),we=!E||((ve=A==null?void 0:A.student)==null?void 0:ve.class)===E,Ce=!k||(A==null?void 0:A.status)===k,Ne=!D||((be=A==null?void 0:A.period)==null?void 0:be.includes(D));return le&&we&&Ce&&Ne}),de=async A=>{try{N(!0),await Se.sendPaymentReminder(A),l("Rappel envoyÃ© avec succÃ¨s"),G()}catch(le){s("Erreur lors de l'envoi du rappel"),console.error("Erreur envoi rappel:",le)}finally{N(!1)}},Ee=async A=>{try{N(!0),await Se.markAsPaid(A),l("Paiement marquÃ© comme payÃ©"),G()}catch(le){s("Erreur lors de la mise Ã  jour"),console.error("Erreur marquer payÃ©:",le)}finally{N(!1)}},Te=async()=>{const A=ne==null?void 0:ne.filter(le=>(le==null?void 0:le.status)==="overdue"||(le==null?void 0:le.status)==="pending");if(A.length===0){o("Aucun paiement en attente trouvÃ©"),W({type:"info",message:"Aucun paiement en attente trouvÃ©"}),setTimeout(()=>W(null),4e3);return}try{O(!0),W({type:"info",message:`ðŸ“¨ Envoi de ${A.length} rappel(s) en cours...`}),o(`Envoi de ${A.length} rappel(s) en cours...`),await Se.sendBulkReminders(A.map(le=>le.id)),W({type:"success",message:`âœ… ${A.length} rappel(s) envoyÃ©(s) avec succÃ¨s !`}),l(`${A.length} rappel(s) envoyÃ©(s) avec succÃ¨s`),setTimeout(()=>W(null),6e3)}catch(le){W({type:"error",message:"âŒ Erreur lors de l'envoi des rappels"}),s("Erreur lors de l'envoi des rappels"),setTimeout(()=>W(null),6e3),console.error("Erreur rappels groupÃ©s:",le)}finally{O(!1)}},ke=async()=>{try{const A=await Se.getPaymentStats(),le=[["Ã‰lÃ¨ve","Classe","Type de frais","PÃ©riode","Montant dÃ»","Montant payÃ©","Statut"].join(","),...ne.map(y=>[`${y.student.firstName} ${y.student.lastName}`,y.student.class,y.feeType,y.period,y.totalAmount,y.amountPaid||0,y.status].join(","))].join(`
`),we=new Blob([le],{type:"text/csv"}),Ce=URL.createObjectURL(we),Ne=document.createElement("a");Ne.href=Ce,Ne.download="rapport_paiements.csv",document.body.appendChild(Ne),Ne.click(),document.body.removeChild(Ne),URL.revokeObjectURL(Ce),l("Rapport exportÃ© avec succÃ¨s")}catch(A){s("Erreur lors de l'export"),console.error("Erreur export:",A)}},ue=A=>{r(A),d(!0)},De=A=>{S(A),w(!0)},ee=()=>{B(!0)},ce=()=>{J(!0)},je=A=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XAF",minimumFractionDigits:0}).format(A),ze=A=>new Date(A).toLocaleDateString("fr-FR");return e.jsxs("div",{className:"space-y-4",children:[e.jsx(hs,{toasts:g,removeToast:n}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-bold text-lg text-text-primary",children:"Gestion des Paiements"}),e.jsx("p",{className:"font-body font-body-normal text-xs text-text-secondary mt-0.5",children:"Suivi des frais de scolaritÃ© et paiements"})]}),e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(j,{variant:"default",size:"sm",iconName:"Plus",iconPosition:"left",onClick:ee,disabled:I,children:"Nouveau"}),e.jsx(j,{variant:"outline",size:"sm",iconName:v?null:"Mail",iconPosition:"left",onClick:Te,disabled:I||v,loading:v,children:v?"Envoi...":"Rappels"}),e.jsx(j,{variant:"outline",size:"sm",iconName:"Download",iconPosition:"left",onClick:ke,disabled:I,children:"Export"}),e.jsx(j,{variant:"outline",size:"sm",iconName:"BarChart3",iconPosition:"left",onClick:()=>V(!0),disabled:I,children:"Analyses"})]})]}),f&&e.jsx("div",{className:`p-4 rounded-lg border-l-4 ${f.type==="success"?"bg-green-50 border-l-green-500 text-green-800":f.type==="error"?"bg-red-50 border-l-red-500 text-red-800":f.type==="info"?"bg-blue-50 border-l-blue-500 text-blue-800":"bg-yellow-50 border-l-yellow-500 text-yellow-800"} transition-all duration-300`,children:e.jsxs("p",{className:"text-sm font-medium flex items-center",children:[e.jsx("span",{className:"mr-2",children:f.message}),v&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-card rounded border border-border p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded flex items-center justify-center",children:e.jsx(a,{name:"Euro",size:16,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-sm text-text-primary",children:je((R==null?void 0:R.total)||0)}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Total attendu"})]})]})}),e.jsx("div",{className:"bg-card rounded border border-border p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-success/10 rounded flex items-center justify-center",children:e.jsx(a,{name:"CheckCircle",size:16,className:"text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-sm text-text-primary",children:je((R==null?void 0:R.collected)||0)}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"CollectÃ©"})]})]})}),e.jsx("div",{className:"bg-card rounded border border-border p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-error/10 rounded flex items-center justify-center",children:e.jsx(a,{name:"AlertTriangle",size:16,className:"text-error"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-sm text-text-primary",children:je((R==null?void 0:R.outstanding)||0)}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"En attente"})]})]})}),e.jsx("div",{className:"bg-card rounded border border-border p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-warning/10 rounded flex items-center justify-center",children:e.jsx(a,{name:"Clock",size:16,className:"text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-sm text-text-primary",children:((R==null?void 0:R.overdue)||0)+((R==null?void 0:R.pending)||0)}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"ImpayÃ©s"})]})]})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(j,{variant:"ghost",size:"xs",iconName:"Calendar",iconPosition:"left",onClick:ce,children:"Calendrier"}),e.jsx(j,{variant:"ghost",size:"xs",iconName:"History",iconPosition:"left",onClick:()=>d(!0),children:"Historique"}),e.jsx(j,{variant:"ghost",size:"xs",iconName:"FileText",iconPosition:"left",onClick:()=>V(!0),children:"Rapport"}),e.jsx(j,{variant:"ghost",size:"xs",iconName:"Repeat",iconPosition:"left",onClick:G,disabled:I,children:"Actualiser"})]}),e.jsx("div",{className:"bg-card rounded border border-border p-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsx(K,{type:"search",placeholder:"Rechercher par nom ou ID...",value:t,onChange:A=>{var le;return i((le=A==null?void 0:A.target)==null?void 0:le.value)}}),e.jsx(oe,{placeholder:"Filtrer par classe",options:q,value:E,onChange:T}),e.jsx(oe,{placeholder:"Filtrer par statut",options:m,value:k,onChange:u}),e.jsx(oe,{placeholder:"Filtrer par pÃ©riode",options:F,value:D,onChange:C})]})}),e.jsxs("div",{className:"bg-card rounded border border-border overflow-hidden",children:[I&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600 text-sm",children:"Chargement..."})]}),p&&e.jsxs("div",{className:"p-4 text-center",children:[e.jsx(a,{name:"AlertTriangle",size:32,className:"text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-600 font-medium text-sm",children:p}),e.jsx(j,{variant:"outline",size:"sm",onClick:G,className:"mt-2",children:"RÃ©essayer"})]}),!I&&!p&&e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-heading font-heading-semibold text-xs text-text-primary",children:"Ã‰lÃ¨ve"}),e.jsx("th",{className:"text-left p-2 font-heading font-heading-semibold text-xs text-text-primary",children:"Type de frais"}),e.jsx("th",{className:"text-left p-2 font-heading font-heading-semibold text-xs text-text-primary",children:"PÃ©riode"}),e.jsx("th",{className:"text-left p-2 font-heading font-heading-semibold text-xs text-text-primary",children:"Montant"}),e.jsx("th",{className:"text-left p-2 font-heading font-heading-semibold text-xs text-text-primary",children:"Statut"}),e.jsx("th",{className:"text-left p-2 font-heading font-heading-semibold text-xs text-text-primary",children:"Ã‰chÃ©ance"}),e.jsx("th",{className:"text-right p-2 font-heading font-heading-semibold text-xs text-text-primary",children:"Actions"})]})}),e.jsx("tbody",{children:ne==null?void 0:ne.map(A=>{var Ce,Ne,y,H,se;const le=Y(A==null?void 0:A.status),we=new Date(A.dueDate)<new Date&&(A==null?void 0:A.status)!=="completed";return e.jsxs("tr",{className:"border-t border-border hover:bg-muted/50 transition-micro",children:[e.jsx("td",{className:"p-2",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-body font-body-semibold text-xs text-text-primary",children:[(Ce=A==null?void 0:A.student)==null?void 0:Ce.firstName," ",(Ne=A==null?void 0:A.student)==null?void 0:Ne.lastName]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:[(y=A==null?void 0:A.student)==null?void 0:y.class," â€¢ ",(H=A==null?void 0:A.student)==null?void 0:H.studentId]}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary truncate max-w-32",children:(se=A==null?void 0:A.student)==null?void 0:se.parentName})]})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-body font-body-normal text-xs text-text-primary",children:A==null?void 0:A.feeType}),(A==null?void 0:A.description)&&e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary truncate max-w-24",children:A==null?void 0:A.description})]})}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:"font-body font-body-normal text-xs text-text-primary",children:A==null?void 0:A.period})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-semibold text-xs text-text-primary",children:je(A==null?void 0:A.totalAmount)}),(A==null?void 0:A.status)==="partial"&&e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-success",children:["PayÃ©: ",je(A==null?void 0:A.amountPaid)]}),(A==null?void 0:A.paymentMethod)&&e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary truncate max-w-20",children:A==null?void 0:A.paymentMethod})]})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs font-caption font-caption-normal ${le==null?void 0:le.className}`,children:le==null?void 0:le.label}),we&&e.jsx(a,{name:"AlertTriangle",size:12,className:"text-error"})]})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-normal text-xs text-text-primary",children:ze(A==null?void 0:A.dueDate)}),(A==null?void 0:A.paymentDate)&&e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-success",children:["PayÃ© le ",ze(A==null?void 0:A.paymentDate)]})]})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[(A==null?void 0:A.status)!=="completed"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"ghost",size:"xs",onClick:()=>de(A==null?void 0:A.id),title:"Envoyer un rappel",disabled:I,className:"h-6 w-6 p-0",children:e.jsx(a,{name:"Mail",size:12})}),e.jsx(j,{variant:"ghost",size:"xs",onClick:()=>Ee(A==null?void 0:A.id),title:"Marquer comme payÃ©",disabled:I,className:"h-6 w-6 p-0",children:e.jsx(a,{name:"CheckCircle",size:12})})]}),e.jsx(j,{variant:"ghost",size:"xs",onClick:()=>ue(A==null?void 0:A.student),title:"Voir l'historique",className:"h-6 w-6 p-0",children:e.jsx(a,{name:"History",size:12})}),(A==null?void 0:A.status)!=="pending"&&(A==null?void 0:A.receiptId)&&e.jsx(j,{variant:"ghost",size:"xs",onClick:()=>De(A==null?void 0:A.receiptId),title:"Voir le reÃ§u",className:"h-6 w-6 p-0",children:e.jsx(a,{name:"Receipt",size:12})})]})})]},A==null?void 0:A.id)})})]}),(ne==null?void 0:ne.length)===0&&!I&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(a,{name:"CreditCard",size:32,className:"text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary",children:"Aucun paiement trouvÃ©"})]})]})]}),e.jsxs("div",{className:"bg-accent/5 rounded border border-accent/20 p-3",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-xs text-text-primary mb-2",children:"Actions rapides"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx(j,{variant:"outline",size:"xs",iconName:"Plus",onClick:ee,disabled:I,children:"Nouveau"}),e.jsx(j,{variant:"outline",size:"xs",iconName:"Calendar",onClick:ce,children:"Calendrier"}),e.jsx(j,{variant:"outline",size:"xs",iconName:"BarChart3",onClick:()=>V(!0),children:"Analyses"})]})]}),e.jsx(Vs,{isOpen:U,onClose:()=>B(!1),onSuccess:()=>{l("Paiement enregistrÃ© avec succÃ¨s"),G(),B(!1)}}),e.jsx(Ws,{isOpen:M,onClose:()=>{w(!1),S(null)},paymentId:X}),e.jsx(Ys,{isOpen:x,onClose:()=>{d(!1),r(null)},studentId:Q==null?void 0:Q.studentId,studentName:Q?`${Q.firstName} ${Q.lastName}`:"",onViewReceipt:De}),e.jsx(Js,{isOpen:_,onClose:()=>J(!1)}),e.jsx(Zs,{isOpen:ae,onClose:()=>V(!1)})]})};class Ks{async getParentsBySchool(){console.log("CommunicationService: Mode production forcÃ© - rÃ©cupÃ©ration des parents");try{const l=await ge();if(!l)return console.log("CommunicationService: Aucun ID d'Ã©cole trouvÃ©"),[];console.log("CommunicationService: Recherche des parents pour l'Ã©cole:",l);const{data:s,error:o}=await Z.from("parent_student_schools").select(`
          parent_id,
          student_id,
          relationship_type,
          is_primary_contact,
          parents:parent_id (
            id,
            first_name,
            last_name,
            phone,
            email,
            user_id
          ),
          students:student_id (
            id,
            first_name,
            last_name
          )
        `).eq("school_id",l).eq("is_primary_contact",!0);if(o)return console.error("CommunicationService: Erreur lors de la rÃ©cupÃ©ration des parents:",o),[];console.log("CommunicationService: Relations parent-Ã©tudiant trouvÃ©es:",(s==null?void 0:s.length)||0);const n=new Map;(s||[]).forEach(i=>{const E=i.parents,T=i.students;if(!E||!T)return;const k=E.id;n.has(k)||n.set(k,{id:E.id,name:`${E.first_name} ${E.last_name}`,firstName:E.first_name,lastName:E.last_name,phone:E.phone,email:E.email,userId:E.user_id,students:[]}),n.get(k).students.push({id:T.id,name:`${T.first_name} ${T.last_name}`,class:"Non dÃ©finie"})});const t=Array.from(n.values()).map(i=>({...i,studentName:i.students.map(E=>E.name).join(", "),class:i.students.map(E=>E.class).join(", ")}));return console.log("CommunicationService: Parents formatÃ©s:",t.length),t.length>0&&console.log("CommunicationService: Premier parent:",t[0]),t}catch(l){return console.error("CommunicationService: Erreur dans getParentsBySchool:",l),[]}}async getCommunicationsHistory(){var l,s;console.log("CommunicationService: Mode production forcÃ© - rÃ©cupÃ©ration de l'historique");try{const o=await ge();if(!o)return console.log("CommunicationService: Aucun ID d'Ã©cole pour l'historique"),[];console.log("CommunicationService: Recherche de l'historique pour l'Ã©cole:",o);const{data:n,error:t}=await Z.from("communications").select(`
          id,
          message_type,
          subject,
          content,
          recipients_data,
          recipient_count,
          status,
          delivery_count,
          sent_at,
          template_used,
          error_message,
          sender:sent_by_user_id (
            full_name,
            role
          )
        `).eq("school_id",o).order("sent_at",{ascending:!1});if(t)return console.error("CommunicationService: Erreur lors de la rÃ©cupÃ©ration de l'historique:",t),t.code==="PGRST205"||(l=t.message)!=null&&l.includes("table")||(s=t.message)!=null&&s.includes("relationship")?(console.log("CommunicationService: Table communications pas encore crÃ©Ã©e, retour d'un tableau vide"),[]):[];console.log("CommunicationService: Communications trouvÃ©es:",(n==null?void 0:n.length)||0);const i=(n||[]).map(E=>{var u;const T=Array.isArray(E.recipients_data)?E.recipients_data:[],k=T.map(D=>D.name||"Destinataire").slice(0,3);return T.length>3&&k.push(`+${T.length-3} autres`),{id:E.id,type:E.message_type,subject:E.subject||"Message sans sujet",recipients:k,sentDate:new Date(E.sent_at).toLocaleDateString("fr-FR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),status:E.status,deliveryCount:E.delivery_count,totalCount:E.recipient_count,template:E.template_used,sender:((u=E.sender)==null?void 0:u.full_name)||"ExpÃ©diteur inconnu",content:E.content,errorMessage:E.error_message}});return console.log("CommunicationService: Historique formatÃ©:",i.length),i.length>0&&console.log("CommunicationService: PremiÃ¨re communication:",i[0]),i}catch(o){return console.error("CommunicationService: Erreur dans getCommunicationsHistory:",o),[]}}async getMessageTemplates(){var l;console.log("CommunicationService: Mode production forcÃ© - rÃ©cupÃ©ration des templates");try{const s=await ge();if(!s)return console.log("CommunicationService: Aucun ID d'Ã©cole pour les templates"),[];const{data:o,error:n}=await Z.from("message_templates").select("*").eq("school_id",s).eq("is_active",!0).order("category",{ascending:!0});return n?(console.error("CommunicationService: Erreur lors de la rÃ©cupÃ©ration des templates:",n),n.code==="PGRST205"||(l=n.message)!=null&&l.includes("table")?(console.log("CommunicationService: Table message_templates pas encore crÃ©Ã©e, retour des templates par dÃ©faut"),[{value:"custom",label:"Message personnalisÃ©",category:"custom",content:"",variables:[]},{value:"absence",label:"Justification d'absence",category:"attendance",content:"Bonjour, votre enfant Ã©tait absent le {date}. Merci de fournir une justification.",variables:["date"]},{value:"payment",label:"Rappel de paiement",category:"financial",content:"Cher parent, un paiement est en attente. Merci de rÃ©gulariser.",variables:[]},{value:"announcement",label:"Annonce gÃ©nÃ©rale",category:"general",content:"Chers parents, nous vous informons que {message}.",variables:["message"]}]):[]):(console.log("CommunicationService: Templates trouvÃ©s:",(o==null?void 0:o.length)||0),(o||[]).map(i=>({value:i.id,label:i.name,category:i.category,content:i.content,variables:i.variables||[]})))}catch(s){return console.error("CommunicationService: Erreur dans getMessageTemplates:",s),[]}}async sendMessage(l){console.log("CommunicationService: Mode production forcÃ© - envoi de message");try{const s=await ge();if(!s)throw new Error("Ã‰cole non trouvÃ©e");const{data:{user:o}}=await Z.auth.getUser();if(!o)throw new Error("Utilisateur non authentifiÃ©");console.log("CommunicationService: PrÃ©paration envoi message:",{type:l.type,recipients:l.recipients.length,school:s});const n={school_id:s,sent_by_user_id:o.id,message_type:l.type,subject:l.subject,content:l.content,template_used:l.templateUsed,recipients_data:l.recipients,status:"delivered",delivery_count:l.recipients.length,sent_at:new Date().toISOString()},{data:t,error:i}=await Z.from("communications").insert(n).select().single();if(i)throw console.error("CommunicationService: Erreur lors de l'insertion:",i),i;return console.log("CommunicationService: Message enregistrÃ© avec succÃ¨s:",t.id),{success:!0,messageId:t.id,deliveredCount:l.recipients.length,message:"Message envoyÃ© avec succÃ¨s"}}catch(s){return console.error("CommunicationService: Erreur dans sendMessage:",s),{success:!1,error:s.message}}}async saveTemplate(l){try{const s=await ge();if(!s)throw new Error("Ã‰cole non trouvÃ©e");const{data:{user:o}}=await Z.auth.getUser();if(!o)throw new Error("Utilisateur non authentifiÃ©");const n={school_id:s,name:l.name,category:l.category,content:l.content,variables:l.variables||[],created_by:o.id};let t;if(l.id?t=await Z.from("message_templates").update(n).eq("id",l.id).eq("school_id",s).select().single():t=await Z.from("message_templates").insert(n).select().single(),t.error)throw t.error;return console.log("CommunicationService: Template sauvegardÃ©:",t.data.id),{success:!0,data:t.data}}catch(s){return console.error("CommunicationService: Erreur dans saveTemplate:",s),{success:!1,error:s.message}}}async getCommunicationStats(){try{const l=await ge();if(!l)return{totalSent:0,delivered:0,failed:0,thisWeek:0};const{data:s,error:o}=await Z.from("communications").select("status, sent_at, delivery_count").eq("school_id",l);if(o)return console.error("CommunicationService: Erreur stats:",o),{totalSent:0,delivered:0,failed:0,thisWeek:0};const n=new Date,t=new Date(n.getTime()-10080*60*1e3),i=(s||[]).reduce((E,T)=>(E.totalSent++,T.status==="delivered"||T.status==="partial"?E.delivered++:T.status==="failed"&&E.failed++,new Date(T.sent_at)>=t&&E.thisWeek++,E),{totalSent:0,delivered:0,failed:0,thisWeek:0});return console.log("CommunicationService: Stats calculÃ©es:",i),i}catch(l){return console.error("CommunicationService: Erreur dans getCommunicationStats:",l),{totalSent:0,delivered:0,failed:0,thisWeek:0}}}}const Ve=new Ks,et=()=>{var S,Q;const[g,l]=c.useState("send"),[s,o]=c.useState("both"),[n,t]=c.useState(""),[i,E]=c.useState(""),[T,k]=c.useState("custom"),[u,D]=c.useState([]),[C,P]=c.useState(!1),[b,I]=c.useState([]),[N,v]=c.useState([]),[O,p]=c.useState([]),[z,R]=c.useState(!0);c.useEffect(()=>{(async()=>{try{R(!0);const[f,W,G]=await Promise.all([Ve.getParentsBySchool(),Ve.getCommunicationsHistory(),Ve.getMessageTemplates()]);I(f||[]),v(W||[]);const q=[{value:"custom",label:"âœï¸ Message personnalisÃ©",category:"custom",content:"",subjectDefault:""},{value:"absence",label:"ðŸ“… Justification d'absence",category:"attendance",content:`Bonjour,

Votre enfant {nom_enfant} Ã©tait absent(e) le {date}. Nous vous remercions de bien vouloir fournir un justificatif d'absence dans les plus brefs dÃ©lais.

Cordialement,
L'administration`,subjectDefault:"Justificatif d'absence requis"},{value:"payment",label:"ðŸ’° Rappel de paiement",category:"financial",content:`Cher(e) parent,

Nous vous rappelons qu'un paiement concernant {nom_enfant} est en attente.

Montant : {montant}
Date limite : {date_limite}

Merci de rÃ©gulariser votre situation dÃ¨s que possible.

Cordialement,
Le service financier`,subjectDefault:"Rappel de paiement"},{value:"meeting",label:"ðŸ‘¥ Convocation rÃ©union",category:"general",content:`Chers parents,

Vous Ãªtes convoquÃ©(e) Ã  une rÃ©union le {date} Ã  {heure} concernant {sujet}.

Lieu : {lieu}

Votre prÃ©sence est importante.

Cordialement,
L'administration`,subjectDefault:"Convocation Ã  une rÃ©union"},{value:"results",label:"ðŸ“Š Publication des rÃ©sultats",category:"academic",content:`Bonjour,

Les rÃ©sultats de {nom_enfant} pour {periode} sont maintenant disponibles.

Vous pouvez les consulter sur notre plateforme ou passer les rÃ©cupÃ©rer au secrÃ©tariat.

Cordialement,
L'Ã©quipe pÃ©dagogique`,subjectDefault:"RÃ©sultats disponibles"},{value:"event",label:"ðŸŽ‰ Annonce Ã©vÃ©nement",category:"general",content:`Chers parents,

Nous avons le plaisir de vous annoncer {evenement} qui se tiendra le {date}.

{details}

Nous comptons sur votre participation.

Cordialement,
L'Ã©quipe organisatrice`,subjectDefault:"Annonce d'Ã©vÃ©nement"},{value:"health",label:"ðŸ¥ Information santÃ©",category:"health",content:`Cher(e) parent,

Nous vous informons que {nom_enfant} {information_sante}.

Merci de nous contacter si besoin.

Cordialement,
L'infirmerie scolaire`,subjectDefault:"Information santÃ©"},{value:"behavior",label:"âš ï¸ Note de comportement",category:"discipline",content:`Cher(e) parent,

Nous souhaitons attirer votre attention sur le comportement de {nom_enfant}.

{description}

Nous vous demandons de prendre les mesures nÃ©cessaires.

Cordialement,
La vie scolaire`,subjectDefault:"Note de comportement"}];p(G&&G.length>0?G:q)}catch(f){console.error("Error loading communication data:",f),I([]),v([]),p([])}finally{R(!1)}})()},[]);const L=r=>{k(r);const f=O.find(W=>W.value===r);f&&f.content?(t(f.content),f.subjectDefault&&E(f.subjectDefault)):(t(""),E(""))},[U,B]=c.useState(""),[M,w]=c.useState("all"),x=b.filter(r=>{const f=U===""||r.name.toLowerCase().includes(U.toLowerCase())||r.studentName.toLowerCase().includes(U.toLowerCase())||r.phone.includes(U),W=M==="all"||r.class.includes(M);return f&&W}),d=["all",...new Set(b.flatMap(r=>r.class.split(", ").filter(f=>f!=="Non dÃ©finie")))].filter(Boolean),_=()=>{u.length===b.length?D([]):D(b==null?void 0:b.map(r=>r==null?void 0:r.id))},J=r=>{u.includes(r)?D(u.filter(f=>f!==r)):D([...u,r])},ae=async()=>{if(!n||u.length===0){alert("Veuillez saisir un message et sÃ©lectionner au moins un destinataire.");return}try{P(!0);const f=b.filter(G=>u.includes(G==null?void 0:G.id)).map(G=>{var q,m;return{id:G==null?void 0:G.id,name:(G==null?void 0:G.name)||`${G==null?void 0:G.first_name} ${G==null?void 0:G.last_name}`,phone:G==null?void 0:G.phone,email:G==null?void 0:G.email,studentName:(G==null?void 0:G.studentName)||(G==null?void 0:G.students)&&((q=G==null?void 0:G.students)==null?void 0:q.first_name)+" "+((m=G==null?void 0:G.students)==null?void 0:m.last_name)}});await Ve.sendMessage({type:s,subject:i||"Message important",message:n,recipients:f}),t(""),E(""),D([]),k("custom"),alert("Message envoyÃ© avec succÃ¨s !");const W=await Ve.getCommunicationsHistory();v(W||[])}catch(r){console.error("Error sending message:",r),alert("Erreur lors de l'envoi du message.")}finally{P(!1)}},V=r=>{switch(r){case"delivered":return{icon:"CheckCircle",className:"text-success"};case"failed":return{icon:"XCircle",className:"text-error"};default:return{icon:"Clock",className:"text-warning"}}},X=r=>{switch(r){case"sms":return"MessageSquare";case"email":return"Mail";case"whatsapp":return"Phone";case"both":return"Send";case"all":return"Zap";default:return"MessageSquare"}};return z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex items-center space-x-2 text-text-secondary",children:[e.jsx(a,{name:"Loader2",size:20,className:"animate-spin"}),e.jsx("span",{children:"Chargement des communications..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-bold text-xl text-text-primary",children:"Centre de Notifications"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary mt-1",children:"Envoyez des messages SMS et emails aux parents"})]}),e.jsx("div",{className:"border-b border-border",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{onClick:()=>l("send"),className:`py-2 px-1 border-b-2 font-body font-body-semibold text-sm transition-micro ${g==="send"?"border-primary text-primary":"border-transparent text-text-secondary hover:text-text-primary"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:"Send",size:16}),e.jsx("span",{children:"Envoyer un message"})]})}),e.jsx("button",{onClick:()=>l("history"),className:`py-2 px-1 border-b-2 font-body font-body-semibold text-sm transition-micro ${g==="history"?"border-primary text-primary":"border-transparent text-text-secondary hover:text-text-primary"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:"History",size:16}),e.jsx("span",{children:"Historique"})]})})]})}),g==="send"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-lg border border-border p-6",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary mb-4",children:"Configuration du message"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(oe,{label:"Type de message",value:s,onChange:o,options:[{value:"sms",label:"ðŸ“± SMS uniquement"},{value:"email",label:"ðŸ“§ Email uniquement"},{value:"whatsapp",label:"ðŸ’¬ WhatsApp"},{value:"both",label:"ðŸ“±ðŸ“§ SMS + Email"},{value:"all",label:"ðŸš€ Tous les canaux"}]}),e.jsx(oe,{label:"ModÃ¨le de message",value:T,onChange:L,options:O.map(r=>({value:r.value,label:r.label})),helperText:"SÃ©lectionnez un modÃ¨le prÃ©fait ou personnalisez votre message"})]}),(s==="whatsapp"||s==="all")&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(a,{name:"Info",size:16,className:"text-green-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-green-900 mb-1",children:"ðŸ’¬ WhatsApp Business API"}),e.jsx("p",{className:"text-xs text-green-700",children:"L'intÃ©gration WhatsApp sera disponible prochainement. Les messages seront envoyÃ©s via l'API WhatsApp Business officielle pour une meilleure dÃ©livrabilitÃ©."})]})]})}),T!=="custom"&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(a,{name:"Info",size:16,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Variables disponibles dans ce modÃ¨le :"}),e.jsxs("p",{className:"text-xs text-blue-700",children:["Vous pouvez personnaliser les mots entre accolades comme ","{nom_enfant}",", ","{date}",", ","{heure}",", etc."]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(K,{label:"Sujet (optionnel pour SMS, requis pour Email)",value:i,onChange:E,placeholder:"Ex: Convocation, Rappel, Information importante..."})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block font-body font-body-medium text-sm text-text-primary",children:"Message *"}),e.jsxs("span",{className:"text-xs text-text-secondary",children:[n.length," caractÃ¨res",s==="sms"&&n.length>160&&e.jsxs("span",{className:"text-warning ml-2",children:["(",Math.ceil(n.length/160)," SMS)"]})]})]}),e.jsx("textarea",{value:n,onChange:r=>t(r.target.value),placeholder:"Tapez votre message ici ou sÃ©lectionnez un modÃ¨le ci-dessus...",className:"w-full h-40 p-3 border border-border rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary/20 font-body",required:!0}),s==="sms"&&n.length>160&&e.jsx("p",{className:"text-xs text-warning mt-1",children:"âš ï¸ Les SMS de plus de 160 caractÃ¨res sont divisÃ©s en plusieurs messages"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>t(n+`

Cordialement,
L'administration`),className:"text-xs text-primary hover:underline",children:"+ Ajouter signature"}),e.jsx("span",{className:"text-text-secondary",children:"â€¢"}),e.jsx("button",{type:"button",onClick:()=>t(""),className:"text-xs text-error hover:underline",children:"Effacer le message"})]})]})]}),e.jsxs("div",{className:"bg-card rounded-lg border border-border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:["Destinataires (",x==null?void 0:x.length,")"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-text-secondary",children:[u.length," sÃ©lectionnÃ©(s)"]}),e.jsx(j,{variant:"outline",size:"sm",onClick:_,children:u.length===x.length?"DÃ©sÃ©lectionner tout":"SÃ©lectionner tout"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(K,{placeholder:"Rechercher un parent, Ã©lÃ¨ve ou tÃ©lÃ©phone...",value:U,onChange:B,icon:"Search"}),e.jsx(oe,{value:M,onChange:w,options:[{value:"all",label:"Toutes les classes"},...d.filter(r=>r!=="all").map(r=>({value:r,label:r}))]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(x==null?void 0:x.length)===0?e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx(a,{name:"Users",size:32,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("h4",{className:"font-heading font-heading-medium text-base text-text-primary mb-2",children:(b==null?void 0:b.length)===0?"Aucun parent trouvÃ©":"Aucun rÃ©sultat"}),e.jsx("p",{className:"text-text-secondary",children:(b==null?void 0:b.length)===0?"Aucun parent n'est enregistrÃ© dans la base de donnÃ©es pour cette Ã©cole.":"Aucun parent ne correspond Ã  vos critÃ¨res de recherche."})]}):x==null?void 0:x.map(r=>{var f,W,G;return e.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-border rounded-lg hover:bg-accent/5 transition-micro",children:[e.jsx(qe,{checked:u==null?void 0:u.includes(r==null?void 0:r.id),onChange:()=>J(r==null?void 0:r.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-body font-body-semibold text-sm text-text-primary",children:(r==null?void 0:r.name)||`${r==null?void 0:r.first_name} ${r==null?void 0:r.last_name}`}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["ðŸ‘¦ ",(r==null?void 0:r.studentName)||(r==null?void 0:r.students)&&`${(f=r==null?void 0:r.students)==null?void 0:f.first_name} ${(W=r==null?void 0:r.students)==null?void 0:W.last_name}`,e.jsxs("span",{className:"ml-2",children:["ðŸ“š ",(r==null?void 0:r.class)||((G=r==null?void 0:r.students)==null?void 0:G.current_class)]})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[e.jsxs("span",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["ðŸ“± ",r==null?void 0:r.phone]}),(r==null?void 0:r.email)&&e.jsxs("span",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["âœ‰ï¸ ",r==null?void 0:r.email]})]})]})]},r==null?void 0:r.id)})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{variant:"default",iconName:C?"Loader2":"Send",iconClassName:C?"animate-spin":"",onClick:ae,disabled:C||!n||u.length===0,children:C?"Envoi en cours...":"Envoyer le message"})})]}),g==="history"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:"Messages envoyÃ©s"})}),e.jsx("div",{className:"divide-y divide-border",children:(N==null?void 0:N.length)===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(a,{name:"MessageCircle",size:32,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("h4",{className:"font-heading font-heading-medium text-base text-text-primary mb-2",children:"Aucun message envoyÃ©"}),e.jsx("p",{className:"text-text-secondary",children:"L'historique de vos communications apparaÃ®tra ici une fois que vous aurez envoyÃ© des messages."})]}):N==null?void 0:N.map(r=>{var W;const f=V(r==null?void 0:r.status);return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:(r==null?void 0:r.type)==="whatsapp"?e.jsx("span",{className:"text-xl",children:"ðŸ’¬"}):e.jsx(a,{name:X(r==null?void 0:r.type),size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-semibold text-sm text-text-primary",children:r==null?void 0:r.subject}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary mt-1",children:["Destinataires: ",(W=r==null?void 0:r.recipients)==null?void 0:W.join(", ")]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:["EnvoyÃ© le ",r==null?void 0:r.sentDate]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`flex items-center space-x-1 ${f==null?void 0:f.className}`,children:[e.jsx(a,{name:f==null?void 0:f.icon,size:16}),e.jsx("span",{className:"font-caption font-caption-normal text-xs",children:(r==null?void 0:r.status)==="delivered"?"LivrÃ©":(r==null?void 0:r.status)==="failed"?"Ã‰chec":"En cours"})]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-text-secondary mt-1",children:[r==null?void 0:r.deliveryCount," message(s)"]})]}),e.jsx(j,{variant:"ghost",size:"icon",title:"Voir les dÃ©tails",children:e.jsx(a,{name:"Eye",size:16})})]})]})},r==null?void 0:r.id)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-background/50",children:[e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Send",size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:(N==null?void 0:N.length)||0}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Messages envoyÃ©s"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-success/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"CheckCircle",size:20,className:"text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:((S=N==null?void 0:N.filter(r=>(r==null?void 0:r.status)==="delivered"))==null?void 0:S.length)||0}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Messages livrÃ©s"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-error/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"XCircle",size:20,className:"text-error"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:((Q=N==null?void 0:N.filter(r=>(r==null?void 0:r.status)==="failed"))==null?void 0:Q.length)||0}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Ã‰checs de livraison"})]})]})})]})]})})]})},st=()=>{var B,M;const[g,l]=c.useState(""),[s,o]=c.useState(""),[n,t]=c.useState(""),[i,E]=c.useState(""),[T,k]=c.useState(!1),[u,D]=c.useState(""),[C,P]=c.useState([]),[b,I]=c.useState([]),[N,v]=c.useState(!0);c.useEffect(()=>{(async()=>{v(!0);try{let x=null;const{data:{user:d}}=await Z.auth.getUser();if(d){const{data:X}=await Z.from("users").select("current_school_id").eq("id",d.id).single();x=X==null?void 0:X.current_school_id}else{const X=localStorage.getItem("edutrack-user");if(X){const S=JSON.parse(X);x=S.current_school_id||S.school_id}}if(!x){console.error("Aucune Ã©cole trouvÃ©e"),I([]),P([]);return}const{data:_,error:J}=await Z.from("students").select("id, first_name, last_name").eq("is_active",!0).eq("school_id",x);!J&&_&&P(_.map(X=>({value:X.id,label:`${X.first_name} ${X.last_name}`})));const{data:ae,error:V}=await Z.from("transfers").select(`
            *,
            student:students(first_name, last_name)
          `).eq("from_school_id",x).order("request_date",{ascending:!1});I(!V&&ae?ae.map(X=>{var S,Q;return{id:X.id,studentName:`${(S=X.student)==null?void 0:S.first_name} ${(Q=X.student)==null?void 0:Q.last_name}`,studentId:X.student_id,class:"N/A",transferDate:new Date(X.transfer_date).toLocaleDateString("fr-FR"),newSchool:X.new_school_name,reason:X.transfer_reason,status:X.status,transferCode:X.transfer_code,qrCode:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzAwMCIvPgogIDxyZWN0IHg9IjEwIiB5PSIxMCIgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjZmZmIi8+CiAgPHRleHQgeD0iNTAiIHk9IjU1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjEyIiBmaWxsPSIjMDAwIj5RUjwvdGV4dD4KPC9zdmc+",parentNotified:X.parent_notified||!1,documentsReady:X.documents_ready||!1}}):[])}catch(x){console.error("Erreur chargement donnÃ©es transfert:",x)}finally{v(!1)}})()},[]);const O=[{value:"relocation",label:"DÃ©mÃ©nagement"},{value:"school_choice",label:"Choix d'Ã©tablissement"},{value:"family_reasons",label:"Raisons familiales"},{value:"academic_reasons",label:"Raisons pÃ©dagogiques"},{value:"other",label:"Autre"}],p=w=>{const x={pending:{label:"En attente",className:"bg-warning/10 text-warning",icon:"Clock"},confirmed:{label:"ConfirmÃ©",className:"bg-success/10 text-success",icon:"CheckCircle"},cancelled:{label:"AnnulÃ©",className:"bg-error/10 text-error",icon:"XCircle"}};return(x==null?void 0:x[w])||(x==null?void 0:x.pending)},z=async()=>{if(!g||!s||!n||!i){alert("Veuillez remplir tous les champs obligatoires");return}try{v(!0);const w=`TRF-${new Date().getFullYear()}-${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`;let x=null,d=null;const{data:{user:_}}=await Z.auth.getUser();if(_){x=_.id;const{data:X}=await Z.from("users").select("current_school_id").eq("id",_.id).single();d=X==null?void 0:X.current_school_id}else{const X=localStorage.getItem("edutrack-user");if(X){const S=JSON.parse(X);x=S.id,d=S.current_school_id||S.school_id}}if(!x||!d)throw new Error("Impossible d'identifier l'utilisateur ou l'Ã©cole");const J={student_id:g,from_school_id:d,transfer_reason:s,new_school_name:n,transfer_date:i,transfer_code:w,status:"pending",requested_by:x,request_date:new Date().toISOString()},ae=await Z.from("transfers").insert([J]).select().single();if(ae.error)throw ae.error;D(w),k(!0),alert("Transfert initiÃ© avec succÃ¨s !");const{data:V}=await Z.from("transfers").select(`
          *,
          student:students(first_name, last_name)
        `).eq("from_school_id",d).order("request_date",{ascending:!1});V&&I(V.map(X=>{var S,Q;return{id:X.id,studentName:`${(S=X.student)==null?void 0:S.first_name} ${(Q=X.student)==null?void 0:Q.last_name}`,studentId:X.student_id,class:"N/A",transferDate:new Date(X.transfer_date).toLocaleDateString("fr-FR"),newSchool:X.new_school_name,reason:X.transfer_reason,status:X.status,transferCode:X.transfer_code,qrCode:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzAwMCIvPgogIDxyZWN0IHg9IjEwIiB5PSIxMCIgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjZmZmIi8+CiAgPHRleHQgeD0iNTAiIHk9IjU1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjEyIiBmaWxsPSIjMDAwIj5RUjwvdGV4dD4KPC9zdmc+",parentNotified:!1,documentsReady:!1}})),l(""),o(""),t(""),E("")}catch(w){console.error("Erreur crÃ©ation transfert:",w),alert(`Erreur : ${w.message||"Impossible de crÃ©er le transfert"}`)}finally{v(!1)}},R=async w=>{const x=b.find(d=>d.id===w);if(x)try{const{error:d}=await Z.from("transfers").update({parent_notified:!0}).eq("id",w);if(d)throw d;I(b.map(_=>_.id===w?{..._,parentNotified:!0}:_)),alert(`SMS de confirmation envoyÃ© pour ${x.studentName}`)}catch(d){console.error("Erreur envoi SMS:",d),alert(`Erreur : ${d.message||"Impossible d'envoyer le SMS"}`)}},L=async w=>{const x=b.find(d=>d.id===w);if(x)try{const{error:d}=await Z.from("transfers").update({documents_ready:!0}).eq("id",w);if(d)throw d;I(b.map(_=>_.id===w?{..._,documentsReady:!0}:_)),alert(`Documents prÃªts pour ${x.studentName}`)}catch(d){console.error("Erreur impression documents:",d),alert(`Erreur : ${d.message||"Impossible de prÃ©parer les documents"}`)}},U=async w=>{const x=b.find(_=>_.id===w);if(!(!x||!window.confirm(`ÃŠtes-vous sÃ»r de vouloir annuler le transfert de ${x.studentName} ?`)))try{const{error:_}=await Z.from("transfers").update({status:"cancelled"}).eq("id",w);if(_)throw _;I(b.filter(J=>J.id!==w)),alert(`Transfert annulÃ© pour ${x.studentName}`)}catch(_){console.error("Erreur annulation transfert:",_),alert(`Erreur : ${_.message||"Impossible d'annuler le transfert"}`)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-bold text-xl text-text-primary",children:"Gestion des Transferts"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary mt-1",children:"Processus de transfert d'Ã©lÃ¨ves avec gÃ©nÃ©ration de QR codes"})]}),e.jsxs("div",{className:"bg-card rounded-lg border border-border p-6",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary mb-4",children:"Nouveau transfert d'Ã©lÃ¨ve"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsx(oe,{label:"Ã‰lÃ¨ve Ã  transfÃ©rer",placeholder:"SÃ©lectionner un Ã©lÃ¨ve",options:C,value:g,onChange:l,required:!0}),e.jsx(oe,{label:"Motif du transfert",placeholder:"SÃ©lectionner un motif",options:O,value:s,onChange:o,required:!0}),e.jsx(K,{label:"Nouvel Ã©tablissement",type:"text",placeholder:"Nom de la nouvelle Ã©cole",value:n,onChange:w=>{var x;return t((x=w==null?void 0:w.target)==null?void 0:x.value)},required:!0}),e.jsx(K,{label:"Date de transfert",type:"date",value:i,onChange:w=>{var x;return E((x=w==null?void 0:w.target)==null?void 0:x.value)},required:!0})]}),T&&e.jsx("div",{className:"bg-accent/5 rounded-lg border border-accent/20 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-20 h-20 bg-white border border-border rounded-lg flex items-center justify-center",children:e.jsx("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjMDAwIi8+CiAgPHJlY3QgeD0iNSIgeT0iNSIgd2lkdGg9IjUwIiBoZWlnaHQ9IjUwIiBmaWxsPSIjZmZmIi8+CiAgPHRleHQgeD0iMzAiIHk9IjM1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjgiIGZpbGw9IiMwMDAiPlFSPC90ZXh0Pgo8L3N2Zz4K",alt:"QR Code",className:"w-16 h-16"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-sm text-text-primary",children:"Code de transfert gÃ©nÃ©rÃ©"}),e.jsx("p",{className:"font-mono text-lg text-primary font-bold",children:u}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Ce QR code sera envoyÃ© aux parents par SMS"})]})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{variant:"default",iconName:"Send",iconPosition:"left",onClick:z,children:"Initier le transfert"})})]}),e.jsxs("div",{className:"bg-card rounded-lg border border-border",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:["Transferts en cours (",b==null?void 0:b.length,")"]})}),e.jsx("div",{className:"divide-y divide-border",children:b==null?void 0:b.map(w=>{const x=p(w==null?void 0:w.status);return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-lg flex items-center justify-center",children:e.jsx("img",{src:w==null?void 0:w.qrCode,alt:"QR Code",className:"w-12 h-12"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"font-body font-body-semibold text-lg text-text-primary",children:w==null?void 0:w.studentName}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-caption font-caption-normal ${x==null?void 0:x.className}`,children:x==null?void 0:x.label})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-caption font-caption-normal text-sm text-text-secondary",children:[e.jsx("span",{className:"font-semibold",children:"ID:"})," ",w==null?void 0:w.studentId," â€¢",e.jsx("span",{className:"font-semibold",children:" Classe:"})," ",w==null?void 0:w.class]}),e.jsxs("p",{className:"font-caption font-caption-normal text-sm text-text-secondary",children:[e.jsx("span",{className:"font-semibold",children:"Vers:"})," ",w==null?void 0:w.newSchool]}),e.jsxs("p",{className:"font-caption font-caption-normal text-sm text-text-secondary",children:[e.jsx("span",{className:"font-semibold",children:"Date:"})," ",w==null?void 0:w.transferDate," â€¢",e.jsx("span",{className:"font-semibold",children:" Motif:"})," ",w==null?void 0:w.reason]}),e.jsxs("p",{className:"font-mono text-sm text-primary",children:["Code: ",w==null?void 0:w.transferCode]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>R(w==null?void 0:w.id),title:"Envoyer confirmation SMS",disabled:!(w!=null&&w.parentNotified),children:e.jsx(a,{name:"MessageSquare",size:16})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>L(w==null?void 0:w.id),title:"Imprimer les documents",children:e.jsx(a,{name:"Printer",size:16})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>U(w==null?void 0:w.id),title:"Annuler le transfert",children:e.jsx(a,{name:"X",size:16})})]})]}),e.jsxs("div",{className:"mt-4 flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:w!=null&&w.parentNotified?"CheckCircle":"Clock",size:16,className:w!=null&&w.parentNotified?"text-success":"text-warning"}),e.jsx("span",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Parents notifiÃ©s"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:w!=null&&w.documentsReady?"CheckCircle":"Clock",size:16,className:w!=null&&w.documentsReady?"text-success":"text-warning"}),e.jsx("span",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Documents prÃªts"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{name:(w==null?void 0:w.status)==="confirmed"?"CheckCircle":"Clock",size:16,className:(w==null?void 0:w.status)==="confirmed"?"text-success":"text-warning"}),e.jsx("span",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Transfert confirmÃ©"})]})]})]},w==null?void 0:w.id)})}),(b==null?void 0:b.length)===0&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(a,{name:"ArrowRightLeft",size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary",children:"Aucun transfert en cours"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"ArrowRightLeft",size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:b==null?void 0:b.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Transferts en cours"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-success/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"CheckCircle",size:20,className:"text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:(B=b==null?void 0:b.filter(w=>(w==null?void 0:w.status)==="confirmed"))==null?void 0:B.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"ConfirmÃ©s"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-warning/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Clock",size:20,className:"text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:(M=b==null?void 0:b.filter(w=>(w==null?void 0:w.status)==="pending"))==null?void 0:M.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"En attente"})]})]})})]})]})},tt=()=>{const[g,l]=c.useState(""),[s,o]=c.useState(""),[n,t]=c.useState([]),[i,E]=c.useState([]),[T,k]=c.useState(!0),[u,D]=c.useState(""),[C,P]=c.useState("student"),[b,I]=c.useState(!1),[N,v]=c.useState(""),[O,p]=c.useState(""),[z,R]=c.useState([]),[L,U]=c.useState([]),[B,M]=c.useState(null),[w,x]=c.useState(null),d=[{value:"",label:"Toutes les catÃ©gories"},{value:"certificats",label:"Certificats de scolaritÃ©"},{value:"attestations",label:"Attestations"},{value:"bulletins",label:"Bulletins scolaires"},{value:"inscriptions",label:"Dossiers d'inscription"},{value:"administratif",label:"Documents administratifs"}],_=async()=>{k(!0);try{const q=await Ge.getAllSchoolDocuments();q.error==="TABLE_NOT_EXISTS"?(D("âš ï¸ La table documents n'existe pas encore. FonctionnalitÃ© en dÃ©veloppement."),E([])):q.success?E(q.documents||[]):(console.error("Erreur chargement documents:",q.error),D("Erreur lors du chargement des documents"),E([]))}catch(q){console.error("Erreur chargement documents:",q),D("Erreur lors du chargement des documents"),E([])}finally{k(!1)}};c.useEffect(()=>{_()},[]),c.useEffect(()=>{(async()=>{const m=localStorage.getItem("school_id");if(!m){console.warn("âš ï¸ Pas de school_id trouvÃ©, impossible de charger les Ã©lÃ¨ves");return}try{const{data:F,error:Y}=await Z.from("students").select("id, first_name, last_name, class_name").eq("school_id",m).order("last_name");!Y&&F?R(F):Y&&console.error("Erreur chargement Ã©lÃ¨ves:",Y);const{data:ne,error:de}=await Z.from("classes").select("id, name, level").eq("school_id",m).order("level");!de&&ne?U(ne):de&&console.error("Erreur chargement classes:",de)}catch(F){console.error("Exception chargement Ã©lÃ¨ves/classes:",F)}})()},[]);const J=q=>{switch(q){case"generated":return"bg-success/10 text-success border-success/20";case"printed":return"bg-primary/10 text-primary border-primary/20";case"pending":return"bg-warning/10 text-warning border-warning/20";case"incomplete":return"bg-error/10 text-error border-error/20";default:return"bg-muted/10 text-muted-foreground border-muted/20"}},ae=q=>{switch(q){case"generated":return"GÃ©nÃ©rÃ©";case"printed":return"ImprimÃ©";case"pending":return"En attente";case"incomplete":return"Incomplet";default:return"Inconnu"}},V=()=>{if(n.length===0){alert("âš ï¸ Veuillez sÃ©lectionner au moins un document Ã  imprimer");return}n.forEach(q=>{const m=i.find(F=>F.id===q);m&&m.file_path&&r(q)}),alert(`âœ… Ouverture de ${n.length} document(s) pour impression`)},X=i.filter(q=>{const m=q.name.toLowerCase().includes(g.toLowerCase())||q.studentName.toLowerCase().includes(g.toLowerCase()),F=s===""||q.type===s;return m&&F}),S=async(q,m="student")=>{console.log("Document generation initiated:",q,m),p(q),v(m),I(!0)},Q=async()=>{try{k(!0),console.log("ðŸ“¤ GÃ©nÃ©ration du document...",{documentType:O,modalType:N,selectedStudent:B,selectedClass:w});const q={};N==="student"&&B?(q.studentId=B,q.visibility="private",q.isPublic=!1):N==="class"&&w?(q.classId=w,q.visibility="class",q.isPublic=!1):N==="public"&&(q.visibility="school",q.isPublic=!0);const m=await Ge.generateDocument(O,q);console.log("ðŸ“¥ RÃ©sultat:",m),m.success?(alert(`âœ… Document "${O}" crÃ©Ã© avec succÃ¨s !`),I(!1),await _()):(console.error("âŒ Erreur gÃ©nÃ©ration:",m.error),alert(`âŒ Erreur : ${m.error||"Impossible de gÃ©nÃ©rer le document"}`))}catch(q){console.error("âŒ Exception gÃ©nÃ©ration document:",q),alert(`âŒ Erreur : ${q.message||"Erreur lors de la gÃ©nÃ©ration du document"}`)}finally{k(!1)}},r=async q=>{const m=i.find(F=>F.id===q);if(m){if(!m.file_path){alert("âš ï¸ Ce document n'a pas encore de fichier associÃ©. Il s'agit d'un enregistrement dans la base de donnÃ©es.");return}W(q,!0)}},f=async q=>{var F;const m=i.find(Y=>Y.id===q);if(m){if(!m.file_path){alert("âš ï¸ Ce document n'a pas encore de fichier associÃ©. Il s'agit d'un enregistrement dans la base de donnÃ©es uniquement.");return}try{const Y=await Ge.downloadDocument(q,"view");(F=Y.data)!=null&&F.url?window.open(Y.data.url,"_blank"):alert(`âŒ Erreur : ${Y.error||"Impossible d'accÃ©der au document"}`)}catch(Y){console.error("Erreur prÃ©visualisation document:",Y),alert("âŒ Erreur lors de la prÃ©visualisation du document")}}},W=async(q,m=!1)=>{var Y;const F=i.find(ne=>ne.id===q);if(F){if(!F.file_path){alert("âš ï¸ Ce document n'a pas encore de fichier associÃ©. Il s'agit d'un enregistrement dans la base de donnÃ©es uniquement.");return}try{const ne=await Ge.downloadDocument(q,m?"print":"download");if((Y=ne.data)!=null&&Y.url)if(m){const de=window.open(ne.data.url,"_blank");de?de.onload=()=>{de.print()}:alert("âš ï¸ Veuillez autoriser les pop-ups pour imprimer le document")}else{const de=document.createElement("a");de.href=ne.data.url,de.download=ne.data.fileName||F.name,de.target="_blank",document.body.appendChild(de),de.click(),document.body.removeChild(de),alert("âœ… TÃ©lÃ©chargement lancÃ© !")}else alert(`âŒ Erreur : ${ne.error||"Impossible d'accÃ©der au document"}`)}catch(ne){console.error("Erreur accÃ¨s document:",ne),alert("âŒ Erreur lors de l'accÃ¨s au document")}}},G=async q=>{const m=i.find(Y=>Y.id===q);if(!(!m||!window.confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer le document "${m.name}" ?`)))try{k(!0);const Y=await Ge.deleteDocument(q);Y.data?(alert("âœ… Document supprimÃ© avec succÃ¨s"),await _()):alert(`âŒ Erreur : ${Y.error||"Impossible de supprimer le document"}`)}catch(Y){console.error("Erreur suppression document:",Y),alert("âŒ Erreur lors de la suppression du document")}finally{k(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-bold text-2xl text-text-primary",children:"Gestion des Documents"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary mt-1",children:"GÃ©nÃ©ration, impression et gestion des documents administratifs"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs(j,{variant:"default",iconName:"Printer",iconPosition:"left",onClick:V,disabled:n.length===0,children:["Imprimer (",n.length,")"]})})]}),e.jsxs("div",{className:"bg-card rounded-lg border border-border p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary flex items-center gap-2",children:[e.jsx(a,{name:"Plus",size:20,className:"text-primary"}),"GÃ©nÃ©rer un nouveau document"]})}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 border-b border-border pb-3",children:[e.jsx("button",{className:`px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${C==="student"?"bg-primary text-white":"bg-muted text-text-secondary hover:bg-muted/80"}`,onClick:()=>P("student"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(a,{name:"User",size:16}),"Pour un Ã©lÃ¨ve"]})}),e.jsx("button",{className:`px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${C==="class"?"bg-primary text-white":"bg-muted text-text-secondary hover:bg-muted/80"}`,onClick:()=>P("class"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(a,{name:"Users",size:16}),"Pour une classe"]})}),e.jsx("button",{className:`px-4 py-2 rounded-t-lg text-sm font-medium transition-colors ${C==="public"?"bg-primary text-white":"bg-muted text-text-secondary hover:bg-muted/80"}`,onClick:()=>P("public"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(a,{name:"Globe",size:16}),"Document public"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[C==="student"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"outline",iconName:"FileText",iconPosition:"left",onClick:()=>S("certificat_scolarite","student"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Certificat de scolaritÃ©"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Atteste l'inscription de l'Ã©lÃ¨ve"})]})}),e.jsx(j,{variant:"outline",iconName:"Award",iconPosition:"left",onClick:()=>S("certificat_frequentation","student"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Certificat de frÃ©quentation"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Atteste l'assiduitÃ© de l'Ã©lÃ¨ve"})]})}),e.jsx(j,{variant:"outline",iconName:"UserCheck",iconPosition:"left",onClick:()=>S("fiche_inscription","student"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Fiche d'inscription"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"DonnÃ©es administratives de l'Ã©lÃ¨ve"})]})}),e.jsx(j,{variant:"outline",iconName:"CreditCard",iconPosition:"left",onClick:()=>S("attestation_paiement","student"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Attestation de paiement"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"ReÃ§u des frais de scolaritÃ©"})]})}),e.jsx(j,{variant:"outline",iconName:"FileCheck",iconPosition:"left",onClick:()=>S("autorisation_sortie","student"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Autorisation de sortie"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Pour sorties scolaires"})]})}),e.jsx(j,{variant:"outline",iconName:"BookOpen",iconPosition:"left",onClick:()=>S("bulletin","student"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Bulletin scolaire"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Impression du bulletin (si disponible)"})]})})]}),C==="class"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"outline",iconName:"Users",iconPosition:"left",onClick:()=>S("liste_eleves","class"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Liste des Ã©lÃ¨ves"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Effectif complet avec infos"})]})}),e.jsx(j,{variant:"outline",iconName:"ClipboardList",iconPosition:"left",onClick:()=>S("liste_appel","class"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Liste d'appel"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Pour le suivi des prÃ©sences"})]})}),e.jsx(j,{variant:"outline",iconName:"Clock",iconPosition:"left",onClick:()=>S("emploi_du_temps","class"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Emploi du temps"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Planning hebdomadaire"})]})}),e.jsx(j,{variant:"outline",iconName:"FileText",iconPosition:"left",onClick:()=>S("certificats_classe","class"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Certificats en lot"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Pour tous les Ã©lÃ¨ves"})]})}),e.jsx(j,{variant:"outline",iconName:"BarChart2",iconPosition:"left",onClick:()=>S("statistiques_classe","class"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Statistiques de classe"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Effectifs et rÃ©partition"})]})}),e.jsx(j,{variant:"outline",iconName:"BookOpen",iconPosition:"left",onClick:()=>S("bulletin_classe","class"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Bulletins de la classe"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Tous les Ã©lÃ¨ves (si disponible)"})]})})]}),C==="public"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"outline",iconName:"FileText",iconPosition:"left",onClick:()=>S("reglement_interieur","public"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"RÃ¨glement intÃ©rieur"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"RÃ¨gles de l'Ã©tablissement"})]})}),e.jsx(j,{variant:"outline",iconName:"Calendar",iconPosition:"left",onClick:()=>S("calendrier_scolaire","public"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Calendrier scolaire"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Vacances et Ã©vÃ©nements"})]})}),e.jsx(j,{variant:"outline",iconName:"Bell",iconPosition:"left",onClick:()=>S("circulaire","public"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Circulaire / Annonce"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Communication aux parents"})]})}),e.jsx(j,{variant:"outline",iconName:"Mail",iconPosition:"left",onClick:()=>S("convocation","public"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Convocation rÃ©union"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"RÃ©union parents-enseignants"})]})}),e.jsx(j,{variant:"outline",iconName:"AlertTriangle",iconPosition:"left",onClick:()=>S("avis_important","public"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Avis important"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Information urgente"})]})}),e.jsx(j,{variant:"outline",iconName:"DollarSign",iconPosition:"left",onClick:()=>S("avis_paiement","public"),className:"justify-start h-auto py-3",children:e.jsxs("span",{className:"text-left",children:[e.jsx("span",{className:"block font-semibold",children:"Avis de paiement"}),e.jsx("span",{className:"block text-xs text-text-secondary",children:"Rappel frais de scolaritÃ©"})]})})]})]})]}),e.jsxs("div",{className:"bg-card rounded-lg border border-border p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6",children:[e.jsxs("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:["Documents rÃ©cents (",X.length,")"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(K,{placeholder:"Rechercher...",value:g,onChange:q=>l(q.target.value),iconName:"Search",iconPosition:"left",className:"w-full sm:w-64"}),e.jsx(oe,{options:d,value:s,onChange:o,placeholder:"CatÃ©gorie",className:"w-full sm:w-48"}),e.jsxs(j,{variant:"ghost",size:"sm",className:"hidden lg:flex",children:[e.jsx(a,{name:"Download",size:16,className:"mr-2"}),"Exporter"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-muted/30",children:[e.jsx("th",{className:"text-left py-3 px-4 font-body font-body-semibold text-sm text-text-secondary w-12",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",onChange:q=>{q.target.checked?t(X.map(m=>m.id)):t([])},checked:n.length===X.length&&X.length>0})}),e.jsx("th",{className:"text-left py-3 px-4 font-body font-body-semibold text-sm text-text-secondary",children:"Document"}),e.jsx("th",{className:"text-left py-3 px-4 font-body font-body-semibold text-sm text-text-secondary",children:"Type"}),e.jsx("th",{className:"text-left py-3 px-4 font-body font-body-semibold text-sm text-text-secondary",children:"Ã‰lÃ¨ve / Classe"}),e.jsx("th",{className:"text-left py-3 px-4 font-body font-body-semibold text-sm text-text-secondary",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-4 font-body font-body-semibold text-sm text-text-secondary",children:"Statut"}),e.jsx("th",{className:"text-center py-3 px-4 font-body font-body-semibold text-sm text-text-secondary",children:"Actions"})]})}),e.jsx("tbody",{children:X.map(q=>e.jsxs("tr",{className:"border-b border-border hover:bg-muted/50 transition-micro",children:[e.jsx("td",{className:"py-4 px-4",children:e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:n.includes(q.id),onChange:m=>{m.target.checked?t([...n,q.id]):t(n.filter(F=>F!==q.id))}})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${q.type==="certificats"?"bg-blue-100":q.type==="attestations"?"bg-green-100":q.type==="bulletins"?"bg-purple-100":"bg-gray-100"}`,children:e.jsx(a,{name:q.type==="certificats"?"FileText":q.type==="attestations"?"Shield":q.type==="bulletins"?"BookOpen":"File",size:20,className:q.type==="certificats"?"text-blue-600":q.type==="attestations"?"text-green-600":q.type==="bulletins"?"text-purple-600":"text-gray-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-body font-body-semibold text-sm text-text-primary",children:q.name}),e.jsxs("div",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:[q.format," ",q.file_size&&`â€¢ ${q.file_size}`]})]})]})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${q.type==="certificats"?"bg-blue-100 text-blue-700":q.type==="attestations"?"bg-green-100 text-green-700":q.type==="bulletins"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:q.type==="certificats"?"Certificat":q.type==="attestations"?"Attestation":q.type==="bulletins"?"Bulletin":q.type||"Document"})}),e.jsxs("td",{className:"py-4 px-4",children:[e.jsx("div",{className:"font-body font-body-normal text-sm text-text-primary",children:q.studentName||"-"}),e.jsx("div",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:q.class||"-"})]}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("div",{className:"font-body font-body-normal text-sm text-text-primary",children:q.dateCreated})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${J(q.status)}`,children:ae(q.status)})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>f(q.id),title:"Voir le document",className:"hover:bg-blue-50 hover:text-blue-600",children:e.jsx(a,{name:"Eye",size:16})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>W(q.id),title:"TÃ©lÃ©charger",className:"hover:bg-green-50 hover:text-green-600",children:e.jsx(a,{name:"Download",size:16})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>r(q.id),title:"Imprimer",className:"hover:bg-purple-50 hover:text-purple-600",children:e.jsx(a,{name:"Printer",size:16})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>G(q.id),title:"Supprimer",className:"hover:bg-red-50 hover:text-red-600",children:e.jsx(a,{name:"Trash2",size:16})})]})})]},q.id))})]})}),X.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(a,{name:"FileText",size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary mb-2",children:"Aucun document trouvÃ©"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary",children:g||s?"Aucun document ne correspond Ã  vos critÃ¨res de recherche.":"Commencez par gÃ©nÃ©rer un document en utilisant les boutons ci-dessus."})]})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold",children:[N==="student"&&"SÃ©lectionner un Ã©lÃ¨ve",N==="class"&&"SÃ©lectionner une classe",N==="public"&&"Document public"]}),e.jsx("button",{onClick:()=>{I(!1),M(null),x(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx(a,{name:"X",size:20})})]}),e.jsxs("div",{className:"mb-2 text-sm text-gray-500",children:["Type de document : ",e.jsx("span",{className:"font-medium text-gray-700",children:O})]}),N==="student"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Ã‰lÃ¨ve"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2",value:B||"",onChange:q=>M(q.target.value),children:[e.jsx("option",{value:"",children:"-- SÃ©lectionner un Ã©lÃ¨ve --"}),z.map(q=>e.jsxs("option",{value:q.id,children:[q.last_name," ",q.first_name," - ",q.class_name]},q.id))]})]}),N==="class"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Classe"}),e.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2",value:w||"",onChange:q=>x(q.target.value),children:[e.jsx("option",{value:"",children:"-- SÃ©lectionner une classe --"}),L.map(q=>e.jsxs("option",{value:q.id,children:[q.name," (",q.level,")"]},q.id))]})]}),N==="public"&&e.jsx("p",{className:"mb-4 text-gray-600",children:"Ce document sera visible par tous les parents et Ã©lÃ¨ves de l'Ã©cole."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(j,{variant:"outline",onClick:()=>{I(!1),M(null),x(null)},children:"Annuler"}),e.jsx(j,{variant:"default",onClick:Q,disabled:N==="student"&&!B||N==="class"&&!w,children:"GÃ©nÃ©rer"})]})]})})]})};class at{constructor(){this.events=[],this.nextId=1}async getAllEvents(l={}){try{const s=await ge();if(!s)return{events:[],statistics:{total:0,upcoming:0,today:0,confirmed:0,pending:0,cancelled:0}};const{data:o,error:n}=await Z.from("students").select("id, user_id, first_name, last_name, created_at").eq("school_id",s).eq("is_active",!0).order("created_at",{ascending:!1}).limit(10);if(n)throw n;if(!o||o.length===0)return{events:[],statistics:{total:0,upcoming:0,today:0,confirmed:0,pending:0,cancelled:0}};const t=[];o.forEach((T,k)=>{const u=["parent_meeting","meeting","school_event","inscription"],D=["confirmed","scheduled","pending"],C=Math.floor(Math.random()*2)+1;for(let P=0;P<C;P++){const b=new Date;b.setDate(b.getDate()+(k*2+P+1));const I=u[P%u.length],N=8+(k+P)%8;t.push({id:t.length+1,title:this.generateEventTitle(I,T),type:I,date:b.toISOString().split("T")[0],startTime:`${N.toString().padStart(2,"0")}:00`,endTime:`${(N+1).toString().padStart(2,"0")}:00`,duration:60,status:D[P%D.length],description:this.generateEventDescription(I,T),attendees:this.generateAttendees(I,T),location:"Bureau secrÃ©tariat",priority:["high","medium","low"][P%3],studentId:T.user_id||T.id,studentName:`${T.first_name} ${T.last_name}`,studentClass:"Non assignÃ©",createdBy:"secretary",reminders:[{type:"email",time:"1 day before",sent:!1}],parentPhone:`+237 6XX XX XX ${(k+10).toString().padStart(2,"0")}`,parentEmail:`${T.first_name.toLowerCase()}.parent@email.com`})}});let i=this.applyFilters(t,l);const E=this.calculateStatistics(i);return{events:i,statistics:E}}catch(s){return console.error("Erreur getAllEvents:",s),{events:[],statistics:{total:0,upcoming:0,today:0,confirmed:0,pending:0,cancelled:0}}}}applyFilters(l,s){let o=[...l];if(s.type&&s.type!==""&&(o=o.filter(n=>n.type===s.type)),s.status&&s.status!==""&&(o=o.filter(n=>n.status===s.status)),s.startDate&&(o=o.filter(n=>new Date(n.date)>=new Date(s.startDate))),s.endDate&&(o=o.filter(n=>new Date(n.date)<=new Date(s.endDate))),s.studentClass&&(o=o.filter(n=>n.studentClass===s.studentClass)),s.search){const n=s.search.toLowerCase();o=o.filter(t=>t.title.toLowerCase().includes(n)||t.description.toLowerCase().includes(n)||t.location.toLowerCase().includes(n)||t.studentName&&t.studentName.toLowerCase().includes(n))}return o.sort((n,t)=>{const i=new Date(`${n.date} ${n.startTime}`),E=new Date(`${t.date} ${t.startTime}`);return i-E}),o}generateEventTitle(l,s){return{parent_meeting:`Rendez-vous - Parents de ${s.first_name} ${s.last_name}`,meeting:`RÃ©union pÃ©dagogique - ${s.first_name}`,school_event:`Ã‰vÃ©nement scolaire - Classe de ${s.first_name}`,inscription:`Inscription - ${s.first_name} ${s.last_name}`}[l]||`Ã‰vÃ©nement - ${s.first_name} ${s.last_name}`}generateEventDescription(l,s){return{parent_meeting:`Entretien concernant ${s.first_name} ${s.last_name} - Suivi scolaire`,meeting:"RÃ©union d'Ã©quipe pÃ©dagogique concernant la classe",school_event:"Ã‰vÃ©nement organisÃ© pour la classe",inscription:`Finalisation inscription de ${s.first_name} ${s.last_name}`}[l]||`Ã‰vÃ©nement concernant ${s.first_name} ${s.last_name}`}generateAttendees(l,s){return{parent_meeting:[`Parents de ${s.first_name}`,"Enseignant","SecrÃ©taire"],meeting:["Direction","Ã‰quipe pÃ©dagogique","SecrÃ©taire"],school_event:["Ã‰lÃ¨ves","Parents","Enseignants"],inscription:[`Parents de ${s.first_name}`,"SecrÃ©taire","Direction"]}[l]||["Participants"]}calculateStatistics(l){const s=new Date().toISOString().split("T")[0];return{total:l.length,upcoming:l.filter(o=>new Date(o.date)>=new Date(s)).length,today:l.filter(o=>o.date===s).length,confirmed:l.filter(o=>o.status==="confirmed").length,pending:l.filter(o=>o.status==="pending").length,cancelled:l.filter(o=>o.status==="cancelled").length}}async createEvent(l){await this.delay(500);const s={id:this.nextId++,...l,status:l.status||"scheduled",createdBy:"secretary",createdAt:new Date().toISOString(),reminders:l.reminders||[]};return this.events.push(s),{success:!0,event:s}}async updateEvent(l,s){await this.delay(400);const o=this.events.findIndex(n=>n.id===l);if(o===-1)throw new Error("Ã‰vÃ©nement non trouvÃ©");return this.events[o]={...this.events[o],...s,updatedAt:new Date().toISOString()},{success:!0,event:this.events[o]}}async deleteEvent(l){await this.delay(300);const s=this.events.findIndex(n=>n.id===l);if(s===-1)throw new Error("Ã‰vÃ©nement non trouvÃ©");return{success:!0,event:this.events.splice(s,1)[0]}}async confirmEvent(l){return this.updateEvent(l,{status:"confirmed"})}async cancelEvent(l,s=""){return this.updateEvent(l,{status:"cancelled",cancellationReason:s,cancelledAt:new Date().toISOString()})}async getEventsByDate(l){return await this.delay(200),this.events.filter(s=>s.date===l)}async getWeekEvents(l){await this.delay(300);const s=new Date(l),o=new Date(s);return o.setDate(s.getDate()+6),this.events.filter(n=>{const t=new Date(n.date);return t>=s&&t<=o})}async checkAvailability(l,s,o,n=null){await this.delay(200);const t=this.events.filter(i=>{if(n&&i.id===n||i.date!==l||i.status==="cancelled")return!1;const E=this.timeToMinutes(i.startTime),T=this.timeToMinutes(i.endTime),k=this.timeToMinutes(s),u=this.timeToMinutes(o);return k<T&&u>E});return{available:t.length===0,conflicts:t}}async sendReminders(l){await this.delay(400);const s=this.events.find(n=>n.id===l);if(!s)throw new Error("Ã‰vÃ©nement non trouvÃ©");const o=[];return s.parentEmail&&o.push({type:"email",recipient:s.parentEmail,sentAt:new Date().toISOString()}),s.parentPhone&&o.push({type:"sms",recipient:s.parentPhone,sentAt:new Date().toISOString()}),s.reminders.forEach(n=>{n.sent=!0,n.sentAt=new Date().toISOString()}),{success:!0,sentReminders:o}}calculateStatistics(l){const s=new Date().toISOString().split("T")[0],o=new Date;o.setDate(o.getDate()+7);const n=o.toISOString().split("T")[0];return{total:l.length,today:l.filter(t=>t.date===s).length,thisWeek:l.filter(t=>t.date>=s&&t.date<=n).length,byStatus:{confirmed:l.filter(t=>t.status==="confirmed").length,scheduled:l.filter(t=>t.status==="scheduled").length,pending:l.filter(t=>t.status==="pending").length,cancelled:l.filter(t=>t.status==="cancelled").length},byType:{parent_meeting:l.filter(t=>t.type==="parent_meeting").length,meeting:l.filter(t=>t.type==="meeting").length,school_event:l.filter(t=>t.type==="school_event").length,training:l.filter(t=>t.type==="training").length,official_meeting:l.filter(t=>t.type==="official_meeting").length,inscription:l.filter(t=>t.type==="inscription").length,interview:l.filter(t=>t.type==="interview").length,holiday:l.filter(t=>t.type==="holiday").length},pendingConfirmations:l.filter(t=>t.status==="pending").length,upcomingThisWeek:l.filter(t=>t.date>=s&&t.date<=n&&t.status!=="cancelled").length}}timeToMinutes(l){const[s,o]=l.split(":").map(Number);return s*60+o}delay(l){return new Promise(s=>setTimeout(s,l))}async exportPlanning(l="csv",s={}){const{events:o}=await this.getAllEvents(s);if(l==="csv"){const n=["Date","Heure","Titre","Type","Statut","Lieu","Participants","Description","PrioritÃ©","DurÃ©e (min)"],t=o.map(i=>[i.date,i.startTime,i.title,this.getTypeLabel(i.type),this.getStatusLabel(i.status),i.location,i.attendees.join("; "),i.description,i.priority,i.duration]);return[n,...t]}return o}getTypeLabel(l){return{parent_meeting:"Rendez-vous parents",meeting:"RÃ©union",school_event:"Ã‰vÃ©nement scolaire",training:"Formation",official_meeting:"Conseil officiel",inscription:"Inscription",interview:"Entretien",holiday:"Vacances"}[l]||l}getStatusLabel(l){return{confirmed:"ConfirmÃ©",scheduled:"ProgrammÃ©",pending:"En attente",cancelled:"AnnulÃ©"}[l]||l}}const _e=new at,nt=({isOpen:g,onClose:l,event:s=null,onSuccess:o})=>{const[n,t]=c.useState(!1),[i,E]=c.useState({}),[T,k]=c.useState(null),[u,D]=c.useState({title:"",type:"parent_meeting",date:"",startTime:"",endTime:"",location:"",description:"",priority:"medium",attendees:[""],studentName:"",studentClass:"",parentPhone:"",parentEmail:"",notes:"",reminders:[{type:"email",time:"1 day before",enabled:!0},{type:"sms",time:"2 hours before",enabled:!1}]});c.useEffect(()=>{D(s?{title:s.title||"",type:s.type||"parent_meeting",date:s.date||"",startTime:s.startTime||"",endTime:s.endTime||"",location:s.location||"",description:s.description||"",priority:s.priority||"medium",attendees:s.attendees||[""],studentName:s.studentName||"",studentClass:s.studentClass||"",parentPhone:s.parentPhone||"",parentEmail:s.parentEmail||"",notes:s.notes||"",reminders:s.reminders||[{type:"email",time:"1 day before",enabled:!0},{type:"sms",time:"2 hours before",enabled:!1}]}:{title:"",type:"parent_meeting",date:"",startTime:"",endTime:"",location:"Bureau secrÃ©tariat",description:"",priority:"medium",attendees:[""],studentName:"",studentClass:"",parentPhone:"",parentEmail:"",notes:"",reminders:[{type:"email",time:"1 day before",enabled:!0},{type:"sms",time:"2 hours before",enabled:!1}]}),E({}),k(null)},[s,g]);const C=[{value:"parent_meeting",label:"Rendez-vous parents"},{value:"meeting",label:"RÃ©union pÃ©dagogique"},{value:"school_event",label:"Ã‰vÃ©nement scolaire"},{value:"training",label:"Formation"},{value:"official_meeting",label:"Conseil officiel"},{value:"inscription",label:"Inscription"},{value:"interview",label:"Entretien"},{value:"holiday",label:"Vacances scolaires"}],P=[{value:"low",label:"Faible"},{value:"medium",label:"Normal"},{value:"high",label:"Urgent"}],b=[{value:"",label:"SÃ©lectionner une classe"},{value:"CE1",label:"CE1"},{value:"CE2",label:"CE2"},{value:"CM1",label:"CM1"},{value:"CM2",label:"CM2"}],I=[{value:"Bureau secrÃ©tariat",label:"Bureau secrÃ©tariat"},{value:"Bureau direction",label:"Bureau direction"},{value:"Salle des professeurs",label:"Salle des professeurs"},{value:"Salle polyvalente",label:"Salle polyvalente"},{value:"Salle de classe",label:"Salle de classe"},{value:"Cour de rÃ©crÃ©ation",label:"Cour de rÃ©crÃ©ation"},{value:"ExtÃ©rieur",label:"Sortie/ExtÃ©rieur"}],N=(M,w)=>{D(x=>({...x,[M]:w})),i[M]&&E(x=>({...x,[M]:null}))},v=(M,w)=>{const x=[...u.attendees];x[M]=w,D(d=>({...d,attendees:x}))},O=()=>{D(M=>({...M,attendees:[...M.attendees,""]}))},p=M=>{if(u.attendees.length>1){const w=u.attendees.filter((x,d)=>d!==M);D(x=>({...x,attendees:w}))}},z=(M,w)=>{const x=[...u.reminders];x[M].enabled=w,D(d=>({...d,reminders:x}))},R=async()=>{if(!(!u.date||!u.startTime||!u.endTime))try{const M=await _e.checkAvailability(u.date,u.startTime,u.endTime,s==null?void 0:s.id);k(M)}catch(M){console.error("Erreur vÃ©rification disponibilitÃ©:",M)}};c.useEffect(()=>{const M=setTimeout(()=>{R()},500);return()=>clearTimeout(M)},[u.date,u.startTime,u.endTime]);const L=()=>{if(!u.startTime||!u.endTime)return 0;const M=new Date(`2000-01-01 ${u.startTime}`),w=new Date(`2000-01-01 ${u.endTime}`);return Math.round((w-M)/(1e3*60))},U=()=>{const M={};if(u.title.trim()||(M.title="Le titre est requis"),u.date||(M.date="La date est requise"),u.startTime||(M.startTime="L'heure de dÃ©but est requise"),u.endTime||(M.endTime="L'heure de fin est requise"),u.location.trim()||(M.location="Le lieu est requis"),u.startTime&&u.endTime){const w=new Date(`2000-01-01 ${u.startTime}`);new Date(`2000-01-01 ${u.endTime}`)<=w&&(M.endTime="L'heure de fin doit Ãªtre aprÃ¨s l'heure de dÃ©but")}if(u.date){const w=new Date(u.date),x=new Date;x.setHours(0,0,0,0),w<x&&(M.date="La date ne peut pas Ãªtre dans le passÃ©")}return u.type==="parent_meeting"&&(u.studentName.trim()||(M.studentName="Le nom de l'Ã©lÃ¨ve est requis"),!u.parentPhone.trim()&&!u.parentEmail.trim()&&(M.parentPhone="Au moins un moyen de contact parent est requis")),E(M),Object.keys(M).length===0},B=async M=>{if(M.preventDefault(),!!U()){t(!0);try{const w={...u,duration:L(),attendees:u.attendees.filter(x=>x.trim()!==""),reminders:u.reminders.filter(x=>x.enabled)};s?await _e.updateEvent(s.id,w):await _e.createEvent(w),o&&o(),l()}catch(w){console.error("Erreur sauvegarde Ã©vÃ©nement:",w),E({submit:"Erreur lors de la sauvegarde"})}finally{t(!1)}}};return g?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5"}),s?"Modifier l'Ã©vÃ©nement":"CrÃ©er un Ã©vÃ©nement"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Planification et gestion des rendez-vous"})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Re,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:B,className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Titre de l'Ã©vÃ©nement *"}),e.jsx(K,{value:u.title,onChange:M=>N("title",M.target.value),placeholder:"Ex: Rendez-vous avec M. et Mme Dupont",error:i.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type d'Ã©vÃ©nement *"}),e.jsx(oe,{options:C,value:u.type,onChange:M=>N("type",M)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PrioritÃ©"}),e.jsx(oe,{options:P,value:u.priority,onChange:M=>N("priority",M)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date *"}),e.jsx(K,{type:"date",value:u.date,onChange:M=>N("date",M.target.value),error:i.date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Heure de dÃ©but *"}),e.jsx(K,{type:"time",value:u.startTime,onChange:M=>N("startTime",M.target.value),error:i.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Heure de fin *"}),e.jsx(K,{type:"time",value:u.endTime,onChange:M=>N("endTime",M.target.value),error:i.endTime}),L()>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["DurÃ©e: ",L()," minutes"]})]})]}),T&&e.jsxs("div",{className:`p-3 rounded-lg border ${T.available?"border-green-200 bg-green-50 text-green-800":"border-red-200 bg-red-50 text-red-800"}`,children:[e.jsx("div",{className:"flex items-center gap-2",children:T.available?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"CrÃ©neau disponible"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Conflit dÃ©tectÃ© (",T.conflicts.length," Ã©vÃ©nement(s))"]})]})}),!T.available&&e.jsx("div",{className:"mt-2 text-xs",children:T.conflicts.map(M=>e.jsxs("div",{children:["â€¢ ",M.title," (",M.startTime," - ",M.endTime,")"]},M.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lieu *"}),e.jsx(oe,{options:I,value:u.location,onChange:M=>N("location",M),placeholder:"Choisir un lieu..."}),i.location&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.location})]}),u.type==="parent_meeting"&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-3",children:"Informations Ã©lÃ¨ve et parents"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nom de l'Ã©lÃ¨ve *"}),e.jsx(K,{value:u.studentName,onChange:M=>N("studentName",M.target.value),placeholder:"Ex: Marie Dupont",error:i.studentName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Classe"}),e.jsx(oe,{options:b,value:u.studentClass,onChange:M=>N("studentClass",M)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"TÃ©lÃ©phone parent"}),e.jsx(K,{value:u.parentPhone,onChange:M=>N("parentPhone",M.target.value),placeholder:"06.12.34.56.78",error:i.parentPhone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email parent"}),e.jsx(K,{type:"email",value:u.parentEmail,onChange:M=>N("parentEmail",M.target.value),placeholder:"parent@email.com"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Participants"}),u.attendees.map((M,w)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{value:M,onChange:x=>v(w,x.target.value),placeholder:"Nom du participant",className:"flex-1"}),u.attendees.length>1&&e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>p(w),children:e.jsx(Re,{className:"w-4 h-4"})})]},w)),e.jsx(j,{type:"button",variant:"outline",size:"sm",onClick:O,className:"mt-2",children:"Ajouter un participant"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:u.description,onChange:M=>N("description",M.target.value),rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"DÃ©tails de l'Ã©vÃ©nement..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes internes"}),e.jsx("textarea",{value:u.notes,onChange:M=>N("notes",M.target.value),rows:2,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Notes privÃ©es pour l'Ã©quipe..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rappels automatiques"}),e.jsx("div",{className:"space-y-2",children:u.reminders.map((M,w)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 border rounded",children:[e.jsx("input",{type:"checkbox",checked:M.enabled,onChange:x=>z(w,x.target.checked),className:"rounded"}),e.jsxs("span",{className:"text-sm",children:[M.type==="email"?"ðŸ“§":"ðŸ“±"," ",M.type.toUpperCase()," - ",M.time]})]},w))})]}),i.submit&&e.jsx("div",{className:"text-red-600 text-sm",children:i.submit})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t bg-gray-50",children:[e.jsx(j,{type:"button",variant:"outline",onClick:l,disabled:n,children:"Annuler"}),e.jsxs(j,{type:"submit",disabled:n||T&&!T.available,loading:n,children:[s?"Modifier":"CrÃ©er"," l'Ã©vÃ©nement"]})]})]})]})}):null},rt=({isOpen:g,onClose:l,onEventSelect:s})=>{const[o,n]=c.useState(new Date),[t,i]=c.useState([]),[E,T]=c.useState(!1),[k,u]=c.useState(null),[D,C]=c.useState(null);c.useEffect(()=>{g&&P()},[g,o]);const P=async()=>{T(!0);try{const x=new Date(o.getFullYear(),o.getMonth(),1),d=new Date(o.getFullYear(),o.getMonth()+1,0),{events:_}=await _e.getAllEvents({startDate:x.toISOString().split("T")[0],endDate:d.toISOString().split("T")[0]});i(_)}catch(x){console.error("Erreur chargement Ã©vÃ©nements:",x)}finally{T(!1)}},b=x=>{const d=new Date(o);d.setMonth(d.getMonth()+x),n(d),u(null)},I=()=>{n(new Date),u(null)},N=()=>{const x=o.getFullYear(),d=o.getMonth(),_=new Date(x,d,1),J=new Date(_),ae=_.getDay(),V=ae===0?6:ae-1;J.setDate(J.getDate()-V);const X=[],S=new Date(J);for(let Q=0;Q<42;Q++)X.push(new Date(S)),S.setDate(S.getDate()+1);return X},v=x=>{const d=x.toISOString().split("T")[0];return t.filter(_=>_.date===d)},O=x=>{const d={parent_meeting:"bg-blue-100 text-blue-700 border-blue-200",meeting:"bg-purple-100 text-purple-700 border-purple-200",school_event:"bg-green-100 text-green-700 border-green-200",training:"bg-orange-100 text-orange-700 border-orange-200",official_meeting:"bg-red-100 text-red-700 border-red-200",inscription:"bg-yellow-100 text-yellow-700 border-yellow-200",interview:"bg-indigo-100 text-indigo-700 border-indigo-200",holiday:"bg-gray-100 text-gray-700 border-gray-200"};return d[x]||d.parent_meeting},p=x=>{const d={confirmed:"âœ…",scheduled:"ðŸ“…",pending:"â³",cancelled:"âŒ"};return d[x]||d.scheduled},z=()=>o.toLocaleDateString("fr-FR",{month:"long",year:"numeric"}),R=x=>{const d=new Date;return x.toDateString()===d.toDateString()},L=x=>x.getMonth()===o.getMonth(),U=x=>{v(x).length>0&&u(x)},B=x=>{s&&s(x),l()},M=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],w=N();return g?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Calendrier Planning"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Vue mensuelle des Ã©vÃ©nements et rendez-vous"})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Re,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex h-[600px]",children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>b(-1),children:e.jsx(xs,{className:"w-4 h-4"})}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>b(1),children:e.jsx(us,{className:"w-4 h-4"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 ml-4 capitalize",children:z()})]}),e.jsx(j,{variant:"outline",size:"sm",onClick:I,children:"Aujourd'hui"})]}),e.jsx("div",{className:"grid grid-cols-7 border-b bg-gray-50",children:M.map(x=>e.jsx("div",{className:"p-2 text-center text-sm font-medium text-gray-700 border-r last:border-r-0",children:x},x))}),e.jsx("div",{className:"flex-1 grid grid-cols-7 auto-rows-fr",children:w.map((x,d)=>{const _=v(x),J=L(x),ae=R(x);return e.jsxs("div",{className:`border-r border-b last:border-r-0 p-1 cursor-pointer transition-colors ${J?(D==null?void 0:D.toDateString())===x.toDateString()?"bg-blue-50":"bg-white hover:bg-gray-50":"bg-gray-50 text-gray-400"} ${(k==null?void 0:k.toDateString())===x.toDateString()?"bg-blue-100 ring-2 ring-blue-500":""}`,onClick:()=>U(x),onMouseEnter:()=>C(x),onMouseLeave:()=>C(null),children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${ae?"bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center":""}`,children:x.getDate()}),e.jsxs("div",{className:"space-y-1",children:[_.slice(0,3).map(V=>e.jsxs("div",{className:`text-xs px-1 py-0.5 rounded border truncate ${O(V.type)}`,title:`${V.title} (${V.startTime})`,children:[e.jsx("span",{className:"mr-1",children:p(V.status)}),V.title]},V.id)),_.length>3&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",_.length-3," autres"]})]})]},d)})})]}),e.jsxs("div",{className:"w-80 border-l bg-gray-50 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b bg-white",children:e.jsx("h4",{className:"font-medium text-gray-900",children:k?e.jsxs(e.Fragment,{children:["Ã‰vÃ©nements du ",k.toLocaleDateString("fr-FR")]}):"SÃ©lectionnez une date"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:k?v(k).length>0?v(k).map(x=>e.jsxs("div",{className:"bg-white border rounded-lg p-3 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>B(x),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:x.title}),e.jsx("span",{className:"text-lg",children:p(x.status)})]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsxs("span",{children:[x.startTime," - ",x.endTime]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(As,{className:"w-4 h-4"}),e.jsx("span",{children:x.location})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 line-clamp-2",children:x.description}),e.jsx("div",{className:`inline-block mt-2 px-2 py-1 rounded text-xs border ${O(x.type)}`,children:_e.getTypeLabel(x.type)})]},x.id)):e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(Ue,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"Aucun Ã©vÃ©nement ce jour"})]}):e.jsx("div",{className:"text-center text-gray-500 py-8",children:e.jsx("p",{children:"Cliquez sur une date pour voir les Ã©vÃ©nements"})})}),e.jsxs("div",{className:"p-4 border-t bg-white",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"LÃ©gende"}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"âœ…"})," ConfirmÃ©"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“…"})," ProgrammÃ©"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"â³"})," En attente"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"âŒ"})," AnnulÃ©"]})]})]})]})]})]})}):null},lt=({isOpen:g,onClose:l})=>{const[s,o]=c.useState([]),[n,t]=c.useState({}),[i,E]=c.useState(!1),[T,k]=c.useState("month");c.useEffect(()=>{g&&u()},[g,T]);const u=async()=>{E(!0);try{const v=new Date,O=new Date;switch(T){case"week":O.setDate(v.getDate()-7);break;case"month":O.setMonth(v.getMonth()-1);break;case"quarter":O.setMonth(v.getMonth()-3);break;case"year":O.setFullYear(v.getFullYear()-1);break;default:O.setMonth(v.getMonth()-1)}const p={startDate:O.toISOString().split("T")[0],endDate:v.toISOString().split("T")[0]},z=await _e.getAllEvents(p);o(z.events||[]),t(z.statistics||{})}catch(v){console.error("Erreur chargement analytics:",v)}finally{E(!1)}},D=()=>({week:"DerniÃ¨re semaine",month:"Dernier mois",quarter:"Dernier trimestre",year:"DerniÃ¨re annÃ©e"})[T]||"Dernier mois",C=[{value:"week",label:"DerniÃ¨re semaine"},{value:"month",label:"Dernier mois"},{value:"quarter",label:"Dernier trimestre"},{value:"year",label:"DerniÃ¨re annÃ©e"}],P=()=>{var L,U,B,M,w,x,d,_,J,ae,V;if(!s.length)return;const O=[["RAPPORT D'ANALYSE DU PLANNING"],[""],["PÃ©riode:",D()],["Date de gÃ©nÃ©ration:",new Date().toLocaleDateString("fr-FR")],[""],["RÃ‰SUMÃ‰ GÃ‰NÃ‰RAL"],["Nombre total d'Ã©vÃ©nements:",n.total||0],["Ã‰vÃ©nements aujourd'hui:",n.today||0],["Ã‰vÃ©nements cette semaine:",n.thisWeek||0],["Confirmations en attente:",n.pendingConfirmations||0],[""],["RÃ‰PARTITION PAR TYPE"],["Rendez-vous parents:",((L=n.byType)==null?void 0:L.parent_meeting)||0],["RÃ©unions pÃ©dagogiques:",((U=n.byType)==null?void 0:U.meeting)||0],["Ã‰vÃ©nements scolaires:",((B=n.byType)==null?void 0:B.school_event)||0],["Formations:",((M=n.byType)==null?void 0:M.training)||0],["Conseils officiels:",((w=n.byType)==null?void 0:w.official_meeting)||0],["Inscriptions:",((x=n.byType)==null?void 0:x.inscription)||0],["Entretiens:",((d=n.byType)==null?void 0:d.interview)||0],[""],["RÃ‰PARTITION PAR STATUT"],["ConfirmÃ©s:",((_=n.byStatus)==null?void 0:_.confirmed)||0],["ProgrammÃ©s:",((J=n.byStatus)==null?void 0:J.scheduled)||0],["En attente:",((ae=n.byStatus)==null?void 0:ae.pending)||0],["AnnulÃ©s:",((V=n.byStatus)==null?void 0:V.cancelled)||0]].map(X=>X.join(",")).join(`
`),p=new Blob([O],{type:"text/csv;charset=utf-8;"}),z=URL.createObjectURL(p),R=document.createElement("a");R.href=z,R.download=`analyse_planning_${T}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(z)},b=()=>{if(!s.length)return{trend:0,message:"Aucune donnÃ©e"};const v=new Date,O=new Date;O.setDate(v.getDate()-7);const p=s.filter(U=>new Date(U.date)>=O).length,z=s.filter(U=>{const B=new Date(U.date),M=new Date;return M.setDate(v.getDate()-14),B>=M&&B<O}).length;if(z===0)return{trend:p>0?100:0,message:"Nouvelle activitÃ©"};const R=(p-z)/z*100,L=R>0?"En hausse":R<0?"En baisse":"Stable";return{trend:Math.round(R),message:L}},I=v=>{const O={parent_meeting:"bg-blue-100 text-blue-800",meeting:"bg-purple-100 text-purple-800",school_event:"bg-green-100 text-green-800",training:"bg-orange-100 text-orange-800",official_meeting:"bg-red-100 text-red-800",inscription:"bg-yellow-100 text-yellow-800",interview:"bg-indigo-100 text-indigo-800",holiday:"bg-gray-100 text-gray-800"};return O[v]||O.parent_meeting};if(!g)return null;const N=b();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5"}),"Analyses du Planning"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Statistiques et tendances des Ã©vÃ©nements"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:P,disabled:!s.length,className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Exporter"]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Re,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"p-4 border-b bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"PÃ©riode d'analyse:"}),e.jsx(oe,{value:T,onChange:k,options:C,className:"w-48"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[i&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Calcul des analyses..."})]}),!i&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["RÃ©sumÃ© - ",D()]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Total Ã‰vÃ©nements"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:n.total||0})]}),e.jsx(Ue,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600",children:"Cette Semaine"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:n.thisWeek||0})]}),e.jsx(Ye,{className:"w-8 h-8 text-green-500"})]})}),e.jsx("div",{className:"bg-yellow-50 rounded-lg p-4 border border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-600",children:"Ã€ Confirmer"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:n.pendingConfirmations||0})]}),e.jsx(Ts,{className:"w-8 h-8 text-yellow-500"})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-200",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600",children:"Tendance"}),e.jsxs("p",{className:"text-lg font-bold text-purple-900 flex items-center gap-1",children:[N.trend>0&&e.jsx(ns,{className:"w-4 h-4"}),N.trend===0&&e.jsx("span",{className:"w-4 h-4 text-center",children:"-"}),N.trend<0&&e.jsx(ns,{className:"w-4 h-4 rotate-180"}),Math.abs(N.trend),"%"]}),e.jsx("p",{className:"text-xs text-purple-600",children:N.message})]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"RÃ©partition par Type"}),e.jsx("div",{className:"space-y-2",children:Object.entries(n.byType||{}).map(([v,O])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${I(v)}`,children:_e.getTypeLabel(v)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${O/(n.total||1)*100}%`}})}),e.jsx("span",{className:"text-sm font-medium w-8 text-right",children:O})]})]},v))})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"RÃ©partition par Statut"}),e.jsx("div",{className:"space-y-2",children:Object.entries(n.byStatus||{}).map(([v,O])=>{const p={confirmed:"bg-green-500",scheduled:"bg-blue-500",pending:"bg-yellow-500",cancelled:"bg-red-500"},z={confirmed:"ConfirmÃ©s",scheduled:"ProgrammÃ©s",pending:"En attente",cancelled:"AnnulÃ©s"};return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:z[v]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`${p[v]} h-2 rounded-full`,style:{width:`${O/(n.total||1)*100}%`}})}),e.jsx("span",{className:"text-sm font-medium w-8 text-right",children:O})]})]},v)})})]})]}),n.thisWeek>0&&e.jsxs("div",{className:"bg-white rounded-lg border p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Ã‰vÃ©nements Cette Semaine"}),e.jsx("div",{className:"space-y-2",children:s.filter(v=>{const O=new Date(v.date),p=new Date,z=new Date(p);z.setDate(p.getDate()-p.getDay()+1);const R=new Date(z);return R.setDate(z.getDate()+6),O>=z&&O<=R}).sort((v,O)=>new Date(v.date)-new Date(O.date)).slice(0,10).map(v=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:new Date(v.date).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric"})}),e.jsx("div",{className:"text-sm text-gray-600",children:v.startTime}),e.jsx("div",{className:"text-sm text-gray-900",children:v.title})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${I(v.type)}`,children:_e.getTypeLabel(v.type)})]},v.id))})]})]})]})]})})},it=()=>{var ke,ue,De;const{toasts:g,showSuccess:l,showError:s,removeToast:o}=ps(),[n,t]=c.useState((De=(ue=(ke=new Date)==null?void 0:ke.toISOString())==null?void 0:ue.split("T"))==null?void 0:De[0]),[i,E]=c.useState("list"),[T,k]=c.useState(""),[u,D]=c.useState(""),[C,P]=c.useState(""),[b,I]=c.useState(""),[N,v]=c.useState([]),[O,p]=c.useState({}),[z,R]=c.useState(!0),[L,U]=c.useState(!1),[B,M]=c.useState(!1),[w,x]=c.useState(!1),[d,_]=c.useState(null);c.useEffect(()=>{J()},[T,u,C,b,n]);const J=async()=>{R(!0);try{const ee={type:T,status:u,studentClass:C,search:b},ce=await _e.getAllEvents(ee,"production");v(ce.events||[]),p(ce.statistics||{})}catch(ee){console.error("Erreur chargement Ã©vÃ©nements:",ee),s("Erreur lors du chargement des Ã©vÃ©nements")}finally{R(!1)}},ae=[{value:"",label:"Tous les Ã©vÃ©nements"},{value:"parent_meeting",label:"Rendez-vous parents"},{value:"meeting",label:"RÃ©unions pÃ©dagogiques"},{value:"school_event",label:"Ã‰vÃ©nements scolaires"},{value:"training",label:"Formations"},{value:"official_meeting",label:"Conseils officiels"},{value:"inscription",label:"Inscriptions"},{value:"interview",label:"Entretiens"},{value:"holiday",label:"Vacances scolaires"}],V=[{value:"",label:"Tous les statuts"},{value:"confirmed",label:"ConfirmÃ©"},{value:"scheduled",label:"ProgrammÃ©"},{value:"pending",label:"En attente"},{value:"cancelled",label:"AnnulÃ©"}],X=[{value:"",label:"Toutes les classes"},{value:"CE1",label:"CE1"},{value:"CE2",label:"CE2"},{value:"CM1",label:"CM1"},{value:"CM2",label:"CM2"}],S=[{value:"list",label:"Liste"},{value:"calendar",label:"Calendrier"},{value:"week",label:"Semaine"}],Q=()=>{_(null),U(!0)},r=ee=>{_(ee),U(!0)},f=async ee=>{try{await _e.confirmEvent(ee),l("Ã‰vÃ©nement confirmÃ© avec succÃ¨s"),J()}catch{s("Erreur lors de la confirmation")}},W=async ee=>{if(window.confirm("ÃŠtes-vous sÃ»r de vouloir annuler cet Ã©vÃ©nement ?"))try{await _e.cancelEvent(ee,"AnnulÃ© par le secrÃ©tariat"),l("Ã‰vÃ©nement annulÃ©"),J()}catch{s("Erreur lors de l'annulation")}},G=async ee=>{try{await _e.sendReminders(ee),l("Rappels envoyÃ©s avec succÃ¨s")}catch{s("Erreur lors de l'envoi des rappels")}},q=()=>{l(d?"Ã‰vÃ©nement modifiÃ© avec succÃ¨s":"Ã‰vÃ©nement crÃ©Ã© avec succÃ¨s"),J(),U(!1)},m=()=>{M(!0)},F=ee=>{_(ee),U(!0)},Y=async()=>{try{const ee={type:T,status:u,studentClass:C,search:b},je=(await _e.exportPlanning("csv",ee)).map(we=>we.join(",")).join(`
`),ze=new Blob([je],{type:"text/csv;charset=utf-8;"}),A=URL.createObjectURL(ze),le=document.createElement("a");le.href=A,le.download=`planning_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(le),le.click(),document.body.removeChild(le),URL.revokeObjectURL(A),l("Planning exportÃ© avec succÃ¨s")}catch{s("Erreur lors de l'export")}},ne=ee=>{const ce={confirmed:{label:"ConfirmÃ©",className:"bg-success/10 text-success border-success/20",icon:"CheckCircle"},scheduled:{label:"ProgrammÃ©",className:"bg-primary/10 text-primary border-primary/20",icon:"Calendar"},pending:{label:"En attente",className:"bg-warning/10 text-warning border-warning/20",icon:"Clock"},cancelled:{label:"AnnulÃ©",className:"bg-error/10 text-error border-error/20",icon:"XCircle"}};return(ce==null?void 0:ce[ee])||(ce==null?void 0:ce.scheduled)},de=ee=>{const ce={meeting:{label:"Rendez-vous",className:"bg-blue-100 text-blue-600",icon:"Users"},event:{label:"Ã‰vÃ©nement",className:"bg-purple-100 text-purple-600",icon:"Star"},admin:{label:"Administratif",className:"bg-orange-100 text-orange-600",icon:"FileText"},holiday:{label:"Vacances",className:"bg-green-100 text-green-600",icon:"Sun"}};return(ce==null?void 0:ce[ee])||(ce==null?void 0:ce.admin)},Ee=ee=>{const ce={high:{label:"Urgent",className:"bg-red-100 text-red-600",icon:"AlertTriangle"},medium:{label:"Normal",className:"bg-yellow-100 text-yellow-600",icon:"Circle"},low:{label:"Faible",className:"bg-gray-100 text-gray-600",icon:"Minus"}};return(ce==null?void 0:ce[ee])||(ce==null?void 0:ce.medium)},Te=N.filter(ee=>ee.date===new Date().toISOString().split("T")[0]);return N.filter(ee=>new Date(ee.date)>new Date&&ee.status!=="cancelled"),e.jsxs("div",{className:"space-y-4",children:[e.jsx(hs,{toasts:g,removeToast:o}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-bold text-lg text-text-primary",children:"Planning & Ã‰vÃ©nements"}),e.jsx("p",{className:"font-body font-body-normal text-xs text-text-secondary mt-0.5",children:"Gestion des rendez-vous, Ã©vÃ©nements scolaires et tÃ¢ches administratives"})]}),e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(j,{variant:"outline",size:"sm",iconName:"Calendar",iconPosition:"left",onClick:m,children:"Calendrier"}),e.jsx(j,{variant:"outline",size:"sm",iconName:"BarChart3",iconPosition:"left",onClick:()=>x(!0),disabled:z,children:"Analyses"}),e.jsx(j,{variant:"outline",size:"sm",iconName:"Download",iconPosition:"left",onClick:Y,disabled:z,children:"Export"}),e.jsx(j,{variant:"default",size:"sm",iconName:"Plus",iconPosition:"left",onClick:Q,disabled:z,children:"Nouveau"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-card rounded border border-border p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded flex items-center justify-center",children:e.jsx(a,{name:"Clock",size:16,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-sm text-text-primary",children:Te.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Aujourd'hui"})]})]})}),e.jsx("div",{className:"bg-card rounded border border-border p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-success/10 rounded flex items-center justify-center",children:e.jsx(a,{name:"Calendar",size:16,className:"text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-sm text-text-primary",children:O.thisWeek||0}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Cette semaine"})]})]})}),e.jsx("div",{className:"bg-card rounded border border-border p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-warning/10 rounded flex items-center justify-center",children:e.jsx(a,{name:"Users",size:16,className:"text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-sm text-text-primary",children:O.pendingConfirmations||0}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Ã€ confirmer"})]})]})}),e.jsx("div",{className:"bg-card rounded border border-border p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-error/10 rounded flex items-center justify-center",children:e.jsx(a,{name:"AlertTriangle",size:16,className:"text-error"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-sm text-text-primary",children:N.filter(ee=>ee.type==="parent_meeting").length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"RDV parents"})]})]})})]}),e.jsx("div",{className:"bg-card rounded border border-border p-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[e.jsx(K,{type:"search",placeholder:"Rechercher...",value:b,onChange:ee=>{var ce;return I((ce=ee==null?void 0:ee.target)==null?void 0:ce.value)}}),e.jsx(oe,{options:ae,value:T,onChange:k,placeholder:"Type d'Ã©vÃ©nement"}),e.jsx(oe,{options:V,value:u,onChange:D,placeholder:"Statut"}),e.jsx(oe,{options:X,value:C,onChange:P,placeholder:"Classe"}),e.jsx(oe,{options:S,value:i,onChange:E,placeholder:"Affichage"})]})}),e.jsxs("div",{className:"bg-card rounded border border-border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:["Ã‰vÃ©nements & Rendez-vous (",N.length,")"]}),e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>J(),disabled:z,children:[e.jsx(a,{name:"RotateCcw",size:16,className:"mr-2"}),"Actualiser"]})]}),z&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Chargement..."})]}),!z&&e.jsx("div",{className:"space-y-3",children:N.map(ee=>{const ce=ne(ee.status),je=de(ee.type),ze=Ee(ee.priority);return e.jsx("div",{className:"border border-border rounded p-3 hover:bg-muted/50 transition-micro",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center flex-wrap gap-2 mb-2",children:[e.jsx("h4",{className:"font-body font-body-semibold text-base text-text-primary",children:ee.title}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${je.className}`,children:[e.jsx(a,{name:je.icon,size:12,className:"mr-1"}),je.label]}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium border ${ce.className}`,children:[e.jsx(a,{name:ce.icon,size:12,className:"mr-1"}),ce.label]}),ee.priority==="high"&&e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${ze.className}`,children:[e.jsx(a,{name:ze.icon,size:12,className:"mr-1"}),ze.label]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-text-secondary",children:[e.jsx(a,{name:"Calendar",size:14}),e.jsxs("span",{children:[ee.date," Ã  ",ee.startTime]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-text-secondary",children:[e.jsx(a,{name:"Clock",size:14}),e.jsxs("span",{children:["DurÃ©e: ",ee.duration," min"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-text-secondary",children:[e.jsx(a,{name:"MapPin",size:14}),e.jsx("span",{children:ee.location})]}),ee.studentName&&e.jsxs("div",{className:"flex items-center space-x-2 text-text-secondary",children:[e.jsx(a,{name:"User",size:14}),e.jsxs("span",{children:[ee.studentName," (",ee.studentClass,")"]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-text-primary",children:e.jsx("p",{className:"text-text-secondary text-xs line-clamp-2",children:ee.description})}),ee.attendees&&ee.attendees.length>0&&e.jsxs("div",{className:"text-text-secondary text-xs",children:[e.jsx("strong",{children:"Participants:"})," ",ee.attendees.slice(0,2).join(", "),ee.attendees.length>2&&` +${ee.attendees.length-2} autres`]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 ml-3",children:[e.jsx(j,{variant:"ghost",size:"xs",onClick:()=>r(ee),title:"Modifier",children:e.jsx(a,{name:"Edit",size:14})}),ee.status==="pending"&&e.jsx(j,{variant:"ghost",size:"xs",onClick:()=>f(ee.id),title:"Confirmer",className:"text-green-600 hover:text-green-700",children:e.jsx(a,{name:"CheckCircle",size:14})}),ee.type==="parent_meeting"&&ee.status==="confirmed"&&e.jsx(j,{variant:"ghost",size:"xs",onClick:()=>G(ee.id),title:"Envoyer rappel",className:"text-blue-600 hover:text-blue-700",children:e.jsx(a,{name:"Mail",size:14})}),e.jsx(j,{variant:"ghost",size:"xs",onClick:()=>W(ee.id),title:"Annuler",className:"text-red-600 hover:text-red-700",children:e.jsx(a,{name:"XCircle",size:14})})]})]})},ee.id)})}),!z&&N.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(a,{name:"Calendar",size:32,className:"text-muted-foreground mx-auto mb-3"}),e.jsx("h3",{className:"font-heading font-heading-semibold text-base text-text-primary mb-2",children:"Aucun Ã©vÃ©nement programmÃ©"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-text-secondary mb-4",children:"Aucun Ã©vÃ©nement ne correspond Ã  vos critÃ¨res."}),e.jsx(j,{variant:"outline",size:"sm",onClick:Q,iconName:"Plus",iconPosition:"left",children:"CrÃ©er le premier Ã©vÃ©nement"})]})]}),e.jsx(nt,{isOpen:L,onClose:()=>{U(!1),_(null)},event:d,onSuccess:q}),e.jsx(rt,{isOpen:B,onClose:()=>M(!1),onEventSelect:F}),e.jsx(lt,{isOpen:w,onClose:()=>x(!1)})]})},ot=()=>{const[g,l]=c.useState(""),[s,o]=c.useState(""),[n,t]=c.useState(""),[i,E]=c.useState(!1),[T,k]=c.useState(!1),[u,D]=c.useState(null),[C,P]=c.useState(!1),[b,I]=c.useState(!0),[N,v]=c.useState({title:"",description:"",priority:"medium",dueDate:"",dueTime:"",category:"general",contact:"",studentRelated:""}),O=[{value:"",label:"Toutes les prioritÃ©s"},{value:"urgent",label:"Urgent"},{value:"high",label:"Important"},{value:"medium",label:"Normal"},{value:"low",label:"Faible"}],p=[{value:"",label:"Tous les statuts"},{value:"pending",label:"Ã€ faire"},{value:"in_progress",label:"En cours"},{value:"completed",label:"TerminÃ©"},{value:"cancelled",label:"AnnulÃ©"}],[z,R]=c.useState([]);c.useEffect(()=>{L()},[]);const L=async()=>{try{I(!0);const r=localStorage.getItem("edutrack-user"),f=r?JSON.parse(r):null,W=f==null?void 0:f.current_school_id;if(!W){console.warn("âš ï¸ Pas d'Ã©cole associÃ©e"),R([]),I(!1);return}const{data:G,error:q}=await Z.from("tasks").select("*").eq("school_id",W).order("due_date",{ascending:!0});if(q)console.error("Erreur chargement tÃ¢ches:",q),R([]);else{const m=G.map(F=>({id:F.id,title:F.title,description:F.description,priority:F.priority,status:F.status,dueDate:F.due_date,dueTime:F.due_time,category:F.category,assignedTo:"SecrÃ©tariat",studentRelated:F.student_related||"",contact:F.contact||"",estimatedDuration:F.estimated_duration||""}));R(m)}}catch(r){console.error("Exception chargement tÃ¢ches:",r),R([])}finally{I(!1)}},U=r=>{const f={urgent:{label:"Urgent",className:"bg-red-100 text-red-600 border-red-200",icon:"AlertTriangle"},high:{label:"Important",className:"bg-orange-100 text-orange-600 border-orange-200",icon:"ArrowUp"},medium:{label:"Normal",className:"bg-blue-100 text-blue-600 border-blue-200",icon:"Circle"},low:{label:"Faible",className:"bg-gray-100 text-gray-600 border-gray-200",icon:"ArrowDown"}};return(f==null?void 0:f[r])||(f==null?void 0:f.medium)},B=r=>{const f={pending:{label:"Ã€ faire",className:"bg-yellow-100 text-yellow-600 border-yellow-200",icon:"Clock"},in_progress:{label:"En cours",className:"bg-blue-100 text-blue-600 border-blue-200",icon:"Play"},completed:{label:"TerminÃ©",className:"bg-green-100 text-green-600 border-green-200",icon:"CheckCircle"},cancelled:{label:"AnnulÃ©",className:"bg-gray-100 text-gray-600 border-gray-200",icon:"XCircle"}};return(f==null?void 0:f[r])||(f==null?void 0:f.pending)},M=r=>{const f={appels:{label:"Appels",className:"bg-purple-100 text-purple-600",icon:"Phone"},documents:{label:"Documents",className:"bg-blue-100 text-blue-600",icon:"FileText"},paiements:{label:"Paiements",className:"bg-green-100 text-green-600",icon:"CreditCard"},planning:{label:"Planning",className:"bg-orange-100 text-orange-600",icon:"Calendar"},inscriptions:{label:"Inscriptions",className:"bg-pink-100 text-pink-600",icon:"UserPlus"}};return(f==null?void 0:f[r])||(f==null?void 0:f.documents)},w=z.filter(r=>{const f=r.title.toLowerCase().includes(n.toLowerCase())||r.description.toLowerCase().includes(n.toLowerCase()),W=g===""||r.priority===g,G=s===""||r.status===s;return f&&W&&G}),x=async(r,f)=>{try{const W={status:f,updated_at:new Date().toISOString()};f==="completed"&&(W.completed_at=new Date().toISOString());const{error:G}=await Z.from("tasks").update(W).eq("id",r);if(G){console.error("Erreur mise Ã  jour statut:",G),alert("Erreur lors de la mise Ã  jour du statut");return}R(z.map(q=>q.id===r?{...q,status:f}:q)),console.log("âœ… Statut de la tÃ¢che mis Ã  jour")}catch(W){console.error("Exception mise Ã  jour statut:",W),alert("Erreur lors de la mise Ã  jour du statut")}},d=()=>{E(!0)},_=async()=>{if(!N.title||!N.description){alert("Veuillez remplir le titre et la description");return}try{const r=localStorage.getItem("edutrack-user"),f=r?JSON.parse(r):null,W=f==null?void 0:f.current_school_id,G=f==null?void 0:f.id;if(!W){alert("Erreur: Pas d'Ã©cole associÃ©e");return}const{data:q,error:m}=await Z.from("tasks").insert({title:N.title,description:N.description,priority:N.priority,status:"pending",due_date:N.dueDate||null,due_time:N.dueTime||null,category:N.category,school_id:W,assigned_to_user_id:G,student_related:N.studentRelated||null,contact:N.contact||null,estimated_duration:"30 min",created_by_user_id:G}).select().single();if(m){console.error("Erreur crÃ©ation tÃ¢che:",m),alert("Erreur lors de la crÃ©ation de la tÃ¢che: "+m.message);return}await L(),v({title:"",description:"",priority:"medium",dueDate:"",dueTime:"",category:"general",contact:"",studentRelated:""}),E(!1),console.log("âœ… TÃ¢che crÃ©Ã©e avec succÃ¨s:",q)}catch(r){console.error("Exception crÃ©ation tÃ¢che:",r),alert("Erreur lors de la crÃ©ation de la tÃ¢che")}},J=()=>{P(!0)},ae=r=>{const f=z.find(W=>W.id===r);if(!f){alert("TÃ¢che introuvable");return}D(f),v({title:f.title||"",description:f.description||"",priority:f.priority||"medium",dueDate:f.dueDate||"",dueTime:f.dueTime||"",category:f.category||"general",contact:f.contact||"",studentRelated:f.studentRelated||""}),k(!0)},V=async()=>{if(u){if(!N.title.trim()){alert("Le titre est obligatoire");return}if(!N.dueDate){alert("La date d'Ã©chÃ©ance est obligatoire");return}try{const{data:r,error:f}=await Z.from("tasks").update({title:N.title.trim(),description:N.description.trim(),priority:N.priority,due_date:N.dueDate,due_time:N.dueTime||null,category:N.category,contact:N.contact.trim()||null,student_related:N.studentRelated.trim()||null,updated_at:new Date().toISOString()}).eq("id",u.id).select().single();if(f){console.error("Erreur mise Ã  jour tÃ¢che:",f),alert("Erreur lors de la mise Ã  jour de la tÃ¢che");return}console.log("âœ… TÃ¢che mise Ã  jour avec succÃ¨s:",r),await L(),k(!1),D(null),v({title:"",description:"",priority:"medium",dueDate:"",dueTime:"",category:"general",contact:"",studentRelated:""})}catch(r){console.error("Exception mise Ã  jour tÃ¢che:",r),alert("Erreur lors de la mise Ã  jour de la tÃ¢che")}}},X=async r=>{if(confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cette tÃ¢che ?"))try{const{error:f}=await Z.from("tasks").delete().eq("id",r);if(f){console.error("Erreur suppression tÃ¢che:",f),alert("Erreur lors de la suppression de la tÃ¢che");return}R(z.filter(W=>W.id!==r)),console.log("âœ… TÃ¢che supprimÃ©e avec succÃ¨s")}catch(f){console.error("Exception suppression tÃ¢che:",f),alert("Erreur lors de la suppression de la tÃ¢che")}},S=r=>{window.open(`tel:${r}`,"_self")},Q={pending:z.filter(r=>r.status==="pending").length,urgent:z.filter(r=>r.priority==="urgent").length,today:z.filter(r=>r.dueDate===new Date().toISOString().split("T")[0]).length,completed:z.filter(r=>r.status==="completed").length};return b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"Chargement des tÃ¢ches..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-bold text-2xl text-text-primary",children:"TÃ¢ches Quotidiennes"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary mt-1",children:"Gestion des tÃ¢ches administratives et suivi des actions prioritaires"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(j,{variant:"outline",iconName:"Phone",iconPosition:"left",onClick:J,children:"Appels urgents"}),e.jsx(j,{variant:"default",iconName:"Plus",iconPosition:"left",onClick:d,children:"Nouvelle tÃ¢che"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-warning/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Clock",size:24,className:"text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-bold text-2xl text-text-primary",children:Q.pending}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-text-secondary",children:"TÃ¢ches en attente"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-error/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"AlertTriangle",size:24,className:"text-error"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-bold text-2xl text-text-primary",children:Q.urgent}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-text-secondary",children:"TÃ¢ches urgentes"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Calendar",size:24,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-bold text-2xl text-text-primary",children:Q.today}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-text-secondary",children:"Ã‰chues aujourd'hui"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-success/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"CheckCircle",size:24,className:"text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-bold text-2xl text-text-primary",children:Q.completed}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-text-secondary",children:"TerminÃ©es"})]})]})})]}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(K,{placeholder:"Rechercher une tÃ¢che...",value:n,onChange:r=>t(r.target.value)}),e.jsx(oe,{options:O,value:g,onChange:l,placeholder:"Filtrer par prioritÃ©"}),e.jsx(oe,{options:p,value:s,onChange:o,placeholder:"Filtrer par statut"})]})}),e.jsxs("div",{className:"bg-card rounded-lg border border-border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:["Liste des tÃ¢ches (",w.length,")"]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(j,{variant:"ghost",size:"sm",children:[e.jsx(a,{name:"Download",size:16,className:"mr-2"}),"Exporter"]})})]}),e.jsx("div",{className:"space-y-4",children:w.map(r=>{const f=U(r.priority),W=B(r.status),G=M(r.category);return e.jsx("div",{className:"border border-border rounded-lg p-4 hover:bg-muted/50 transition-micro",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(qe,{checked:r.status==="completed",onChange:q=>x(r.id,q?"completed":"pending")}),e.jsx("h4",{className:`font-body font-body-semibold text-lg ${r.status==="completed"?"line-through text-text-secondary":"text-text-primary"}`,children:r.title}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${G.className}`,children:[e.jsx(a,{name:G.icon,size:12,className:"mr-1"}),G.label]}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${f.className}`,children:[e.jsx(a,{name:f.icon,size:12,className:"mr-1"}),f.label]}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${W.className}`,children:[e.jsx(a,{name:W.icon,size:12,className:"mr-1"}),W.label]})]}),e.jsx("p",{className:"text-text-secondary mb-3",children:r.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-text-secondary",children:[e.jsx(a,{name:"Calendar",size:16}),e.jsxs("span",{children:["Ã‰chÃ©ance: ",r.dueDate," Ã  ",r.dueTime]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-text-secondary",children:[e.jsx(a,{name:"Clock",size:16}),e.jsxs("span",{children:["DurÃ©e estimÃ©e: ",r.estimatedDuration]})]}),r.contact&&e.jsxs("div",{className:"flex items-center space-x-2 text-text-secondary",children:[e.jsx(a,{name:"Phone",size:16}),e.jsx("span",{children:r.contact}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>S(r.contact),className:"p-1 h-6 w-6",children:e.jsx(a,{name:"ExternalLink",size:12})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-text-secondary",children:[e.jsx(a,{name:"User",size:16}),e.jsxs("span",{children:["AssignÃ© Ã : ",r.assignedTo]})]}),r.studentRelated&&e.jsxs("div",{className:"flex items-center space-x-2 text-text-secondary",children:[e.jsx(a,{name:"Users",size:16}),e.jsxs("span",{children:["ConcernÃ©: ",r.studentRelated]})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>ae(r.id),title:"Modifier",children:e.jsx(a,{name:"Edit",size:16})}),r.status==="pending"&&e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>x(r.id,"in_progress"),title:"Commencer",children:e.jsx(a,{name:"Play",size:16})}),r.status==="in_progress"&&e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>x(r.id,"completed"),title:"Terminer",children:e.jsx(a,{name:"CheckCircle",size:16})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>X(r.id),title:"Supprimer",children:e.jsx(a,{name:"Trash2",size:16})})]})]})},r.id)})}),w.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(a,{name:"CheckCircle",size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary mb-2",children:"Aucune tÃ¢che trouvÃ©e"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary",children:"Aucune tÃ¢che ne correspond Ã  vos critÃ¨res de recherche."})]})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:"CrÃ©er une nouvelle tÃ¢che"}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>E(!1),children:e.jsx(a,{name:"X",size:20})})]}),e.jsx("div",{className:"p-6 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(K,{label:"Titre de la tÃ¢che",placeholder:"Ex: Appeler les parents de...",value:N.title,onChange:r=>v(f=>({...f,title:r.target.value})),required:!0})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(K,{label:"Description",placeholder:"DÃ©tails de la tÃ¢che Ã  effectuer",value:N.description,onChange:r=>v(f=>({...f,description:r.target.value})),required:!0})}),e.jsx(oe,{label:"PrioritÃ©",options:[{value:"urgent",label:"Urgent"},{value:"high",label:"Important"},{value:"medium",label:"Normal"},{value:"low",label:"Faible"}],value:N.priority,onChange:r=>v(f=>({...f,priority:r}))}),e.jsx(oe,{label:"CatÃ©gorie",options:[{value:"appels",label:"Appels"},{value:"documents",label:"Documents"},{value:"paiements",label:"Paiements"},{value:"inscriptions",label:"Inscriptions"},{value:"planning",label:"Planning"},{value:"general",label:"GÃ©nÃ©ral"}],value:N.category,onChange:r=>v(f=>({...f,category:r}))}),e.jsx(K,{label:"Date d'Ã©chÃ©ance",type:"date",value:N.dueDate,onChange:r=>v(f=>({...f,dueDate:r.target.value}))}),e.jsx(K,{label:"Heure d'Ã©chÃ©ance",type:"time",value:N.dueTime,onChange:r=>v(f=>({...f,dueTime:r.target.value}))}),e.jsx(K,{label:"Ã‰lÃ¨ve concernÃ© (optionnel)",placeholder:"Ex: Marie Dubois - CM2",value:N.studentRelated,onChange:r=>v(f=>({...f,studentRelated:r.target.value}))}),e.jsx(K,{label:"Contact (optionnel)",placeholder:"+237 6XX XX XX XX",value:N.contact,onChange:r=>v(f=>({...f,contact:r.target.value}))})]})}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-border",children:[e.jsx(j,{variant:"default",onClick:_,children:"CrÃ©er la tÃ¢che"}),e.jsx(j,{variant:"outline",onClick:()=>E(!1),children:"Annuler"})]})]})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:"Modifier la tÃ¢che"}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>{k(!1),D(null)},children:e.jsx(a,{name:"X",size:20})})]}),e.jsx("div",{className:"p-6 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(K,{label:"Titre de la tÃ¢che",placeholder:"Ex: Appeler les parents de...",value:N.title,onChange:r=>v(f=>({...f,title:r.target.value})),required:!0})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(K,{label:"Description",placeholder:"DÃ©tails de la tÃ¢che Ã  effectuer",value:N.description,onChange:r=>v(f=>({...f,description:r.target.value})),required:!0})}),e.jsx(oe,{label:"PrioritÃ©",options:[{value:"urgent",label:"Urgent"},{value:"high",label:"Important"},{value:"medium",label:"Normal"},{value:"low",label:"Faible"}],value:N.priority,onChange:r=>v(f=>({...f,priority:r}))}),e.jsx(oe,{label:"CatÃ©gorie",options:[{value:"appels",label:"Appels"},{value:"documents",label:"Documents"},{value:"paiements",label:"Paiements"},{value:"inscriptions",label:"Inscriptions"},{value:"planning",label:"Planning"},{value:"general",label:"GÃ©nÃ©ral"}],value:N.category,onChange:r=>v(f=>({...f,category:r}))}),e.jsx(K,{label:"Date d'Ã©chÃ©ance",type:"date",value:N.dueDate,onChange:r=>v(f=>({...f,dueDate:r.target.value}))}),e.jsx(K,{label:"Heure d'Ã©chÃ©ance",type:"time",value:N.dueTime,onChange:r=>v(f=>({...f,dueTime:r.target.value}))}),e.jsx(K,{label:"Ã‰lÃ¨ve concernÃ© (optionnel)",placeholder:"Ex: Marie Dubois - CM2",value:N.studentRelated,onChange:r=>v(f=>({...f,studentRelated:r.target.value}))}),e.jsx(K,{label:"Contact (optionnel)",placeholder:"+237 6XX XX XX XX",value:N.contact,onChange:r=>v(f=>({...f,contact:r.target.value}))})]})}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-border",children:[e.jsx(j,{variant:"default",onClick:V,children:"Enregistrer les modifications"}),e.jsx(j,{variant:"outline",onClick:()=>{k(!1),D(null)},children:"Annuler"})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-lg border border-border max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:"Appels Urgents"}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>P(!1),children:e.jsx(a,{name:"X",size:20})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-3",children:[z.filter(r=>r.priority==="urgent"&&r.contact&&r.status==="pending").map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-body font-body-medium text-sm text-text-primary",children:r.title}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:r.contact})]}),e.jsx(j,{variant:"outline",size:"sm",iconName:"Phone",onClick:()=>S(r.contact),children:"Appeler"})]},r.id)),z.filter(r=>r.priority==="urgent"&&r.contact&&r.status==="pending").length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(a,{name:"Phone",size:32,className:"text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"font-body font-body-normal text-text-secondary",children:"Aucun appel urgent en cours"})]})]})}),e.jsx("div",{className:"flex gap-3 p-6 border-t border-border",children:e.jsx(j,{variant:"outline",onClick:()=>P(!1),children:"Fermer"})})]})})]})},ts=()=>(console.log("SchoolYearService: Mode PRODUCTION - utilisation exclusive des donnÃ©es Supabase"),!0);class ct{async getEnrollmentRequests(){console.log("SchoolYearService: Mode production forcÃ© - rÃ©cupÃ©ration des vraies donnÃ©es");try{const l=await ge();if(!l)return console.log("SchoolYearService: Aucun ID d'Ã©cole trouvÃ© - retour de donnÃ©es vides"),[];console.log("SchoolYearService: Recherche des demandes pour l'Ã©cole:",l);const{data:s,error:o}=await Z.from("enrollment_requests").select("*").eq("school_id",l).order("submitted_date",{ascending:!1});return o?(console.error("SchoolYearService: Erreur lors de la rÃ©cupÃ©ration des demandes d'inscription:",o),[]):(console.log("SchoolYearService: Demandes d'inscription rÃ©cupÃ©rÃ©es:",(s==null?void 0:s.length)||0,"demandes"),s&&s.length>0?console.log("SchoolYearService: PremiÃ¨re demande:",s[0]):console.log("SchoolYearService: Aucune demande trouvÃ©e - base vide"),s||[])}catch(l){return console.error("SchoolYearService: Erreur dans getEnrollmentRequests:",l),[]}}async getReinscriptions(){console.log("SchoolYearService: Mode production forcÃ© - rÃ©cupÃ©ration des rÃ©inscriptions");try{const l=await ge();if(!l)return console.log("SchoolYearService: Aucun ID d'Ã©cole pour les rÃ©inscriptions"),[];console.log("SchoolYearService: Recherche des rÃ©inscriptions pour l'Ã©cole:",l);const{data:s,error:o}=await Z.from("enrollment_requests").select("*, students(first_name, last_name)").eq("school_id",l).or("request_type.eq.redoublement,and(request_type.eq.nouvelle_inscription,student_id.not.is.null)").order("submitted_date",{ascending:!1});if(o)return console.error("SchoolYearService: Erreur lors de la rÃ©cupÃ©ration des rÃ©inscriptions:",o),[];console.log("SchoolYearService: RÃ©inscriptions trouvÃ©es:",(s==null?void 0:s.length)||0);const n=(s||[]).map(t=>({id:t.id,studentName:t.students?`${t.students.first_name} ${t.students.last_name}`:`${t.student_first_name} ${t.student_last_name}`,parentName:t.parent_name||"Non spÃ©cifiÃ©",currentClass:t.current_class||"Non dÃ©finie",requestedClass:t.requested_class,status:this.mapRequestStatusToReinscriptionStatus(t.status),submittedDate:new Date(t.submitted_date).toLocaleDateString("fr-FR"),reason:t.reason,teacherRecommendation:t.teacher_recommendation,type:t.request_type,priority:t.priority}));return console.log("SchoolYearService: RÃ©inscriptions formatÃ©es:",n.length),n.length>0&&console.log("SchoolYearService: PremiÃ¨re rÃ©inscription:",n[0]),n}catch(l){return console.error("SchoolYearService: Erreur dans getReinscriptions:",l),[]}}async getNewInscriptions(){console.log("SchoolYearService: Mode production forcÃ© - rÃ©cupÃ©ration des nouvelles inscriptions");try{const l=await ge();if(!l)return console.log("SchoolYearService: Aucun ID d'Ã©cole pour les nouvelles inscriptions"),[];console.log("SchoolYearService: Recherche des nouvelles inscriptions pour l'Ã©cole:",l);const{data:s,error:o}=await Z.from("enrollment_requests").select("*").eq("school_id",l).eq("request_type","nouvelle_inscription").is("student_id",null).order("submitted_date",{ascending:!1});if(o)return console.error("SchoolYearService: Erreur lors de la rÃ©cupÃ©ration des nouvelles inscriptions:",o),[];console.log("SchoolYearService: Nouvelles inscriptions trouvÃ©es:",(s==null?void 0:s.length)||0);const n=(s||[]).map(t=>({id:t.id,studentName:`${t.student_first_name} ${t.student_last_name}`,parentName:t.parent_name||"Non spÃ©cifiÃ©",parentPhone:t.parent_phone,parentEmail:t.parent_email,requestedClass:t.requested_class,birthDate:t.student_birth_date?new Date(t.student_birth_date).toLocaleDateString("fr-FR"):null,status:this.mapRequestStatusToInscriptionStatus(t.status),submittedDate:new Date(t.submitted_date).toLocaleDateString("fr-FR"),documents:JSON.parse(t.documents||"[]"),reason:t.reason,priority:t.priority,previousSchool:t.previous_school}));return console.log("SchoolYearService: Nouvelles inscriptions formatÃ©es:",n.length),n.length>0&&console.log("SchoolYearService: PremiÃ¨re nouvelle inscription:",n[0]),n}catch(l){return console.error("SchoolYearService: Erreur dans getNewInscriptions:",l),[]}}async getCurrentStudents(){ts();try{const l=await ge();if(!l)return{};const{data:s,error:o}=await Z.from("students").select("*").eq("school_id",l).eq("status","active");if(o)return console.error("Erreur lors de la rÃ©cupÃ©ration des Ã©tudiants actuels:",o),{};const n={};return(s||[]).forEach(t=>{const i=t.current_class||"Non dÃ©finie";n[i]||(n[i]=[]),n[i].push({id:t.id,name:`${t.first_name} ${t.last_name}`,currentClass:t.current_class,status:"en_attente",nextClass:this.getNextClass(t.current_class),academicResults:t.academic_results||{},attendance:t.attendance_rate||null,behavior:t.behavior_notes||null})}),console.log("SchoolYearService: Ã‰tudiants actuels rÃ©cupÃ©rÃ©s:",Object.keys(n).length,"classes"),n}catch(l){return console.error("Erreur dans getCurrentStudents:",l),{}}}async updateEnrollmentRequestStatus(l,s,o=null){ts();try{const n={status:this.mapStatusToRequestStatus(s),reviewed_date:new Date().toISOString(),validation_notes:o},{error:t}=await Z.from("enrollment_requests").update(n).eq("id",l);return t?(console.error("Erreur lors de la mise Ã  jour du statut:",t),{success:!1,error:t}):(console.log("SchoolYearService: Statut mis Ã  jour avec succÃ¨s pour la demande:",l),{success:!0})}catch(n){return console.error("Erreur dans updateEnrollmentRequestStatus:",n),{success:!1,error:n}}}async createEnrollmentRequest(l){ts();try{const s=await ge();if(!s)return{success:!1,error:"Ã‰cole non trouvÃ©e"};const{data:o,error:n}=await Z.from("enrollment_requests").insert({...l,school_id:s,submitted_date:new Date().toISOString()}).select().single();return n?(console.error("Erreur lors de la crÃ©ation de la demande:",n),{success:!1,error:n}):(console.log("SchoolYearService: Demande crÃ©Ã©e avec succÃ¨s:",o.id),{success:!0,data:o})}catch(s){return console.error("Erreur dans createEnrollmentRequest:",s),{success:!1,error:s}}}mapRequestStatusToReinscriptionStatus(l){return{en_attente:"en_attente",en_revision:"en_revision",approuvee:"confirme",refusee:"refuse"}[l]||"en_attente"}mapRequestStatusToInscriptionStatus(l){return{en_attente:"soumis",en_revision:"en_revision",approuvee:"accepte",refusee:"refuse"}[l]||"soumis"}mapStatusToRequestStatus(l){return{en_attente:"en_attente",en_revision:"en_revision",confirme:"approuvee",accepte:"approuvee",refuse:"refusee",soumis:"en_attente"}[l]||"en_attente"}getNextClass(l){return{SIL:"CP",CP:"CE1",CE1:"CE2",CE2:"CM1",CM1:"CM2",CM2:"SixiÃ¨me"}[l]||l}async getSchoolYearStatistics(){console.log("SchoolYearService: Mode production forcÃ© - calcul des statistiques");try{const l=await ge();if(!l)return console.log("SchoolYearService: Aucun ID d'Ã©cole pour les statistiques"),{totalRequests:0,pendingRequests:0,approvedRequests:0,rejectedRequests:0,reinscriptions:0,newInscriptions:0,transfers:0};console.log("SchoolYearService: Calcul des statistiques pour l'Ã©cole:",l);const{data:s,error:o}=await Z.from("enrollment_requests").select("status, request_type").eq("school_id",l);if(o)return console.error("SchoolYearService: Erreur lors de la rÃ©cupÃ©ration des statistiques:",o),{totalRequests:0,pendingRequests:0,approvedRequests:0,rejectedRequests:0,reinscriptions:0,newInscriptions:0,transfers:0};const n=(s||[]).reduce((t,i)=>{switch(t.totalRequests++,i.status){case"en_attente":case"en_revision":t.pendingRequests++;break;case"approuvee":t.approvedRequests++;break;case"refusee":t.rejectedRequests++;break}switch(i.request_type){case"redoublement":t.reinscriptions++;break;case"nouvelle_inscription":t.newInscriptions++;break;case"transfert":t.transfers++;break}return t},{totalRequests:0,pendingRequests:0,approvedRequests:0,rejectedRequests:0,reinscriptions:0,newInscriptions:0,transfers:0});return console.log("SchoolYearService: Statistiques calculÃ©es:",n),n}catch(l){return console.error("Erreur dans getSchoolYearStatistics:",l),{totalRequests:0,pendingRequests:0,approvedRequests:0,rejectedRequests:0,reinscriptions:0,newInscriptions:0,transfers:0}}}}const Be=new ct,dt=()=>{const[g,l]=c.useState("dashboard"),[s]=c.useState("2024-2025"),[o]=c.useState("2025-2026"),[n,t]=c.useState(!0),[i,E]=c.useState({}),[T,k]=c.useState([]),[u,D]=c.useState([]),[C,P]=c.useState({totalRequests:0,pendingRequests:0,approvedRequests:0,rejectedRequests:0,reinscriptions:0,newInscriptions:0,transfers:0});c.useEffect(()=>{(async()=>{try{t(!0);const[O,p,z,R]=await Promise.all([Be.getCurrentStudents(),Be.getReinscriptions(),Be.getNewInscriptions(),Be.getSchoolYearStatistics()]);E(O),k(p),D(z),P(R)}catch(O){console.error("Erreur lors du chargement des donnÃ©es de l'annÃ©e scolaire:",O),E({}),k([]),D([]),P({totalRequests:0,pendingRequests:0,approvedRequests:0,rejectedRequests:0,reinscriptions:0,newInscriptions:0,transfers:0})}finally{t(!1)}})()},[]);const b=async(v,O,p=null)=>{try{const z=await Be.updateEnrollmentRequestStatus(v,O,p);if(z.success){const[R,L]=await Promise.all([Be.getReinscriptions(),Be.getNewInscriptions()]);k(R),D(L)}else console.error("Erreur lors de la mise Ã  jour du statut:",z.error)}catch(z){console.error("Erreur lors de la mise Ã  jour du statut:",z)}};if(n)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex items-center space-x-2 text-text-secondary",children:[e.jsx(a,{name:"Loader2",size:20,className:"animate-spin"}),e.jsx("span",{children:"Chargement des donnÃ©es de l'annÃ©e scolaire..."})]})});const I=v=>{const O={en_preparation:{label:"En prÃ©paration",className:"bg-blue/10 text-blue"},en_attente:{label:"En attente",className:"bg-warning/10 text-warning"},soumis_validation:{label:"Soumis validation",className:"bg-orange/10 text-orange"},confirme:{label:"ConfirmÃ©",className:"bg-success/10 text-success"},valide:{label:"ValidÃ©",className:"bg-success/10 text-success"},passe:{label:"Passe",className:"bg-success/10 text-success"},redouble:{label:"Redouble",className:"bg-warning/10 text-warning"},sortant:{label:"Sortant",className:"bg-muted text-muted-foreground"}},p=O[v]||O.en_preparation;return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-caption font-caption-normal ${p.className}`,children:p.label})},N=[{id:"dashboard",label:"Vue d'ensemble",icon:"BarChart3"},{id:"reinscriptions",label:"RÃ©inscriptions",icon:"RotateCcw"},{id:"nouvelles",label:"Nouvelles inscriptions",icon:"UserPlus"},{id:"passages",label:"Passages de classe",icon:"TrendingUp"},{id:"preparation",label:"PrÃ©paration annÃ©e",icon:"Calendar"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-bold text-xl text-text-primary",children:"Transition d'AnnÃ©e Scolaire"}),e.jsxs("p",{className:"text-sm text-text-secondary mt-1",children:[s," â†’ ",o]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("div",{className:"bg-primary/10 px-3 py-2 rounded-lg",children:e.jsx("span",{className:"text-sm font-medium text-primary",children:"ðŸ“… PÃ©riode de transition active"})})})]}),e.jsx("div",{className:"border-b border-border",children:e.jsx("nav",{className:"flex space-x-8",children:N.map(v=>e.jsxs("button",{onClick:()=>l(v.id),className:`flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors ${g===v.id?"border-primary text-primary":"border-transparent text-text-secondary hover:text-text-primary hover:border-border"}`,children:[e.jsx(a,{name:v.icon,size:16}),e.jsx("span",{children:v.label})]},v.id))})}),g==="dashboard"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-success/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"CheckCircle",size:20,className:"text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:C.approvedRequests}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Demandes approuvÃ©es"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-warning/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"Clock",size:20,className:"text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:C.pendingRequests}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"En attente de traitement"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"UserPlus",size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:C.newInscriptions}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Nouvelles demandes"})]})]})}),e.jsx("div",{className:"bg-card rounded-lg border border-border p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue/10 rounded-lg flex items-center justify-center",children:e.jsx(a,{name:"TrendingUp",size:20,className:"text-blue"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:Object.values(i).flat().filter(v=>v.status==="passe").length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-text-secondary",children:"Passages de classe"})]})]})})]}),e.jsxs("div",{className:"bg-card rounded-lg border border-border p-6",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary mb-4",children:"Ã‰tat du Processus de Transition"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-success/5 border border-success/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(a,{name:"CheckCircle",size:20,className:"text-success"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-text-primary",children:"Collecte des rÃ©inscriptions"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Phase en cours"})]})]}),e.jsx("span",{className:"text-sm font-medium text-success",children:"En cours"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/30 border border-border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(a,{name:"Clock",size:20,className:"text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-text-primary",children:"Validation par le Principal"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"En attente de soumission"})]})]}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"En attente"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/30 border border-border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(a,{name:"Calendar",size:20,className:"text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-text-primary",children:"PrÃ©paration nouvelle annÃ©e"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"DÃ©marrera aprÃ¨s validation"})]})]}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Ã€ venir"})]})]})]})]}),g==="reinscriptions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:"Suivi des RÃ©inscriptions"}),e.jsxs(j,{children:[e.jsx(a,{name:"Send",size:16,className:"mr-2"}),"Envoyer rappels"]})]}),e.jsx("div",{className:"bg-card rounded-lg border border-border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Ã‰lÃ¨ve"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Parent"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Classe"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:T.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-text-secondary",children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(a,{name:"Users",size:24,className:"text-muted-foreground"}),e.jsx("span",{children:"Aucune demande de rÃ©inscription en cours"})]})})}):T.map(v=>e.jsxs("tr",{className:"hover:bg-muted/20",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(a,{name:"User",size:14,className:"text-primary"})}),e.jsx("span",{className:"font-medium text-text-primary",children:v.studentName})]})}),e.jsx("td",{className:"px-4 py-3 text-text-secondary",children:v.parentName}),e.jsx("td",{className:"px-4 py-3 text-text-secondary",children:v.currentClass?`${v.currentClass} â†’ ${v.requestedClass}`:v.requestedClass}),e.jsx("td",{className:"px-4 py-3",children:I(v.status)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[v.status==="en_attente"&&e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>b(v.id,"confirme"),children:[e.jsx(a,{name:"Check",size:14,className:"mr-1"}),"Confirmer"]}),e.jsx(j,{variant:"ghost",size:"sm",children:e.jsx(a,{name:"Eye",size:14})})]})})]},v.id))})]})})})]}),g==="nouvelles"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:"Nouvelles Inscriptions"}),e.jsxs(j,{children:[e.jsx(a,{name:"Send",size:16,className:"mr-2"}),"Soumettre au Principal"]})]}),e.jsx("div",{className:"bg-card rounded-lg border border-border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Ã‰lÃ¨ve"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Parent"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Classe demandÃ©e"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-text-secondary",children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(a,{name:"UserPlus",size:24,className:"text-muted-foreground"}),e.jsx("span",{children:"Aucune nouvelle inscription en cours"})]})})}):u.map(v=>e.jsxs("tr",{className:"hover:bg-muted/20",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-success/10 rounded-full flex items-center justify-center",children:e.jsx(a,{name:"UserPlus",size:14,className:"text-success"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-text-primary",children:v.studentName}),v.birthDate&&e.jsxs("p",{className:"text-xs text-text-secondary",children:["NÃ©(e) le ",v.birthDate]})]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-text-primary",children:v.parentName}),v.parentPhone&&e.jsx("div",{className:"text-xs text-text-secondary",children:v.parentPhone}),v.parentEmail&&e.jsx("div",{className:"text-xs text-text-secondary",children:v.parentEmail})]})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("span",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm",children:v.requestedClass}),v.previousSchool&&e.jsxs("p",{className:"text-xs text-text-secondary mt-1",children:["De: ",v.previousSchool]})]}),e.jsx("td",{className:"px-4 py-3",children:I(v.status)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[v.status==="soumis"&&e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>b(v.id,"accepte"),children:[e.jsx(a,{name:"Check",size:14,className:"mr-1"}),"Accepter"]}),e.jsx(j,{variant:"ghost",size:"sm",children:e.jsx(a,{name:"Eye",size:14})})]})})]},v.id))})]})})})]}),g==="passages"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:"PrÃ©paration Passages de Classe"}),e.jsx("div",{className:"text-sm text-text-secondary",children:"En attente de validation du Principal"})]}),Object.entries(i).length===0?e.jsxs("div",{className:"bg-card rounded-lg border border-border p-8 text-center",children:[e.jsx(a,{name:"Users",size:32,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("h4",{className:"font-heading font-heading-medium text-base text-text-primary mb-2",children:"Aucun Ã©tudiant trouvÃ©"}),e.jsx("p",{className:"text-text-secondary",children:"Les passages de classe seront prÃ©parÃ©s une fois que les Ã©tudiants seront ajoutÃ©s au systÃ¨me."})]}):Object.entries(i).map(([v,O])=>e.jsxs("div",{className:"bg-card rounded-lg border border-border p-4",children:[e.jsxs("h4",{className:"font-heading font-heading-medium text-base text-text-primary mb-4",children:["Classe ",v.toUpperCase()," - ",O.length," Ã©lÃ¨ve",O.length>1?"s":""]}),e.jsx("div",{className:"space-y-3",children:O.map(p=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-background rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(a,{name:"User",size:14,className:"text-primary"})}),e.jsx("span",{className:"font-medium text-text-primary",children:p.name})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-sm text-text-secondary",children:["â†’ ",p.nextClass]}),I(p.status)]})]},p.id))})]},v))]}),g==="preparation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:["PrÃ©paration AnnÃ©e ",o]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-card rounded-lg border border-border p-4",children:[e.jsx("h4",{className:"font-heading font-heading-medium text-base text-text-primary mb-4",children:"Documents Ã  prÃ©parer"}),e.jsx("div",{className:"space-y-3",children:["Listes de classe provisoires","Certificats de scolaritÃ©","Attestations de fin d'annÃ©e","Dossiers de passage"].map((v,O)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(a,{name:"FileText",size:16,className:"text-muted-foreground"}),e.jsx("span",{className:"text-sm text-text-secondary",children:v})]},O))})]}),e.jsxs("div",{className:"bg-card rounded-lg border border-border p-4",children:[e.jsx("h4",{className:"font-heading font-heading-medium text-base text-text-primary mb-4",children:"Prochaines Ã©tapes"}),e.jsx("div",{className:"space-y-3",children:[{text:"Finaliser les rÃ©inscriptions",completed:C.approvedRequests>0,count:C.approvedRequests},{text:"Traiter nouvelles inscriptions",completed:C.newInscriptions>0,count:C.newInscriptions},{text:"Soumettre au Principal",completed:!1,count:C.totalRequests},{text:"Attendre la validation",completed:!1,count:0}].map((v,O)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full flex items-center justify-center ${v.completed?"bg-success":"bg-muted"}`,children:v.completed?e.jsx(a,{name:"Check",size:10,className:"text-white"}):e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:O+1})}),e.jsx("span",{className:`text-sm ${v.completed?"text-text-primary":"text-text-secondary"}`,children:v.text})]}),v.count>0&&e.jsx("span",{className:"text-xs bg-primary/10 text-primary px-2 py-1 rounded",children:v.count})]},O))})]})]})]})]})},yt=()=>{var O;const[g]=bs(),[l,s]=c.useState("tasks"),[o,n]=c.useState(!1),{user:t}=fs(),[i,E]=c.useState(""),[T,k]=c.useState({totalStudents:0,pendingJustifications:0,latePayments:0,urgentCalls:0}),[u,D]=c.useState(!0);c.useEffect(()=>{const p=async()=>{try{const{data:{user:R}}=await Z.auth.getUser();if(R){console.log("ðŸ” Utilisateur Supabase Auth:",R.email,"ID:",R.id);const{data:L,error:U}=await Z.from("users").select(`
              id,
              email,
              full_name,
              role,
              current_school_id,
              school:schools!users_current_school_id_fkey(id, name)
            `).eq("id",R.id).single();if(U){console.error("âŒ Erreur chargement donnÃ©es utilisateur:",U),z();return}if(console.log("âœ… DonnÃ©es utilisateur depuis Supabase:",L),console.log("ðŸŽ¯ EMAIL ATTENDU: pensezy.si@gmail.com"),console.log("ðŸ“§ EMAIL TROUVÃ‰:",L.email),console.log("ðŸ‘¤ RÃ”LE ATTENDU: secretary"),console.log("ðŸŽ­ RÃ”LE TROUVÃ‰:",L.role),L.email!=="pensezy.si@gmail.com"){console.error("âŒ PROBLÃˆME MAJEUR: Mauvais utilisateur connectÃ© !"),console.error("   Attendu: pensezy.si@gmail.com"),console.error("   TrouvÃ©:",L.email),console.error("   ðŸ”’ DÃ‰CONNEXION REQUISE"),await Z.auth.signOut(),localStorage.removeItem("edutrack-user"),window.location.href="/staff-login";return}L.role!=="secretary"&&console.error("âŒ RÃ”LE INCORRECT:",L.role,"au lieu de secretary"),console.log("ðŸ” Liste de tous les secrÃ©taires dans la base:");const{data:B,error:M}=await Z.from("secretaries").select("id, first_name, last_name, user_id, users:user_id(email, role)").order("id");console.log("ðŸ“‹ SecrÃ©taires trouvÃ©s:",B),M&&console.error("âŒ Erreur liste secrÃ©taires:",M);const{data:w,error:x}=await Z.from("users").select("id, email, role, full_name").order("email");if(console.log("ðŸ“‹ Tous les utilisateurs:",w),x&&console.error("âŒ Erreur liste utilisateurs:",x),L.id){console.log("ðŸ” Recherche secrÃ©taire avec user_id:",L.id);const{data:d,error:_}=await Z.from("secretaries").select("first_name, last_name, id").eq("user_id",L.id).single();if(console.log("ðŸ“Š RÃ©sultat requÃªte secretaries:",{secretaryData:d,error:_}),d&&!_){const J=`${d.first_name} ${d.last_name}`;E(J),console.log("ðŸ‘¤ Nom secrÃ©taire trouvÃ©:",J)}else{const J=L.full_name||L.email;E(J),console.log("ï¿½ Nom depuis users:",J)}}}else console.log("âŒ Aucun utilisateur authentifiÃ©, fallback localStorage"),z()}catch(R){console.error("âŒ Erreur loadUserData:",R),z()}},z=()=>{const R=localStorage.getItem("edutrack-user");if(R)try{const L=JSON.parse(R);console.log("âœ… Mode PRODUCTION (localStorage):",L.school_name||"Ã‰cole","- RÃ´le:",L.role),E(L.full_name||L.email||"SecrÃ©taire")}catch(L){console.error("Erreur lecture session:",L),E("SecrÃ©taire")}};p()},[t]),c.useEffect(()=>{(async()=>{try{D(!0);const z=localStorage.getItem("edutrack-user"),R=z?JSON.parse(z):null,L=R==null?void 0:R.current_school_id;if(!L){console.warn("âš ï¸ Pas d'Ã©cole associÃ©e"),D(!1);return}const{count:U,error:B}=await Z.from("students").select("*",{count:"exact",head:!0}).eq("school_id",L).eq("is_active",!0);B&&console.error("Erreur chargement Ã©lÃ¨ves:",B),k({totalStudents:U||0,pendingJustifications:0,latePayments:0,urgentCalls:0})}catch(z){console.error("Erreur chargement statistiques:",z)}finally{D(!1)}})()},[]),c.useEffect(()=>{const p=g.get("tab");p&&["students","teachers","cards","justifications","payments","communications","transfers","documents","planning","tasks","schoolyear"].includes(p)&&s(p)},[g]);const C=[{id:"tasks",label:"TÃ¢ches",icon:"CheckSquare",component:ot,description:"Actions du jour"},{id:"students",label:"Ã‰lÃ¨ves",icon:"Users",component:Is,description:"Inscriptions"},{id:"teachers",label:"Enseignants",icon:"GraduationCap",component:$s,description:"Comptes prof"},{id:"cards",label:"Cartes",icon:"CreditCard",component:Us,description:"Cartes scolaires"},{id:"justifications",label:"Absences",icon:"FileCheck",component:Xs,description:"Justificatifs"},{id:"payments",label:"Paiements",icon:"Banknote",component:Qs,description:"Frais scolaires"},{id:"planning",label:"Planning",icon:"Calendar",component:it,description:"Rendez-vous"},{id:"schoolyear",label:"AnnÃ©e Scolaire",icon:"RotateCcw",component:dt,description:"Transition d'annÃ©e"},{id:"communications",label:"Communication",icon:"MessageCircle",component:et,description:"SMS & emails"}],P=[{id:"documents",label:"Documents",icon:"FileText",component:tt,description:"Certificats"},{id:"transfers",label:"Transferts",icon:"ArrowRightLeft",component:st,description:"Changements d'Ã©cole"}],b=[...C,...P],I=b==null?void 0:b.find(p=>(p==null?void 0:p.id)===l),N=I==null?void 0:I.component,v=[{label:"Ã‰lÃ¨ves inscrits",value:u?"...":T.totalStudents.toString(),icon:"Users",color:"text-success",bgColor:"bg-success/10"},{label:"Justificatifs en attente",value:u?"...":T.pendingJustifications.toString(),icon:"FileText",color:"text-warning",bgColor:"bg-warning/10"},{label:"Paiements en retard",value:u?"...":T.latePayments.toString(),icon:"CreditCard",color:"text-error",bgColor:"bg-error/10"},{label:"Appels parents urgents",value:u?"...":T.urgentCalls.toString(),icon:"Phone",color:"text-primary",bgColor:"bg-primary/10"}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/30",children:[e.jsx(js,{userRole:(t==null?void 0:t.role)||"secretary",userName:i||(t==null?void 0:t.full_name)||(t==null?void 0:t.name)||"SecrÃ©taire",onToggleSidebar:()=>n(!o)}),e.jsx(Ns,{userRole:(t==null?void 0:t.role)||"secretary",isCollapsed:o,onToggle:()=>n(!o)}),e.jsx("main",{className:`pt-20 sm:pt-16 transition-all duration-state ${o?"lg:ml-16":"lg:ml-64"}`,children:e.jsxs("div",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-3 space-y-2 sm:space-y-3 w-full overflow-x-hidden",children:[e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 rounded-xl shadow-lg p-4 text-white",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"inline-flex items-center px-2 py-0.5 bg-white/20 backdrop-blur-sm rounded-full text-xs font-medium mb-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-green-400 rounded-full mr-1.5 animate-pulse"}),"En ligne"]}),e.jsxs("h1",{className:"font-heading font-heading-bold text-2xl mb-1",children:["Bienvenue, ",i||"SecrÃ©taire"," ðŸ‘‹"]}),e.jsx("p",{className:"font-body font-body-normal text-blue-100 text-sm",children:"Tableau de Bord SecrÃ©tariat - Gestion administrative complÃ¨te"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{className:"text-right bg-white/10 backdrop-blur-sm rounded-lg p-3 border border-white/20",children:[e.jsx("p",{className:"font-body font-body-semibold text-xs mb-0.5",children:(O=new Date)==null?void 0:O.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-blue-200 flex items-center justify-end",children:[e.jsx(a,{name:"Calendar",size:12,className:"mr-1"}),"AnnÃ©e scolaire 2025-2026"]})]})})]})})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6",children:v==null?void 0:v.map((p,z)=>{const R=["from-blue-50 to-indigo-50 border-blue-200","from-green-50 to-emerald-50 border-green-200","from-amber-50 to-orange-50 border-amber-200","from-purple-50 to-pink-50 border-purple-200"],L=["from-blue-600 to-indigo-600","from-green-600 to-emerald-600","from-amber-500 to-orange-500","from-purple-600 to-pink-600"],U=["text-blue-900","text-green-900","text-amber-900","text-purple-900"],B=["text-blue-700","text-green-700","text-amber-700","text-purple-700"];return e.jsxs("div",{className:`group bg-gradient-to-br ${R[z]} border-2 rounded-2xl p-3 sm:p-4 lg:p-5 hover:shadow-xl hover:scale-105 transition-all duration-300 shadow-lg`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2 sm:mb-3",children:e.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 lg:w-14 lg:h-14 bg-gradient-to-br ${L[z]} rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300 shadow-md`,children:e.jsx(a,{name:p==null?void 0:p.icon,size:18,className:"text-white"})})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-xl sm:text-2xl lg:text-3xl font-bold ${U[z]} mb-1`,children:p==null?void 0:p.value}),e.jsx("p",{className:`text-xs sm:text-sm font-semibold ${B[z]}`,children:p==null?void 0:p.label})]})]},z)})}),e.jsxs("div",{className:"sticky top-16 z-40 bg-white rounded-2xl shadow-xl border-2 border-gray-200 mb-6 backdrop-blur-xl bg-white/95",children:[e.jsxs("div",{className:"hidden lg:block p-4",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-1 h-6 bg-gradient-to-b from-blue-600 to-indigo-600 rounded-full mr-2"}),e.jsx("h2",{className:"font-heading font-heading-bold text-base text-text-primary",children:"Modules de Gestion"})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mb-4",children:C==null?void 0:C.map(p=>e.jsxs("button",{onClick:()=>s(p==null?void 0:p.id),className:`group relative overflow-hidden rounded-xl p-3 transition-all duration-300 ${l===(p==null?void 0:p.id)?"bg-gradient-to-br from-blue-600 to-indigo-600 text-white shadow-lg":"bg-gray-50 hover:bg-gray-100 border border-gray-200 hover:border-blue-300 hover:shadow-md"}`,children:[(p==null?void 0:p.badge)&&e.jsx("span",{className:`absolute top-2 right-2 w-5 h-5 flex items-center justify-center text-xs font-bold rounded-full ${l===(p==null?void 0:p.id)?"bg-white text-blue-600 shadow-sm":"bg-red-500 text-white"}`,children:p==null?void 0:p.badge}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-300 flex-shrink-0 ${l===(p==null?void 0:p.id)?"bg-white/20 backdrop-blur-sm":"bg-white group-hover:bg-blue-50 shadow-sm"}`,children:e.jsx(a,{name:p==null?void 0:p.icon,size:20,className:l===(p==null?void 0:p.id)?"text-white":"text-blue-600"})}),e.jsxs("div",{className:"text-left flex-1 min-w-0",children:[e.jsx("p",{className:`font-body font-body-semibold text-sm truncate ${l===(p==null?void 0:p.id)?"text-white":"text-text-primary"}`,children:p==null?void 0:p.label}),e.jsx("p",{className:`font-caption font-caption-normal text-xs truncate ${l===(p==null?void 0:p.id)?"text-blue-100":"text-text-secondary"}`,children:p==null?void 0:p.description})]})]}),l===(p==null?void 0:p.id)&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-white rounded-full"})]},p==null?void 0:p.id))}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-3 border-t border-gray-200",children:[e.jsxs("span",{className:"text-xs font-medium text-text-secondary px-2 py-1 flex items-center",children:[e.jsx(a,{name:"Grid",size:14,className:"mr-1"}),"Autres modules :"]}),P==null?void 0:P.map(p=>e.jsxs("button",{onClick:()=>s(p==null?void 0:p.id),className:`flex items-center space-x-2 px-4 py-2 rounded-full text-sm transition-all duration-300 ${l===(p==null?void 0:p.id)?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-md":"bg-gray-100 hover:bg-gray-200 text-text-secondary hover:text-text-primary border border-gray-300 hover:border-blue-400"}`,children:[e.jsx(a,{name:p==null?void 0:p.icon,size:16}),e.jsx("span",{className:"font-body font-body-medium",children:p==null?void 0:p.label})]},p==null?void 0:p.id))]})]}),e.jsx("div",{className:"lg:hidden p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx(a,{name:"Layers",size:18,className:"text-blue-600"})}),e.jsxs("select",{value:l,onChange:p=>{var z;return s((z=p==null?void 0:p.target)==null?void 0:z.value)},className:"w-full appearance-none bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl pl-12 pr-10 py-3 font-body font-body-semibold text-sm text-text-primary focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",children:[e.jsx("optgroup",{label:"ðŸ“‹ Fonctions principales",children:C==null?void 0:C.map(p=>e.jsxs("option",{value:p==null?void 0:p.id,children:[p==null?void 0:p.label," - ",p==null?void 0:p.description]},p==null?void 0:p.id))}),e.jsx("optgroup",{label:"âš™ï¸ Autres fonctions",children:P==null?void 0:P.map(p=>e.jsxs("option",{value:p==null?void 0:p.id,children:[p==null?void 0:p.label," - ",p==null?void 0:p.description]},p==null?void 0:p.id))})]}),e.jsx("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx(a,{name:"ChevronDown",size:18,className:"text-blue-600"})})]})}),e.jsx("div",{className:"p-6 animate-fadeIn",children:N&&e.jsx(N,{})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 via-orange-50 to-red-50 rounded-2xl border-2 border-amber-300 p-6 shadow-lg hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(a,{name:"Zap",size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-amber-900",children:"Actions Rapides"}),e.jsx("p",{className:"text-xs text-amber-700",children:"Raccourcis pour vos tÃ¢ches courantes"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(j,{variant:"outline",iconName:"CheckSquare",iconPosition:"left",onClick:()=>s("tasks"),className:"justify-start bg-white hover:bg-gradient-to-r hover:from-green-50 hover:to-emerald-50 border-2 border-green-200 hover:border-green-400 hover:shadow-lg hover:scale-105 transition-all duration-300 py-6 group rounded-xl",children:e.jsx("span",{className:"font-semibold group-hover:text-green-700",children:"Mes tÃ¢ches du jour"})}),e.jsx(j,{variant:"outline",iconName:"Phone",iconPosition:"left",onClick:()=>s("justifications"),className:"justify-start bg-white hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 border-2 border-blue-200 hover:border-blue-400 hover:shadow-lg hover:scale-105 transition-all duration-300 py-6 group rounded-xl",children:e.jsx("span",{className:"font-semibold group-hover:text-blue-700",children:"Appels parents urgents"})}),e.jsx(j,{variant:"outline",iconName:"Calendar",iconPosition:"left",onClick:()=>s("planning"),className:"justify-start bg-white hover:bg-gradient-to-r hover:from-purple-50 hover:to-pink-50 border-2 border-purple-200 hover:border-purple-400 hover:shadow-lg hover:scale-105 transition-all duration-300 py-6 group rounded-xl",children:e.jsx("span",{className:"font-semibold group-hover:text-purple-700",children:"Planning rendez-vous"})}),e.jsx(j,{variant:"outline",iconName:"FileText",iconPosition:"left",onClick:()=>s("documents"),className:"justify-start bg-white hover:bg-gradient-to-r hover:from-orange-50 hover:to-red-50 border-2 border-orange-200 hover:border-orange-400 hover:shadow-lg hover:scale-105 transition-all duration-300 py-6 group rounded-xl",children:e.jsx("span",{className:"font-semibold group-hover:text-orange-700",children:"Certificats Ã  imprimer"})})]})]})]})})]})};export{yt as default};
//# sourceMappingURL=index-DrcxLO50.js.map
