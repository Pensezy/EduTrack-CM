{"version":3,"file":"contexts-fbpOeTmm.js","sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../src/contexts/AuthContext.jsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { supabase } from '../lib/supabase';\r\nimport databaseService from '../services/databaseService';\r\n\r\nconst AuthContext = createContext({});\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [userProfile, setUserProfile] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    // PRIORIT√â : Toujours v√©rifier la session Supabase d'abord\r\n    // Cela √©vite qu'un compte local (√©tudiant) ne masque un compte principal connect√©\r\n    const initializeAuth = async () => {\r\n      try {\r\n        console.log('üîç V√©rification de la session Supabase...');\r\n        const { data: { session }, error } = await supabase.auth.getSession();\r\n        \r\n        if (session?.user) {\r\n          // ‚úÖ Session Supabase active (Principal) - PRIORIT√â ABSOLUE\r\n          console.log('‚úÖ Session Supabase trouv√©e:', session.user.email);\r\n          await ensureUserInDatabase(session.user);\r\n          setUser(session.user);\r\n          setUserProfile(session.user);\r\n          localStorage.setItem('edutrack-user', JSON.stringify(session.user));\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        console.log('‚ÑπÔ∏è Pas de session Supabase, v√©rification localStorage...');\r\n\r\n        // Pas de session Supabase, v√©rifier localStorage\r\n        const savedUser = localStorage.getItem('edutrack-user');\r\n        if (savedUser) {\r\n          const userData = JSON.parse(savedUser);\r\n          console.log('üîÑ Utilisateur depuis localStorage:', userData.email);\r\n\r\n          if (userData.sessionId) {\r\n            // Compte local (enseignant, √©tudiant, parent, secr√©taire)\r\n            console.log('‚úÖ Compte local d√©tect√©, utilisation directe des donn√©es');\r\n            setUser(userData);\r\n            setUserProfile(userData);\r\n            setLoading(false);\r\n          } else {\r\n            // Donn√©es invalides dans localStorage\r\n            console.warn('‚ö†Ô∏è Donn√©es localStorage invalides');\r\n            localStorage.removeItem('edutrack-user');\r\n            setLoading(false);\r\n          }\r\n        } else {\r\n          console.log('‚ÑπÔ∏è Aucune session trouv√©e');\r\n          setLoading(false);\r\n        }\r\n      } catch (e) {\r\n        console.error('‚ùå Erreur lors de l\\'initialisation:', e);\r\n        localStorage.removeItem('edutrack-user');\r\n        setLoading(false);\r\n      }\r\n    };\r\n    \r\n    initializeAuth();\r\n\r\n    // √âcouter les changements de session Supabase (connexion/d√©connexion principal)\r\n    let isProcessingAuth = false;\r\n    let lastProcessedUserId = null; // Tracker le dernier utilisateur trait√©\r\n    \r\n    const { data: authListener } = supabase.auth.onAuthStateChange(async (event, session) => {\r\n      console.log('üîê Changement d\\'√©tat Supabase:', event, session?.user?.email);\r\n      \r\n      // Ignorer les √©v√©nements TOKEN_REFRESHED, USER_UPDATED, etc. si l'utilisateur est d√©j√† connect√©\r\n      if (event !== 'SIGNED_IN' && event !== 'SIGNED_OUT' && event !== 'INITIAL_SESSION') {\r\n        console.log('‚è≠Ô∏è √âv√©nement ignor√© (type non g√©r√©):', event);\r\n        return;\r\n      }\r\n      \r\n      // √âviter les appels multiples simultan√©s\r\n      if (isProcessingAuth) {\r\n        console.log('‚è≠Ô∏è √âv√©nement ignor√© (traitement en cours)');\r\n        return;\r\n      }\r\n      \r\n      if ((event === 'SIGNED_IN' || event === 'INITIAL_SESSION') && session?.user) {\r\n        // V√©rifier si on a d√©j√† trait√© cet utilisateur\r\n        if (lastProcessedUserId === session.user.id) {\r\n          console.log('‚úÖ Utilisateur d√©j√† trait√©, ignorer l\\'√©v√©nement');\r\n          return;\r\n        }\r\n        \r\n        // Principal connect√© - Ne traiter que si ce n'est pas d√©j√† fait\r\n        const currentUser = localStorage.getItem('edutrack-user');\r\n        if (currentUser) {\r\n          try {\r\n            const userData = JSON.parse(currentUser);\r\n            if (userData.id === session.user.id) {\r\n              console.log('‚úÖ Utilisateur d√©j√† d√©fini dans localStorage, ignorer');\r\n              lastProcessedUserId = session.user.id;\r\n              return;\r\n            }\r\n          } catch (e) {\r\n            // Continuer si erreur de parsing\r\n          }\r\n        }\r\n        \r\n        isProcessingAuth = true;\r\n        try {\r\n          await ensureUserInDatabase(session.user);\r\n          setUser(session.user);\r\n          setUserProfile(session.user);\r\n          localStorage.setItem('edutrack-user', JSON.stringify(session.user));\r\n          lastProcessedUserId = session.user.id;\r\n          console.log('‚úÖ Utilisateur configur√© avec succ√®s');\r\n        } finally {\r\n          isProcessingAuth = false;\r\n        }\r\n      } else if (event === 'SIGNED_OUT') {\r\n        // Principal d√©connect√©\r\n        console.log('üëã D√©connexion Supabase');\r\n        lastProcessedUserId = null;\r\n        \r\n        // Ne pas nettoyer si un compte local est actif\r\n        const savedUser = localStorage.getItem('edutrack-user');\r\n        if (savedUser) {\r\n          try {\r\n            const userData = JSON.parse(savedUser);\r\n            if (!userData.sessionId) {\r\n              // C'√©tait un compte Supabase, le supprimer\r\n              localStorage.removeItem('edutrack-user');\r\n              setUser(null);\r\n              setUserProfile(null);\r\n            }\r\n          } catch (e) {\r\n            console.error('Erreur parsing user:', e);\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    // √âcouter les changements dans le localStorage (changement de compte)\r\n    // Note: storage event ne marche que pour les autres fen√™tres\r\n    const handleStorageChange = (e) => {\r\n      if (e.key === 'edutrack-user') {\r\n        console.log('üîÑ Changement de compte d√©tect√© dans localStorage (autre fen√™tre)');\r\n        if (e.newValue) {\r\n          try {\r\n            const userData = JSON.parse(e.newValue);\r\n            console.log('üë§ Nouveau compte:', userData.email);\r\n            setUser(userData);\r\n            setUserProfile(userData);\r\n          } catch (err) {\r\n            console.error('Erreur parsing nouveau user:', err);\r\n          }\r\n        } else {\r\n          setUser(null);\r\n          setUserProfile(null);\r\n        }\r\n      }\r\n    };\r\n\r\n    // √âcouter les √©v√©nements personnalis√©s pour les changements dans la m√™me fen√™tre\r\n    const handleUserChange = (e) => {\r\n      console.log('üîÑ Changement de compte d√©tect√© (√©v√©nement personnalis√©)');\r\n      const userData = e.detail;\r\n      if (userData) {\r\n        console.log('üë§ Nouveau compte:', userData.email);\r\n        setUser(userData);\r\n        setUserProfile(userData);\r\n      } else {\r\n        setUser(null);\r\n        setUserProfile(null);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('storage', handleStorageChange);\r\n    window.addEventListener('edutrack-user-changed', handleUserChange);\r\n    \r\n    return () => {\r\n      authListener?.subscription?.unsubscribe();\r\n      window.removeEventListener('storage', handleStorageChange);\r\n      window.removeEventListener('edutrack-user-changed', handleUserChange);\r\n    };\r\n  }, []);\r\n\r\n  const checkSupabaseSession = async (localUser = null) => {\r\n    try {\r\n      const { data: { session }, error } = await supabase.auth.getSession();\r\n      \r\n      if (error) {\r\n        throw error;\r\n      }\r\n      \r\n      if (session?.user) {\r\n        // We have a Supabase session, ensure user exists in users table\r\n        await ensureUserInDatabase(session.user);\r\n        setUser(session.user);\r\n        setUserProfile(session.user);\r\n\r\n        // Save to localStorage\r\n        localStorage.setItem('edutrack-user', JSON.stringify(session.user));\r\n      } else if (localUser) {\r\n        // Try to restore from local user if session is invalid\r\n        setUser(localUser);\r\n        setUserProfile(localUser);\r\n      }\r\n    } catch (err) {\r\n      console.warn('‚ö†Ô∏è Error checking Supabase session:', err);\r\n      // Continue without blocking\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const ensureUserInDatabase = async (authUser) => {\r\n    try {\r\n      // V√©rifier d'abord si l'utilisateur existe d√©j√† (lecture seule, pas d'√©criture)\r\n      const { data: existingUser, error: fetchError } = await supabase\r\n        .from('users')\r\n        .select('*')\r\n        .eq('id', authUser.id)\r\n        .single();\r\n\r\n      if (existingUser && !fetchError) {\r\n        console.log('‚úÖ User already exists in database:', existingUser.email);\r\n        return existingUser;\r\n      }\r\n\r\n      // Si l'utilisateur n'existe pas, ne PAS essayer de l'ajouter ici\r\n      // Le trigger handle_new_user_automatic() s'en charge automatiquement\r\n      console.log('‚ÑπÔ∏è User not found in database, will be created by trigger');\r\n      return null;\r\n    } catch (err) {\r\n      console.warn('‚ö†Ô∏è Exception checking user in database:', err);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const signInWithPin = async (pin, identifier) => {\r\n    try {\r\n      setError(null);\r\n      if (!identifier || !pin) {\r\n        throw new Error('Identifiant et code PIN requis');\r\n      }\r\n\r\n      // V√©rifier avec Supabase\r\n      const { data, error } = await supabase.rpc('verify_pin', {\r\n        identifier,\r\n        pin_input: pin\r\n      });\r\n\r\n      if (error || !data || data.length === 0) {\r\n        throw new Error('Identifiant ou code PIN incorrect');\r\n      }\r\n\r\n      // Transformer les donn√©es re√ßues dans le format attendu\r\n      const authenticatedUser = {\r\n        id: data[0].user_id,\r\n        full_name: data[0].user_full_name,\r\n        role: data[0].user_role,\r\n        phone: data[0].user_phone,\r\n        email: data[0].user_email\r\n      };\r\n\r\n      // Ensure user exists in database with proper permissions\r\n      // If the returned user_id looks like a legacy numeric id (e.g. 1),\r\n      // attempt to resolve a proper UUID from the `users` table by email.\r\n      // If none exists, create a new users row with a generated UUID.\r\n      try {\r\n        const { data: existingUser, error: existingError } = await supabase\r\n          .from('users')\r\n          .select('id')\r\n          .eq('email', authenticatedUser.email)\r\n          .single();\r\n\r\n        if (existingError) {\r\n          // If the select failed because no row, existingUser will be null.\r\n          console.warn('‚ö†Ô∏è No existing users row found by email (or select error):', existingError?.message || existingError);\r\n        }\r\n\r\n        if (existingUser && existingUser.id) {\r\n          authenticatedUser.id = existingUser.id;\r\n        } else {\r\n          // If the RPC returned a numeric id or no matching users row exists,\r\n          // generate a UUID for the new users entry to match the DB schema.\r\n          const newUuid = (typeof crypto !== 'undefined' && crypto.randomUUID) ? crypto.randomUUID() : null;\r\n          const generatedId = newUuid || `gen-${Date.now()}-${Math.floor(Math.random()*1000)}`;\r\n\r\n          // Upsert the users row with a valid id\r\n          const { data: upserted, error: upsertError } = await supabase\r\n            .from('users')\r\n            .upsert({\r\n              id: generatedId,\r\n              email: authenticatedUser.email,\r\n              full_name: authenticatedUser.full_name || authenticatedUser.email.split('@')[0],\r\n              role: authenticatedUser.role || 'student',\r\n              phone: authenticatedUser.phone || '',\r\n              is_active: true,\r\n              created_at: new Date().toISOString(),\r\n              updated_at: new Date().toISOString()\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n          if (upsertError) {\r\n            console.warn('‚ö†Ô∏è Could not create users row with generated UUID:', upsertError);\r\n          } else if (upserted && upserted.id) {\r\n            authenticatedUser.id = upserted.id;\r\n          } else {\r\n            // As a fallback, keep the original id but log a warning\r\n            console.warn('‚ö†Ô∏è No id returned after upsert; keeping original id:', authenticatedUser.id);\r\n          }\r\n        }\r\n      } catch (resolveErr) {\r\n        console.warn('‚ö†Ô∏è Exception while resolving user id for sign-in:', resolveErr);\r\n      }\r\n\r\n      await ensureUserInDatabase(authenticatedUser);\r\n\r\n      // Valider et corriger les donn√©es au moment de la connexion (pour les directeurs)\r\n      if (authenticatedUser.role === 'principal') {\r\n        try {\r\n          const validationResult = await databaseService.validateDirectorData(authenticatedUser.id, authenticatedUser.email);\r\n          if (validationResult.corrections && validationResult.corrections.length > 0) {\r\n            console.log('‚úÖ Donn√©es corrig√©es lors de la connexion:', validationResult.corrections);\r\n          }\r\n          \r\n          // Mettre √† jour les donn√©es utilisateur si des corrections ont √©t√© apport√©es\r\n          if (validationResult.schoolData && validationResult.schoolData.director_name) {\r\n            authenticatedUser.full_name = validationResult.schoolData.director_name;\r\n          }\r\n        } catch (validationError) {\r\n          console.warn('‚ö†Ô∏è Erreur validation donn√©es:', validationError);\r\n          // Ne pas bloquer la connexion pour une erreur de validation\r\n        }\r\n      }\r\n\r\n      // Sauvegarder les donn√©es compl√®tes dans le localStorage\r\n      localStorage.setItem('edutrack-user', JSON.stringify(authenticatedUser));\r\n\r\n      setUser(authenticatedUser);\r\n      setUserProfile(authenticatedUser);\r\n      return { user: authenticatedUser, error: null };\r\n\r\n    } catch (error) {\r\n      console.error('Erreur de connexion:', error);\r\n      setError(error?.message || 'Erreur de connexion');\r\n      return { user: null, error };\r\n    }\r\n  };\r\n\r\n  const signOut = async () => {\r\n    try {\r\n      // Supprimer la session locale\r\n      localStorage.removeItem('edutrack-user');\r\n      localStorage.removeItem('edutrack-session');\r\n      setUser(null);\r\n      setUserProfile(null);\r\n      setError(null);\r\n      // D√©connexion Supabase uniquement si une session existe\r\n      const { error } = await supabase.auth.signOut();\r\n      if (error) throw error;\r\n    } catch (error) {\r\n      console.error('Erreur lors de la d√©connexion:', error);\r\n      setError(error?.message);\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    userProfile,\r\n    loading,\r\n    signInWithPin,\r\n    signOut,\r\n    error,\r\n    setError\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default AuthContext;"],"names":["f","require$$0","k","l","m","n","p","q","c","g","b","d","e","h","reactJsxRuntime_production_min","jsxRuntimeModule","AuthContext","createContext","useAuth","context","useContext","AuthProvider","children","user","setUser","useState","userProfile","setUserProfile","loading","setLoading","error","setError","useEffect","session","supabase","ensureUserInDatabase","savedUser","userData","isProcessingAuth","lastProcessedUserId","authListener","event","_a","currentUser","handleStorageChange","err","handleUserChange","authUser","existingUser","fetchError","value","pin","identifier","data","authenticatedUser","existingError","generatedId","upserted","upsertError","resolveErr","validationResult","databaseService","validationError","jsx"],"mappings":"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","x_google_ignoreList":[0,1]}