{"version":3,"mappings":"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","names":["useUserProfile","providedUser","authUser","useAuth","profile","setProfile","useState","loading","setLoading","error","setError","user","useEffect","realProfile","getRealProfile","err","getMinimalProfile","_a","_b","_c","_d","_e","productionDataService","_f","schoolId","_g","schoolData","employees","supabase","students","studentsCount","teacherData","_h","c","studentData","studentError","parentInfo","parentStudentLink","_i","parentData","userData","_j","_k","ProfileSettings","location","useLocation","expectedRole","currentPath","roleUser","useRoleSession","userProfile","profileLoading","isChangingPassword","setIsChangingPassword","passwordData","setPasswordData","showPasswords","setShowPasswords","jsxs","jsx","Icon","passwordValidation","password","minLength","hasUpper","hasLower","hasNumber","hasSpecial","handlePasswordChange","resolve","generateSecurePassword","lowercase","uppercase","numbers","symbols","allChars","i","handleGeneratePassword","newPassword","prev","classe","index","permission","subject","child","cert","Button","Input","e","key","label","DangerZone","userRole","userId","userEmail","showDeleteModal","setShowDeleteModal","deleteConfirmText","setDeleteConfirmText","isDeleting","setIsDeleting","deleteError","setDeleteError","handleDeleteAccount","__vitePreload","n","userDataError","gradesError","attendancesError","paymentsError","notificationsError","communicationsError","templatesError","auditError","classSubjectsError","teacherSubjectsError","parentStudentError","studentsSelectError","studentsDeleteError","teachers","teachersSelectError","teachersDeleteError","parents","parentsSelectError","parentsDeleteError","secretaries","secretariesSelectError","secretariesDeleteError","userIdsToDelete","s","t","p","id","usersDeleteError","subjectsError","classesError","evaluationPeriodsError","academicYearsError","gradeTypesError","attendanceTypesError","paymentTypesError","userRolesError","schoolError","schoolDeletionError","userDeactivateError","userDeleteError","authDeleteError","Fragment"],"ignoreList":[],"sources":["../../src/hooks/useUserProfile.js","../../src/pages/profile-settings/index.jsx"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { supabase } from '../lib/supabase';\r\nimport productionDataService from '../services/productionDataService';\r\n\r\n/**\r\n * Hook optimis√© pour charger SEULEMENT les donn√©es de profil utilisateur depuis Supabase\r\n * Plus rapide que useDashboardData pour les pages qui n'ont besoin que du profil\r\n * @param {object} providedUser - Utilisateur √† charger (optionnel, sinon utilise AuthContext)\r\n */\r\nexport const useUserProfile = (providedUser = null) => {\r\n  const { user: authUser } = useAuth();\r\n  const [profile, setProfile] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Utiliser l'utilisateur fourni ou celui du contexte\r\n  const user = providedUser || authUser;\r\n\r\n  useEffect(() => {\r\n    const loadUserProfile = async () => {\r\n      if (!user) {\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      console.log('üë§ useUserProfile - Chargement profil pour:', user.email, '(ID:', user.id, ')');\r\n\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      try {\r\n        const realProfile = await getRealProfile(user);\r\n        console.log('üìã Profil charg√©:', realProfile);\r\n        setProfile(realProfile);\r\n      } catch (err) {\r\n        console.error('Erreur chargement profil:', err);\r\n        setError(err);\r\n        // Fallback avec profil minimal\r\n        setProfile(getMinimalProfile(user));\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadUserProfile();\r\n  }, [user]);\r\n\r\n  return { profile, loading, error };\r\n};\r\n\r\n// Profil r√©el optimis√© (chargement rapide des donn√©es essentielles depuis Supabase)\r\nconst getRealProfile = async (user) => {\r\n  // Base profile from auth\r\n  let profile = {\r\n    id: user.id,\r\n    full_name: user.full_name || user.user_metadata?.full_name || user.email?.split('@')[0] || 'Utilisateur',\r\n    email: user.email,\r\n    phone: user.phone || user.user_metadata?.phone,\r\n    role: user.role || user.user_metadata?.role || 'student',\r\n    avatar: user.avatar || user.user_metadata?.avatar,\r\n    created_at: user.created_at\r\n  };\r\n\r\n  try {\r\n    // Initialiser le contexte pour productionDataService si n√©cessaire\r\n    if (user.current_school_id) {\r\n      productionDataService.setUserContext(user.id, user.current_school_id);\r\n    }\r\n\r\n    // Charger SEULEMENT les donn√©es sp√©cifiques au r√¥le\r\n    switch (profile.role) {\r\n      case 'principal':\r\n        // Charger donn√©es √©cole compl√®tes\r\n        if (user.current_school_id || user.schoolData?.id) {\r\n          const schoolId = user.current_school_id || user.schoolData?.id;\r\n\r\n          // Charger les d√©tails de l'√©cole\r\n          const schoolData = await productionDataService.getSchoolDetails();\r\n\r\n          if (schoolData.data) {\r\n            // Compter le personnel et les √©tudiants\r\n            const { data: employees } = await supabase\r\n              .from('users')\r\n              .select('id', { count: 'exact' })\r\n              .eq('current_school_id', schoolId)\r\n              .in('role', ['teacher', 'secretary']);\r\n\r\n            const { data: students, count: studentsCount } = await supabase\r\n              .from('students')\r\n              .select('id', { count: 'exact', head: true })\r\n              .eq('school_id', schoolId);\r\n\r\n            profile = {\r\n              ...profile,\r\n              school_name: schoolData.data.name || '√âcole non d√©finie',\r\n              school_address: schoolData.data.address || 'Adresse non d√©finie',\r\n              school_city: schoolData.data.city || '',\r\n              school_country: schoolData.data.country || '',\r\n              school_phone: schoolData.data.phone || '',\r\n              school_code: schoolData.data.code || '',\r\n              position: 'Directeur d\\'√âtablissement',\r\n              experience: 'Non d√©fini',\r\n              specialization: 'Administration Scolaire',\r\n              employees_count: employees?.length || 0,\r\n              students_count: studentsCount || 0,\r\n              classes_managed: schoolData.data.available_classes || [],\r\n              school_type: schoolData.data.type || 'Non d√©fini',\r\n              school_status: schoolData.data.status || 'active'\r\n            };\r\n          }\r\n        }\r\n        break;\r\n\r\n      case 'teacher':\r\n        // Pour les enseignants, charger depuis la table teachers\r\n        if (user.current_school_id) {\r\n          const { data: teacherData } = await supabase\r\n            .from('teachers')\r\n            .select('*, classes(name)')\r\n            .eq('user_id', user.id)\r\n            .eq('is_active', true)\r\n            .maybeSingle();\r\n\r\n          if (teacherData) {\r\n            profile = {\r\n              ...profile,\r\n              full_name: profile.full_name || `${teacherData.first_name} ${teacherData.last_name}`,\r\n              subject: teacherData.specialty || 'Mati√®re non d√©finie',\r\n              degree: teacherData.degree || 'Non d√©fini',\r\n              experience: teacherData.hire_date ?\r\n                `${new Date().getFullYear() - new Date(teacherData.hire_date).getFullYear()} ans` :\r\n                'Non d√©fini',\r\n              classes: teacherData.classes?.map(c => c.name) || [],\r\n              phone: teacherData.phone || profile.phone\r\n            };\r\n\r\n            // Compter les √©tudiants\r\n            const { count: studentsCount } = await supabase\r\n              .from('students')\r\n              .select('id', { count: 'exact', head: true })\r\n              .eq('school_id', user.current_school_id);\r\n\r\n            profile.students_count = studentsCount || 0;\r\n          }\r\n        }\r\n        break;\r\n\r\n      case 'student':\r\n        // Pour les √©tudiants, charger depuis la table students\r\n        const { data: studentData, error: studentError } = await supabase\r\n          .from('students')\r\n          .select(`\r\n            *,\r\n            classes(name),\r\n            schools(name)\r\n          `)\r\n          .eq('user_id', user.id)\r\n          .maybeSingle();\r\n\r\n        console.log('üìö Donn√©es √©tudiant charg√©es:', studentData);\r\n\r\n        if (studentData) {\r\n          // Charger les informations du parent\r\n          let parentInfo = null;\r\n\r\n          // Chercher via parent_students\r\n          const { data: parentStudentLink } = await supabase\r\n            .from('parent_students')\r\n            .select(`\r\n              parent_id,\r\n              relationship,\r\n              is_primary,\r\n              parents!inner(\r\n                id,\r\n                user_id,\r\n                profession,\r\n                address,\r\n                emergency_contact,\r\n                users!inner(id, full_name, phone, email)\r\n              )\r\n            `)\r\n            .eq('student_id', studentData.id)\r\n            .eq('is_primary', true)\r\n            .maybeSingle();\r\n\r\n          if (parentStudentLink?.parents?.users) {\r\n            const parentData = parentStudentLink.parents;\r\n            const userData = parentData.users;\r\n\r\n            parentInfo = {\r\n              id: userData.id,\r\n              name: userData.full_name || 'Non d√©fini',\r\n              phone: userData.phone || 'Non d√©fini',\r\n              email: userData.email || 'Non d√©fini',\r\n              profession: parentData.profession || null,\r\n              address: parentData.address || null,\r\n              emergency_contact: parentData.emergency_contact || null,\r\n              relationship: parentStudentLink.relationship || 'Parent'\r\n            };\r\n          } else if (studentData.parent_id) {\r\n            // Fallback : ancienne structure\r\n            const { data: parentData } = await supabase\r\n              .from('parents')\r\n              .select(`\r\n                *,\r\n                users!inner(id, full_name, phone, email)\r\n              `)\r\n              .eq('id', studentData.parent_id)\r\n              .maybeSingle();\r\n\r\n            if (parentData?.users) {\r\n              parentInfo = {\r\n                id: parentData.users.id,\r\n                name: parentData.users.full_name || 'Non d√©fini',\r\n                phone: parentData.users.phone || 'Non d√©fini',\r\n                email: parentData.users.email || 'Non d√©fini',\r\n                profession: parentData.profession || null,\r\n                address: parentData.address || null,\r\n                emergency_contact: parentData.emergency_contact || null,\r\n                relationship: 'Parent'\r\n              };\r\n            }\r\n          }\r\n\r\n          profile = {\r\n            ...profile,\r\n            full_name: studentData.first_name && studentData.last_name\r\n              ? `${studentData.first_name} ${studentData.last_name}`\r\n              : profile.full_name,\r\n            class_name: studentData.classes?.name || 'Non assign√©',\r\n            school_name: studentData.schools?.name || '√âcole non d√©finie',\r\n            student_id: studentData.student_number || 'Non d√©fini',\r\n            birth_date: studentData.birth_date || 'Non d√©fini',\r\n            parent_name: parentInfo?.name || 'Non d√©fini',\r\n            parent_phone: parentInfo?.phone || 'Non d√©fini',\r\n            parent_email: parentInfo?.email || null,\r\n            parent_profession: parentInfo?.profession || null,\r\n            parent_address: parentInfo?.address || null,\r\n            parent_emergency_contact: parentInfo?.emergency_contact || null,\r\n            parent_relationship: parentInfo?.relationship || null,\r\n            phone: studentData.phone || profile.phone,\r\n            gender: studentData.gender || 'Non d√©fini',\r\n            average_grade: '√Ä calculer',\r\n            attendance_rate: '√Ä calculer',\r\n            subjects: []\r\n          };\r\n        }\r\n        break;\r\n\r\n      case 'secretary':\r\n        // Pour les secr√©taires, charger depuis la table users\r\n        if (user.current_school_id) {\r\n          const { data: schoolData } = await supabase\r\n            .from('schools')\r\n            .select('name, address')\r\n            .eq('id', user.current_school_id)\r\n            .maybeSingle();\r\n\r\n          profile = {\r\n            ...profile,\r\n            position: 'Secr√©taire',\r\n            school_name: schoolData?.name || '√âcole non d√©finie',\r\n            specialization: 'Gestion Administrative',\r\n            permissions: ['Gestion √âtudiants', 'Documents Administratifs']\r\n          };\r\n        }\r\n        break;\r\n\r\n      default:\r\n        // Pour les autres r√¥les, garder le profil de base\r\n        break;\r\n    }\r\n  } catch (error) {\r\n    console.warn('Erreur chargement donn√©es sp√©cifiques:', error);\r\n    // Continuer avec le profil de base\r\n  }\r\n\r\n  return profile;\r\n};\r\n\r\n// Profil minimal de fallback\r\nconst getMinimalProfile = (user) => ({\r\n  id: user.id,\r\n  full_name: user.full_name || user.email?.split('@')[0] || 'Utilisateur',\r\n  email: user.email,\r\n  role: user.role || 'student',\r\n  phone: user.phone || 'Non d√©fini'\r\n});\r\n\r\nexport default useUserProfile;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport Icon from '../../components/AppIcon';\r\nimport Button from '../../components/ui/Button';\r\nimport Input from '../../components/ui/Input';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport useUserProfile from '../../hooks/useUserProfile';\r\nimport useRoleSession from '../../hooks/useRoleSession';\r\n\r\nconst ProfileSettings = () => {\r\n  const location = useLocation();\r\n  const { user: authUser } = useAuth();\r\n  \r\n  console.log('üîç ProfileSettings - AuthUser re√ßu:', authUser?.email, 'Role:', authUser?.role, 'ID:', authUser?.id);\r\n  \r\n  // PRIORIT√â ABSOLUE : Si authUser existe, l'utiliser directement sans v√©rifier de session\r\n  // Cela corrige le probl√®me o√π un utilisateur connect√© voit les donn√©es d'un autre utilisateur\r\n  let user = authUser;\r\n  \r\n  // D√©terminer le r√¥le attendu (uniquement pour useRoleSession en fallback)\r\n  let expectedRole = authUser?.role || 'student';\r\n  \r\n  if (!authUser?.role) {\r\n    const currentPath = location.pathname;\r\n    \r\n    if (currentPath.includes('principal')) {\r\n      expectedRole = 'principal';\r\n    } else if (currentPath.includes('teacher')) {\r\n      expectedRole = 'teacher';\r\n    } else if (currentPath.includes('parent')) {\r\n      expectedRole = 'parent';\r\n    } else if (currentPath.includes('secretary')) {\r\n      expectedRole = 'secretary';\r\n    }\r\n  }\r\n  \r\n  // Toujours appeler le hook (r√®gle React) mais uniquement en fallback\r\n  const { user: roleUser } = useRoleSession(expectedRole);\r\n  \r\n  // Fallback : Si authUser n'existe pas, essayer roleUser\r\n  if (!user && roleUser) {\r\n    user = roleUser;\r\n    console.log('üë§ ProfileSettings - Utilisation RoleSession (fallback):', roleUser.email);\r\n  }\r\n  \r\n  console.log('‚úÖ ProfileSettings - Utilisateur final s√©lectionn√©:', user?.email, '(r√¥le:', user?.role, ')');\r\n  \r\n  // Passer l'utilisateur sp√©cifique au hook\r\n  const { profile: userProfile, loading: profileLoading, error } = useUserProfile(user);\r\n  \r\n  const [isChangingPassword, setIsChangingPassword] = useState(false);\r\n  const [passwordData, setPasswordData] = useState({\r\n    currentPassword: '',\r\n    newPassword: '',\r\n    confirmPassword: ''\r\n  });\r\n  const [showPasswords, setShowPasswords] = useState({\r\n    current: false,\r\n    new: false,\r\n    confirm: false\r\n  });\r\n\r\n  // Le profil est maintenant g√©r√© par le hook useUserProfile\r\n\r\n  // Affichage de chargement rapide\r\n  if (profileLoading || !user) {\r\n    return (\r\n      <div className=\"max-w-2xl mx-auto p-6\">\r\n        <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm p-6\">\r\n          <div className=\"animate-pulse flex space-x-4\">\r\n            <div className=\"rounded-full bg-gray-200 h-16 w-16\"></div>\r\n            <div className=\"flex-1 space-y-2 py-1\">\r\n              <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\r\n              <div className=\"h-4 bg-gray-200 rounded w-1/2\"></div>\r\n              <div className=\"h-3 bg-gray-200 rounded w-1/3 mt-2\"></div>\r\n            </div>\r\n          </div>\r\n          <div className=\"mt-6 space-y-3\">\r\n            <div className=\"h-4 bg-gray-200 rounded\"></div>\r\n            <div className=\"h-4 bg-gray-200 rounded w-4/5\"></div>\r\n            <div className=\"h-4 bg-gray-200 rounded w-3/5\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Affichage d'erreur si √©chec de chargement\r\n  if (error && !profileLoading) {\r\n    return (\r\n      <div className=\"max-w-2xl mx-auto p-6\">\r\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-6\">\r\n          <div className=\"flex items-center space-x-3\">\r\n            <Icon name=\"AlertCircle\" size={20} className=\"text-red-600\" />\r\n            <div>\r\n              <h3 className=\"font-medium text-red-900\">Erreur de chargement</h3>\r\n              <p className=\"text-sm text-red-700 mt-1\">\r\n                Impossible de charger les informations du profil. Veuillez actualiser la page.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  // Validation de la force du mot de passe\r\n  const validatePassword = (password) => {\r\n    const minLength = password.length >= 8;\r\n    const hasUpper = /[A-Z]/.test(password);\r\n    const hasLower = /[a-z]/.test(password);\r\n    const hasNumber = /\\d/.test(password);\r\n    const hasSpecial = /[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]/.test(password);\r\n    \r\n    return {\r\n      isValid: minLength && hasUpper && hasLower && hasNumber && hasSpecial,\r\n      criteria: {\r\n        minLength,\r\n        hasUpper,\r\n        hasLower,\r\n        hasNumber,\r\n        hasSpecial\r\n      }\r\n    };\r\n  };\r\n\r\n  const passwordValidation = validatePassword(passwordData.newPassword);\r\n\r\n  const handlePasswordChange = async () => {\r\n    // Validation des champs\r\n    if (!passwordData.currentPassword || !passwordData.newPassword || !passwordData.confirmPassword) {\r\n      alert('Veuillez remplir tous les champs');\r\n      return;\r\n    }\r\n\r\n    if (passwordData.newPassword !== passwordData.confirmPassword) {\r\n      alert('Les nouveaux mots de passe ne correspondent pas');\r\n      return;\r\n    }\r\n\r\n    if (!passwordValidation.isValid) {\r\n      alert('Le nouveau mot de passe ne respecte pas les crit√®res de s√©curit√©');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Ici, on int√©grerait la logique de changement de mot de passe\r\n      // avec l'API backend (Supabase, etc.)\r\n      \r\n      // Simulation\r\n      await new Promise(resolve => setTimeout(resolve, 1000));\r\n      \r\n      alert('Mot de passe chang√© avec succ√®s !');\r\n      \r\n      // Reset du formulaire\r\n      setPasswordData({\r\n        currentPassword: '',\r\n        newPassword: '',\r\n        confirmPassword: ''\r\n      });\r\n      setIsChangingPassword(false);\r\n      \r\n    } catch (error) {\r\n      console.error('Erreur changement mot de passe:', error);\r\n      alert('Erreur lors du changement de mot de passe. Veuillez r√©essayer.');\r\n    }\r\n  };\r\n\r\n  const generateSecurePassword = () => {\r\n    const lowercase = 'abcdefghijklmnopqrstuvwxyz';\r\n    const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n    const numbers = '0123456789';\r\n    const symbols = '!@#$%^&*()_+-=[]{}|;:,.<>?';\r\n    \r\n    const allChars = lowercase + uppercase + numbers + symbols;\r\n    let password = '';\r\n    \r\n    // Assurer au moins un caract√®re de chaque type\r\n    password += lowercase[Math.floor(Math.random() * lowercase.length)];\r\n    password += uppercase[Math.floor(Math.random() * uppercase.length)];\r\n    password += numbers[Math.floor(Math.random() * numbers.length)];\r\n    password += symbols[Math.floor(Math.random() * symbols.length)];\r\n    \r\n    // Compl√©ter jusqu'√† 12 caract√®res\r\n    for (let i = 4; i < 12; i++) {\r\n      password += allChars[Math.floor(Math.random() * allChars.length)];\r\n    }\r\n    \r\n    // M√©langer les caract√®res\r\n    return password.split('').sort(() => Math.random() - 0.5).join('');\r\n  };\r\n\r\n  const handleGeneratePassword = () => {\r\n    const newPassword = generateSecurePassword();\r\n    setPasswordData(prev => ({\r\n      ...prev,\r\n      newPassword,\r\n      confirmPassword: newPassword\r\n    }));\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-2xl mx-auto p-6\">\r\n      <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm\">\r\n        {/* En-t√™te */}\r\n        <div className=\"p-6 border-b border-gray-200\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div className={`w-16 h-16 rounded-full flex items-center justify-center ${\r\n                userProfile.role === 'principal' ? 'bg-purple-100' :\r\n                userProfile.role === 'teacher' ? 'bg-green-100' :\r\n                userProfile.role === 'secretary' ? 'bg-blue-100' :\r\n                userProfile.role === 'student' ? 'bg-yellow-100' :\r\n                userProfile.role === 'parent' ? 'bg-pink-100' : 'bg-gray-100'\r\n              }`}>\r\n                <Icon \r\n                  name={\r\n                    userProfile.role === 'principal' ? 'Crown' :\r\n                    userProfile.role === 'teacher' ? 'GraduationCap' :\r\n                    userProfile.role === 'secretary' ? 'UserCheck' :\r\n                    userProfile.role === 'student' ? 'BookOpen' :\r\n                    userProfile.role === 'parent' ? 'Users' : 'User'\r\n                  } \r\n                  size={24} \r\n                  className={\r\n                    userProfile.role === 'principal' ? 'text-purple-600' :\r\n                    userProfile.role === 'teacher' ? 'text-green-600' :\r\n                    userProfile.role === 'secretary' ? 'text-blue-600' :\r\n                    userProfile.role === 'student' ? 'text-yellow-600' :\r\n                    userProfile.role === 'parent' ? 'text-pink-600' : 'text-gray-600'\r\n                  }\r\n                />\r\n              </div>\r\n              <div>\r\n                <h2 className=\"text-xl font-semibold text-gray-900\">{userProfile.full_name}</h2>\r\n                <p className=\"text-sm text-gray-500\">{userProfile.email}</p>\r\n                <div className=\"flex items-center space-x-2 mt-1\">\r\n                  <span className={`px-2 py-1 rounded-full text-xs font-medium ${\r\n                    userProfile.role === 'principal' ? 'bg-purple-100 text-purple-800' :\r\n                    userProfile.role === 'teacher' ? 'bg-green-100 text-green-800' :\r\n                    userProfile.role === 'secretary' ? 'bg-blue-100 text-blue-800' :\r\n                    userProfile.role === 'student' ? 'bg-yellow-100 text-yellow-800' :\r\n                    userProfile.role === 'parent' ? 'bg-pink-100 text-pink-800' : 'bg-gray-100 text-gray-800'\r\n                  }`}>\r\n                    {userProfile.role === 'principal' ? 'Directeur' :\r\n                     userProfile.role === 'teacher' ? 'Enseignant' :\r\n                     userProfile.role === 'secretary' ? 'Secr√©taire' :\r\n                     userProfile.role === 'student' ? '√âtudiant' :\r\n                     userProfile.role === 'parent' ? 'Parent' : userProfile.role}\r\n                  </span>\r\n                  {userProfile.position && (\r\n                    <span className=\"text-xs text-gray-500\">‚Ä¢ {userProfile.position}</span>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Informations du profil */}\r\n        <div className=\"p-6 border-b border-gray-200\">\r\n          <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Informations du profil</h3>\r\n          \r\n          {/* Informations de base communes */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Nom complet</label>\r\n              <p className=\"text-sm text-gray-900 bg-gray-50 p-2 rounded\">{userProfile.full_name}</p>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">Email</label>\r\n              <p className=\"text-sm text-gray-900 bg-gray-50 p-2 rounded\">{userProfile.email}</p>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">T√©l√©phone</label>\r\n              <p className=\"text-sm text-gray-900 bg-gray-50 p-2 rounded\">\r\n                {userProfile.phone || 'Non d√©fini'}\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">R√¥le</label>\r\n              <p className=\"text-sm text-gray-900 bg-gray-50 p-2 rounded\">\r\n                {userProfile.role === 'principal' ? 'Directeur d\\'√âtablissement' :\r\n                 userProfile.role === 'teacher' ? 'Enseignant' :\r\n                 userProfile.role === 'secretary' ? 'Secr√©taire' :\r\n                 userProfile.role === 'student' ? '√âtudiant' :\r\n                 userProfile.role === 'parent' ? 'Parent d\\'√âl√®ve' : userProfile.role}\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Informations sp√©cifiques selon le r√¥le */}\r\n          {userProfile.role === 'principal' && (\r\n            <div className=\"bg-purple-50 border border-purple-200 rounded-lg p-4 mb-4\">\r\n              <h4 className=\"font-medium text-purple-900 mb-3 flex items-center\">\r\n                <Icon name=\"Crown\" size={16} className=\"mr-2\" />\r\n                Informations Directeur\r\n              </h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-purple-700 mb-1\">√âtablissement</label>\r\n                  <p className=\"text-sm text-purple-900 bg-white p-2 rounded\">\r\n                    {userProfile.school_name || 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-purple-700 mb-1\">Exp√©rience</label>\r\n                  <p className=\"text-sm text-purple-900 bg-white p-2 rounded\">\r\n                    {userProfile.experience || 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-purple-700 mb-1\">Personnel g√©r√©</label>\r\n                  <p className=\"text-sm text-purple-900 bg-white p-2 rounded\">\r\n                    {userProfile.employees_count || 0} employ√©s\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-purple-700 mb-1\">√âl√®ves</label>\r\n                  <p className=\"text-sm text-purple-900 bg-white p-2 rounded\">\r\n                    {userProfile.students_count || 0} √©tudiants\r\n                  </p>\r\n                </div>\r\n                {userProfile.school_address && (\r\n                  <div className=\"md:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-purple-700 mb-1\">Adresse √©tablissement</label>\r\n                    <p className=\"text-sm text-purple-900 bg-white p-2 rounded\">\r\n                      {userProfile.school_address}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n                {userProfile.classes_managed && userProfile.classes_managed.length > 0 && (\r\n                  <div className=\"md:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-purple-700 mb-1\">Classes de l'√©tablissement</label>\r\n                    <div className=\"bg-white p-2 rounded\">\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {userProfile.classes_managed.map((classe, index) => (\r\n                          <span key={index} className=\"px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs\">\r\n                            {classe}\r\n                          </span>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {userProfile.role === 'teacher' && (\r\n            <div className=\"bg-green-50 border border-green-200 rounded-lg p-4 mb-4\">\r\n              <h4 className=\"font-medium text-green-900 mb-3 flex items-center\">\r\n                <Icon name=\"GraduationCap\" size={16} className=\"mr-2\" />\r\n                Informations Enseignant\r\n              </h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-green-700 mb-1\">Mati√®re enseign√©e</label>\r\n                  <p className=\"text-sm text-green-900 bg-white p-2 rounded\">\r\n                    {userProfile.subject || 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-green-700 mb-1\">Exp√©rience</label>\r\n                  <p className=\"text-sm text-green-900 bg-white p-2 rounded\">\r\n                    {userProfile.experience || 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-green-700 mb-1\">Nombre d'√©l√®ves</label>\r\n                  <p className=\"text-sm text-green-900 bg-white p-2 rounded\">\r\n                    {userProfile.students_count || 0} √©tudiants\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-green-700 mb-1\">Dipl√¥me</label>\r\n                  <p className=\"text-sm text-green-900 bg-white p-2 rounded\">\r\n                    {userProfile.degree || 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                {userProfile.classes && userProfile.classes.length > 0 && (\r\n                  <div className=\"md:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-green-700 mb-1\">Classes enseign√©es</label>\r\n                    <div className=\"bg-white p-2 rounded\">\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {userProfile.classes.map((classe, index) => (\r\n                          <span key={index} className=\"px-2 py-1 bg-green-100 text-green-800 rounded text-xs\">\r\n                            {classe}\r\n                          </span>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                {userProfile.specialization && (\r\n                  <div className=\"md:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-green-700 mb-1\">Sp√©cialisation</label>\r\n                    <p className=\"text-sm text-green-900 bg-white p-2 rounded\">\r\n                      {userProfile.specialization}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {userProfile.role === 'secretary' && (\r\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4\">\r\n              <h4 className=\"font-medium text-blue-900 mb-3 flex items-center\">\r\n                <Icon name=\"UserCheck\" size={16} className=\"mr-2\" />\r\n                Informations Secr√©taire\r\n              </h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-blue-700 mb-1\">Position</label>\r\n                  <p className=\"text-sm text-blue-900 bg-white p-2 rounded\">\r\n                    {userProfile.position || 'Secr√©taire'}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-blue-700 mb-1\">Exp√©rience</label>\r\n                  <p className=\"text-sm text-blue-900 bg-white p-2 rounded\">\r\n                    {userProfile.experience || 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-blue-700 mb-1\">Horaires</label>\r\n                  <p className=\"text-sm text-blue-900 bg-white p-2 rounded\">\r\n                    {userProfile.schedule || 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-blue-700 mb-1\">Sp√©cialisation</label>\r\n                  <p className=\"text-sm text-blue-900 bg-white p-2 rounded\">\r\n                    {userProfile.specialization || 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                {userProfile.permissions && userProfile.permissions.length > 0 && (\r\n                  <div className=\"md:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-blue-700 mb-1\">Permissions</label>\r\n                    <div className=\"bg-white p-2 rounded\">\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {userProfile.permissions.map((permission, index) => (\r\n                          <span key={index} className=\"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs\">\r\n                            {permission}\r\n                          </span>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {userProfile.role === 'student' && (\r\n            <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4\">\r\n              <h4 className=\"font-medium text-yellow-900 mb-3 flex items-center\">\r\n                <Icon name=\"BookOpen\" size={16} className=\"mr-2\" />\r\n                Informations √âtudiant\r\n              </h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-yellow-700 mb-1\">Classe</label>\r\n                  <p className=\"text-sm text-yellow-900 bg-white p-2 rounded\">\r\n                    {userProfile.class_name || 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-yellow-700 mb-1\">Num√©ro √©tudiant</label>\r\n                  <p className=\"text-sm text-yellow-900 bg-white p-2 rounded\">\r\n                    {userProfile.student_id || 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-yellow-700 mb-1\">Date de naissance</label>\r\n                  <p className=\"text-sm text-yellow-900 bg-white p-2 rounded\">\r\n                    {userProfile.birth_date ? new Date(userProfile.birth_date).toLocaleDateString('fr-FR') : 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-yellow-700 mb-1\">Genre</label>\r\n                  <p className=\"text-sm text-yellow-900 bg-white p-2 rounded\">\r\n                    {userProfile.gender === 'M' ? 'Masculin' : userProfile.gender === 'F' ? 'F√©minin' : 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-yellow-700 mb-1\">Moyenne g√©n√©rale</label>\r\n                  <p className=\"text-sm text-yellow-900 bg-white p-2 rounded\">\r\n                    {userProfile.average_grade || 'Non calcul√©e'}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-yellow-700 mb-1\">Taux de pr√©sence</label>\r\n                  <p className=\"text-sm text-yellow-900 bg-white p-2 rounded\">\r\n                    {userProfile.attendance_rate || 'Non calcul√©'}\r\n                  </p>\r\n                </div>\r\n                {userProfile.subjects && userProfile.subjects.length > 0 && (\r\n                  <div className=\"md:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-yellow-700 mb-1\">Mati√®res √©tudi√©es</label>\r\n                    <div className=\"bg-white p-2 rounded\">\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {userProfile.subjects.map((subject, index) => (\r\n                          <span key={index} className=\"px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs\">\r\n                            {subject}\r\n                          </span>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n              \r\n              {/* Section Parent/Tuteur - Visible et mise en avant */}\r\n              <div className=\"mt-4 pt-4 border-t border-yellow-300\">\r\n                <h5 className=\"font-medium text-yellow-900 mb-3 flex items-center\">\r\n                  <Icon name=\"Users\" size={16} className=\"mr-2\" />\r\n                  Informations Parent / Tuteur\r\n                </h5>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div className=\"bg-gradient-to-r from-yellow-100 to-orange-100 p-3 rounded-lg border border-yellow-300\">\r\n                    <div className=\"flex items-center space-x-3\">\r\n                      <div className=\"w-10 h-10 bg-yellow-200 rounded-full flex items-center justify-center\">\r\n                        <Icon name=\"User\" size={20} className=\"text-yellow-700\" />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-yellow-700 mb-1\">Nom complet</label>\r\n                        <p className=\"text-sm font-semibold text-yellow-900\">\r\n                          {userProfile.parent_name || 'Non d√©fini'}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"bg-gradient-to-r from-yellow-100 to-orange-100 p-3 rounded-lg border border-yellow-300\">\r\n                    <div className=\"flex items-center space-x-3\">\r\n                      <div className=\"w-10 h-10 bg-yellow-200 rounded-full flex items-center justify-center\">\r\n                        <Icon name=\"Phone\" size={20} className=\"text-yellow-700\" />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-yellow-700 mb-1\">T√©l√©phone</label>\r\n                        <p className=\"text-sm font-semibold text-yellow-900\">\r\n                          {userProfile.parent_phone || 'Non d√©fini'}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  {userProfile.parent_email && (\r\n                    <div className=\"bg-gradient-to-r from-yellow-100 to-orange-100 p-3 rounded-lg border border-yellow-300\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <div className=\"w-10 h-10 bg-yellow-200 rounded-full flex items-center justify-center\">\r\n                          <Icon name=\"Mail\" size={20} className=\"text-yellow-700\" />\r\n                        </div>\r\n                        <div>\r\n                          <label className=\"block text-xs font-medium text-yellow-700 mb-1\">Email</label>\r\n                          <p className=\"text-sm font-semibold text-yellow-900\">\r\n                            {userProfile.parent_email}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  {userProfile.parent_profession && (\r\n                    <div className=\"bg-gradient-to-r from-yellow-100 to-orange-100 p-3 rounded-lg border border-yellow-300\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <div className=\"w-10 h-10 bg-yellow-200 rounded-full flex items-center justify-center\">\r\n                          <Icon name=\"Briefcase\" size={20} className=\"text-yellow-700\" />\r\n                        </div>\r\n                        <div>\r\n                          <label className=\"block text-xs font-medium text-yellow-700 mb-1\">Profession</label>\r\n                          <p className=\"text-sm font-semibold text-yellow-900\">\r\n                            {userProfile.parent_profession}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <div className=\"mt-3 bg-blue-50 border border-blue-200 rounded-lg p-3\">\r\n                  <div className=\"flex items-start space-x-2\">\r\n                    <Icon name=\"Info\" size={16} className=\"text-blue-600 mt-0.5\" />\r\n                    <div>\r\n                      <p className=\"text-xs text-blue-900 font-medium\">Informations importantes</p>\r\n                      <p className=\"text-xs text-blue-700 mt-1\">\r\n                        En cas d'urgence ou pour toute question concernant votre scolarit√©, \r\n                        votre parent/tuteur peut √™tre contact√© aux coordonn√©es ci-dessus.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {userProfile.role === 'parent' && (\r\n            <div className=\"bg-pink-50 border border-pink-200 rounded-lg p-4 mb-4\">\r\n              <h4 className=\"font-medium text-pink-900 mb-3 flex items-center\">\r\n                <Icon name=\"Users\" size={16} className=\"mr-2\" />\r\n                Informations Parent\r\n              </h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-pink-700 mb-1\">Profession</label>\r\n                  <p className=\"text-sm text-pink-900 bg-white p-2 rounded\">\r\n                    {userProfile.profession || 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-pink-700 mb-1\">Contact d'urgence</label>\r\n                  <p className=\"text-sm text-pink-900 bg-white p-2 rounded\">\r\n                    {userProfile.emergency_contact || 'Non d√©fini'}\r\n                  </p>\r\n                </div>\r\n                {userProfile.address && (\r\n                  <div className=\"md:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-pink-700 mb-1\">Adresse</label>\r\n                    <p className=\"text-sm text-pink-900 bg-white p-2 rounded\">\r\n                      {userProfile.address}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n                {userProfile.children && userProfile.children.length > 0 && (\r\n                  <div className=\"md:col-span-2\">\r\n                    <label className=\"block text-sm font-medium text-pink-700 mb-1\">Enfants scolaris√©s</label>\r\n                    <div className=\"bg-white p-2 rounded space-y-2\">\r\n                      {userProfile.children.map((child, index) => (\r\n                        <div key={index} className=\"flex items-center justify-between p-2 bg-pink-50 rounded\">\r\n                          <div>\r\n                            <span className=\"font-medium text-pink-900\">{child.name}</span>\r\n                            <span className=\"text-sm text-pink-700 ml-2\">Classe: {child.class}</span>\r\n                          </div>\r\n                          <span className=\"text-sm text-pink-600\">Moyenne: {child.average}</span>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Certifications (si disponibles) */}\r\n          {userProfile.certifications && userProfile.certifications.length > 0 && (\r\n            <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4\">\r\n              <h4 className=\"font-medium text-gray-900 mb-3 flex items-center\">\r\n                <Icon name=\"Award\" size={16} className=\"mr-2\" />\r\n                Certifications & Formations\r\n              </h4>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {userProfile.certifications.map((cert, index) => (\r\n                  <span key={index} className=\"px-3 py-1 bg-white border border-gray-300 text-gray-700 rounded-full text-sm\">\r\n                    {cert}\r\n                  </span>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Changement de mot de passe */}\r\n        <div className=\"p-6\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h3 className=\"text-lg font-medium text-gray-900\">S√©curit√© du compte</h3>\r\n            {!isChangingPassword && (\r\n              <Button\r\n                onClick={() => setIsChangingPassword(true)}\r\n                className=\"bg-blue-600 hover:bg-blue-700\"\r\n              >\r\n                <Icon name=\"Lock\" size={16} className=\"mr-2\" />\r\n                Changer le mot de passe\r\n              </Button>\r\n            )}\r\n          </div>\r\n\r\n          {isChangingPassword ? (\r\n            <div className=\"space-y-6\">\r\n              {/* Formulaire de changement de mot de passe */}\r\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n                <div className=\"flex items-start space-x-3\">\r\n                  <Icon name=\"Info\" size={20} className=\"text-blue-600 mt-1\" />\r\n                  <div>\r\n                    <h4 className=\"font-medium text-blue-900\">Changement de mot de passe</h4>\r\n                    <p className=\"text-sm text-blue-700 mt-1\">\r\n                      Pour votre s√©curit√©, votre nouveau mot de passe doit respecter tous les crit√®res list√©s ci-dessous.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <Input\r\n                    label=\"Mot de passe actuel\"\r\n                    type={showPasswords.current ? \"text\" : \"password\"}\r\n                    value={passwordData.currentPassword}\r\n                    onChange={(e) => setPasswordData(prev => ({ ...prev, currentPassword: e.target.value }))}\r\n                    placeholder=\"Saisissez votre mot de passe actuel\"\r\n                    rightIcon={\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowPasswords(prev => ({ ...prev, current: !prev.current }))}\r\n                        className=\"text-gray-400 hover:text-gray-600\"\r\n                      >\r\n                        <Icon name={showPasswords.current ? \"EyeOff\" : \"Eye\"} size={16} />\r\n                      </button>\r\n                    }\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <Input\r\n                    label=\"Nouveau mot de passe\"\r\n                    type={showPasswords.new ? \"text\" : \"password\"}\r\n                    value={passwordData.newPassword}\r\n                    onChange={(e) => setPasswordData(prev => ({ ...prev, newPassword: e.target.value }))}\r\n                    placeholder=\"Saisissez votre nouveau mot de passe\"\r\n                    rightIcon={\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowPasswords(prev => ({ ...prev, new: !prev.new }))}\r\n                        className=\"text-gray-400 hover:text-gray-600\"\r\n                      >\r\n                        <Icon name={showPasswords.new ? \"EyeOff\" : \"Eye\"} size={16} />\r\n                      </button>\r\n                    }\r\n                  />\r\n                  \r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={handleGeneratePassword}\r\n                    className=\"mt-2\"\r\n                  >\r\n                    <Icon name=\"Shuffle\" size={14} className=\"mr-2\" />\r\n                    G√©n√©rer un mot de passe s√©curis√©\r\n                  </Button>\r\n                </div>\r\n\r\n                <div>\r\n                  <Input\r\n                    label=\"Confirmer le nouveau mot de passe\"\r\n                    type={showPasswords.confirm ? \"text\" : \"password\"}\r\n                    value={passwordData.confirmPassword}\r\n                    onChange={(e) => setPasswordData(prev => ({ ...prev, confirmPassword: e.target.value }))}\r\n                    placeholder=\"Confirmez votre nouveau mot de passe\"\r\n                    rightIcon={\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowPasswords(prev => ({ ...prev, confirm: !prev.confirm }))}\r\n                        className=\"text-gray-400 hover:text-gray-600\"\r\n                      >\r\n                        <Icon name={showPasswords.confirm ? \"EyeOff\" : \"Eye\"} size={16} />\r\n                      </button>\r\n                    }\r\n                  />\r\n                </div>\r\n\r\n                {/* Crit√®res de s√©curit√© */}\r\n                {passwordData.newPassword && (\r\n                  <div className=\"bg-gray-50 rounded-lg p-4\">\r\n                    <h4 className=\"font-medium text-gray-900 mb-3\">Crit√®res de s√©curit√©</h4>\r\n                    <div className=\"space-y-2\">\r\n                      {[\r\n                        { key: 'minLength', label: 'Au moins 8 caract√®res' },\r\n                        { key: 'hasUpper', label: 'Au moins une lettre majuscule (A-Z)' },\r\n                        { key: 'hasLower', label: 'Au moins une lettre minuscule (a-z)' },\r\n                        { key: 'hasNumber', label: 'Au moins un chiffre (0-9)' },\r\n                        { key: 'hasSpecial', label: 'Au moins un caract√®re sp√©cial (!@#$...)' },\r\n                      ].map(({ key, label }) => (\r\n                        <div key={key} className=\"flex items-center space-x-2\">\r\n                          <Icon\r\n                            name={passwordValidation.criteria[key] ? \"CheckCircle\" : \"XCircle\"}\r\n                            size={16}\r\n                            className={passwordValidation.criteria[key] ? \"text-green-600\" : \"text-red-500\"}\r\n                          />\r\n                          <span className={`text-sm ${passwordValidation.criteria[key] ? \"text-green-700\" : \"text-red-600\"}`}>\r\n                            {label}\r\n                          </span>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Correspondance des mots de passe */}\r\n                {passwordData.newPassword && passwordData.confirmPassword && (\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <Icon\r\n                      name={passwordData.newPassword === passwordData.confirmPassword ? \"CheckCircle\" : \"XCircle\"}\r\n                      size={16}\r\n                      className={passwordData.newPassword === passwordData.confirmPassword ? \"text-green-600\" : \"text-red-500\"}\r\n                    />\r\n                    <span className={`text-sm ${passwordData.newPassword === passwordData.confirmPassword ? \"text-green-700\" : \"text-red-600\"}`}>\r\n                      Les mots de passe {passwordData.newPassword === passwordData.confirmPassword ? \"correspondent\" : \"ne correspondent pas\"}\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Actions */}\r\n              <div className=\"flex justify-end space-x-4 pt-4 border-t border-gray-200\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  onClick={() => {\r\n                    setIsChangingPassword(false);\r\n                    setPasswordData({\r\n                      currentPassword: '',\r\n                      newPassword: '',\r\n                      confirmPassword: ''\r\n                    });\r\n                  }}\r\n                >\r\n                  Annuler\r\n                </Button>\r\n                <Button\r\n                  onClick={handlePasswordChange}\r\n                  disabled={!passwordValidation.isValid || passwordData.newPassword !== passwordData.confirmPassword}\r\n                  className=\"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300\"\r\n                >\r\n                  <Icon name=\"Save\" size={16} className=\"mr-2\" />\r\n                  Changer le mot de passe\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <Icon name=\"Shield\" size={20} className=\"text-green-600\" />\r\n                  <div>\r\n                    <h4 className=\"font-medium text-green-900\">S√©curit√© du compte</h4>\r\n                    <p className=\"text-sm text-green-700\">\r\n                      Votre compte est s√©curis√©. Changez r√©guli√®rement votre mot de passe pour maintenir la s√©curit√©.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"text-sm text-gray-600\">\r\n                <p><strong>Recommandations de s√©curit√© :</strong></p>\r\n                <ul className=\"mt-2 space-y-1 list-disc list-inside\">\r\n                  <li>Changez votre mot de passe tous les 3 mois</li>\r\n                  <li>Utilisez un mot de passe unique pour cette plateforme</li>\r\n                  <li>Ne partagez jamais vos identifiants</li>\r\n                  <li>D√©connectez-vous apr√®s chaque session</li>\r\n                </ul>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Zone de danger - Suppression de compte */}\r\n        <DangerZone userRole={userProfile?.role} userId={user?.id} userEmail={user?.email} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Composant Zone de danger pour la suppression de compte\r\nconst DangerZone = ({ userRole, userId, userEmail }) => {\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [deleteConfirmText, setDeleteConfirmText] = useState('');\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  const [deleteError, setDeleteError] = useState(null);\r\n\r\n  const handleDeleteAccount = async () => {\r\n    if (deleteConfirmText !== 'SUPPRIMER MON COMPTE') {\r\n      alert('Veuillez taper exactement \"SUPPRIMER MON COMPTE\" pour confirmer');\r\n      return;\r\n    }\r\n\r\n    setIsDeleting(true);\r\n    setDeleteError(null);\r\n\r\n    try {\r\n      const { supabase } = await import('../../lib/supabase');\r\n      \r\n      // 1. Supprimer toutes les donn√©es li√©es √† l'utilisateur\r\n      if (userRole === 'principal') {\r\n        // R√©cup√©rer l'√©cole du directeur\r\n        const { data: userData, error: userDataError } = await supabase\r\n          .from('users')\r\n          .select('current_school_id')\r\n          .eq('id', userId)\r\n          .single();\r\n\r\n        if (userDataError) {\r\n          console.error('‚ùå Erreur lors de la r√©cup√©ration des donn√©es utilisateur:', userDataError);\r\n          throw new Error(`Impossible de r√©cup√©rer les donn√©es utilisateur: ${userDataError.message}`);\r\n        }\r\n\r\n        if (userData?.current_school_id) {\r\n          const schoolId = userData.current_school_id;\r\n          \r\n          console.log('üóëÔ∏è D√©but de la suppression compl√®te de l\\'√©cole et de toutes ses donn√©es...');\r\n          console.log(`üìã √âcole ID: ${schoolId}`);\r\n          \r\n          // ORDRE DE SUPPRESSION (inverse des d√©pendances)\r\n          // ================================================\r\n          \r\n          try {\r\n            // 1Ô∏è‚É£ DONN√âES TRANSACTIONNELLES (notes, pr√©sences, paiements)\r\n            console.log('1/7 Suppression des notes...');\r\n            const { error: gradesError } = await supabase.from('grades').delete().eq('school_id', schoolId);\r\n            if (gradesError) console.error('Erreur suppression notes:', gradesError);\r\n            \r\n            console.log('2/7 Suppression des pr√©sences...');\r\n            const { error: attendancesError } = await supabase.from('attendances').delete().eq('school_id', schoolId);\r\n            if (attendancesError) console.error('Erreur suppression pr√©sences:', attendancesError);\r\n            \r\n            console.log('3/7 Suppression des paiements...');\r\n            const { error: paymentsError } = await supabase.from('payments').delete().eq('school_id', schoolId);\r\n            if (paymentsError) console.error('Erreur suppression paiements:', paymentsError);\r\n          \r\n            \r\n            // 2Ô∏è‚É£ COMMUNICATIONS & LOGS\r\n            console.log('4/7 Suppression des notifications...');\r\n            const { error: notificationsError } = await supabase.from('notifications').delete().eq('school_id', schoolId);\r\n            if (notificationsError) console.error('Erreur suppression notifications:', notificationsError);\r\n            \r\n            console.log('   Suppression des communications...');\r\n            const { error: communicationsError } = await supabase.from('communications').delete().eq('school_id', schoolId);\r\n            if (communicationsError) console.error('Erreur suppression communications:', communicationsError);\r\n            \r\n            console.log('   Suppression des mod√®les de messages...');\r\n            const { error: templatesError } = await supabase.from('message_templates').delete().eq('school_id', schoolId);\r\n            if (templatesError) console.error('Erreur suppression mod√®les messages:', templatesError);\r\n            \r\n            console.log('   Suppression des logs d\\'audit...');\r\n            const { error: auditError } = await supabase.from('audit_logs').delete().eq('school_id', schoolId);\r\n            if (auditError) console.error('Erreur suppression audit logs:', auditError);\r\n            \r\n            // 3Ô∏è‚É£ RELATIONS (class_subjects, teacher_subjects, parent-student)\r\n            console.log('   Suppression des relations classes-mati√®res...');\r\n            const { error: classSubjectsError } = await supabase.from('class_subjects').delete().eq('school_id', schoolId);\r\n            if (classSubjectsError) console.error('Erreur suppression class_subjects:', classSubjectsError);\r\n            \r\n            console.log('   Suppression des relations enseignants-mati√®res...');\r\n            const { error: teacherSubjectsError } = await supabase.from('teacher_subjects').delete().eq('school_id', schoolId);\r\n            if (teacherSubjectsError) console.error('Erreur suppression teacher_subjects:', teacherSubjectsError);\r\n            \r\n            console.log('   Suppression des relations parents-√©tudiants...');\r\n            const { error: parentStudentError } = await supabase.from('parent_student_schools').delete().eq('school_id', schoolId);\r\n            if (parentStudentError) console.error('Erreur suppression parent_student_schools:', parentStudentError);          // 4Ô∏è‚É£ UTILISATEURS (√©tudiants, enseignants, parents, secr√©taires)\r\n          console.log('5/7 Suppression des √©tudiants...');\r\n          const { data: students, error: studentsSelectError } = await supabase\r\n            .from('students')\r\n            .select('user_id')\r\n            .eq('school_id', schoolId);\r\n          \r\n          if (studentsSelectError) console.error('Erreur r√©cup√©ration √©tudiants:', studentsSelectError);\r\n          \r\n          const { error: studentsDeleteError } = await supabase.from('students').delete().eq('school_id', schoolId);\r\n          if (studentsDeleteError) console.error('Erreur suppression √©tudiants:', studentsDeleteError);\r\n          \r\n          console.log('   Suppression des enseignants...');\r\n          const { data: teachers, error: teachersSelectError } = await supabase\r\n            .from('teachers')\r\n            .select('user_id')\r\n            .eq('school_id', schoolId);\r\n          \r\n          if (teachersSelectError) console.error('Erreur r√©cup√©ration enseignants:', teachersSelectError);\r\n          \r\n          const { error: teachersDeleteError } = await supabase.from('teachers').delete().eq('school_id', schoolId);\r\n          if (teachersDeleteError) console.error('Erreur suppression enseignants:', teachersDeleteError);\r\n          \r\n          console.log('   Suppression des parents...');\r\n          const { data: parents, error: parentsSelectError } = await supabase\r\n            .from('parents')\r\n            .select('user_id')\r\n            .eq('school_id', schoolId);\r\n          \r\n          if (parentsSelectError) console.error('Erreur r√©cup√©ration parents:', parentsSelectError);\r\n          \r\n          const { error: parentsDeleteError } = await supabase.from('parents').delete().eq('school_id', schoolId);\r\n          if (parentsDeleteError) console.error('Erreur suppression parents:', parentsDeleteError);\r\n          \r\n          console.log('   Suppression des secr√©taires...');\r\n          const { data: secretaries, error: secretariesSelectError } = await supabase\r\n            .from('secretaries')\r\n            .select('user_id')\r\n            .eq('school_id', schoolId);\r\n          \r\n          if (secretariesSelectError) console.error('Erreur r√©cup√©ration secr√©taires:', secretariesSelectError);\r\n          \r\n          const { error: secretariesDeleteError } = await supabase.from('secretaries').delete().eq('school_id', schoolId);\r\n          if (secretariesDeleteError) console.error('Erreur suppression secr√©taires:', secretariesDeleteError);\r\n          \r\n          // Supprimer les comptes users li√©s (sauf le directeur)\r\n          const userIdsToDelete = [\r\n            ...(students?.map(s => s.user_id) || []),\r\n            ...(teachers?.map(t => t.user_id) || []),\r\n            ...(parents?.map(p => p.user_id) || []),\r\n            ...(secretaries?.map(s => s.user_id) || [])\r\n          ].filter(id => id && id !== userId);\r\n          \r\n          if (userIdsToDelete.length > 0) {\r\n            console.log(`   Suppression de ${userIdsToDelete.length} comptes utilisateurs li√©s...`);\r\n            const { error: usersDeleteError } = await supabase.from('users').delete().in('id', userIdsToDelete);\r\n            if (usersDeleteError) console.error('Erreur suppression comptes users:', usersDeleteError);\r\n          }\r\n          \r\n            // 5Ô∏è‚É£ CONFIGURATION (mati√®res, classes, p√©riodes)\r\n            console.log('6/7 Suppression des mati√®res...');\r\n            const { error: subjectsError } = await supabase.from('subjects').delete().eq('school_id', schoolId);\r\n            if (subjectsError) console.error('Erreur suppression mati√®res:', subjectsError);\r\n            \r\n            console.log('   Suppression des classes...');\r\n            const { error: classesError } = await supabase.from('classes').delete().eq('school_id', schoolId);\r\n            if (classesError) console.error('Erreur suppression classes:', classesError);\r\n            \r\n            console.log('   Suppression des p√©riodes d\\'√©valuation...');\r\n            const { error: evaluationPeriodsError } = await supabase.from('evaluation_periods').delete().eq('school_id', schoolId);\r\n            if (evaluationPeriodsError) console.error('Erreur suppression p√©riodes √©valuation:', evaluationPeriodsError);\r\n            \r\n            console.log('   Suppression des ann√©es acad√©miques...');\r\n            const { error: academicYearsError } = await supabase.from('academic_years').delete().eq('school_id', schoolId);\r\n            if (academicYearsError) console.error('Erreur suppression ann√©es acad√©miques:', academicYearsError);\r\n            \r\n            // 6Ô∏è‚É£ TYPES (grade_types, attendance_types, payment_types)\r\n            console.log('   Suppression des types de notes...');\r\n            const { error: gradeTypesError } = await supabase.from('grade_types').delete().eq('school_id', schoolId);\r\n            if (gradeTypesError) console.error('Erreur suppression types notes:', gradeTypesError);\r\n            \r\n            console.log('   Suppression des types de pr√©sences...');\r\n            const { error: attendanceTypesError } = await supabase.from('attendance_types').delete().eq('school_id', schoolId);\r\n            if (attendanceTypesError) console.error('Erreur suppression types pr√©sences:', attendanceTypesError);\r\n            \r\n            console.log('   Suppression des types de paiements...');\r\n            const { error: paymentTypesError } = await supabase.from('payment_types').delete().eq('school_id', schoolId);\r\n            if (paymentTypesError) console.error('Erreur suppression types paiements:', paymentTypesError);\r\n            \r\n            console.log('   Suppression des r√¥les utilisateurs...');\r\n            const { error: userRolesError } = await supabase.from('user_roles').delete().eq('school_id', schoolId);\r\n            if (userRolesError) console.error('Erreur suppression r√¥les utilisateurs:', userRolesError);\r\n            \r\n            // 7Ô∏è‚É£ √âCOLE\r\n            console.log('7/7 Suppression de l\\'√©cole...');\r\n            const { error: schoolError } = await supabase.from('schools').delete().eq('id', schoolId);\r\n            if (schoolError) {\r\n              console.error('‚ùå ERREUR CRITIQUE - Impossible de supprimer l\\'√©cole:', schoolError);\r\n              throw new Error(`√âchec de suppression de l'√©cole: ${schoolError.message}`);\r\n            }\r\n            \r\n            console.log('‚úÖ Toutes les donn√©es de l\\'√©cole ont √©t√© supprim√©es avec succ√®s !');\r\n          \r\n          } catch (schoolDeletionError) {\r\n            console.error('‚ùå ERREUR pendant la suppression des donn√©es √©cole:', schoolDeletionError);\r\n            throw new Error(`Erreur lors de la suppression des donn√©es de l'√©cole: ${schoolDeletionError.message}`);\r\n          }\r\n        } else {\r\n          console.log('‚ö†Ô∏è Aucune √©cole associ√©e trouv√©e pour ce directeur');\r\n        }\r\n      }\r\n\r\n      // 2. Supprimer les r√©f√©rences sp√©cifiques √† cet utilisateur (hors √©cole)\r\n      console.log('üóëÔ∏è Nettoyage des r√©f√©rences utilisateur...');\r\n      \r\n      // Pour les enseignants, parents, √©tudiants, secr√©taires: D√âSACTIVER au lieu de supprimer\r\n      // Car les donn√©es appartiennent √† l'√©tablissement, pas √† l'utilisateur\r\n      if (['teacher', 'parent', 'student', 'secretary'].includes(userRole)) {\r\n        console.log(`üìã R√¥le ${userRole}: D√©sactivation au lieu de suppression`);\r\n        \r\n        // 1. D√©sactiver dans la table users\r\n        const { error: userDeactivateError } = await supabase\r\n          .from('users')\r\n          .update({ \r\n            is_active: false,\r\n            email: `deleted_${Date.now()}_${userId.substring(0, 8)}@deleted.local`,\r\n            phone: null,\r\n            updated_at: new Date().toISOString()\r\n          })\r\n          .eq('id', userId);\r\n\r\n        if (userDeactivateError) {\r\n          console.error('Erreur d√©sactivation user:', userDeactivateError);\r\n          throw userDeactivateError;\r\n        }\r\n\r\n        // 2. D√©sactiver dans les tables sp√©cifiques\r\n        if (userRole === 'teacher') {\r\n          await supabase\r\n            .from('teachers')\r\n            .update({ is_active: false, updated_at: new Date().toISOString() })\r\n            .eq('user_id', userId);\r\n          \r\n          // D√©sactiver les assignations (ne pas supprimer)\r\n          await supabase\r\n            .from('teacher_assignments')\r\n            .update({ is_active: false, end_date: new Date().toISOString() })\r\n            .eq('teacher_id', userId);\r\n        } else if (userRole === 'parent') {\r\n          await supabase\r\n            .from('parents')\r\n            .update({ is_active: false, updated_at: new Date().toISOString() })\r\n            .eq('user_id', userId);\r\n        } else if (userRole === 'student') {\r\n          await supabase\r\n            .from('students')\r\n            .update({ is_active: false, updated_at: new Date().toISOString() })\r\n            .eq('user_id', userId);\r\n        } else if (userRole === 'secretary') {\r\n          await supabase\r\n            .from('secretaries')\r\n            .update({ is_active: false, updated_at: new Date().toISOString() })\r\n            .eq('user_id', userId);\r\n        }\r\n\r\n        console.log('‚úÖ Compte d√©sactiv√©. Les donn√©es de l\\'√©tablissement sont pr√©serv√©es.');\r\n        \r\n        // NE PAS supprimer:\r\n        // - Les notes cr√©√©es par l'enseignant\r\n        // - Les pr√©sences enregistr√©es\r\n        // - Les documents cr√©√©s\r\n        // - Les communications envoy√©es\r\n        // Ces donn√©es appartiennent √† l'√©tablissement\r\n        \r\n      } else {\r\n        // Pour les autres r√¥les (si existants), suppression compl√®te\r\n        console.log('‚ö†Ô∏è Suppression compl√®te pour ce type de compte');\r\n        \r\n        // Supprimer les mod√®les de messages cr√©√©s par cet utilisateur\r\n        await supabase.from('message_templates').delete().eq('created_by', userId);\r\n        \r\n        // Supprimer les communications envoy√©es par cet utilisateur  \r\n        await supabase.from('communications').delete().eq('sent_by_user_id', userId);\r\n        \r\n        // Supprimer les notifications cr√©√©es par cet utilisateur\r\n        await supabase.from('notifications').delete().eq('created_by_user_id', userId);\r\n\r\n        // Supprimer l'utilisateur de la table users\r\n        const { error: userDeleteError } = await supabase\r\n          .from('users')\r\n          .delete()\r\n          .eq('id', userId);\r\n\r\n        if (userDeleteError) throw userDeleteError;\r\n      }\r\n\r\n      // 3. Supprimer/d√©sactiver le compte Supabase Auth\r\n      // Pour tous les r√¥les: supprimer l'auth (ils ne pourront plus se connecter)\r\n      const { error: authDeleteError } = await supabase.auth.admin.deleteUser(userId);\r\n      \r\n      if (authDeleteError) {\r\n        console.warn('Impossible de supprimer le compte auth:', authDeleteError);\r\n        // Continuer quand m√™me pour d√©connecter l'utilisateur\r\n      }\r\n\r\n      // 4. D√©connecter l'utilisateur\r\n      await supabase.auth.signOut();\r\n\r\n      // 5. Message et redirection selon le type de suppression\r\n      if (['teacher', 'parent', 'student', 'secretary'].includes(userRole)) {\r\n        alert('‚úÖ Votre compte a √©t√© d√©sactiv√©. Vous ne pourrez plus vous connecter mais l\\'historique de l\\'√©tablissement est pr√©serv√©.');\r\n      } else {\r\n        alert('‚úÖ Votre compte a √©t√© supprim√© avec succ√®s. Toutes vos donn√©es ont √©t√© effac√©es.');\r\n      }\r\n      \r\n      // 6. Rediriger vers la page d'accueil\r\n      window.location.href = '/';\r\n\r\n    } catch (error) {\r\n      console.error('‚ùå Erreur lors de la suppression du compte:', error);\r\n      setDeleteError(error.message || 'Une erreur est survenue lors de la suppression du compte');\r\n      setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"bg-white rounded-lg border-2 border-red-200 shadow-sm p-6\">\r\n        <div className=\"flex items-start space-x-4\">\r\n          <div className=\"flex-shrink-0\">\r\n            <div className=\"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center\">\r\n              <Icon name=\"AlertTriangle\" size={24} className=\"text-red-600\" />\r\n            </div>\r\n          </div>\r\n          <div className=\"flex-1\">\r\n            <h2 className=\"text-xl font-bold text-red-900 mb-2\">Zone de danger</h2>\r\n            <p className=\"text-gray-700 mb-4\">\r\n              La suppression de votre compte est <strong>irr√©versible</strong>. Toutes vos donn√©es seront d√©finitivement effac√©es.\r\n            </p>\r\n\r\n            {userRole === 'principal' && (\r\n              <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-4\">\r\n                <div className=\"flex items-start space-x-3\">\r\n                  <Icon name=\"AlertCircle\" size={20} className=\"text-red-600 mt-0.5\" />\r\n                  <div>\r\n                    <h4 className=\"font-medium text-red-900 mb-1\">‚ö†Ô∏è ATTENTION - Compte Directeur</h4>\r\n                    <p className=\"text-sm text-red-700 mb-2\">\r\n                      La suppression de votre compte entra√Ænera la <strong>suppression D√âFINITIVE et IRR√âVERSIBLE</strong> de :\r\n                    </p>\r\n                    <div className=\"grid grid-cols-2 gap-2 text-sm text-red-700\">\r\n                      <div>\r\n                        <p className=\"font-semibold mb-1\">üë• Comptes utilisateurs :</p>\r\n                        <ul className=\"list-disc list-inside space-y-0.5 ml-2\">\r\n                          <li>Tous les √©tudiants</li>\r\n                          <li>Tous les enseignants</li>\r\n                          <li>Tous les parents</li>\r\n                          <li>Tous les secr√©taires</li>\r\n                        </ul>\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"font-semibold mb-1\">üìä Donn√©es p√©dagogiques :</p>\r\n                        <ul className=\"list-disc list-inside space-y-0.5 ml-2\">\r\n                          <li>Toutes les notes</li>\r\n                          <li>Toutes les pr√©sences</li>\r\n                          <li>Tous les paiements</li>\r\n                          <li>Toutes les notifications</li>\r\n                        </ul>\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"font-semibold mb-1\">üè´ Structure de l'√©cole :</p>\r\n                        <ul className=\"list-disc list-inside space-y-0.5 ml-2\">\r\n                          <li>Toutes les classes</li>\r\n                          <li>Toutes les mati√®res</li>\r\n                          <li>Ann√©es acad√©miques</li>\r\n                          <li>P√©riodes d'√©valuation</li>\r\n                        </ul>\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"font-semibold mb-1\">‚öôÔ∏è Configuration :</p>\r\n                        <ul className=\"list-disc list-inside space-y-0.5 ml-2\">\r\n                          <li>Types de notes</li>\r\n                          <li>Types de pr√©sences</li>\r\n                          <li>Types de paiements</li>\r\n                          <li>Logs d'audit</li>\r\n                        </ul>\r\n                      </div>\r\n                    </div>\r\n                    <p className=\"text-sm text-red-800 font-bold mt-3 bg-red-100 px-3 py-2 rounded border border-red-300\">\r\n                      üè¢ L'√©cole enti√®re sera supprim√©e d√©finitivement !\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\r\n                <Icon name=\"Info\" size={16} className=\"text-gray-500\" />\r\n                <span>Email du compte : <strong>{userEmail}</strong></span>\r\n              </div>\r\n\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={() => setShowDeleteModal(true)}\r\n                className=\"border-red-300 text-red-700 hover:bg-red-50 hover:border-red-400\"\r\n              >\r\n                <Icon name=\"Trash2\" size={16} className=\"mr-2\" />\r\n                Supprimer d√©finitivement mon compte\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modal de confirmation de suppression */}\r\n      {showDeleteModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white rounded-xl shadow-2xl max-w-md w-full p-6\">\r\n            <div className=\"text-center mb-6\">\r\n              <div className=\"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-4\">\r\n                <Icon name=\"AlertTriangle\" size={32} className=\"text-red-600\" />\r\n              </div>\r\n              <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">\r\n                Confirmer la suppression\r\n              </h3>\r\n              <p className=\"text-gray-600\">\r\n                Cette action est <strong className=\"text-red-600\">d√©finitive et irr√©versible</strong>.\r\n              </p>\r\n            </div>\r\n\r\n            {deleteError && (\r\n              <div className=\"mb-4 bg-red-50 border border-red-200 rounded-lg p-3\">\r\n                <p className=\"text-sm text-red-700\">{deleteError}</p>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-4\">\r\n              <p className=\"text-sm text-red-800 font-medium mb-2\">\r\n                Pour confirmer, tapez exactement :\r\n              </p>\r\n              <p className=\"text-lg font-mono font-bold text-red-900 bg-white px-3 py-2 rounded border border-red-300\">\r\n                SUPPRIMER MON COMPTE\r\n              </p>\r\n            </div>\r\n\r\n            <Input\r\n              value={deleteConfirmText}\r\n              onChange={(e) => setDeleteConfirmText(e.target.value)}\r\n              placeholder=\"Tapez ici...\"\r\n              className=\"mb-6\"\r\n              disabled={isDeleting}\r\n            />\r\n\r\n            <div className=\"flex space-x-3\">\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={() => {\r\n                  setShowDeleteModal(false);\r\n                  setDeleteConfirmText('');\r\n                  setDeleteError(null);\r\n                }}\r\n                disabled={isDeleting}\r\n                className=\"flex-1\"\r\n              >\r\n                Annuler\r\n              </Button>\r\n              <Button\r\n                onClick={handleDeleteAccount}\r\n                disabled={deleteConfirmText !== 'SUPPRIMER MON COMPTE' || isDeleting}\r\n                className=\"flex-1 bg-red-600 hover:bg-red-700 disabled:bg-gray-300 text-white\"\r\n              >\r\n                {isDeleting ? (\r\n                  <>\r\n                    <Icon name=\"Loader\" size={16} className=\"mr-2 animate-spin\" />\r\n                    Suppression...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Icon name=\"Trash2\" size={16} className=\"mr-2\" />\r\n                    Supprimer d√©finitivement\r\n                  </>\r\n                )}\r\n              </Button>\r\n            </div>\r\n\r\n            <p className=\"text-xs text-gray-500 text-center mt-4\">\r\n              Cette action supprimera toutes vos donn√©es de mani√®re permanente\r\n            </p>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ProfileSettings;"],"file":"assets/index-C1h2SCqI.js"}