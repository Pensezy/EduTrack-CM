{"version":3,"file":"documentService-BNZuJcP9.js","sources":["../../src/services/pdfGenerator.js","../../src/services/documentService.js"],"sourcesContent":["/**\r\n * Service de g√©n√©ration de documents PDF\r\n * Utilise jsPDF pour cr√©er des documents administratifs scolaires\r\n */\r\nimport { jsPDF } from 'jspdf';\r\n\r\nclass PDFGenerator {\r\n  constructor() {\r\n    this.pageWidth = 210; // A4 width in mm\r\n    this.pageHeight = 297; // A4 height in mm\r\n    this.margin = 20;\r\n  }\r\n\r\n  /**\r\n   * Formate une date pour l'affichage\r\n   */\r\n  formatDate(dateValue) {\r\n    if (!dateValue) return '__/__/____';\r\n    \r\n    try {\r\n      const date = new Date(dateValue);\r\n      if (isNaN(date.getTime())) return '__/__/____';\r\n      \r\n      return date.toLocaleDateString('fr-FR', {\r\n        day: '2-digit',\r\n        month: '2-digit', \r\n        year: 'numeric'\r\n      });\r\n    } catch {\r\n      return '__/__/____';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * R√©cup√®re la date de naissance depuis diff√©rents champs possibles\r\n   */\r\n  getBirthDate(student) {\r\n    return student?.date_of_birth || student?.birth_date || student?.birthdate || student?.dateOfBirth;\r\n  }\r\n\r\n  /**\r\n   * G√©n√®re un certificat de scolarit√©\r\n   */\r\n  generateCertificatScolarite(data) {\r\n    const { student, school, academicYear } = data;\r\n    const doc = new jsPDF();\r\n    \r\n    // En-t√™te √©cole\r\n    doc.setFontSize(16);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text(school?.name || '√âcole', this.pageWidth / 2, 30, { align: 'center' });\r\n    \r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(school?.address || '', this.pageWidth / 2, 38, { align: 'center' });\r\n    doc.text(`${school?.city || ''}, ${school?.country || 'Cameroun'}`, this.pageWidth / 2, 44, { align: 'center' });\r\n    \r\n    // Ligne de s√©paration\r\n    doc.setLineWidth(0.5);\r\n    doc.line(this.margin, 52, this.pageWidth - this.margin, 52);\r\n    \r\n    // Titre du document\r\n    doc.setFontSize(18);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('CERTIFICAT DE SCOLARIT√â', this.pageWidth / 2, 70, { align: 'center' });\r\n    \r\n    doc.setFontSize(12);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Ann√©e scolaire ${academicYear || new Date().getFullYear() + '-' + (new Date().getFullYear() + 1)}`, this.pageWidth / 2, 80, { align: 'center' });\r\n    \r\n    // Corps du certificat\r\n    doc.setFontSize(12);\r\n    const startY = 100;\r\n    const lineHeight = 10;\r\n    \r\n    doc.text('Je soussign√©(e), Directeur(trice) de l\\'√©tablissement scolaire mentionn√© ci-dessus,', this.margin, startY);\r\n    doc.text('certifie que :', this.margin, startY + lineHeight);\r\n    \r\n    doc.setFont('helvetica', 'bold');\r\n    const studentName = `${student?.last_name || ''} ${student?.first_name || ''}`.trim() || 'Nom de l\\'√©l√®ve';\r\n    doc.text(`L'√©l√®ve : ${studentName}`, this.margin, startY + lineHeight * 3);\r\n    \r\n    doc.setFont('helvetica', 'normal');\r\n    const birthDate = this.formatDate(this.getBirthDate(student));\r\n    doc.text(`N√©(e) le : ${birthDate}`, this.margin, startY + lineHeight * 4);\r\n    doc.text(`Lieu de naissance : ${student?.birth_place || student?.place_of_birth || '________'}`, this.margin + 80, startY + lineHeight * 4);\r\n    doc.text(`Classe : ${student?.class_name || '________'}`, this.margin, startY + lineHeight * 5);\r\n    doc.text(`Matricule : ${student?.matricule || student?.id?.substring(0, 8) || '________'}`, this.margin, startY + lineHeight * 6);\r\n    \r\n    doc.text('Est r√©guli√®rement inscrit(e) dans notre √©tablissement pour l\\'ann√©e scolaire en cours.', this.margin, startY + lineHeight * 8);\r\n    doc.text('Ce certificat est d√©livr√© √† l\\'int√©ress√©(e) pour servir et valoir ce que de droit.', this.margin, startY + lineHeight * 10);\r\n    \r\n    // Date et signature\r\n    const today = new Date().toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' });\r\n    doc.text(`Fait √† ${school?.city || '________'}, le ${today}`, this.pageWidth - this.margin - 60, startY + lineHeight * 13);\r\n    \r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('Le(La) Directeur(trice)', this.pageWidth - this.margin - 40, startY + lineHeight * 16);\r\n    \r\n    // Cachet (placeholder)\r\n    doc.setDrawColor(150, 150, 150);\r\n    doc.setLineWidth(0.3);\r\n    doc.rect(this.margin, startY + lineHeight * 14, 40, 25);\r\n    doc.setFontSize(8);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text('Cachet de l\\'√©cole', this.margin + 5, startY + lineHeight * 16);\r\n    \r\n    return doc;\r\n  }\r\n\r\n  /**\r\n   * G√©n√®re un certificat de fr√©quentation\r\n   */\r\n  generateCertificatFrequentation(data) {\r\n    const { student, school, academicYear } = data;\r\n    const doc = new jsPDF();\r\n    \r\n    // En-t√™te √©cole\r\n    doc.setFontSize(16);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text(school?.name || '√âcole', this.pageWidth / 2, 30, { align: 'center' });\r\n    \r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(school?.address || '', this.pageWidth / 2, 38, { align: 'center' });\r\n    \r\n    // Titre\r\n    doc.setFontSize(18);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('CERTIFICAT DE FR√âQUENTATION', this.pageWidth / 2, 70, { align: 'center' });\r\n    \r\n    // Corps\r\n    doc.setFontSize(12);\r\n    doc.setFont('helvetica', 'normal');\r\n    const startY = 100;\r\n    const lineHeight = 10;\r\n    \r\n    doc.text('Je soussign√©(e), Directeur(trice) de l\\'√©tablissement scolaire,', this.margin, startY);\r\n    doc.text('atteste que l\\'√©l√®ve :', this.margin, startY + lineHeight * 2);\r\n    \r\n    doc.setFont('helvetica', 'bold');\r\n    const studentName = `${student?.last_name || ''} ${student?.first_name || ''}`.trim();\r\n    doc.text(studentName || 'Nom de l\\'√©l√®ve', this.margin, startY + lineHeight * 3);\r\n    \r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Inscrit(e) en classe de : ${student?.class_name || '________'}`, this.margin, startY + lineHeight * 5);\r\n    doc.text('Fr√©quente r√©guli√®rement et assid√ªment notre √©tablissement.', this.margin, startY + lineHeight * 7);\r\n    doc.text('En foi de quoi, le pr√©sent certificat lui est d√©livr√© pour servir et', this.margin, startY + lineHeight * 9);\r\n    doc.text('valoir ce que de droit.', this.margin, startY + lineHeight * 10);\r\n    \r\n    // Date et signature\r\n    const today = new Date().toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' });\r\n    doc.text(`Fait √† ${school?.city || '________'}, le ${today}`, this.pageWidth - this.margin - 60, startY + lineHeight * 13);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('Le(La) Directeur(trice)', this.pageWidth - this.margin - 40, startY + lineHeight * 16);\r\n    \r\n    return doc;\r\n  }\r\n\r\n  /**\r\n   * G√©n√®re une fiche d'inscription\r\n   */\r\n  generateFicheInscription(data) {\r\n    const { student, school, academicYear } = data;\r\n    const doc = new jsPDF();\r\n    \r\n    // En-t√™te\r\n    doc.setFontSize(16);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text(school?.name || '√âcole', this.pageWidth / 2, 25, { align: 'center' });\r\n    \r\n    doc.setFontSize(14);\r\n    doc.text('FICHE D\\'INSCRIPTION', this.pageWidth / 2, 45, { align: 'center' });\r\n    doc.text(`Ann√©e scolaire ${academicYear || '____-____'}`, this.pageWidth / 2, 53, { align: 'center' });\r\n    \r\n    // Informations √©l√®ve\r\n    doc.setFontSize(12);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('INFORMATIONS DE L\\'√âL√àVE', this.margin, 70);\r\n    \r\n    doc.setLineWidth(0.3);\r\n    doc.line(this.margin, 73, this.pageWidth - this.margin, 73);\r\n    \r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setFontSize(11);\r\n    const startY = 82;\r\n    const lineHeight = 8;\r\n    \r\n    doc.text(`Nom : ${student?.last_name || '________________________'}`, this.margin, startY);\r\n    doc.text(`Pr√©nom : ${student?.first_name || '________________________'}`, this.pageWidth / 2, startY);\r\n    \r\n    doc.text(`Date de naissance : ${this.formatDate(this.getBirthDate(student))}`, this.margin, startY + lineHeight);\r\n    doc.text(`Lieu de naissance : ${student?.place_of_birth || student?.birth_place || '________________'}`, this.pageWidth / 2, startY + lineHeight);\r\n    \r\n    doc.text(`Sexe : ${student?.gender === 'M' ? 'Masculin' : student?.gender === 'F' ? 'F√©minin' : '________'}`, this.margin, startY + lineHeight * 2);\r\n    doc.text(`Nationalit√© : ${student?.nationality || 'Camerounaise'}`, this.pageWidth / 2, startY + lineHeight * 2);\r\n    \r\n    doc.text(`Classe : ${student?.class_name || '________'}`, this.margin, startY + lineHeight * 3);\r\n    doc.text(`Matricule : ${student?.matricule || student?.id?.substring(0, 8) || '________'}`, this.pageWidth / 2, startY + lineHeight * 3);\r\n    \r\n    // Informations parent/tuteur\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('INFORMATIONS DU PARENT/TUTEUR', this.margin, startY + lineHeight * 5);\r\n    doc.line(this.margin, startY + lineHeight * 5 + 3, this.pageWidth - this.margin, startY + lineHeight * 5 + 3);\r\n    \r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Nom du p√®re/tuteur : ${student?.father_name || '________________________'}`, this.margin, startY + lineHeight * 6.5);\r\n    doc.text(`Profession : ${student?.father_profession || '________________'}`, this.pageWidth / 2, startY + lineHeight * 6.5);\r\n    \r\n    doc.text(`Nom de la m√®re : ${student?.mother_name || '________________________'}`, this.margin, startY + lineHeight * 7.5);\r\n    doc.text(`Profession : ${student?.mother_profession || '________________'}`, this.pageWidth / 2, startY + lineHeight * 7.5);\r\n    \r\n    doc.text(`T√©l√©phone : ${student?.parent_phone || '________________'}`, this.margin, startY + lineHeight * 8.5);\r\n    doc.text(`Email : ${student?.parent_email || '________________________'}`, this.pageWidth / 2, startY + lineHeight * 8.5);\r\n    \r\n    doc.text(`Adresse : ${student?.address || '________________________________________'}`, this.margin, startY + lineHeight * 9.5);\r\n    \r\n    // Signature\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('Signature du parent/tuteur', this.margin, startY + lineHeight * 13);\r\n    doc.text('Cachet et signature de l\\'√©cole', this.pageWidth - this.margin - 50, startY + lineHeight * 13);\r\n    \r\n    // Zones de signature\r\n    doc.setDrawColor(150, 150, 150);\r\n    doc.rect(this.margin, startY + lineHeight * 14, 60, 25);\r\n    doc.rect(this.pageWidth - this.margin - 60, startY + lineHeight * 14, 60, 25);\r\n    \r\n    return doc;\r\n  }\r\n\r\n  /**\r\n   * G√©n√®re une attestation de paiement\r\n   */\r\n  generateAttestationPaiement(data) {\r\n    const { student, school, academicYear, amount, paymentDate } = data;\r\n    const doc = new jsPDF();\r\n    \r\n    // En-t√™te\r\n    doc.setFontSize(16);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text(school?.name || '√âcole', this.pageWidth / 2, 30, { align: 'center' });\r\n    \r\n    doc.setFontSize(18);\r\n    doc.text('ATTESTATION DE PAIEMENT', this.pageWidth / 2, 60, { align: 'center' });\r\n    \r\n    // Corps\r\n    doc.setFontSize(12);\r\n    doc.setFont('helvetica', 'normal');\r\n    const startY = 90;\r\n    const lineHeight = 10;\r\n    \r\n    doc.text('Je soussign√©(e), responsable administratif de l\\'√©tablissement,', this.margin, startY);\r\n    doc.text('atteste avoir re√ßu de :', this.margin, startY + lineHeight * 2);\r\n    \r\n    doc.setFont('helvetica', 'bold');\r\n    const studentName = `${student?.last_name || ''} ${student?.first_name || ''}`.trim();\r\n    doc.text(`Parent/Tuteur de : ${studentName || '________________________'}`, this.margin, startY + lineHeight * 3);\r\n    \r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Classe : ${student?.class_name || '________'}`, this.margin, startY + lineHeight * 4);\r\n    \r\n    doc.text(`La somme de : ${amount || '____________'} FCFA`, this.margin, startY + lineHeight * 6);\r\n    doc.text(`En paiement de : Frais de scolarit√© - ${academicYear || 'Ann√©e en cours'}`, this.margin, startY + lineHeight * 7);\r\n    doc.text(`Date du paiement : ${paymentDate || new Date().toLocaleDateString('fr-FR')}`, this.margin, startY + lineHeight * 8);\r\n    \r\n    doc.text('Cette attestation est d√©livr√©e pour servir et valoir ce que de droit.', this.margin, startY + lineHeight * 10);\r\n    \r\n    // Date et signature\r\n    const today = new Date().toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' });\r\n    doc.text(`Fait √† ${school?.city || '________'}, le ${today}`, this.pageWidth - this.margin - 60, startY + lineHeight * 13);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('Le(La) Comptable', this.pageWidth - this.margin - 35, startY + lineHeight * 16);\r\n    \r\n    return doc;\r\n  }\r\n\r\n  /**\r\n   * G√©n√®re une liste d'√©l√®ves pour une classe\r\n   */\r\n  generateListeEleves(data) {\r\n    const { students, className, school, academicYear } = data;\r\n    const doc = new jsPDF();\r\n    \r\n    // En-t√™te\r\n    doc.setFontSize(14);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text(school?.name || '√âcole', this.pageWidth / 2, 20, { align: 'center' });\r\n    \r\n    doc.setFontSize(16);\r\n    doc.text(`LISTE DES √âL√àVES - ${className || 'Classe'}`, this.pageWidth / 2, 35, { align: 'center' });\r\n    \r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Ann√©e scolaire : ${academicYear || '____-____'}`, this.pageWidth / 2, 43, { align: 'center' });\r\n    doc.text(`Effectif total : ${students?.length || 0} √©l√®ves`, this.pageWidth / 2, 50, { align: 'center' });\r\n    \r\n    // Table header\r\n    const startY = 60;\r\n    const colWidths = [15, 55, 55, 30, 25];\r\n    const headers = ['N¬∞', 'Nom', 'Pr√©nom', 'Date naiss.', 'Sexe'];\r\n    \r\n    doc.setFillColor(240, 240, 240);\r\n    doc.rect(this.margin, startY - 5, this.pageWidth - 2 * this.margin, 10, 'F');\r\n    \r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setFontSize(10);\r\n    let xPos = this.margin + 2;\r\n    headers.forEach((header, i) => {\r\n      doc.text(header, xPos, startY + 2);\r\n      xPos += colWidths[i];\r\n    });\r\n    \r\n    // Table rows\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setFontSize(9);\r\n    let yPos = startY + 12;\r\n    \r\n    const studentList = students || [];\r\n    studentList.forEach((student, index) => {\r\n      if (yPos > 270) {\r\n        doc.addPage();\r\n        yPos = 30;\r\n      }\r\n      \r\n      xPos = this.margin + 2;\r\n      doc.text(String(index + 1), xPos, yPos);\r\n      xPos += colWidths[0];\r\n      doc.text(student.last_name || '', xPos, yPos);\r\n      xPos += colWidths[1];\r\n      doc.text(student.first_name || '', xPos, yPos);\r\n      xPos += colWidths[2];\r\n      doc.text(this.formatDate(this.getBirthDate(student)), xPos, yPos);\r\n      xPos += colWidths[3];\r\n      doc.text(student.gender || '', xPos, yPos);\r\n      \r\n      yPos += 7;\r\n    });\r\n    \r\n    // Lignes du tableau\r\n    doc.setDrawColor(200, 200, 200);\r\n    doc.setLineWidth(0.1);\r\n    for (let i = 0; i <= studentList.length + 1; i++) {\r\n      const y = startY - 5 + i * 7;\r\n      if (y < 280) {\r\n        doc.line(this.margin, y, this.pageWidth - this.margin, y);\r\n      }\r\n    }\r\n    \r\n    return doc;\r\n  }\r\n\r\n  /**\r\n   * G√©n√®re une liste d'appel\r\n   */\r\n  generateListeAppel(data) {\r\n    const { students, className, school, date } = data;\r\n    const doc = new jsPDF('landscape'); // Format paysage pour plus de colonnes\r\n    \r\n    const pageWidth = 297;\r\n    const pageHeight = 210;\r\n    const margin = 15;\r\n    \r\n    // En-t√™te\r\n    doc.setFontSize(12);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text(school?.name || '√âcole', margin, 15);\r\n    \r\n    doc.setFontSize(14);\r\n    doc.text(`LISTE D'APPEL - ${className || 'Classe'}`, pageWidth / 2, 15, { align: 'center' });\r\n    \r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Date : ${date || new Date().toLocaleDateString('fr-FR')}`, pageWidth - margin, 15, { align: 'right' });\r\n    \r\n    // Jours de la semaine\r\n    const days = ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven'];\r\n    const startY = 30;\r\n    const rowHeight = 8;\r\n    const nameColWidth = 80;\r\n    const dayColWidth = 35;\r\n    \r\n    // En-t√™tes de colonnes\r\n    doc.setFillColor(240, 240, 240);\r\n    doc.rect(margin, startY - 5, pageWidth - 2 * margin, 10, 'F');\r\n    \r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setFontSize(9);\r\n    doc.text('N¬∞', margin + 2, startY + 2);\r\n    doc.text('Nom et Pr√©nom', margin + 15, startY + 2);\r\n    \r\n    let xPos = margin + nameColWidth;\r\n    days.forEach(day => {\r\n      doc.text(day, xPos + dayColWidth / 2, startY + 2, { align: 'center' });\r\n      xPos += dayColWidth;\r\n    });\r\n    doc.text('Obs.', xPos + 10, startY + 2);\r\n    \r\n    // Lignes √©l√®ves\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setFontSize(8);\r\n    let yPos = startY + 12;\r\n    \r\n    const studentList = students || [];\r\n    studentList.forEach((student, index) => {\r\n      if (yPos > pageHeight - 20) {\r\n        doc.addPage('landscape');\r\n        yPos = 30;\r\n      }\r\n      \r\n      doc.text(String(index + 1), margin + 2, yPos);\r\n      doc.text(`${student.last_name || ''} ${student.first_name || ''}`, margin + 15, yPos);\r\n      \r\n      // Cases pour les jours\r\n      xPos = margin + nameColWidth;\r\n      days.forEach(() => {\r\n        doc.rect(xPos + 5, yPos - 5, dayColWidth - 10, rowHeight);\r\n        xPos += dayColWidth;\r\n      });\r\n      \r\n      yPos += rowHeight;\r\n    });\r\n    \r\n    // L√©gende\r\n    doc.setFontSize(8);\r\n    doc.text('P = Pr√©sent | A = Absent | R = Retard | E = Excus√©', margin, pageHeight - 10);\r\n    \r\n    return doc;\r\n  }\r\n\r\n  /**\r\n   * G√©n√®re un document circulaire/annonce\r\n   */\r\n  generateCirculaire(data) {\r\n    const { school, title, content, date } = data;\r\n    const doc = new jsPDF();\r\n    \r\n    // En-t√™te officiel\r\n    doc.setFontSize(14);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('R√âPUBLIQUE DU CAMEROUN', this.pageWidth / 2, 20, { align: 'center' });\r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'italic');\r\n    doc.text('Paix - Travail - Patrie', this.pageWidth / 2, 26, { align: 'center' });\r\n    \r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setFontSize(12);\r\n    doc.text(school?.name || '√âcole', this.pageWidth / 2, 40, { align: 'center' });\r\n    \r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(school?.address || '', this.pageWidth / 2, 47, { align: 'center' });\r\n    \r\n    // Ligne de s√©paration\r\n    doc.setLineWidth(1);\r\n    doc.line(this.margin, 55, this.pageWidth - this.margin, 55);\r\n    \r\n    // Titre de la circulaire\r\n    doc.setFontSize(16);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text(title || 'CIRCULAIRE', this.pageWidth / 2, 70, { align: 'center' });\r\n    \r\n    // Date\r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Date : ${date || new Date().toLocaleDateString('fr-FR')}`, this.pageWidth - this.margin, 80, { align: 'right' });\r\n    \r\n    // Destinataires\r\n    doc.text('√Ä l\\'attention des Parents d\\'√©l√®ves', this.margin, 90);\r\n    \r\n    // Corps du message\r\n    doc.setFontSize(11);\r\n    const startY = 105;\r\n    \r\n    if (content) {\r\n      const lines = doc.splitTextToSize(content, this.pageWidth - 2 * this.margin);\r\n      doc.text(lines, this.margin, startY);\r\n    } else {\r\n      doc.text('Madame, Monsieur,', this.margin, startY);\r\n      doc.text('', this.margin, startY + 15);\r\n      doc.text('[Contenu de la circulaire]', this.margin, startY + 25);\r\n    }\r\n    \r\n    // Signature\r\n    doc.text('La Direction', this.pageWidth - this.margin - 30, 240);\r\n    \r\n    return doc;\r\n  }\r\n\r\n  /**\r\n   * G√©n√®re le PDF selon le type de document\r\n   */\r\n  generate(documentType, data) {\r\n    switch (documentType) {\r\n      case 'certificat_scolarite':\r\n        return this.generateCertificatScolarite(data);\r\n      case 'certificat_frequentation':\r\n        return this.generateCertificatFrequentation(data);\r\n      case 'fiche_inscription':\r\n        return this.generateFicheInscription(data);\r\n      case 'attestation_paiement':\r\n        return this.generateAttestationPaiement(data);\r\n      case 'liste_eleves':\r\n        return this.generateListeEleves(data);\r\n      case 'liste_appel':\r\n        return this.generateListeAppel(data);\r\n      case 'circulaire':\r\n      case 'convocation':\r\n      case 'avis_important':\r\n      case 'avis_paiement':\r\n        return this.generateCirculaire({ ...data, title: this.getDocumentTitle(documentType) });\r\n      default:\r\n        // Document g√©n√©rique\r\n        return this.generateGenericDocument(data, documentType);\r\n    }\r\n  }\r\n\r\n  getDocumentTitle(type) {\r\n    const titles = {\r\n      'circulaire': 'CIRCULAIRE',\r\n      'convocation': 'CONVOCATION - R√âUNION PARENTS-ENSEIGNANTS',\r\n      'avis_important': 'AVIS IMPORTANT',\r\n      'avis_paiement': 'AVIS DE PAIEMENT',\r\n      'reglement_interieur': 'R√àGLEMENT INT√âRIEUR',\r\n      'calendrier_scolaire': 'CALENDRIER SCOLAIRE'\r\n    };\r\n    return titles[type] || type.toUpperCase().replace(/_/g, ' ');\r\n  }\r\n\r\n  generateGenericDocument(data, documentType) {\r\n    const { school } = data;\r\n    const doc = new jsPDF();\r\n    \r\n    doc.setFontSize(14);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text(school?.name || '√âcole', this.pageWidth / 2, 30, { align: 'center' });\r\n    \r\n    doc.setFontSize(18);\r\n    doc.text(this.getDocumentTitle(documentType), this.pageWidth / 2, 60, { align: 'center' });\r\n    \r\n    doc.setFontSize(12);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Document g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')}`, this.pageWidth / 2, 80, { align: 'center' });\r\n    \r\n    doc.text('Ce document est en cours de d√©veloppement.', this.pageWidth / 2, 120, { align: 'center' });\r\n    \r\n    return doc;\r\n  }\r\n\r\n  /**\r\n   * Convertit le PDF en Blob pour l'upload\r\n   */\r\n  toBlob(doc) {\r\n    return doc.output('blob');\r\n  }\r\n\r\n  /**\r\n   * Ouvre le PDF dans un nouvel onglet\r\n   */\r\n  preview(doc) {\r\n    const pdfUrl = doc.output('bloburl');\r\n    window.open(pdfUrl, '_blank');\r\n  }\r\n\r\n  /**\r\n   * T√©l√©charge le PDF\r\n   */\r\n  download(doc, filename) {\r\n    doc.save(filename || 'document.pdf');\r\n  }\r\n}\r\n\r\nexport const pdfGenerator = new PDFGenerator();\r\nexport default pdfGenerator;\r\n","import { supabase } from '../lib/supabase';\r\nimport { pdfGenerator } from './pdfGenerator.js';\r\n\r\nclass DocumentService {\r\n  // Helper method to get current user with valid database ID\r\n  async getCurrentUserWithDbId() {\r\n    let user = null;\r\n    let dbUserId = null;\r\n    \r\n    // Try Supabase Auth first\r\n    try {\r\n      const res = await supabase?.auth?.getUser();\r\n      user = res?.data?.user;\r\n      console.log('üîê Supabase Auth user:', user?.email || 'none');\r\n    } catch (e) {\r\n      user = null;\r\n    }\r\n\r\n    // Fallback to localStorage-stored user for EmailJS/persisted sessions\r\n    if (!user) {\r\n      try {\r\n        const saved = localStorage.getItem('edutrack-user');\r\n        if (saved) {\r\n          user = JSON.parse(saved);\r\n          console.log('üì¶ localStorage user:', user?.email, 'id:', user?.id);\r\n        }\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n    }\r\n\r\n    if (!user) return { user: null, dbUserId: null };\r\n\r\n    // Get the actual user ID from the database by email\r\n    // This ensures we use an ID that exists in the users table (for FK constraint)\r\n    if (user?.email) {\r\n      try {\r\n        console.log('üîç Searching user in DB by email:', user.email);\r\n        const { data: dbUser, error: dbError } = await supabase\r\n          ?.from('users')\r\n          ?.select('id, current_school_id')\r\n          ?.eq('email', user.email)\r\n          ?.single();\r\n        \r\n        if (dbError) {\r\n          console.error('‚ùå Error fetching user from DB:', dbError);\r\n        }\r\n        \r\n        if (dbUser) {\r\n          dbUserId = dbUser.id;\r\n          // Also attach school_id if available\r\n          user.db_school_id = dbUser.current_school_id;\r\n          console.log('‚úÖ Found user in DB - dbUserId:', dbUserId, 'school:', dbUser.current_school_id);\r\n        } else {\r\n          console.warn('‚ö†Ô∏è User not found in DB for email:', user.email);\r\n        }\r\n      } catch (e) {\r\n        console.warn('Could not fetch user from database:', e);\r\n      }\r\n    }\r\n\r\n    // Fallback to user.id if no dbUserId found (for Supabase Auth users)\r\n    if (!dbUserId && user?.id) {\r\n      console.log('‚ö†Ô∏è Using fallback user.id:', user.id);\r\n      dbUserId = user.id;\r\n    }\r\n\r\n    console.log('üìã getCurrentUserWithDbId result - dbUserId:', dbUserId);\r\n    return { user, dbUserId };\r\n  }\r\n\r\n  // Document CRUD operations\r\n  async uploadDocument(documentData, file) {\r\n    try {\r\n      const { user, dbUserId } = await this.getCurrentUserWithDbId();\r\n\r\n      if (!user) throw new Error('Non authentifi√©');\r\n      if (!dbUserId) throw new Error('Utilisateur non trouv√© dans la base de donn√©es. Veuillez vous reconnecter.');\r\n\r\n      // Bucket name configurable via Vite env var VITE_SUPABASE_STORAGE_BUCKET\r\n      const STORAGE_BUCKET = (typeof import.meta !== 'undefined' && import.meta.env && import.meta.env.VITE_SUPABASE_STORAGE_BUCKET)\r\n        || (typeof process !== 'undefined' && process.env && process.env.VITE_SUPABASE_STORAGE_BUCKET)\r\n        || 'documents';\r\n\r\n      // Create file path using database user ID\r\n      const timestamp = Date.now();\r\n      const fileExtension = file?.name?.split('.')?.pop() || '';\r\n      const fileName = `${documentData?.title?.replace(/\\s+/g, '_')}_${timestamp}.${fileExtension}`;\r\n      const subjectSegment = (documentData?.subject || 'general').toString().replace(/\\s+/g, '_').toLowerCase();\r\n      const filePath = `teacher/${dbUserId}/${subjectSegment}/${fileName}`;\r\n\r\n      // Upload file to storage\r\n      const { data: storageData, error: storageError } = await supabase?.storage?.from(STORAGE_BUCKET)?.upload(filePath, file, {\r\n          cacheControl: '3600',\r\n          upsert: false\r\n        });\r\n\r\n      if (storageError) throw storageError;\r\n\r\n      // Determine school_id: use provided, or from user profile, or from database\r\n      const schoolId = documentData?.school_id || user?.current_school_id || user?.db_school_id;\r\n\r\n      // Insert document record with the valid database user ID\r\n      const { data, error } = await supabase?.from('documents')?.insert({\r\n        title: documentData?.title,\r\n        description: documentData?.description,\r\n        file_name: file?.name,\r\n        file_path: filePath,\r\n        file_size: file?.size,\r\n        mime_type: file?.type,\r\n        document_type: documentData?.document_type,\r\n        uploaded_by: dbUserId, // Use the database user ID (valid FK)\r\n        class_name: documentData?.class_name,\r\n        subject: documentData?.subject,\r\n        school_id: schoolId,\r\n        is_public: documentData?.is_public || false\r\n      })?.select()?.single();\r\n\r\n      if (error) throw error;\r\n      return { data, error: null };\r\n    } catch (error) {\r\n      console.error('Erreur upload document:', error);\r\n      return { data: null, error: error?.message };\r\n    }\r\n  }\r\n\r\n  async getDocuments(filters = {}) {\r\n    try {\r\n        let query = supabase?.from('documents')?.select(`\r\n          id, title, description, file_name, file_path, file_size, mime_type,\r\n          document_type, class_name, subject, is_public, created_at, updated_at,\r\n          uploader:uploaded_by(id, full_name),\r\n          school:school_id(id, name)\r\n        `)?.order('created_at', { ascending: false });\r\n\r\n      // Apply filters\r\n      if (filters?.class_name) {\r\n        query = query?.eq('class_name', filters?.class_name);\r\n      }\r\n      if (filters?.subject) {\r\n        query = query?.eq('subject', filters?.subject);\r\n      }\r\n      if (filters?.document_type) {\r\n        query = query?.eq('document_type', filters?.document_type);\r\n      }\r\n      if (filters?.school_id) {\r\n        query = query?.eq('school_id', filters?.school_id);\r\n      }\r\n\r\n      const { data, error } = await query;\r\n      if (error) throw error;\r\n      return { data, error: null };\r\n    } catch (error) {\r\n      console.error('Erreur r√©cup√©ration documents:', error);\r\n      return { data: [], error: error?.message };\r\n    }\r\n  }\r\n\r\n  async getTeacherDocuments() {\r\n    try {\r\n      const { data: { user } } = await supabase?.auth?.getUser();\r\n      if (!user) throw new Error('Non authentifi√©');\r\n\r\n      return await this.getDocuments({ uploaded_by: user?.id });\r\n    } catch (error) {\r\n      console.error('Erreur r√©cup√©ration documents professeur:', error);\r\n      return { data: [], error: error?.message };\r\n    }\r\n  }\r\n\r\n  async getStudentDocuments() {\r\n    try {\r\n      const { data: { user } } = await supabase?.auth?.getUser();\r\n      if (!user) throw new Error('Non authentifi√©');\r\n\r\n      // Get student's class information\r\n      const { data: studentData, error: studentError } = await supabase?.from('students')?.select('current_class, current_school_id')?.eq('user_id', user?.id)?.single();\r\n\r\n      if (studentError || !studentData) {\r\n        return { data: [], error: 'Informations √©tudiant non trouv√©es' };\r\n      }\r\n\r\n      return await this.getDocuments({\r\n        class_name: studentData?.current_class,\r\n        school_id: studentData?.current_school_id\r\n      });\r\n    } catch (error) {\r\n      console.error('Erreur r√©cup√©ration documents √©tudiant:', error);\r\n      return { data: [], error: error?.message };\r\n    }\r\n  }\r\n\r\n  async deleteDocument(documentId) {\r\n    try {\r\n      // Utiliser la m√©thode centralis√©e pour obtenir l'utilisateur\r\n      const { user, dbUserId } = await this.getCurrentUserWithDbId();\r\n      if (!user || !dbUserId) throw new Error('Non authentifi√©');\r\n\r\n      // Get document info first\r\n      const { data: document, error: fetchError } = await supabase?.from('documents')?.select('file_path, uploaded_by')?.eq('id', documentId)?.single();\r\n\r\n      if (fetchError || !document) {\r\n        throw new Error('Document non trouv√©');\r\n      }\r\n\r\n      // Check if user owns the document (comparer avec dbUserId)\r\n      if (document?.uploaded_by !== dbUserId) {\r\n        throw new Error('Non autoris√© √† supprimer ce document');\r\n      }\r\n\r\n      // Delete from storage\r\n      const STORAGE_BUCKET = (typeof import.meta !== 'undefined' && import.meta.env && import.meta.env.VITE_SUPABASE_STORAGE_BUCKET)\r\n        || (typeof process !== 'undefined' && process.env && process.env.VITE_SUPABASE_STORAGE_BUCKET)\r\n        || 'documents';\r\n\r\n      const { error: storageError } = await supabase?.storage?.from(STORAGE_BUCKET)?.remove([document?.file_path]);\r\n\r\n      if (storageError) {\r\n        console.error('Erreur suppression storage:', storageError);\r\n      }\r\n\r\n      // Delete from database\r\n      const { error: dbError } = await supabase?.from('documents')?.delete()?.eq('id', documentId);\r\n\r\n      if (dbError) throw dbError;\r\n      return { data: true, error: null };\r\n    } catch (error) {\r\n      console.error('Erreur suppression document:', error);\r\n      return { data: false, error: error?.message };\r\n    }\r\n  }\r\n\r\n  async downloadDocument(documentId, action = 'download') {\r\n    try {\r\n      // Utiliser la m√©thode centralis√©e pour obtenir l'utilisateur\r\n      const { user, dbUserId } = await this.getCurrentUserWithDbId();\r\n      if (!user || !dbUserId) throw new Error('Non authentifi√©');\r\n\r\n      // Get document info\r\n      const { data: document, error: fetchError } = await supabase?.from('documents')?.select('file_path, file_name, title')?.eq('id', documentId)?.single();\r\n\r\n      if (fetchError || !document) {\r\n        throw new Error('Document non trouv√©');\r\n      }\r\n\r\n      // Create signed URL for download\r\n      const STORAGE_BUCKET = (typeof import.meta !== 'undefined' && import.meta.env && import.meta.env.VITE_SUPABASE_STORAGE_BUCKET)\r\n        || (typeof process !== 'undefined' && process.env && process.env.VITE_SUPABASE_STORAGE_BUCKET)\r\n        || 'documents';\r\n\r\n      const { data: signedUrlData, error: urlError } = await supabase?.storage?.from(STORAGE_BUCKET)?.createSignedUrl(document?.file_path, 3600); // 1 hour expiry\r\n\r\n      if (urlError || !signedUrlData) {\r\n        throw new Error('Impossible de g√©n√©rer l\\'URL de t√©l√©chargement');\r\n      }\r\n\r\n      // Log access\r\n      await this.logDocumentAccess(documentId, action);\r\n\r\n      return { \r\n        data: {\r\n          url: signedUrlData?.signedUrl,\r\n          fileName: document?.file_name,\r\n          title: document?.title\r\n        }, \r\n        error: null \r\n      };\r\n    } catch (error) {\r\n      console.error('Erreur t√©l√©chargement document:', error);\r\n      return { data: null, error: error?.message };\r\n    }\r\n  }\r\n\r\n  // Upload file and create a record in documents table (used by teacher dashboard)\r\n  // Utilise la table `documents` existante avec les colonnes correctes\r\n  async uploadTeacherDocument(documentData, file) {\r\n    try {\r\n      // Utiliser la m√©thode centralis√©e pour obtenir l'utilisateur avec son ID de la base de donn√©es\r\n      const { user, dbUserId } = await this.getCurrentUserWithDbId();\r\n\r\n      if (!user) throw new Error('Non authentifi√©');\r\n      if (!dbUserId) throw new Error('Utilisateur non trouv√© dans la base de donn√©es. Veuillez vous reconnecter.');\r\n\r\n      // R√©cup√©rer school_id depuis plusieurs sources possibles\r\n      let schoolId = user?.current_school_id || user?.school_id || user?.db_school_id || documentData?.school_id;\r\n\r\n      // Si pas de schoolId, le chercher dans la base de donn√©es\r\n      if (!schoolId && dbUserId) {\r\n        try {\r\n          const { data: userData } = await supabase?.from('users')?.select('current_school_id')?.eq('id', dbUserId)?.single();\r\n          schoolId = userData?.current_school_id;\r\n        } catch (e) {\r\n          console.warn('Impossible de r√©cup√©rer school_id:', e);\r\n        }\r\n      }\r\n\r\n      if (!schoolId) {\r\n        throw new Error('√âcole non trouv√©e - veuillez vous reconnecter');\r\n      }\r\n\r\n      // Nom du bucket Storage (configurable via env ou d√©faut 'documents')\r\n      const STORAGE_BUCKET = (typeof import.meta !== 'undefined' && import.meta.env && import.meta.env.VITE_SUPABASE_STORAGE_BUCKET)\r\n        || (typeof process !== 'undefined' && process.env && process.env.VITE_SUPABASE_STORAGE_BUCKET)\r\n        || 'documents';\r\n\r\n      console.log('üì§ Upload document - bucket:', STORAGE_BUCKET, 'dbUserId:', dbUserId, 'school:', schoolId);\r\n\r\n      // Construire le chemin du fichier (utiliser dbUserId pour le path)\r\n      const timestamp = Date.now();\r\n      const fileExtension = file?.name?.split('.')?.pop() || '';\r\n      const safeTitle = (documentData?.title || 'document').toString().replace(/[^a-zA-Z0-9_-]/g, '_');\r\n      const fileName = `${safeTitle}_${timestamp}.${fileExtension}`;\r\n      const filePath = `teacher/${dbUserId}/${fileName}`;\r\n\r\n      // Upload vers Supabase Storage\r\n      const { data: storageData, error: storageError } = await supabase?.storage?.from(STORAGE_BUCKET)?.upload(filePath, file, { \r\n        cacheControl: '3600', \r\n        upsert: false \r\n      });\r\n      \r\n      if (storageError) {\r\n        console.error('‚ùå Storage error:', storageError);\r\n        throw storageError;\r\n      }\r\n\r\n      console.log('‚úÖ Fichier upload√©:', filePath);\r\n\r\n      // Ins√©rer dans la table `documents` avec les colonnes existantes\r\n      // Colonnes disponibles: id, school_id, document_type, visibility, is_public, \r\n      // uploaded_by, target_student_id, target_class_id, title, file_name, file_path, mime_type, class_name\r\n      \r\n      // D√©terminer la visibilit√© selon le choix utilisateur\r\n      // - 'private' : seul l'enseignant voit\r\n      // - 'class' : √©l√®ves de la classe voient\r\n      // - 'school' : toute l'√©cole voit (parents inclus si is_public=true)\r\n      let visibility = 'class'; // d√©faut: visible par la classe\r\n      if (documentData?.visibility === 'students') {\r\n        visibility = 'class';\r\n      } else if (documentData?.visibility === 'students_parents') {\r\n        visibility = 'school'; // visible par √©l√®ves ET parents\r\n      } else if (documentData?.visibility === 'private') {\r\n        visibility = 'private';\r\n      }\r\n\r\n      // DEBUG: Voir ce qui est envoy√©\r\n      console.log('üìã documentData re√ßu:', documentData);\r\n\r\n      // Pour l'instant, on ne met pas target_class_id pour √©viter les erreurs FK\r\n      // On utilise class_name pour stocker le nom de la classe (pas besoin de FK)\r\n      const record = {\r\n        school_id: schoolId,\r\n        document_type: documentData?.document_type || documentData?.type || 'cours',\r\n        visibility: visibility,\r\n        is_public: documentData?.visibility === 'students_parents', // parents peuvent voir\r\n        uploaded_by: dbUserId, // üë§ QUI a upload√© le document (ID de la table users)\r\n        // target_class_id: null, // D√©sactiv√© temporairement - pas de FK probl√©matique\r\n        title: documentData?.title,\r\n        file_name: file?.name,\r\n        file_path: filePath,\r\n        mime_type: file?.type,\r\n        class_name: documentData?.class_name || documentData?.class_id // Nom de la classe pour affichage\r\n      };\r\n\r\n      console.log('üìù Insertion document record:', record);\r\n\r\n      const { data, error } = await supabase?.from('documents')?.insert(record)?.select()?.single();\r\n      \r\n      if (error) {\r\n        console.error('‚ùå DB insert error:', error);\r\n        throw error;\r\n      }\r\n\r\n      console.log('‚úÖ Document enregistr√©:', data?.id);\r\n      return { data, error: null };\r\n    } catch (error) {\r\n      console.error('Erreur upload teacher document:', error);\r\n      return { data: null, error: error?.message || String(error) };\r\n    }\r\n  }\r\n\r\n  async logDocumentAccess(documentId, action) {\r\n    try {\r\n      const { error } = await supabase?.rpc('log_document_access', {\r\n        doc_id: documentId,\r\n        access_action: action\r\n      });\r\n\r\n      if (error) {\r\n        console.error('Erreur log acc√®s document:', error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Erreur log acc√®s document:', error);\r\n    }\r\n  }\r\n\r\n  // Teacher assignment operations\r\n  async getTeacherAssignments() {\r\n    try {\r\n      const { data: { user } } = await supabase?.auth?.getUser();\r\n      if (!user) throw new Error('Non authentifi√©');\r\n\r\n      const { data, error } = await supabase?.from('teacher_assignments')?.select(`\r\n          id, class_name, subject, assigned_at, is_active,\r\n          school:school_id(id, name),\r\n          assigned_by_user:assigned_by(id, full_name)\r\n        `)?.eq('teacher_id', user?.id)?.eq('is_active', true)?.order('assigned_at', { ascending: false });\r\n\r\n      if (error) throw error;\r\n      return { data, error: null };\r\n    } catch (error) {\r\n      console.error('Erreur r√©cup√©ration assignments:', error);\r\n      return { data: [], error: error?.message };\r\n    }\r\n  }\r\n\r\n  async assignTeacherToClass(assignmentData) {\r\n    try {\r\n      const { data: { user } } = await supabase?.auth?.getUser();\r\n      if (!user) throw new Error('Non authentifi√©');\r\n\r\n      const { data, error } = await supabase?.from('teacher_assignments')?.insert({\r\n          teacher_id: assignmentData?.teacher_id,\r\n          school_id: assignmentData?.school_id,\r\n          class_name: assignmentData?.class_name,\r\n          subject: assignmentData?.subject,\r\n          assigned_by: user?.id\r\n        })?.select()?.single();\r\n\r\n      if (error) throw error;\r\n      return { data, error: null };\r\n    } catch (error) {\r\n      console.error('Erreur assignation professeur:', error);\r\n      return { data: null, error: error?.message };\r\n    }\r\n  }\r\n\r\n  async removeTeacherAssignment(assignmentId) {\r\n    try {\r\n      const { error } = await supabase?.from('teacher_assignments')?.update({ is_active: false })?.eq('id', assignmentId);\r\n\r\n      if (error) throw error;\r\n      return { data: true, error: null };\r\n    } catch (error) {\r\n      console.error('Erreur suppression assignation:', error);\r\n      return { data: false, error: error?.message };\r\n    }\r\n  }\r\n\r\n  // Utility functions\r\n  async getClassesAndSubjects() {\r\n    try {\r\n      const { data: assignments, error } = await supabase?.from('teacher_assignments')?.select('class_name, subject')?.eq('is_active', true);\r\n\r\n      if (error) throw error;\r\n\r\n      const classes = [...new Set(assignments?.map(a => a.class_name) || [])];\r\n      const subjects = [...new Set(assignments?.map(a => a.subject) || [])];\r\n\r\n      return { data: { classes, subjects }, error: null };\r\n    } catch (error) {\r\n      console.error('Erreur r√©cup√©ration classes/mati√®res:', error);\r\n      return { data: { classes: [], subjects: [] }, error: error?.message };\r\n    }\r\n  }\r\n\r\n  async getDocumentStats() {\r\n    try {\r\n      const { data: { user } } = await supabase?.auth?.getUser();\r\n      if (!user) throw new Error('Non authentifi√©');\r\n\r\n      const { data, error } = await supabase?.from('documents')?.select('document_type, created_at')?.eq('uploaded_by', user?.id);\r\n\r\n      if (error) throw error;\r\n\r\n      const stats = {\r\n        total: data?.length || 0,\r\n        byType: {},\r\n        thisMonth: 0\r\n      };\r\n\r\n      const currentMonth = new Date()?.getMonth();\r\n      const currentYear = new Date()?.getFullYear();\r\n\r\n      data?.forEach(doc => {\r\n        // Count by type\r\n        stats.byType[doc.document_type] = (stats?.byType?.[doc?.document_type] || 0) + 1;\r\n\r\n        // Count this month\r\n        const docDate = new Date(doc.created_at);\r\n        if (docDate?.getMonth() === currentMonth && docDate?.getFullYear() === currentYear) {\r\n          stats.thisMonth++;\r\n        }\r\n      });\r\n\r\n      return { data: stats, error: null };\r\n    } catch (error) {\r\n      console.error('Erreur statistiques documents:', error);\r\n      return { data: null, error: error?.message };\r\n    }\r\n  }\r\n\r\n  // Get all school documents for secretary\r\n  async getAllSchoolDocuments() {\r\n    try {\r\n      let schoolId = null;\r\n      let userId = null;\r\n\r\n      // Essayer avec Auth Supabase d'abord\r\n      const { data: { user: authUser } } = await supabase?.auth?.getUser();\r\n      \r\n      if (authUser) {\r\n        userId = authUser.id;\r\n        const { data: userData } = await supabase\r\n          ?.from('users')\r\n          ?.select('current_school_id')\r\n          ?.eq('id', authUser.id)\r\n          ?.single();\r\n        schoolId = userData?.current_school_id;\r\n      } else {\r\n        // Fallback : localStorage (pour comptes personnel EmailJS)\r\n        const savedUser = localStorage.getItem('edutrack-user');\r\n        if (savedUser) {\r\n          const userData = JSON.parse(savedUser);\r\n          userId = userData.id;\r\n          schoolId = userData.current_school_id || userData.school_id;\r\n          console.log('‚úÖ Utilisation localStorage pour documents:', { userId, schoolId });\r\n        }\r\n      }\r\n\r\n      if (!schoolId) {\r\n        return { success: false, documents: [], error: '√âcole non trouv√©e' };\r\n      }\r\n\r\n      // Get documents for the school\r\n      const { data, error } = await supabase\r\n        ?.from('documents')\r\n        ?.select(`\r\n          id,\r\n          title,\r\n          document_type,\r\n          created_at,\r\n          file_name,\r\n          file_path,\r\n          mime_type,\r\n          class_name\r\n        `)\r\n        ?.eq('school_id', schoolId)\r\n        ?.order('created_at', { ascending: false });\r\n\r\n      if (error) throw error;\r\n\r\n      // Format documents to match expected structure\r\n      const documents = (data || []).map(doc => ({\r\n        id: doc.id,\r\n        name: doc.title,\r\n        type: doc.document_type || 'administratif',\r\n        dateCreated: new Date(doc.created_at).toLocaleDateString('fr-FR'),\r\n        status: 'generated',\r\n        studentName: doc.class_name || 'Document g√©n√©ral',\r\n        class: doc.class_name || 'N/A',\r\n        format: doc.mime_type?.split('/')[1]?.toUpperCase() || 'PDF',\r\n        file_path: doc.file_path, // Garder pour savoir si le fichier existe\r\n        file_name: doc.file_name\r\n      }));\r\n\r\n      return { success: true, documents, error: null };\r\n    } catch (error) {\r\n      console.error('Erreur r√©cup√©ration documents √©cole:', error);\r\n      \r\n      // Si la table n'existe pas, retourner un message clair\r\n      if (error.message?.includes('Could not find the table')) {\r\n        return { \r\n          success: false, \r\n          documents: [], \r\n          error: 'TABLE_NOT_EXISTS',\r\n          message: 'La table documents n\\'existe pas encore dans Supabase. Cr√©ez-la pour activer cette fonctionnalit√©.'\r\n        };\r\n      }\r\n      \r\n      return { success: false, documents: [], error: error?.message };\r\n    }\r\n  }\r\n\r\n  // Generate a certificate or administrative document with PDF\r\n  async generateDocument(documentType, options = {}) {\r\n    try {\r\n      const { studentId = null, classId = null, visibility = 'private', isPublic = false } = options;\r\n      \r\n      let schoolId = null;\r\n      let userId = null;\r\n      let schoolData = null;\r\n      let studentData = null;\r\n      let studentsData = [];\r\n      let classData = null;\r\n\r\n      // R√©cup√©rer les infos utilisateur depuis localStorage d'abord (plus rapide)\r\n      const savedUser = localStorage.getItem('edutrack-user');\r\n      if (savedUser) {\r\n        const userData = JSON.parse(savedUser);\r\n        userId = userData.id;\r\n        schoolId = userData.current_school_id || userData.school_id;\r\n        schoolData = userData.schoolData || { name: userData.school_name };\r\n      }\r\n      \r\n      // Fallback Auth Supabase si pas de localStorage\r\n      if (!schoolId) {\r\n        const { data: { user: authUser } } = await supabase?.auth?.getUser();\r\n        if (authUser) {\r\n          userId = authUser.id;\r\n          const { data: userData } = await supabase\r\n            ?.from('users')\r\n            ?.select('current_school_id, school:schools!users_current_school_id_fkey(id, name, address, city, country)')\r\n            ?.eq('id', authUser.id)\r\n            ?.single();\r\n          schoolId = userData?.current_school_id;\r\n          schoolData = userData?.school;\r\n        }\r\n      }\r\n\r\n      if (!schoolId) {\r\n        throw new Error('√âcole non trouv√©e');\r\n      }\r\n\r\n      // Charger les donn√©es en parall√®le pour plus de rapidit√©\r\n      const promises = [];\r\n      \r\n      if (studentId) {\r\n        promises.push(\r\n          supabase?.from('students')?.select('*')?.eq('id', studentId)?.single()\r\n            .then(({ data }) => { studentData = data; })\r\n        );\r\n      }\r\n      \r\n      if (classId) {\r\n        promises.push(\r\n          supabase?.from('classes')?.select('*')?.eq('id', classId)?.single()\r\n            .then(({ data }) => { classData = data; })\r\n        );\r\n        promises.push(\r\n          supabase?.from('students')?.select('*')?.eq('class_id', classId)?.order('last_name')\r\n            .then(({ data }) => { studentsData = data || []; })\r\n        );\r\n      }\r\n      \r\n      // Attendre toutes les requ√™tes en parall√®le\r\n      if (promises.length > 0) {\r\n        await Promise.all(promises);\r\n      }\r\n      \r\n      // Pr√©parer les donn√©es pour le PDF\r\n      const pdfData = {\r\n        student: studentData,\r\n        students: studentsData,\r\n        school: schoolData,\r\n        className: classData?.name || studentData?.class_name,\r\n        academicYear: `${new Date().getFullYear()}-${new Date().getFullYear() + 1}`,\r\n        date: new Date().toLocaleDateString('fr-FR')\r\n      };\r\n      \r\n      // G√©n√©rer le PDF (pdfGenerator d√©j√† import√© statiquement)\r\n      const pdfDoc = pdfGenerator.generate(documentType, pdfData);\r\n      \r\n      // OUVRIR LE PDF IMM√âDIATEMENT (sans attendre l'upload)\r\n      pdfGenerator.preview(pdfDoc);\r\n      \r\n      // Sauvegarder en arri√®re-plan (non bloquant)\r\n      this.saveDocumentInBackground(pdfDoc, documentType, {\r\n        schoolId, userId, studentId, classId, visibility, isPublic,\r\n        studentData, classData, pdfGenerator\r\n      });\r\n      \r\n      return { success: true, document: null, error: null };\r\n    } catch (error) {\r\n      console.error('Erreur g√©n√©ration document:', error);\r\n      return { success: false, document: null, error: error?.message };\r\n    }\r\n  }\r\n\r\n  // Sauvegarde le document en arri√®re-plan sans bloquer l'interface\r\n  async saveDocumentInBackground(pdfDoc, documentType, options) {\r\n    const { schoolId, userId, studentId, classId, visibility, isPublic, studentData, classData, pdfGenerator } = options;\r\n    \r\n    try {\r\n      // Convertir en Blob\r\n      const pdfBlob = pdfGenerator.toBlob(pdfDoc);\r\n      \r\n      // Nom du fichier\r\n      const timestamp = Date.now();\r\n      const fileName = `${documentType}_${timestamp}.pdf`;\r\n      const filePath = `school_${schoolId}/documents/${fileName}`;\r\n      \r\n      // Uploader dans Supabase Storage (en arri√®re-plan)\r\n      const { error: uploadError } = await supabase.storage\r\n        .from('documents')\r\n        .upload(filePath, pdfBlob, {\r\n          contentType: 'application/pdf',\r\n          upsert: false\r\n        });\r\n      \r\n      if (uploadError) {\r\n        console.warn('‚ö†Ô∏è Erreur upload Storage:', uploadError.message);\r\n      }\r\n      \r\n      // G√©n√©rer un titre lisible\r\n      const docTitle = this.generateDocumentTitle(documentType, studentData, classData);\r\n      \r\n      // Insert document record\r\n      const documentData = {\r\n        title: docTitle,\r\n        document_type: documentType,\r\n        school_id: schoolId,\r\n        file_name: fileName,\r\n        file_path: uploadError ? null : filePath,\r\n        file_size: pdfBlob.size,\r\n        mime_type: 'application/pdf',\r\n        visibility: visibility,\r\n        is_public: isPublic\r\n      };\r\n      \r\n      if (studentId) documentData.target_student_id = studentId;\r\n      if (classId) documentData.target_class_id = classId;\r\n      if (userId && userId.length === 36) documentData.uploaded_by = userId;\r\n      \r\n      const { error: insertError } = await supabase?.from('documents')?.insert(documentData);\r\n      \r\n      if (insertError) {\r\n        console.error('‚ùå Erreur insertion document:', insertError.message, insertError.details);\r\n      } else {\r\n        console.log('‚úÖ Document sauvegard√© en arri√®re-plan:', docTitle);\r\n      }\r\n    } catch (error) {\r\n      console.warn('‚ö†Ô∏è Erreur sauvegarde en arri√®re-plan:', error);\r\n      // On ne bloque pas l'utilisateur, le PDF est d√©j√† affich√©\r\n    }\r\n  }\r\n\r\n  // G√©n√®re un titre lisible pour le document\r\n  generateDocumentTitle(documentType, student, classData) {\r\n    const typeLabels = {\r\n      'certificat_scolarite': 'Certificat de scolarit√©',\r\n      'certificat_frequentation': 'Certificat de fr√©quentation',\r\n      'fiche_inscription': 'Fiche d\\'inscription',\r\n      'attestation_paiement': 'Attestation de paiement',\r\n      'autorisation_sortie': 'Autorisation de sortie',\r\n      'bulletin': 'Bulletin scolaire',\r\n      'liste_eleves': 'Liste des √©l√®ves',\r\n      'liste_appel': 'Liste d\\'appel',\r\n      'emploi_du_temps': 'Emploi du temps',\r\n      'certificats_classe': 'Certificats de classe',\r\n      'statistiques_classe': 'Statistiques de classe',\r\n      'bulletin_classe': 'Bulletins de classe',\r\n      'reglement_interieur': 'R√®glement int√©rieur',\r\n      'calendrier_scolaire': 'Calendrier scolaire',\r\n      'circulaire': 'Circulaire',\r\n      'convocation': 'Convocation',\r\n      'avis_important': 'Avis important',\r\n      'avis_paiement': 'Avis de paiement'\r\n    };\r\n    \r\n    const label = typeLabels[documentType] || documentType;\r\n    \r\n    if (student) {\r\n      return `${label} - ${student.last_name} ${student.first_name}`;\r\n    } else if (classData) {\r\n      return `${label} - ${classData.name}`;\r\n    }\r\n    \r\n    return label;\r\n  }\r\n}\r\n\r\nexport const documentService = new DocumentService();"],"names":["PDFGenerator","dateValue","date","student","data","school","academicYear","doc","jsPDF","startY","lineHeight","studentName","birthDate","_a","today","amount","paymentDate","students","className","colWidths","headers","xPos","header","i","yPos","studentList","index","y","pageWidth","pageHeight","margin","days","rowHeight","nameColWidth","dayColWidth","day","title","content","lines","documentType","type","pdfUrl","filename","pdfGenerator","DocumentService","user","dbUserId","res","_b","supabase","_c","saved","dbUser","dbError","_g","_f","_e","_d","e","documentData","file","STORAGE_BUCKET","__vite_import_meta_env__","define_process_env_default","timestamp","fileExtension","fileName","subjectSegment","filePath","storageData","storageError","schoolId","error","_j","_i","_h","filters","query","studentData","studentError","documentId","document","fetchError","action","signedUrlData","urlError","userData","visibility","record","_m","_l","_k","assignmentData","assignmentId","assignments","classes","a","subjects","stats","currentMonth","currentYear","docDate","userId","authUser","savedUser","options","studentId","classId","isPublic","schoolData","studentsData","classData","promises","_n","_r","_q","_p","_o","pdfData","pdfDoc","pdfBlob","uploadError","docTitle","insertError","label","documentService"],"mappings":"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"}