const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/services-CdXttHtG.js","assets/supabase-CIvuJI4W.js"])))=>i.map(i=>d[i]);
import{s as B,_ as ts}from"./services-CdXttHtG.js";import{j as e,u as Xe}from"./contexts-fbpOeTmm.js";import{e as He,r as h,u as ss}from"./react-vendor-CFDIsUAY.js";import{H as as}from"./Helmet-B3bMicap.js";import{H as ls,S as ns}from"./Sidebar-Q0ML3SY6.js";import{I as t,B as F,S as ie,a as ne}from"./index-BPV3rumr.js";import{u as fe}from"./useDashboardData-CL9BpvNP.js";import{R as Ke,B as rs,C as Qe,X as We,Y as Je,T as qe,b as Ie,L as is,c as Ge,a as os,P as cs,d as ds,e as ms}from"./charts-vendor-i33Lw0zL.js";import{i as Ze,s as us}from"./emailService-yXWWlP6-.js";import{p as pe}from"./productionDataService-T6uUAzM-.js";import{u as xs}from"./useRoleSession-CjNGQy2C.js";import"./supabase-CIvuJI4W.js";import"./ui-vendor-BrXTGbgA.js";const hs=({title:C,value:T,change:$,changeType:_,icon:y,description:L,trend:w,onClick:M,navigateTo:o})=>{const P=He(),I=()=>_==="positive"?"text-green-600":_==="negative"?"text-red-600":"text-gray-600",u=()=>_==="positive"?"TrendingUp":_==="negative"?"TrendingDown":"Minus",x=()=>_==="positive"?"from-green-50 to-emerald-50 border-green-200":_==="negative"?"from-red-50 to-pink-50 border-red-200":"from-blue-50 to-indigo-50 border-blue-200",S=()=>_==="positive"?"from-green-600 to-emerald-600":_==="negative"?"from-red-600 to-pink-600":"from-blue-600 to-indigo-600",a=()=>_==="positive"?"bg-gradient-to-r from-green-500 to-emerald-500":_==="negative"?"bg-gradient-to-r from-red-500 to-pink-500":"bg-gradient-to-r from-blue-500 to-indigo-500",b=()=>{M?M():o&&P(o)},q=M||o;return e.jsxs("div",{className:`group bg-gradient-to-br ${x()} border-2 rounded-2xl p-4 sm:p-5 shadow-lg hover:shadow-2xl transition-all duration-300 ${q?"cursor-pointer hover:scale-105 active:scale-100":""}`,onClick:q?b:void 0,role:q?"button":void 0,tabIndex:q?0:void 0,onKeyPress:q?G=>G.key==="Enter"&&b():void 0,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br ${S()} rounded-xl flex items-center justify-center shadow-md group-hover:scale-110 transition-transform flex-shrink-0`,children:e.jsx(t,{name:y,size:20,className:"text-white sm:w-6 sm:h-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-heading font-heading-bold text-xs sm:text-sm text-gray-900 mb-0.5 truncate",children:C}),L&&e.jsx("p",{className:"font-caption font-caption-normal text-[10px] sm:text-xs text-gray-600 truncate",children:L})]})]}),$&&e.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full bg-white/60 backdrop-blur-sm ${I()} flex-shrink-0`,children:[e.jsx(t,{name:u(),size:14}),e.jsxs("span",{className:"font-caption font-caption-bold text-xs",children:[Math.abs($),"%"]})]})]}),e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("span",{className:"font-heading font-heading-bold text-2xl sm:text-3xl text-gray-900",children:T}),q&&e.jsx(t,{name:"ChevronRight",size:16,className:"text-gray-400 group-hover:text-gray-600 transition-colors sm:hidden"})]}),w!==void 0&&e.jsx("div",{className:"w-full bg-white/50 rounded-full h-2 overflow-hidden shadow-inner",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-1000 ${a()}`,style:{width:`${Math.min(100,Math.max(0,w))}%`}})})]})]})},gs=()=>{var q,G;const[C,T]=h.useState("all"),[$,_]=h.useState("all"),[y,L]=h.useState("current"),{data:w,loadClassAverages:M}=fe(),o=w.classes||[];h.useEffect(()=>{M({subject:C,grade:$,period:y})},[C,$,y]);const P=w.classAverages||[],I=[{value:"all",label:"Toutes les mati√®res"},{value:"mathematics",label:"Math√©matiques"},{value:"french",label:"Fran√ßais"},{value:"science",label:"Sciences"},{value:"history",label:"Histoire"}],u=[...new Set(o.map(m=>m.level||m.name))],x=[{value:"all",label:"Tous les niveaux"},...u.map(m=>({value:m,label:m}))],S=[{value:"current",label:"Trimestre actuel"},{value:"previous",label:"Trimestre pr√©c√©dent"},{value:"year",label:"Ann√©e scolaire"}],a=()=>{let m=P;return $!=="all"&&(m=m==null?void 0:m.filter(N=>{var E;return(E=N==null?void 0:N.class)==null?void 0:E.includes($+"√®me")})),m==null?void 0:m.map(N=>({...N,displayValue:C==="all"?N==null?void 0:N.average:N==null?void 0:N[C]}))},b=({active:m,payload:N,label:E})=>{var R,s;if(m&&N&&(N!=null&&N.length)){const d=(R=N==null?void 0:N[0])==null?void 0:R.payload;return e.jsxs("div",{className:"bg-popover border border-border rounded-lg p-3 shadow-modal",children:[e.jsx("p",{className:"font-heading font-heading-semibold text-sm text-popover-foreground mb-2",children:E}),C==="all"?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:["Math√©matiques: ",e.jsxs("span",{className:"text-popover-foreground font-body-semibold",children:[d==null?void 0:d.mathematics,"/100"]})]}),e.jsxs("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:["Fran√ßais: ",e.jsxs("span",{className:"text-popover-foreground font-body-semibold",children:[d==null?void 0:d.french,"/100"]})]}),e.jsxs("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:["Sciences: ",e.jsxs("span",{className:"text-popover-foreground font-body-semibold",children:[d==null?void 0:d.science,"/100"]})]}),e.jsxs("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:["Histoire: ",e.jsxs("span",{className:"text-popover-foreground font-body-semibold",children:[d==null?void 0:d.history,"/100"]})]}),e.jsx("div",{className:"border-t border-border pt-1 mt-2",children:e.jsxs("p",{className:"font-body font-body-semibold text-sm text-popover-foreground",children:["Moyenne: ",d==null?void 0:d.average,"/100"]})})]}):e.jsxs("p",{className:"font-body font-body-semibold text-sm text-popover-foreground",children:[(s=I==null?void 0:I.find(D=>(D==null?void 0:D.value)===C))==null?void 0:s.label,": ",d==null?void 0:d[C],"/100"]})]})}return null};return e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(t,{name:"BarChart3",size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"Moyennes par classe"}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-muted-foreground",children:"Performance acad√©mique d√©taill√©e"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{variant:"ghost",size:"icon",children:e.jsx(t,{name:"Download",size:16})}),e.jsx(F,{variant:"ghost",size:"icon",children:e.jsx(t,{name:"RefreshCw",size:16})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(ie,{label:"Mati√®re",options:I,value:C,onChange:T}),e.jsx(ie,{label:"Niveau",options:x,value:$,onChange:_}),e.jsx(ie,{label:"P√©riode",options:S,value:y,onChange:L})]}),e.jsx("div",{className:"w-full h-80","aria-label":"Graphique des moyennes par classe",children:e.jsx(Ke,{width:"100%",height:"100%",children:e.jsxs(rs,{data:a(),margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(Qe,{strokeDasharray:"3 3",stroke:"var(--color-border)"}),e.jsx(We,{dataKey:"class",stroke:"var(--color-text-secondary)",fontSize:12,fontFamily:"Inter, sans-serif"}),e.jsx(Je,{stroke:"var(--color-text-secondary)",fontSize:12,fontFamily:"Inter, sans-serif",domain:[0,100]}),e.jsx(qe,{content:e.jsx(b,{})}),e.jsx(Ie,{dataKey:"displayValue",fill:"var(--color-primary)",radius:[4,4,0,0],name:C==="all"?"Moyenne g√©n√©rale":(q=I==null?void 0:I.find(m=>(m==null?void 0:m.value)===C))==null?void 0:q.label})]})})}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-border",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-primary rounded-sm"}),e.jsx("span",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:C==="all"?"Moyenne g√©n√©rale":(G=I==null?void 0:I.find(m=>(m==null?void 0:m.value)===C))==null?void 0:G.label})]})}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:["Derni√®re mise √† jour: ",new Date().toLocaleDateString("fr-FR")," ",new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]})]})},ps=()=>{var a;const[C,T]=h.useState("all"),[$,_]=h.useState("week"),{data:y,loadAttendance:L}=fe(),w=y.classes||[];h.useEffect(()=>{L($)},[$]);const o=(b=>{var G;if(!b||b.length===0)return[];const q={period:((G=b[0])==null?void 0:G.day)||"Jour 1",overall:0};return w.forEach(m=>{q[m.name||m.level]=0}),[q]})(y.attendance||[]),P=[{value:"all",label:"Toutes les classes"},...w.map(b=>({value:b.name||b.level,label:b.name||`${b.level}${b.section?" "+b.section:""}`}))],I=[{value:"week",label:"Cette semaine"},{value:"month",label:"Ce mois"},{value:"term",label:"Ce trimestre"}],u=()=>o,x=()=>{const b=["var(--color-success)","var(--color-warning)","var(--color-accent)","var(--color-secondary)","var(--color-info)"];if(C==="all"){const q=[{key:"overall",color:"var(--color-primary)",name:"Moyenne g√©n√©rale"}];return w.forEach((G,m)=>{const N=G.name||G.level,E=G.name||`${G.level}${G.section?" "+G.section:""}`;q.push({key:N,color:b[m%b.length],name:E})}),q}else return[{key:C,color:"var(--color-primary)",name:C},{key:"overall",color:"var(--color-muted-foreground)",name:"Moyenne √©cole"}]},S=({active:b,payload:q,label:G})=>b&&q&&(q!=null&&q.length)?e.jsxs("div",{className:"bg-popover border border-border rounded-lg p-3 shadow-modal",children:[e.jsx("p",{className:"font-heading font-heading-semibold text-sm text-popover-foreground mb-2",children:G}),e.jsx("div",{className:"space-y-1",children:q==null?void 0:q.map((m,N)=>e.jsxs("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:[e.jsx("span",{style:{color:m==null?void 0:m.color},children:"‚óè"})," ",m==null?void 0:m.name,": ",m==null?void 0:m.value,"%"]},N))})]}):null;return e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-success/10 rounded-lg flex items-center justify-center",children:e.jsx(t,{name:"Users",size:20,className:"text-success"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"Taux de pr√©sence"}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-muted-foreground",children:"Suivi de l'assiduit√© par niveau"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{variant:"ghost",size:"icon",children:e.jsx(t,{name:"Download",size:16})}),e.jsx(F,{variant:"ghost",size:"icon",children:e.jsx(t,{name:"RefreshCw",size:16})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsx(ie,{label:"Classe",options:P,value:C,onChange:T}),e.jsx(ie,{label:"P√©riode",options:I,value:$,onChange:_})]}),e.jsx("div",{className:"w-full h-80","aria-label":"Graphique du taux de pr√©sence",children:e.jsx(Ke,{width:"100%",height:"100%",children:e.jsxs(is,{data:u(),margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(Qe,{strokeDasharray:"3 3",stroke:"var(--color-border)"}),e.jsx(We,{dataKey:"period",stroke:"var(--color-text-secondary)",fontSize:12,fontFamily:"Inter, sans-serif"}),e.jsx(Je,{stroke:"var(--color-text-secondary)",fontSize:12,fontFamily:"Inter, sans-serif",domain:[80,100]}),e.jsx(qe,{content:e.jsx(S,{})}),e.jsx(Ge,{wrapperStyle:{fontSize:"12px",fontFamily:"Inter, sans-serif",color:"var(--color-text-secondary)"}}),(a=x())==null?void 0:a.map(b=>e.jsx(os,{type:"monotone",dataKey:b==null?void 0:b.key,stroke:b==null?void 0:b.color,strokeWidth:2,dot:{fill:b==null?void 0:b.color,strokeWidth:2,r:4},activeDot:{r:6,stroke:b==null?void 0:b.color,strokeWidth:2},name:b==null?void 0:b.name},b==null?void 0:b.key))]})})}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{name:"Info",size:14,className:"text-muted-foreground"}),e.jsx("span",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Aucune donn√©e d'assiduit√© disponible"})]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:["Derni√®re mise √† jour: ",new Date().toLocaleDateString("fr-FR")," ",new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]})]})},fs=()=>{const[C,T]=h.useState("all"),[$,_]=h.useState("current"),[y,L]=h.useState("pie"),{data:w,loadPayments:M}=fe(),o=w.classes||[];h.useEffect(()=>{M()},[C,$]);const I=(m=>!m||m.length===0?[]:m.map(N=>({name:N.status,value:N.count,percentage:N.percentage,color:N.color})))(w.payments||[]),u=o.length>0?o.map(m=>({class:m.name||`${m.level}${m.section?" "+m.section:""}`,paid:0,late:0,unpaid:0,total:0,rate:0})):[{class:"Aucune classe",paid:0,late:0,unpaid:0,total:0,rate:0}],x=[{value:"all",label:"Toutes les classes"},...o.map(m=>({value:m.name||m.level,label:m.name||`${m.level}${m.section?" "+m.section:""}`}))],S=[{value:"current",label:"Trimestre actuel"},{value:"previous",label:"Trimestre pr√©c√©dent"},{value:"year",label:"Ann√©e scolaire"}],a=[{value:"pie",label:"Vue circulaire"},{value:"bar",label:"Vue par classe"}],b=()=>u,q=({active:m,payload:N,label:E})=>{var R,s;if(m&&N&&(N!=null&&N.length))if(y==="pie"){const d=N==null?void 0:N[0];return e.jsxs("div",{className:"bg-popover border border-border rounded-lg p-3 shadow-modal",children:[e.jsx("p",{className:"font-heading font-heading-semibold text-sm text-popover-foreground mb-1",children:d==null?void 0:d.name}),e.jsxs("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:["Nombre: ",e.jsx("span",{className:"text-popover-foreground font-body-semibold",children:d==null?void 0:d.value})]}),e.jsxs("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:["Pourcentage: ",e.jsxs("span",{className:"text-popover-foreground font-body-semibold",children:[(R=d==null?void 0:d.payload)==null?void 0:R.percentage,"%"]})]})]})}else{const d=(s=N==null?void 0:N[0])==null?void 0:s.payload;return e.jsxs("div",{className:"bg-popover border border-border rounded-lg p-3 shadow-modal",children:[e.jsx("p",{className:"font-heading font-heading-semibold text-sm text-popover-foreground mb-2",children:E}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:["Pay√©: ",e.jsx("span",{className:"text-success font-body-semibold",children:d==null?void 0:d.paid})]}),e.jsxs("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:["En retard: ",e.jsx("span",{className:"text-warning font-body-semibold",children:d==null?void 0:d.late})]}),e.jsxs("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:["Impay√©: ",e.jsx("span",{className:"text-error font-body-semibold",children:d==null?void 0:d.unpaid})]}),e.jsx("div",{className:"border-t border-border pt-1 mt-2",children:e.jsxs("p",{className:"font-body font-body-semibold text-sm text-popover-foreground",children:["Taux de paiement: ",d==null?void 0:d.rate,"%"]})})]})]})}return null},G=m=>{const{payload:N}=m;return e.jsx("div",{className:"flex justify-center space-x-6 mt-4",children:N==null?void 0:N.map((E,R)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-sm",style:{backgroundColor:E==null?void 0:E.color}}),e.jsx("span",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:E==null?void 0:E.value})]},R))})};return e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-warning/10 rounded-lg flex items-center justify-center",children:e.jsx(t,{name:"CreditCard",size:20,className:"text-warning"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"Statut des paiements"}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-muted-foreground",children:"Suivi des frais de scolarit√©"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{variant:"ghost",size:"icon",children:e.jsx(t,{name:"Download",size:16})}),e.jsx(F,{variant:"ghost",size:"icon",children:e.jsx(t,{name:"RefreshCw",size:16})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(ie,{label:"Vue",options:a,value:y,onChange:L}),e.jsx(ie,{label:"Classe",options:x,value:C,onChange:T}),e.jsx(ie,{label:"P√©riode",options:S,value:$,onChange:_})]}),e.jsx("div",{className:"w-full h-80","aria-label":"Graphique du statut des paiements",children:e.jsx(Ke,{width:"100%",height:"100%",children:y==="pie"?e.jsxs(cs,{children:[e.jsx(ds,{data:I,cx:"50%",cy:"50%",innerRadius:60,outerRadius:120,paddingAngle:2,dataKey:"value",children:I==null?void 0:I.map((m,N)=>e.jsx(ms,{fill:m==null?void 0:m.color},`cell-${N}`))}),e.jsx(qe,{content:e.jsx(q,{})}),e.jsx(Ge,{content:G})]}):e.jsxs(rs,{data:b(),margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(Qe,{strokeDasharray:"3 3",stroke:"var(--color-border)"}),e.jsx(We,{dataKey:"class",stroke:"var(--color-text-secondary)",fontSize:12,fontFamily:"Inter, sans-serif"}),e.jsx(Je,{stroke:"var(--color-text-secondary)",fontSize:12,fontFamily:"Inter, sans-serif"}),e.jsx(qe,{content:e.jsx(q,{})}),e.jsx(Ge,{}),e.jsx(Ie,{dataKey:"paid",fill:"var(--color-success)",name:"Pay√©",radius:[2,2,0,0]}),e.jsx(Ie,{dataKey:"late",fill:"var(--color-warning)",name:"En retard",radius:[2,2,0,0]}),e.jsx(Ie,{dataKey:"unpaid",fill:"var(--color-error)",name:"Impay√©",radius:[2,2,0,0]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6 pt-4 border-t border-border",children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 bg-success rounded-sm"}),e.jsx("span",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"0"})]}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Paiements √† jour (0%)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 bg-warning rounded-sm"}),e.jsx("span",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"0"})]}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Paiements en retard (0%)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 bg-error rounded-sm"}),e.jsx("span",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"0"})]}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Paiements impay√©s (0%)"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-border",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{name:"Euro",size:14,className:"text-muted-foreground"}),e.jsx("span",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Montant collect√©: 0 FCFA"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{name:"Info",size:14,className:"text-muted-foreground"}),e.jsx("span",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Aucune transaction enregistr√©e"})]})]})}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:["Derni√®re mise √† jour: ",new Date().toLocaleDateString("fr-FR")," ",new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]})]})},bs=()=>{var M,o,P,I;const[C,T]=h.useState(null),$=He(),{user:_}=fe(),y=[{id:"staff-login",title:"Connexion Personnel",description:"Acc√®s pour enseignants, √©l√®ves et parents",icon:"LogIn",color:"bg-primary",path:"/staff-login"},{id:"notifications",title:"Envoyer une notification",description:"Diffuser un message √† toute l'√©cole",icon:"Bell",color:"bg-secondary",path:"/notification-management"},{id:"reports",title:"G√©n√©rer un rapport",description:"Cr√©er des rapports personnalis√©s",icon:"FileBarChart",color:"bg-success",path:"/report-generation"},{id:"staff",title:"Gestion du personnel",description:"Cr√©er et g√©rer les comptes du personnel",icon:"Users",color:"bg-warning",path:"/principal-dashboard?tab=accounts"},{id:"calendar",title:"Calendrier scolaire",description:"G√©rer les √©v√©nements et vacances",icon:"Calendar",color:"bg-accent",path:"/school-calendar"}],L=[{id:1,title:"√âcole configur√©e",description:`Configuration de ${((M=_==null?void 0:_.schoolData)==null?void 0:M.name)||"votre √©cole"}`,time:"r√©cemment",icon:"School",type:"success"},{id:2,title:"Classes configur√©es",description:`${((P=(o=_==null?void 0:_.schoolData)==null?void 0:o.available_classes)==null?void 0:P.length)||0} classes d√©finies`,time:"r√©cemment",icon:"BookOpen",type:"success"},{id:3,title:"Syst√®me op√©rationnel",description:"Connexion √† la base de donn√©es √©tablie",time:"maintenant",icon:"Database",type:"success"},{id:4,title:"Syst√®me actif",description:"Donn√©es synchronis√©es",time:"maintenant",icon:"Shield",type:"info"}],w=u=>{switch(u){case"success":return"CheckCircle";case"warning":return"AlertTriangle";case"error":return"XCircle";default:return"Info"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"Zap",size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Actions Rapides"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Acc√®s direct aux fonctions principales pour ",((I=_==null?void 0:_.schoolData)==null?void 0:I.name)||"votre √©cole"]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:y==null?void 0:y.map(u=>{var x,S;return e.jsx("button",{onClick:()=>$(u==null?void 0:u.path),className:"group p-5 bg-gradient-to-br from-gray-50 to-white hover:from-blue-50 hover:to-indigo-50 border-2 border-gray-200 hover:border-blue-400 rounded-2xl transition-all duration-300 text-left hover:shadow-lg hover:scale-105",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`w-12 h-12 bg-gradient-to-br ${(x=u==null?void 0:u.color)==null?void 0:x.replace("bg-","from-")} ${(S=u==null?void 0:u.color)==null?void 0:S.replace("bg-primary","to-blue-600").replace("bg-secondary","to-indigo-600").replace("bg-success","to-green-600").replace("bg-warning","to-amber-600").replace("bg-accent","to-purple-600")} rounded-xl flex items-center justify-center shadow-md group-hover:scale-110 transition-transform`,children:e.jsx(t,{name:u==null?void 0:u.icon,size:20,className:"text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-sm mb-1 group-hover:text-blue-700",children:u==null?void 0:u.title}),e.jsx("p",{className:"text-xs text-gray-600",children:u==null?void 0:u.description})]}),e.jsx(t,{name:"ChevronRight",size:16,className:"text-gray-400 group-hover:text-blue-600 group-hover:translate-x-1 transition-all"})]})},u==null?void 0:u.id)})})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"Activity",size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Activit√©s R√©centes"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Historique des derni√®res actions"})]})]}),e.jsxs("button",{className:"px-3 py-1.5 text-sm font-medium bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center space-x-1",children:[e.jsx(t,{name:"ExternalLink",size:14}),e.jsx("span",{children:"Voir tout"})]})]}),e.jsx("div",{className:"space-y-3",children:L==null?void 0:L.map(u=>e.jsxs("div",{className:"flex items-start space-x-3 p-4 rounded-xl bg-gradient-to-r from-gray-50 to-white hover:from-blue-50 hover:to-indigo-50 border border-gray-200 hover:border-blue-300 transition-all duration-300 hover:shadow-md",children:[e.jsx("div",{className:`flex-shrink-0 mt-1 w-8 h-8 rounded-lg flex items-center justify-center ${(u==null?void 0:u.type)==="success"?"bg-gradient-to-br from-green-100 to-emerald-100 text-green-600":(u==null?void 0:u.type)==="warning"?"bg-gradient-to-br from-amber-100 to-orange-100 text-amber-600":(u==null?void 0:u.type)==="error"?"bg-gradient-to-br from-red-100 to-pink-100 text-red-600":"bg-gradient-to-br from-blue-100 to-indigo-100 text-blue-600"}`,children:e.jsx(t,{name:w(u==null?void 0:u.type),size:16})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-900",children:u==null?void 0:u.title}),e.jsxs("span",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:["Il y a ",u==null?void 0:u.time]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:u==null?void 0:u.description})]})]},u==null?void 0:u.id))}),e.jsx("div",{className:"flex items-center justify-center mt-6 pt-4 border-t border-gray-200",children:e.jsxs("button",{className:"px-4 py-2 text-sm font-medium bg-gradient-to-r from-blue-50 to-indigo-50 text-blue-700 rounded-lg hover:from-blue-100 hover:to-indigo-100 transition-all flex items-center space-x-2",children:[e.jsx(t,{name:"RefreshCw",size:14}),e.jsx("span",{children:"Actualiser"})]})})]})]})},vs=()=>{const[C,T]=h.useState(!1),[$,_]=h.useState(!1),[y,L]=h.useState(""),[w,M]=h.useState(!1),{user:o}=Xe(),{data:P}=fe(),I=P.schoolDetails,u=o==null?void 0:o.schoolData,x=I||u,S=()=>{var n,j,X;return(x==null?void 0:x.email)||(x==null?void 0:x.director_email)||((n=x==null?void 0:x.users)==null?void 0:n.email)||((X=(j=o==null?void 0:o.schoolData)==null?void 0:j.users)==null?void 0:X.email)||(o==null?void 0:o.email)||""},[a,b]=h.useState({name:"",type:"college",phone:"",email:"",address:"",availableClasses:[]});h.useEffect(()=>{var j;const n=S();b({name:(x==null?void 0:x.name)||(x==null?void 0:x.director_name)||(o==null?void 0:o.full_name)||"Votre √©tablissement",type:(x==null?void 0:x.type)||"college",phone:(x==null?void 0:x.phone)||(o==null?void 0:o.phone)||"",email:n,address:(x==null?void 0:x.address)||"",availableClasses:((j=x==null?void 0:x.available_classes)==null?void 0:j.map(X=>({level:X,isActive:!0,isCustom:!1})))||[]})},[o,P]),h.useEffect(()=>{const n=G(a.type);b(j=>({...j,availableClasses:[...n.map(X=>({level:X.value,isActive:!1,isCustom:!1,category:X.category})),...j.availableClasses.filter(X=>X.isCustom)]}))},[a.type]);const q=[{value:"maternelle",label:"√âcole Maternelle"},{value:"primaire",label:"√âcole Primaire"},{value:"college",label:"Coll√®ge (6√®me - 3√®me)"},{value:"lycee",label:"Lyc√©e (2nde - Terminale)"},{value:"college_lycee",label:"Coll√®ge-Lyc√©e (6√®me - Terminale)"},{value:"universite",label:"Universit√©"},{value:"formation_professionnelle",label:"Formation Professionnelle"}],G=n=>{switch(n){case"maternelle":return[{value:"Petite Section",label:"Petite Section",category:"maternelle"},{value:"Moyenne Section",label:"Moyenne Section",category:"maternelle"},{value:"Grande Section",label:"Grande Section",category:"maternelle"}];case"primaire":return[{value:"CP",label:"CP (Cours Pr√©paratoire)",category:"primaire"},{value:"CE1",label:"CE1 (Cours √âl√©mentaire 1)",category:"primaire"},{value:"CE2",label:"CE2 (Cours √âl√©mentaire 2)",category:"primaire"},{value:"CM1",label:"CM1 (Cours Moyen 1)",category:"primaire"},{value:"CM2",label:"CM2 (Cours Moyen 2)",category:"primaire"}];case"college":return[{value:"6√®me",label:"6√®me",category:"coll√®ge"},{value:"5√®me",label:"5√®me",category:"coll√®ge"},{value:"4√®me",label:"4√®me",category:"coll√®ge"},{value:"3√®me",label:"3√®me",category:"coll√®ge"}];case"lycee":return[{value:"2nde",label:"2nde (Seconde)",category:"lyc√©e"},{value:"1√®re",label:"1√®re (Premi√®re)",category:"lyc√©e"},{value:"Terminale",label:"Terminale",category:"lyc√©e"}];case"college_lycee":return[{value:"6√®me",label:"6√®me",category:"coll√®ge"},{value:"5√®me",label:"5√®me",category:"coll√®ge"},{value:"4√®me",label:"4√®me",category:"coll√®ge"},{value:"3√®me",label:"3√®me",category:"coll√®ge"},{value:"2nde",label:"2nde (Seconde)",category:"lyc√©e"},{value:"1√®re",label:"1√®re (Premi√®re)",category:"lyc√©e"},{value:"Terminale",label:"Terminale",category:"lyc√©e"}];case"universite":return[{value:"L1",label:"Licence 1",category:"universit√©"},{value:"L2",label:"Licence 2",category:"universit√©"},{value:"L3",label:"Licence 3",category:"universit√©"},{value:"M1",label:"Master 1",category:"universit√©"},{value:"M2",label:"Master 2",category:"universit√©"},{value:"Doctorat",label:"Doctorat",category:"universit√©"}];case"formation_professionnelle":return[{value:"CAP1",label:"CAP Premi√®re Ann√©e",category:"professionnel"},{value:"CAP2",label:"CAP Deuxi√®me Ann√©e",category:"professionnel"},{value:"BEP1",label:"BEP Premi√®re Ann√©e",category:"professionnel"},{value:"BEP2",label:"BEP Deuxi√®me Ann√©e",category:"professionnel"},{value:"BAC_PRO1",label:"Bac Pro Premi√®re Ann√©e",category:"professionnel"},{value:"BAC_PRO2",label:"Bac Pro Deuxi√®me Ann√©e",category:"professionnel"},{value:"BAC_PRO3",label:"Bac Pro Troisi√®me Ann√©e",category:"professionnel"}];default:return[]}},m=(n,j)=>{b(X=>({...X,[n]:j}))},N=n=>{b(j=>({...j,availableClasses:j.availableClasses.map(X=>X.level===n?{...X,isActive:!X.isActive}:X)}))},E=()=>{if(!y.trim())return;if(a.availableClasses.some(j=>j.level.toLowerCase()===y.trim().toLowerCase())){alert("Cette classe existe d√©j√† !");return}b(j=>({...j,availableClasses:[...j.availableClasses,{level:y.trim(),isActive:!0,isCustom:!0,category:"personnalis√©e"}]})),L(""),M(!1)},R=n=>{b(j=>({...j,availableClasses:j.availableClasses.filter(X=>X.level!==n)}))},s=n=>{b(j=>({...j,type:n}))},d=async()=>{_(!0);try{await new Promise(n=>setTimeout(n,2e3)),alert("Param√®tres sauvegard√©s avec succ√®s !")}catch(n){console.error("Erreur lors de la sauvegarde:",n),alert("Erreur lors de la sauvegarde")}_(!1)},D=()=>a.availableClasses.filter(n=>n.isActive).length,H=()=>{const n=q.find(j=>j.value===a.type);return n?n.label:"Non d√©fini"},re=n=>{switch(n){case"maternelle":return"√âcole maternelle : Petite, Moyenne et Grande Section pour les enfants de 3 √† 6 ans.";case"primaire":return"√âcole primaire : Classes de CP √† CM2 pour les enfants de 6 √† 11 ans.";case"college":return"Coll√®ge : Classes de 6√®me √† 3√®me pour le premier cycle du secondaire (Cameroun).";case"lycee":return"Lyc√©e : Classes de 2nde √† Terminale pour le second cycle du secondaire (Cameroun).";case"college_lycee":return"Coll√®ge-Lyc√©e : √âtablissement complet de la 6√®me √† la Terminale (tr√®s courant au Cameroun).";case"universite":return"Universit√© : Enseignement sup√©rieur (Licence, Master, Doctorat).";case"formation_professionnelle":return"Formation professionnelle : CAP, BEP, Bac Pro pour l'apprentissage de m√©tiers sp√©cialis√©s.";default:return"S√©lectionnez un type d'√©tablissement pour voir les classes appropri√©es."}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(t,{name:"School",size:20,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"Param√®tres de l'√©tablissement"}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-muted-foreground",children:"Configuration et informations g√©n√©rales"})]})]}),e.jsxs(F,{onClick:d,loading:$,children:[e.jsx(t,{name:"Save",size:16,className:"mr-2"}),"Sauvegarder"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(t,{name:"GraduationCap",size:20,className:"text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-semibold text-sm text-blue-900",children:"Type d'√©tablissement"}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-blue-700",children:H()})]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(t,{name:"Users",size:20,className:"text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-semibold text-sm text-green-900",children:"Classes actives"}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-green-700",children:[D()," niveaux disponibles"]})]})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(t,{name:"Calendar",size:20,className:"text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-body font-body-semibold text-sm text-purple-900",children:"Ann√©e scolaire"}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-purple-700",children:"2025-2026"})]})]})}),e.jsx("div",{className:"bg-orange-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(t,{name:"Mail",size:20,className:"text-orange-600"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-body font-body-semibold text-sm text-orange-900",children:"Email principal"}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-orange-700 truncate",title:S()||"Non d√©fini - Veuillez configurer",children:S()?e.jsxs("span",{className:"flex items-center",children:[e.jsx(t,{name:"CheckCircle",size:12,className:"mr-1 text-green-600"}),S()]}):e.jsxs("span",{className:"flex items-center text-red-600",children:[e.jsx(t,{name:"AlertCircle",size:12,className:"mr-1"}),"Non d√©fini"]})})]})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-4 text-sm",children:"Informations de base"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ne,{label:"Nom de l'√©tablissement",value:a.name,onChange:n=>m("name",n.target.value),placeholder:"Ex: Complexe Scolaire Excellence"}),e.jsx(ie,{label:"Type d'√©tablissement",value:a.type,onChange:s,options:q})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-4 text-sm flex items-center",children:[e.jsx(t,{name:"Phone",size:16,className:"mr-2 text-blue-600"}),"Informations de contact"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ne,{label:"Email de l'√©tablissement",type:"email",value:a.email||S(),onChange:n=>m("email",n.target.value),placeholder:S()||"contact@votre-ecole.cm",helperText:"üìß Email principal pour les communications officielles"}),e.jsx(ne,{label:"T√©l√©phone",value:a.phone,onChange:n=>m("phone",n.target.value),placeholder:"+237 6XX XXX XXX",helperText:"üìû Num√©ro principal de l'√©tablissement"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-4 text-sm flex items-center",children:[e.jsx(t,{name:"MapPin",size:16,className:"mr-2 text-green-600"}),"Localisation"]}),e.jsx(ne,{label:"Adresse compl√®te",value:a.address,onChange:n=>m("address",n.target.value),placeholder:"Quartier, Ville, R√©gion",helperText:"üìç Adresse physique de l'√©tablissement"})]})]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(t,{name:"Users",size:20,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"Classes disponibles"}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-muted-foreground",children:"S√©lectionnez les niveaux propos√©s dans votre √©tablissement"})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[D()," / ",a.availableClasses.length," classes actives"]})]}),a.availableClasses.length>0&&e.jsx("div",{className:"space-y-6",children:[...new Set(a.availableClasses.map(n=>n.category||"autre"))].map(n=>e.jsxs("div",{children:[e.jsxs("h4",{className:"font-body font-body-semibold text-sm text-gray-900 mb-3 capitalize",children:["Classes ",n]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.availableClasses.filter(j=>(j.category||"autre")===n).map(j=>{const ae=G(a.type).find(he=>he.value===j.level);return e.jsx("div",{className:`p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 relative ${j.isActive?"border-green-300 bg-green-50 hover:bg-green-100":"border-gray-200 bg-gray-50 hover:bg-gray-100"}`,onClick:()=>N(j.level),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${j.isActive?"bg-green-100":"bg-gray-100"}`,children:e.jsx(t,{name:j.isActive?"CheckCircle":"Circle",size:16,className:j.isActive?"text-green-600":"text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:`font-body font-body-semibold text-sm ${j.isActive?"text-green-900":"text-gray-600"}`,children:[j.level,j.isCustom&&e.jsx("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:"Personnalis√©e"})]}),e.jsx("p",{className:`font-caption font-caption-normal text-xs ${j.isActive?"text-green-700":"text-gray-500"}`,children:(ae==null?void 0:ae.label)||j.category})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[j.isActive&&e.jsx(t,{name:"Check",size:16,className:"text-green-600"}),j.isCustom&&e.jsx("button",{onClick:he=>{he.stopPropagation(),R(j.level)},className:"text-red-500 hover:text-red-700 p-1",title:"Supprimer cette classe personnalis√©e",children:e.jsx(t,{name:"Trash2",size:14})})]})]})},j.level)})})]},n||"autre"))}),e.jsx("div",{className:"mt-6",children:w?e.jsxs("div",{className:"flex space-x-3 items-end",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ne,{label:"Nom de la classe",value:y,onChange:n=>L(n.target.value),placeholder:"Ex: CP3, BEP, CAP...",onKeyPress:n=>n.key==="Enter"&&E()})}),e.jsx(F,{onClick:E,disabled:!y.trim(),className:"bg-green-600 hover:bg-green-700",children:e.jsx(t,{name:"Check",size:16})}),e.jsx(F,{variant:"outline",onClick:()=>{M(!1),L("")},children:e.jsx(t,{name:"X",size:16})})]}):e.jsxs(F,{variant:"outline",onClick:()=>M(!0),className:"border-dashed border-gray-300 hover:border-blue-400 hover:bg-blue-50",children:[e.jsx(t,{name:"Plus",size:16,className:"mr-2"}),"Ajouter une classe personnalis√©e"]})}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(t,{name:"Info",size:16,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-body font-body-semibold text-sm text-blue-900 mb-1",children:["Configuration adapt√©e - ",H()]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-blue-700",children:[re(a.type),e.jsx("br",{}),"Les classes s√©lectionn√©es seront disponibles pour l'inscription des √©l√®ves et l'affectation des enseignants."]})]})]})})]})]})},js=()=>{var m,N;const[C,T]=h.useState("excellent"),[$,_]=h.useState(new Date),[y,L]=h.useState("system"),{user:w}=Xe(),{data:M}=fe();h.useEffect(()=>{const E=setInterval(()=>{_(new Date)},3e4);return()=>clearInterval(E)},[]);const o=[{id:"database",name:"Base de donn√©es Supabase",status:"online",uptime:"100%",responseTime:"15ms",icon:"Database",description:`Donn√©es de ${((m=w==null?void 0:w.schoolData)==null?void 0:m.name)||"votre √©cole"}`},{id:"storage",name:"Stockage Supabase",status:"online",uptime:"99.9%",responseTime:"25ms",icon:"HardDrive",description:"Documents et fichiers"},{id:"auth",name:"Authentification",status:"online",uptime:"100%",responseTime:"8ms",icon:"Shield",description:"Syst√®me de connexion s√©curis√©"},{id:"api",name:"API Supabase",status:"online",uptime:"99.8%",responseTime:"45ms",icon:"Wifi",description:"Interface de programmation"}],P=[{id:1,type:"success",title:"Syst√®me op√©rationnel",message:`${((N=w==null?void 0:w.schoolData)==null?void 0:N.name)||"Votre √©cole"} fonctionne normalement`,time:"1 minute",severity:"low"},{id:2,type:"info",title:"Sauvegarde automatique",message:"Donn√©es sauvegard√©es sur Supabase avec succ√®s",time:"30 minutes",severity:"low"}],I=E=>{switch(E){case"online":return"text-success";case"warning":return"text-warning";case"offline":return"text-error";default:return"text-muted-foreground"}},u=E=>{switch(E){case"online":return"bg-success/10";case"warning":return"bg-warning/10";case"offline":return"bg-error/10";default:return"bg-muted/10"}},x=E=>{switch(E){case"online":return"En ligne";case"warning":return"Attention";case"offline":return"Hors ligne";default:return"Inconnu"}},S=E=>{switch(E){case"success":return"CheckCircle";case"warning":return"AlertTriangle";case"error":return"XCircle";default:return"Info"}},a=E=>{switch(E){case"success":return"text-success";case"warning":return"text-warning";case"error":return"text-error";default:return"text-primary"}},b=E=>E==null?void 0:E.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),q=[{id:"system",label:"√âtat du syst√®me",icon:"Activity"},{id:"school",label:"Param√®tres √©cole",icon:"School"}],G=()=>{var E,R;switch(y){case"school":return e.jsx(vs,{});case"system":default:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-600 to-emerald-600 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"Activity",size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"√âtat du Syst√®me"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Surveillance r√©elle - ",((E=w==null?void 0:w.schoolData)==null?void 0:E.name)||"Votre √©cole"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-semibold text-green-700",children:"Syst√®me op√©rationnel"})]}),e.jsx("button",{className:"p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:e.jsx(t,{name:"RefreshCw",size:16,className:"text-gray-700"})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o==null?void 0:o.map(s=>e.jsxs("div",{className:"p-5 bg-gradient-to-br from-gray-50 to-white border-2 border-gray-200 rounded-2xl hover:border-blue-400 hover:shadow-lg hover:scale-105 transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center shadow-md ${(s==null?void 0:s.status)==="online"?"bg-gradient-to-br from-green-600 to-emerald-600":(s==null?void 0:s.status)==="warning"?"bg-gradient-to-br from-amber-500 to-orange-500":"bg-gradient-to-br from-red-500 to-pink-500"}`,children:e.jsx(t,{name:s==null?void 0:s.icon,size:16,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-body font-body-semibold text-sm text-card-foreground",children:s==null?void 0:s.name}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:s==null?void 0:s.description})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-caption font-caption-normal ${u(s==null?void 0:s.status)} ${I(s==null?void 0:s.status)}`,children:x(s==null?void 0:s.status)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-muted-foreground",children:"Disponibilit√©"}),e.jsx("p",{className:"font-body font-body-semibold text-card-foreground",children:s==null?void 0:s.uptime})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-caption font-caption-normal text-muted-foreground",children:"Temps r√©ponse"}),e.jsx("p",{className:"font-body font-body-semibold text-card-foreground",children:s==null?void 0:s.responseTime})]})]})]},s==null?void 0:s.id))})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-success/10 rounded-lg flex items-center justify-center",children:e.jsx(t,{name:"Shield",size:20,className:"text-success"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"Alertes s√©curit√©"}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-muted-foreground",children:"Surveillance r√©elle des √©v√©nements"})]})]}),e.jsxs(F,{variant:"ghost",size:"sm",children:[e.jsx(t,{name:"ExternalLink",size:14,className:"mr-2"}),"Voir tout"]})]}),e.jsx("div",{className:"space-y-4",children:P==null?void 0:P.map(s=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg hover:bg-muted/50 transition-micro",children:[e.jsx("div",{className:`flex-shrink-0 mt-1 ${a(s==null?void 0:s.type)}`,children:e.jsx(t,{name:S(s==null?void 0:s.type),size:16})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-body font-body-semibold text-sm text-card-foreground",children:s==null?void 0:s.title}),e.jsxs("span",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:["Il y a ",s==null?void 0:s.time]})]}),e.jsx("p",{className:"font-body font-body-normal text-sm text-muted-foreground mt-1",children:s==null?void 0:s.message}),e.jsx("div",{className:"flex items-center space-x-2 mt-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-caption font-caption-normal ${(s==null?void 0:s.severity)==="high"?"bg-error/10 text-error":(s==null?void 0:s.severity)==="medium"?"bg-warning/10 text-warning":"bg-primary/10 text-primary"}`,children:(s==null?void 0:s.severity)==="high"?"Critique":(s==null?void 0:s.severity)==="medium"?"Moyen":"Faible"})})]})]},s==null?void 0:s.id))})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"Informations syst√®me"}),e.jsxs("span",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:["Derni√®re mise √† jour: ",b($)]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(t,{name:"Users",size:16,className:"text-primary"}),e.jsx("span",{className:"font-heading font-heading-bold text-xl text-card-foreground",children:(M==null?void 0:M.activeUsers)||"1"})]}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Utilisateurs connect√©s"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(t,{name:"Database",size:16,className:"text-success"}),e.jsx("span",{className:"font-heading font-heading-bold text-xl text-card-foreground",children:(M==null?void 0:M.storageUsed)||"1.2 GB"})]}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Espace utilis√©"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(t,{name:"Zap",size:16,className:"text-success"}),e.jsx("span",{className:"font-heading font-heading-bold text-xl text-card-foreground",children:"100%"})]}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Disponibilit√© Supabase"})]})]})]}),e.jsx("div",{className:"rounded-lg p-4 bg-green-50 border border-green-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(t,{name:"Database",size:20,className:"text-green-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-green-800",children:"Mode Production - Syst√®me"}),e.jsxs("p",{className:"text-sm text-green-700",children:["M√©triques syst√®me r√©elles pour ",((R=w==null?void 0:w.schoolData)==null?void 0:R.name)||"votre √©tablissement",". Surveillance authentique via Supabase avec donn√©es s√©curis√©es."]})]})]})})]})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg w-fit",children:q.map(E=>e.jsxs("button",{onClick:()=>L(E.id),className:`flex items-center space-x-2 px-4 py-2 text-sm rounded-md transition-all duration-200 ${y===E.id?"bg-white text-blue-600 shadow-sm font-medium":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(t,{name:E.icon,size:16}),e.jsx("span",{children:E.label})]},E.id))}),G()]})},Ns=()=>{const C=ss(),[T,$]=h.useState("overview"),[_,y]=h.useState(""),[L,w]=h.useState("all"),[M,o]=h.useState("all"),[P,I]=h.useState(!1),[u,x]=h.useState(!1),{user:S}=Xe();fe();const[a,b]=h.useState(S),[q,G]=h.useState(!1);h.useEffect(()=>{(async()=>{var l,f;if(!(S!=null&&S.id)){b(S),G(!0);return}try{const{data:p,error:A}=await B.from("users").select(`
            id, 
            email, 
            full_name, 
            role, 
            phone, 
            current_school_id,
            school:schools!users_current_school_id_fkey(id, name)
          `).eq("id",S.id).single();if(A)console.error("‚ùå Erreur chargement donn√©es utilisateur:",A),b(S);else{console.log("‚úÖ Donn√©es utilisateur charg√©es:",p);const{data:K}=await B.from("schools").select("type").eq("id",p.current_school_id).single(),{data:U}=await B.from("academic_years").select("id, name").eq("school_id",p.current_school_id).eq("is_current",!0).single();console.log("üìÖ Ann√©e acad√©mique courante:",U);const Y={...p,school_id:((l=p.school)==null?void 0:l.id)||p.current_school_id,school_name:((f=p.school)==null?void 0:f.name)||"√âcole",school_type:(K==null?void 0:K.type)||"combined",academic_year_id:(U==null?void 0:U.id)||null,academic_year_name:(U==null?void 0:U.name)||null};b(Y)}}catch(p){console.error("‚ùå Exception chargement utilisateur:",p),b(S)}finally{G(!0)}})()},[S]),h.useEffect(()=>{const l=new URLSearchParams(C.search).get("subtab");l&&["overview","accounts","create","security"].includes(l)&&$(l),L==="principal"&&w("all")},[C.search,L]);const[m,N]=h.useState([]),[E,R]=h.useState(!1),[s,d]=h.useState({fullName:"",email:"",phone:"",role:"student",password:"",status:"active",specialty:"",hireDate:new Date().toISOString().split("T")[0],selectedClasses:[],selectedSubjects:[],weeklyHours:"",permissions:[],department:"",schoolLevel:"primary",matricule:"",classId:"",dateOfBirth:"",parentId:"",parentName:"",parentPhone:"",parentEmail:"",selectedChildren:[],profession:"",address:""}),[D,H]=h.useState([]),[re,n]=h.useState([]),[j,X]=h.useState([]),[ae,he]=h.useState(!1),[i,ve]=h.useState(!1),[ge,we]=h.useState(""),[be,de]=h.useState(!1);h.useEffect(()=>{if(s.role==="student"&&s.classId){const r=D.find(l=>l.value===s.classId);if(r&&(a!=null&&a.school_type)){const l=v(a.school_type,r.label);l!==s.schoolLevel&&(d(f=>({...f,schoolLevel:l})),console.log(`üéØ Niveau d√©tect√© automatiquement: ${l} (classe: ${r.label}, type √©cole: ${a.school_type})`))}}},[s.classId,s.role,D,a==null?void 0:a.school_type]);const ue={total:m.length,active:m.filter(r=>r.is_active!==void 0?r.is_active:r.status==="active").length,inactive:m.filter(r=>r.status==="inactive").length,locked:m.filter(r=>r.is_locked).length,byRole:{principal:m.filter(r=>r.role==="principal").length,teacher:m.filter(r=>r.role==="teacher").length,secretary:m.filter(r=>r.role==="secretary").length,student:m.filter(r=>r.role==="student").length,parent:m.filter(r=>r.role==="parent").length}},Ce=m.filter(r=>{const l=r.full_name.toLowerCase().includes(_.toLowerCase())||r.email.toLowerCase().includes(_.toLowerCase()),f=L==="all"||r.role===L,p=r.is_active!==void 0?r.is_active?"active":"inactive":r.status;return l&&f&&(M==="all"||p===M)}),Re=[{value:"all",label:"Tous les r√¥les"},{value:"teacher",label:"Enseignant"},{value:"secretary",label:"Secr√©taire"},{value:"student",label:"√âl√®ve"},{value:"parent",label:"Parent"}],Ue=[{value:"all",label:"Tous les statuts"},{value:"active",label:"Actif"},{value:"inactive",label:"Inactif"}],_e=[{value:"student",label:"√âl√®ve"},{value:"parent",label:"Parent"},{value:"teacher",label:"Enseignant"},{value:"secretary",label:"Secr√©taire"}],Se=[{value:"manage_students",label:"G√©rer les √©l√®ves"},{value:"manage_grades",label:"G√©rer les notes"},{value:"manage_attendance",label:"G√©rer les pr√©sences"},{value:"manage_communications",label:"G√©rer les communications"},{value:"view_reports",label:"Voir les rapports"}],Ee=r=>{const l={Maternelle:["√âveil","Psychomotricit√©","Langage","Arts plastiques","Musique","Jeux √©ducatifs"],Primaire:["Math√©matiques","Fran√ßais","Lecture","√âcriture","Histoire","G√©ographie","Sciences","√âducation Civique et Morale","Arts Plastiques","Musique","√âducation Physique et Sportive","Anglais","Informatique","Travaux Manuels","Hygi√®ne et Sant√©","Biblioth√®que"],Coll√®ge:["Math√©matiques","Fran√ßais","Anglais","Histoire-G√©ographie","Sciences de la Vie et de la Terre","Physique-Chimie","Technologie","√âducation Physique et Sportive","Arts Plastiques","Musique","√âducation Civique","Espagnol","Allemand","Informatique"],"Lyc√©e G√©n√©ral":["Math√©matiques","Fran√ßais","Philosophie","Histoire-G√©ographie","Anglais","Espagnol","Allemand","Physique-Chimie","Sciences de la Vie et de la Terre","Sciences √âconomiques et Sociales","√âducation Physique et Sportive","Arts Plastiques","Musique","NSI (Num√©rique et Sciences Informatiques)","SI (Sciences de l'Ing√©nieur)","HGGSP","HLP","LLCER","Biologie-√âcologie","Math√©matiques Expertes"],"Lyc√©e Technique":["Math√©matiques","Fran√ßais","Anglais","Histoire-G√©ographie","Physique-Chimie","√âlectrotechnique","M√©canique","G√©nie Civil","Informatique","√âconomie-Gestion","Construction","CAO/DAO","Automatisme","Sciences de l'Ing√©nieur","T√©l√©communications","Maintenance","√ânergie","√âducation Physique et Sportive"],"Lyc√©e Professionnel":["Math√©matiques","Fran√ßais","Anglais","Histoire-G√©ographie","Commerce","Vente","Comptabilit√©","Secr√©tariat","Cuisine","H√¥tellerie","Coiffure","Esth√©tique","M√©canique Auto","√âlectricit√©","Menuiserie","Soudure","Mode","Agriculture"]};return(l[r]||l.Coll√®ge).map((p,A)=>({id:`default-${A}`,name:p}))},Ae=[{id:"overview",label:"Aper√ßu g√©n√©ral",icon:"BarChart3"},{id:"accounts",label:"Liste des comptes",icon:"Users"},{id:"security",label:"S√©curit√©",icon:"Shield"},{id:"create",label:"Cr√©er un compte",icon:"UserPlus"}];h.useEffect(()=>{T==="create"&&q&&(async()=>{if(console.log("üîÑ Chargement donn√©es r√©f√©rence..."),console.log("  - user:",a),console.log("  - school_id:",a==null?void 0:a.current_school_id),!(a!=null&&a.current_school_id)){console.warn("‚ö†Ô∏è Pas de school_id - Impossible de charger les donn√©es");return}he(!0);try{console.log("üè´ Chargement donn√©es √©cole...");const{data:l,error:f}=await B.from("schools").select("available_classes, type, custom_subjects").eq("id",a.current_school_id).single();if(f)console.error("‚ùå Erreur chargement donn√©es √©cole:",f);else{if(console.log("‚úÖ Donn√©es √©cole charg√©es:",l),console.log("üìã Classes dans available_classes:",l==null?void 0:l.available_classes),l!=null&&l.available_classes&&Array.isArray(l.available_classes)){const{data:V,error:g}=await B.from("classes").select("id, name, level").eq("school_id",a.current_school_id).order("level").order("name"),k=new Map;!g&&V&&(V.forEach(O=>{k.set(O.name,{value:O.id,label:O.name,level:O.level})}),console.log(`‚úÖ ${V.length} classe(s) charg√©e(s) depuis la table classes`));const z=l.available_classes.map((O,le)=>k.has(O)?k.get(O):{value:`temp-${le}-${O}`,label:O,isTemporary:!0});H(z);const te=z.filter(O=>O.isTemporary).length,Q=z.length-te;console.log(`‚úÖ ${z.length} classe(s) disponible(s) (${Q} avec UUID, ${te} temporaire(s))`)}else console.warn("‚ö†Ô∏è Aucune classe disponible dans available_classes"),H([]);const K=Ee(l.type),U=(l.custom_subjects||[]).map(V=>({id:`custom-${V}`,name:V})),Y=new Map;[...K,...U].forEach(V=>{Y.has(V.name)||Y.set(V.name,{value:V.id,label:V.name})});const se=Array.from(Y.values());n(se),console.log(`‚úÖ ${se.length} mati√®re(s) disponible(s) (sans doublons)`)}console.log("üë®‚Äçüë©‚Äçüëß Chargement parents...");const{data:p,error:A}=await B.from("parents").select(`
            id,
            first_name,
            last_name,
            users!inner (
              id,
              email,
              phone,
              full_name
            )
          `).order("last_name");if(A)console.error("‚ùå Erreur chargement parents:",A),X([]);else{console.log("‚úÖ Parents charg√©s:",(p==null?void 0:p.length)||0);const K=(p||[]).map(U=>({id:U.id,user_id:U.users.id,full_name:U.users.full_name||`${U.first_name} ${U.last_name}`,email:U.users.email,phone:U.users.phone}));console.log("üìã Parents format√©s:",K.length),X(K)}}catch(l){console.error("‚ùå Erreur chargement donn√©es r√©f√©rence:",l)}finally{he(!1)}})()},[T,a==null?void 0:a.current_school_id,q]);const ze=async()=>{if(!ge.trim()){alert("Veuillez entrer le nom de la mati√®re");return}if(re.some(r=>r.label.toLowerCase()===ge.trim().toLowerCase())){alert("Cette mati√®re existe d√©j√†");return}de(!0);try{const{data:r,error:l}=await B.from("schools").select("custom_subjects").eq("id",a.current_school_id).single();if(l)throw new Error("Erreur lors de la r√©cup√©ration des mati√®res");const p=[...r.custom_subjects||[],ge.trim()],{error:A}=await B.from("schools").update({custom_subjects:p}).eq("id",a.current_school_id);if(A)throw new Error("Erreur lors de l'ajout de la mati√®re");const K={value:`custom-${Date.now()}`,label:ge.trim()};n(U=>[...U,K]),we(""),ve(!1),alert("‚úÖ Mati√®re ajout√©e avec succ√®s !")}catch(r){console.error("Erreur ajout mati√®re:",r),alert(`‚ùå Erreur : ${r.message}`)}finally{de(!1)}},Pe=(r,l,f)=>{ee(),confirm(`R√©initialiser le mot de passe pour ${l} ?

Un nouveau mot de passe sera g√©n√©r√© automatiquement.

Voulez-vous l'envoyer par email √† ${f} ?`)&&(console.log("R√©initialisation mot de passe pour:",r),ke(f,l))},ke=(r,l,f)=>{console.log("Envoi email de r√©initialisation √†:",r),alert(`Email de r√©initialisation envoy√© √† ${r} !

${l} recevra :
- Son nouveau mot de passe temporaire
- Un lien pour se connecter
- L'obligation de changer son mot de passe`)},$e=(r,l,f)=>{confirm(`Renvoyer les identifiants de connexion √† ${l} ?

Un email sera envoy√© √† ${f} avec :
- Son email de connexion
- Un lien pour r√©initialiser son mot de passe
- Les instructions de premi√®re connexion`)&&(console.log("Renvoi identifiants pour:",r),Le(f,l))},Le=(r,l)=>{console.log("Envoi rappel identifiants √†:",r),alert(`Rappel d'identifiants envoy√© √† ${r} !

${l} recevra :
- Son email de connexion
- Un lien pour r√©initialiser son mot de passe si n√©cessaire
- Le lien de connexion √† la plateforme`)},De=async(r,l)=>{if(confirm(`D√©bloquer le compte de ${l} ?

Les tentatives de connexion √©chou√©es seront r√©initialis√©es.`)){R(!0);try{const{data:p,error:A}=await B.rpc("unlock_user_account",{p_user_id:r,p_unlocked_by:a.id});if(A)throw A;if(p&&!p.success)throw new Error(p.error||"Erreur lors du d√©blocage");alert(`‚úÖ Compte de ${l} d√©bloqu√© avec succ√®s !`),await J()}catch(p){console.error("‚ùå Erreur d√©blocage compte:",p),alert(`‚ùå Erreur lors du d√©blocage :

${p.message}`)}finally{R(!1)}}},Te=async()=>{var r,l,f;if(!s.fullName){alert("Veuillez saisir le nom complet");return}if(s.role==="student"){if(!s.classId){alert("Veuillez s√©lectionner une classe pour l'√©l√®ve");return}if(!s.parentId){alert(`Veuillez s√©lectionner un parent/tuteur pour l'√©l√®ve.

Si le parent n'existe pas, cr√©ez d'abord son compte avec le r√¥le "Parent".`);return}}else if(s.role==="parent"){if(!s.phone){alert("Veuillez saisir le num√©ro de t√©l√©phone du parent (obligatoire)");return}if(!s.address){alert("Veuillez saisir l'adresse du parent (obligatoire)");return}if(!s.password){alert("Veuillez saisir un mot de passe");return}if(s.password.length<8){alert("Le mot de passe doit contenir au moins 8 caract√®res");return}if(!s.email){const p=s.phone.replace(/\s+/g,"").replace(/\+/g,"");s.email=`parent${p}@edutrack.cm`,console.log("üìß Email g√©n√©r√© pour parent sans email:",s.email)}}else{if(!s.phone){alert("Veuillez saisir le num√©ro de t√©l√©phone (obligatoire)");return}if(!s.password){alert("Veuillez saisir un mot de passe");return}if(s.password.length<8){alert("Le mot de passe doit contenir au moins 8 caract√®res");return}if(!s.email){const p=s.phone.replace(/\s+/g,"").replace(/\+/g,""),A={teacher:"enseignant",secretary:"secretaire",principal:"directeur",admin:"admin"}[s.role]||"staff";s.email=`${A}${p}@edutrack.cm`,console.log(`üìß Email g√©n√©r√© pour ${s.role} sans email:`,s.email)}}R(!0);try{if(console.log("Cr√©ation compte avec Supabase..."),!a){alert("‚ùå Erreur : Utilisateur non connect√©. Veuillez vous reconnecter."),console.error("User is null"),R(!1);return}if(!a.current_school_id){console.error("‚ùå current_school_id manquant. User data:",a),alert(`‚ùå Erreur : Votre compte n'est pas associ√© √† une √©cole.

Email: ${(a==null?void 0:a.email)||"N/A"}
R√¥le: ${(a==null?void 0:a.role)||"N/A"}

Veuillez contacter l'administrateur syst√®me.`),R(!1);return}const p=s.fullName.trim().split(" "),A=p[0]||"",K=p.slice(1).join(" ")||A;let U=null;if(s.role==="teacher"||s.role==="secretary"||s.role==="parent"){console.log("Cr√©ation compte personnel/parent...");const Y=crypto.randomUUID(),{data:se,error:V}=await B.from("users").insert({id:Y,email:s.email,full_name:s.fullName,phone:s.phone,role:s.role,current_school_id:a.current_school_id,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(V)throw new Error(`Erreur cr√©ation utilisateur: ${V.message}`);if(U=se.id,console.log("‚úÖ Utilisateur cr√©√©:",U),s.role==="teacher"){const{data:g,error:k}=await B.from("teachers").insert({school_id:a.current_school_id,user_id:U,first_name:A,last_name:K,specialty:s.specialty||"",hire_date:s.hireDate||new Date().toISOString(),is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select("id").single();if(k)throw console.error("Erreur cr√©ation enseignant:",k),new Error(`Erreur cr√©ation enseignant: ${k.message}`);const z=g.id,{data:te}=await B.from("academic_years").select("id").eq("school_id",a.current_school_id).eq("is_current",!0).single(),Q=te==null?void 0:te.id;if(Q){const O=[];if(s.selectedClasses.length>0&&s.selectedSubjects.length>0)for(const le of s.selectedClasses)for(const Me of s.selectedSubjects){const je=D.find(Oe=>Oe.value===le),Ve=re.find(Oe=>Oe.value===Me);O.push({teacher_id:z,school_id:a.current_school_id,academic_year_id:Q,class_id:le,subject_id:Me,class_name:(je==null?void 0:je.label)||"",subject_name:(Ve==null?void 0:Ve.label)||"",schedule:{weekly_hours:parseInt(s.weeklyHours)||0},is_active:!0})}if(O.length>0){const{error:le}=await B.from("teacher_assignments").insert(O);le&&console.error("Erreur cr√©ation assignations:",le)}}}else if(s.role==="secretary"){const{error:g}=await B.from("secretaries").insert({school_id:a.current_school_id,user_id:U,first_name:A,last_name:K,hire_date:s.hireDate||new Date().toISOString(),is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(g)throw console.error("Erreur cr√©ation secr√©taire:",g),new Error(`Erreur cr√©ation secr√©taire: ${g.message}`)}else if(s.role==="parent"){const{data:g,error:k}=await B.from("parents").insert({user_id:U,first_name:A,last_name:K,phone:s.phone,email:s.email,profession:s.profession||null,address:s.address||null}).select("id").single();if(k)throw console.error("Erreur cr√©ation parent:",k),new Error(`Erreur cr√©ation parent: ${k.message}`);console.log("‚úÖ Compte parent cr√©√©. Les enfants seront li√©s lors de la cr√©ation des √©l√®ves.")}console.log("‚úÖ Compte personnel cr√©√©:",U)}else if(s.role==="student"){console.log(`üéì Cr√©ation compte √©l√®ve - Niveau: ${s.schoolLevel}`);const Y=await W(a.current_school_id);console.log("üìã Matricule g√©n√©r√©:",Y);let se=null,V=null,g=null;if(s.schoolLevel==="secondary"){console.log("üìß √âl√®ve du secondaire - Cr√©ation des identifiants..."),V=oe(Y,a.school_name||"ecole"),console.log("üìß Email g√©n√©r√©:",V),g=me(A),console.log("üîë Mot de passe g√©n√©r√©:",g),se=crypto.randomUUID();const{data:O,error:le}=await B.from("users").insert({id:se,email:V,full_name:s.fullName,phone:s.phone||null,role:"student",password_hash:g,current_school_id:a.current_school_id,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(le)throw new Error(`Erreur cr√©ation compte √©l√®ve: ${le.message}`);U=se,console.log("‚úÖ Compte utilisateur cr√©√© pour √©l√®ve du secondaire")}else console.log("üë∂ √âl√®ve du primaire - Aucun compte utilisateur cr√©√©");if(!s.classId)throw new Error("La s√©lection d'une classe est obligatoire pour cr√©er un √©l√®ve");let k=s.classId;if(s.classId.startsWith("temp-")){console.log("‚ö†Ô∏è ID temporaire d√©tect√©, cr√©ation de la classe dans la table classes...");const O=D.find(le=>le.value===s.classId);if(!O)throw new Error("Classe s√©lectionn√©e introuvable dans la liste des classes disponibles");if(O.isTemporary){const le=v(a.school_type,O.label);if(console.log(`üéØ Cr√©ation classe - Niveau d√©tect√©: ${le} pour "${O.label}" (type √©cole: ${a.school_type})`),!a.academic_year_id)throw console.error("‚ö†Ô∏è Aucune ann√©e acad√©mique courante trouv√©e"),new Error("Veuillez d'abord cr√©er une ann√©e acad√©mique courante pour cette √©cole");const{data:Me,error:je}=await B.from("classes").insert({school_id:a.current_school_id,name:O.label,level:le,academic_year_id:a.academic_year_id}).select("id").single();if(je)throw console.error("‚ùå Erreur cr√©ation classe:",je),new Error(`Impossible de cr√©er la classe "${O.label}": ${je.message}`);k=Me.id,console.log("‚úÖ Classe cr√©√©e avec UUID:",k)}}if(!k||k==="null"||k==="undefined")throw new Error("Une classe valide doit √™tre assign√©e √† l'√©l√®ve");console.log(`üìù Cr√©ation √©l√®ve avec school_level: ${s.schoolLevel}`);const{data:z,error:te}=await B.from("students").insert({school_id:a.current_school_id,user_id:s.schoolLevel==="secondary"?se:null,matricule:s.schoolLevel==="secondary"?Y:null,registration_number:Y,first_name:A,last_name:K,class_id:k,date_of_birth:s.dateOfBirth||null,school_level:s.schoolLevel,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select("id").single();if(te)throw console.error("Erreur cr√©ation √©l√®ve:",te),new Error(`Erreur cr√©ation √©l√®ve: ${te.message}`);const{error:Q}=await B.from("parent_students").insert({parent_id:s.parentId,student_id:z.id,relationship:"parent",is_primary:!0});Q?console.error("Erreur liaison parent-√©l√®ve:",Q):console.log("‚úÖ Relation parent-√©l√®ve cr√©√©e"),s.schoolLevel==="secondary"&&V&&g?(s.generatedEmail=V,s.generatedPassword=g,s.generatedMatricule=Y,console.log("‚úÖ √âl√®ve du secondaire cr√©√© avec compte utilisateur")):(s.generatedMatricule=Y,console.log("‚úÖ √âl√®ve du primaire cr√©√© sans compte utilisateur"))}else{console.log("Cr√©ation compte directeur/admin via signUp...");const{data:Y,error:se}=await B.auth.signUp({email:s.email,password:s.password,options:{data:{full_name:s.fullName,phone:s.phone,role:s.role,school:{id:a.current_school_id,name:a.school_name||"√âcole"}}}});if(se||!Y.user)throw new Error((se==null?void 0:se.message)||"Erreur cr√©ation compte");U=Y.user.id,console.log("‚úÖ Compte directeur/admin cr√©√©:",U),await B.from("users").insert({id:U,email:s.email,full_name:s.fullName,phone:s.phone,role:s.role,current_school_id:a.current_school_id,created_by_user_id:a.id,is_active:!0})}if(s.role!=="principal"&&s.role!=="admin"){console.log("üìß Envoi de l'email avec les identifiants..."),console.log("Configuration email actuelle:",{configured:Ze(),hasServiceId:!0,hasTemplateId:!0,hasPublicKey:!0});let Y,se,V;if(s.role==="student"){const k=j.find(z=>z.id===s.parentId);V=(k==null?void 0:k.email)&&!k.email.includes("@edutrack.cm"),Y=V?k.email:a.email,se={recipientEmail:Y,recipientName:V?(k==null?void 0:k.full_name)||"Parent":a.full_name,role:"√âl√®ve",email:s.generatedEmail,password:s.generatedPassword,matricule:s.generatedMatricule,studentName:s.fullName,parentName:k==null?void 0:k.full_name,parentPhone:k==null?void 0:k.phone,isStudent:!0,hasPersonalEmail:V,schoolName:a.school_name||"Votre √©tablissement",principalName:a.full_name||"Le Directeur"}}else V=s.email&&!s.email.includes("@edutrack.cm"),Y=V?s.email:a.email,se={recipientEmail:Y,recipientName:V?s.fullName:a.full_name,role:c(s.role),email:s.email,password:s.password,phone:s.phone,staffName:s.fullName,hasPersonalEmail:V,schoolName:a.school_name||"Votre √©tablissement",principalName:a.full_name||"Le Directeur"};let g={success:!0};if(se&&(console.log(`üìß Envoi email √† ${V?"l'utilisateur":"au directeur"}:`,Y),g=await us(se),console.log("üì¨ R√©sultat de l'envoi:",g)),g.success){let k;if(s.role==="student"){const z=j.find(Q=>Q.id===s.parentId),te=(z==null?void 0:z.email)&&!z.email.includes("@edutrack.cm");s.schoolLevel==="secondary"?k=`‚úÖ Compte √©l√®ve cr√©√© avec succ√®s !

Nom : ${s.fullName}
Classe : ${((r=D.find(Q=>Q.value===s.classId))==null?void 0:r.label)||"N/A"}

üéì COMPTE PERSONNEL CR√â√â :
üìã Matricule : ${s.generatedMatricule}
üìß Email : ${s.generatedEmail}
üîë Mot de passe : ${s.generatedPassword}

üë®‚Äçüë©‚Äçüëß Parent li√© :
‚Ä¢ Nom : ${(z==null?void 0:z.full_name)||"N/A"}
‚Ä¢ Email : ${(z==null?void 0:z.email)||"Non renseign√©"}
‚Ä¢ T√©l√©phone : ${(z==null?void 0:z.phone)||"Non renseign√©"}

üì® EMAIL ENVOY√â :
${te?`‚úÖ Envoy√© au parent : ${z.email}
   Le parent a re√ßu les identifiants de connexion de son enfant.`:`‚úÖ Envoy√© au directeur : ${a.email}
   ‚ö†Ô∏è Le parent n'a pas d'email personnel.
   Les identifiants ont √©t√© envoy√©s √† votre adresse.
   Veuillez les communiquer au parent par t√©l√©phone : ${(z==null?void 0:z.phone)||"N/A"}`}

L'√©l√®ve peut maintenant :
‚Ä¢ Se connecter √† la plateforme
‚Ä¢ Consulter ses notes et devoirs
‚Ä¢ Voir son emploi du temps`:k=`‚úÖ √âl√®ve du primaire enregistr√© avec succ√®s !

Nom : ${s.fullName}
Classe : ${((l=D.find(Q=>Q.value===s.classId))==null?void 0:l.label)||"N/A"}
üìã Matricule : ${s.generatedMatricule}

üë®‚Äçüë©‚Äçüëß Parent li√© :
‚Ä¢ Nom : ${(z==null?void 0:z.full_name)||"N/A"}
‚Ä¢ Email : ${(z==null?void 0:z.email)||"Non renseign√©"}
‚Ä¢ T√©l√©phone : ${(z==null?void 0:z.phone)||"Non renseign√©"}

‚ÑπÔ∏è NOTE : Les √©l√®ves du primaire n'ont pas de compte personnel.
Le parent peut consulter les informations de son enfant via son propre compte parent.`}else{const z=s.role==="parent",te=s.role==="teacher",Q=s.role==="secretary",O=s.email&&!s.email.includes("@edutrack.cm");k=`‚úÖ Compte cr√©√© avec succ√®s !

Utilisateur : ${s.fullName}
T√©l√©phone : ${s.phone}
Email connexion : ${s.email}
R√¥le : ${c(s.role)}
${z&&s.profession?`Profession : ${s.profession}
`:""}${z&&s.address?`Adresse : ${s.address}
`:""}${te&&s.specialty?`Sp√©cialit√© : ${s.specialty}
`:""}
üîë Identifiants de connexion :
‚Ä¢ Email : ${s.email}
‚Ä¢ Mot de passe : ${s.password}

üì® EMAIL ENVOY√â :
${O?`‚úÖ Envoy√© √† l'utilisateur : ${s.email}
   ${z?"Le parent":te?"L'enseignant":"La secr√©taire"} a re√ßu ses identifiants de connexion.`:`‚úÖ Envoy√© au directeur : ${a.email}
   ‚ö†Ô∏è ${z?"Le parent":te?"L'enseignant":"La secr√©taire"} n'a pas d'email personnel.
   Un email technique a √©t√© g√©n√©r√© : ${s.email}
   Les identifiants ont √©t√© envoy√©s √† votre adresse.
   Veuillez les communiquer par t√©l√©phone : ${s.phone}`}

${O?"":`üí° Email technique g√©n√©r√© automatiquement.
   L'utilisateur se connectera avec : ${s.email}

`}${z?"Les enfants seront li√©s lors de la cr√©ation des comptes √©l√®ves.":""}`}alert(k)}else if(g.fallback){const k=g.technicalError?`

üîß Erreur technique : ${g.technicalError}`:"",z=Ze()?`

‚öôÔ∏è EmailJS est configur√© mais l'envoi a √©chou√©.
V√©rifiez :
‚Ä¢ Votre connexion Internet
‚Ä¢ Que le Service ID et Template ID sont corrects
‚Ä¢ Que le template existe sur emailjs.com`:`

‚öôÔ∏è Pour activer l'envoi automatique d'emails :
1. Cr√©ez un compte sur https://emailjs.com
2. Configurez un service email (Gmail, Outlook...)
3. Cr√©ez un template d'email
4. Ajoutez les cl√©s dans le fichier .env`;let te;if(s.role==="student"){const Q=j.find(O=>O.id===s.parentId);te=`‚úÖ Compte √©l√®ve cr√©√© avec succ√®s !

√âl√®ve : ${s.fullName}
Classe : ${((f=D.find(O=>O.value===s.classId))==null?void 0:f.label)||"N/A"}

‚ö†Ô∏è L'email n'a pas pu √™tre envoy√© au parent.
Raison : ${g.error}

üìã IDENTIFIANTS √Ä COMMUNIQUER AU PARENT :

üìß Email : ${s.generatedEmail}
üîë Mot de passe : ${s.generatedPassword}
üìã Matricule : ${s.generatedMatricule}

üë®‚Äçüë©‚Äçüëß Contacter le parent :
‚Ä¢ ${(Q==null?void 0:Q.full_name)||"N/A"}
‚Ä¢ ${(Q==null?void 0:Q.email)||"Pas d'email"}
‚Ä¢ ${(Q==null?void 0:Q.phone)||"Pas de t√©l√©phone"}

‚ö†Ô∏è IMPORTANT :
‚Ä¢ Notez ces identifiants
‚Ä¢ Communiquez-les au parent/tuteur
‚Ä¢ L'√©l√®ve pourra se connecter avec ces identifiants`+z+k}else te=`‚úÖ Compte cr√©√© avec succ√®s !

Utilisateur : ${s.fullName}
Email : ${s.email}
R√¥le : ${c(s.role)}

‚ö†Ô∏è L'email n'a pas pu √™tre envoy√© automatiquement.
Raison : ${g.error}

üìã IDENTIFIANTS √Ä COMMUNIQUER MANUELLEMENT :

Email : ${s.email}
Mot de passe : ${s.password}

‚ö†Ô∏è IMPORTANT :
‚Ä¢ Notez ces identifiants en lieu s√ªr
‚Ä¢ Communiquez-les directement √† ${s.fullName}
‚Ä¢ L'utilisateur pourra se connecter avec ces identifiants
‚Ä¢ Ces identifiants ne seront plus affich√©s apr√®s fermeture`+z+k;alert(te)}}else alert(`‚úÖ Compte cr√©√© avec succ√®s !

Utilisateur : ${s.fullName}
Email : ${s.email}
R√¥le : ${c(s.role)}

üìß Un email de confirmation a √©t√© envoy√© √† ${s.email}`);console.log("üîÑ Rechargement de la liste des comptes..."),await J(),console.log("‚úÖ Liste des comptes recharg√©e"),d({fullName:"",email:"",phone:"",role:"student",password:"",status:"active",specialty:"",hireDate:new Date().toISOString().split("T")[0],selectedClasses:[],selectedSubjects:[],weeklyHours:"",permissions:[],department:"",schoolLevel:"primary",matricule:"",classId:"",dateOfBirth:"",parentId:"",parentName:"",parentPhone:"",parentEmail:"",selectedChildren:[],profession:"",address:""}),$("accounts")}catch(p){console.error("‚ùå Erreur cr√©ation compte:",p);let A=p.message;A.includes("already registered")?A="Cet email est d√©j√† utilis√© par un autre compte.":A.includes("invalid email")?A="L'adresse email n'est pas valide.":A.includes("weak password")&&(A="Le mot de passe est trop faible. Utilisez au moins 8 caract√®res."),alert(`‚ùå Erreur lors de la cr√©ation du compte :

${A}`)}finally{R(!1)}},c=r=>({secretary:"Secr√©taire",teacher:"Enseignant",student:"√âl√®ve",parent:"Parent",principal:"Directeur",admin:"Administrateur"})[r]||r,W=async r=>{const l=new Date().getFullYear(),{data:f,error:p}=await B.from("students").select("matricule",{count:"exact"}).eq("school_id",r).like("matricule",`STD${l}%`).order("created_at",{ascending:!1}).limit(1);if(p)return console.error("Erreur r√©cup√©ration matricule:",p),`STD${l}001`;let A=1;if(f&&f.length>0&&f[0].matricule){const K=f[0].matricule;A=parseInt(K.slice(-3))+1}return`STD${l}${A.toString().padStart(3,"0")}`},oe=(r,l)=>{const f=l.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"").slice(0,15);return`${r.toLowerCase()}@${f}.edutrack.cm`},me=r=>{const l=new Date().getFullYear();return`${r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()}${l}`},v=(r,l)=>{if(r==="primary"||r==="Primaire")return"primary";if(r==="secondary"||r==="Coll√®ge"||r==="Lyc√©e")return"secondary";if(!l)return"primary";const f=l.toLowerCase();return["6√®me","6eme","5√®me","5eme","4√®me","4eme","3√®me","3eme","2nde","2de","seconde","1√®re","1ere","premi√®re","premiere","tle","terminale","terminal"].some(A=>f.includes(A))?"secondary":"primary"},J=async()=>{if(a!=null&&a.current_school_id){R(!0);try{const{data:r,error:l}=await B.from("teachers").select(`
          id,
          first_name,
          last_name,
          specialty,
          hire_date,
          is_active,
          created_at,
          users!inner (
            id,
            email,
            full_name,
            phone,
            role
          )
        `).eq("school_id",a.current_school_id).eq("is_active",!0);l&&console.error("Erreur lors du chargement des enseignants:",l);const{data:f,error:p}=await B.from("secretaries").select(`
          id,
          first_name,
          last_name,
          hire_date,
          is_active,
          created_at,
          users!inner (
            id,
            email,
            full_name,
            phone,
            role
          )
        `).eq("school_id",a.current_school_id).eq("is_active",!0);p&&console.error("Erreur lors du chargement des secr√©taires:",p);const{data:A,error:K}=await B.from("parents").select(`
          id,
          first_name,
          last_name,
          profession,
          address,
          created_at,
          users!inner (
            id,
            email,
            full_name,
            phone,
            role
          )
        `);K&&console.error("Erreur lors du chargement des parents:",K);const{data:U,error:Y}=await B.from("students").select(`
          id,
          first_name,
          last_name,
          registration_number,
          date_of_birth,
          class_id,
          user_id,
          created_at,
          users:user_id (
            id,
            email,
            full_name,
            phone,
            role
          ),
          classes (
            name,
            level
          )
        `).eq("school_id",a.current_school_id).eq("is_active",!0);Y&&console.error("Erreur lors du chargement des √©l√®ves:",Y);const se=[];r&&r.forEach(g=>{se.push({id:g.users.id,email:g.users.email,full_name:g.users.full_name||`${g.first_name} ${g.last_name}`,phone:g.users.phone,role:"teacher",specialty:g.specialty,is_active:g.is_active,created_at:g.created_at,hire_date:g.hire_date,personnel_id:g.id})}),f&&f.forEach(g=>{se.push({id:g.users.id,email:g.users.email,full_name:g.users.full_name||`${g.first_name} ${g.last_name}`,phone:g.users.phone,role:"secretary",is_active:g.is_active,created_at:g.created_at,hire_date:g.hire_date,personnel_id:g.id})}),A&&A.forEach(g=>{se.push({id:g.users.id,email:g.users.email,full_name:g.users.full_name||`${g.first_name} ${g.last_name}`,phone:g.users.phone,role:"parent",profession:g.profession,address:g.address,is_active:!0,created_at:g.created_at,personnel_id:g.id})}),U&&U.forEach(g=>{var k,z,te,Q,O,le;se.push({id:((k=g.users)==null?void 0:k.id)||g.id,email:((z=g.users)==null?void 0:z.email)||"N/A",full_name:((te=g.users)==null?void 0:te.full_name)||`${g.first_name} ${g.last_name}`,phone:((Q=g.users)==null?void 0:Q.phone)||"N/A",role:"student",registration_number:g.registration_number,class_name:(O=g.classes)==null?void 0:O.name,class_level:(le=g.classes)==null?void 0:le.level,date_of_birth:g.date_of_birth,has_account:!!g.users,is_active:!0,created_at:g.created_at,personnel_id:g.id})});const V=se.sort((g,k)=>new Date(k.created_at)-new Date(g.created_at));console.log("‚úÖ Comptes personnel charg√©s depuis Supabase:",V.length),console.log("üìä D√©tail personnel:",{teachers:(r==null?void 0:r.length)||0,secretaries:(f==null?void 0:f.length)||0,parents:(A==null?void 0:A.length)||0,students:(U==null?void 0:U.length)||0,total:V.length}),N(V),console.log("‚úÖ State accounts mis √† jour avec",V.length,"comptes")}catch(r){console.error("‚ùå Erreur chargement comptes:",r)}finally{R(!1)}}};h.useEffect(()=>{a!=null&&a.current_school_id&&J()},[a==null?void 0:a.current_school_id]);const Z=async(r,l)=>{if(confirm(`‚ö†Ô∏è D√©sactiver le compte de ${l} ?

Le compte sera d√©sactiv√© mais toutes les donn√©es cr√©√©es par cette personne seront conserv√©es.

Cette action peut √™tre annul√©e en r√©activant le compte.`)){R(!0);try{const{data:p,error:A}=await B.rpc("deactivate_user_account",{p_user_id:r,p_deactivated_by:a.id});if(A)throw A;if(p&&!p.success)throw new Error(p.error||"Erreur lors de la d√©sactivation");alert(`‚úÖ Compte de ${l} d√©sactiv√© avec succ√®s !`),await J()}catch(p){console.error("‚ùå Erreur d√©sactivation compte:",p),alert(`‚ùå Erreur lors de la d√©sactivation :

${p.message}`)}finally{R(!1)}}},Ne=async(r,l)=>{if(confirm(`R√©activer le compte de ${l} ?

L'utilisateur pourra √† nouveau se connecter.`)){R(!0);try{const{data:p,error:A}=await B.rpc("reactivate_user_account",{p_user_id:r,p_reactivated_by:a.id});if(A)throw A;if(p&&!p.success)throw new Error(p.error||"Erreur lors de la r√©activation");alert(`‚úÖ Compte de ${l} r√©activ√© avec succ√®s !`),await J()}catch(p){console.error("‚ùå Erreur r√©activation compte:",p),alert(`‚ùå Erreur lors de la r√©activation :

${p.message}`)}finally{R(!1)}}},ee=()=>{const r="abcdefghijklmnopqrstuvwxyz",l="ABCDEFGHIJKLMNOPQRSTUVWXYZ",f="0123456789",p="!@#$%^&*()_+-=[]{}|;:,.<>?",A=r+l+f+p;let K="";K+=r[Math.floor(Math.random()*r.length)],K+=l[Math.floor(Math.random()*l.length)],K+=f[Math.floor(Math.random()*f.length)],K+=p[Math.floor(Math.random()*p.length)];for(let U=4;U<12;U++)K+=A[Math.floor(Math.random()*A.length)];return K.split("").sort(()=>Math.random()-.5).join("")},xe=()=>{const r=ee();d(l=>({...l,password:r}))},ce=()=>{switch(T){case"overview":return ye();case"accounts":return Be();case"security":return Ye();case"create":return Fe();default:return ye()}},ye=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl p-6 shadow-lg hover:shadow-xl hover:scale-105 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-blue-700 mb-1",children:"Total Comptes"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:ue.total})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx(t,{name:"Users",size:24,className:"text-white"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-2xl p-6 shadow-lg hover:shadow-xl hover:scale-105 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-green-700 mb-1",children:"Comptes Actifs"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:ue.active})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-600 to-emerald-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx(t,{name:"CheckCircle",size:24,className:"text-white"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-red-50 to-pink-50 border-2 border-red-200 rounded-2xl p-6 shadow-lg hover:shadow-xl hover:scale-105 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-700 mb-1",children:"Comptes Inactifs"}),e.jsx("p",{className:"text-3xl font-bold text-red-900",children:ue.inactive})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-pink-500 rounded-xl flex items-center justify-center shadow-md",children:e.jsx(t,{name:"XCircle",size:24,className:"text-white"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 border-2 border-amber-200 rounded-2xl p-6 shadow-lg hover:shadow-xl hover:scale-105 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-amber-700 mb-1",children:"Comptes Bloqu√©s"}),e.jsx("p",{className:"text-3xl font-bold text-amber-900",children:ue.locked})]}),e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl flex items-center justify-center shadow-md",children:e.jsx(t,{name:"Lock",size:24,className:"text-white"})})]})})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"BarChart3",size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"R√©partition par r√¥le"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Statistiques des diff√©rents types de comptes"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(ue.byRole).filter(([r])=>r!=="principal").map(([r,l])=>e.jsxs("div",{className:"text-center p-5 bg-gradient-to-br from-gray-50 to-white border-2 border-gray-200 rounded-xl hover:border-blue-400 hover:shadow-lg hover:scale-105 transition-all",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-lg flex items-center justify-center mx-auto mb-3",children:e.jsx(t,{name:r==="teacher"?"GraduationCap":r==="secretary"?"UserCheck":r==="student"?"User":"Users",size:20,className:"text-blue-600"})}),e.jsx("p",{className:"text-sm font-semibold text-gray-700 capitalize mb-1",children:r==="teacher"?"Enseignants":r==="secretary"?"Secr√©taires":r==="student"?"√âl√®ves":r==="parent"?"Parents":r}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l})]},r))})]}),e.jsxs("div",{className:"rounded-2xl border-2 p-5 flex items-start space-x-4 shadow-md bg-gradient-to-r from-green-50 to-emerald-50 border-green-200",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-md bg-gradient-to-br from-green-600 to-emerald-600",children:e.jsx(t,{name:"CheckCircle",size:24,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(t,{name:"Mail",size:16,className:"text-green-700"}),e.jsx("h4",{className:"text-sm font-semibold text-green-900",children:"‚úÖ Envoi automatique d'emails activ√©"})]}),e.jsx("p",{className:"text-sm text-green-700",children:"Les identifiants seront automatiquement envoy√©s par email au personnel lors de la cr√©ation de leur compte."})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actions rapides"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(F,{onClick:()=>$("create"),className:"flex items-center justify-center p-4 bg-blue-600 hover:bg-blue-700",children:[e.jsx(t,{name:"UserPlus",size:16,className:"mr-2"}),"Cr√©er un compte"]}),e.jsxs(F,{onClick:()=>$("security"),variant:"outline",className:"flex items-center justify-center p-4",children:[e.jsx(t,{name:"Shield",size:16,className:"mr-2"}),"S√©curit√©"]}),e.jsxs(F,{onClick:()=>$("accounts"),variant:"outline",className:"flex items-center justify-center p-4",children:[e.jsx(t,{name:"Users",size:16,className:"mr-2"}),"G√©rer comptes"]})]})]})]}),Be=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ne,{placeholder:"Rechercher par nom ou email...",value:_,onChange:r=>y(r.target.value),icon:"Search"})}),e.jsx(ie,{value:L,onChange:w,options:Re,placeholder:"Filtrer par r√¥le"}),e.jsx(ie,{value:M,onChange:o,options:Ue,placeholder:"Filtrer par statut"})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Utilisateur"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"R√¥le"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Derni√®re connexion"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ce.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx(t,{name:"User",size:16,className:"text-gray-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.full_name}),e.jsx("div",{className:"text-sm text-gray-500",children:r.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${r.role==="principal"?"bg-purple-100 text-purple-800":r.role==="teacher"?"bg-blue-100 text-blue-800":r.role==="secretary"?"bg-green-100 text-green-800":r.role==="student"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:r.role==="principal"?"Directeur":r.role==="teacher"?"Enseignant":r.role==="secretary"?"Secr√©taire":r.role==="student"?"√âl√®ve":r.role==="parent"?"Parent":r.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[(()=>{const l=r.is_active!==void 0?r.is_active:r.status==="active";return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${l?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:l?"Actif":"Inactif"}),r.deactivated_at&&e.jsx("span",{className:"ml-2 text-xs text-gray-500",title:`D√©sactiv√© le ${new Date(r.deactivated_at).toLocaleDateString("fr-FR")}`,children:"üö´"})]})})(),r.is_locked&&e.jsx(t,{name:"Lock",size:14,className:"ml-2 text-red-500",title:"Compte bloqu√©"}),r.login_attempts>0&&e.jsxs("span",{className:"ml-2 text-xs text-orange-600",title:`${r.login_attempts} tentative(s) √©chou√©e(s)`,children:["‚ö†Ô∏è ",r.login_attempts]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.last_login?new Date(r.last_login).toLocaleString("fr-FR"):"Jamais"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(F,{size:"sm",variant:"outline",onClick:()=>Pe(r.id,r.full_name,r.email),title:"R√©initialiser mot de passe et envoyer par email",className:"text-blue-600 hover:text-blue-700",children:e.jsx(t,{name:"Key",size:14})}),e.jsx(F,{size:"sm",variant:"outline",onClick:()=>$e(r.id,r.full_name,r.email),title:"Renvoyer les identifiants par email",className:"text-green-600 hover:text-green-700",children:e.jsx(t,{name:"Mail",size:14})}),(()=>{const l=r.is_active!==void 0?r.is_active:r.status==="active";return e.jsx(F,{size:"sm",variant:"outline",onClick:()=>{l?Z(r.id,r.full_name):Ne(r.id,r.full_name)},className:l?"text-red-600 hover:text-red-700":"text-green-600 hover:text-green-700",title:l?"D√©sactiver le compte":"R√©activer le compte",children:e.jsx(t,{name:l?"UserX":"UserCheck",size:14})})})(),r.is_locked&&e.jsx(F,{size:"sm",variant:"outline",onClick:()=>De(r.id,r.full_name),className:"text-orange-600 hover:text-orange-700",title:"D√©bloquer compte",children:e.jsx(t,{name:"Unlock",size:14})})]})})]},r.id))})]})})}),Ce.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(t,{name:"Users",size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Aucun compte trouv√© avec ces crit√®res"})]})]}),Ye=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Alertes de s√©curit√©"}),e.jsxs("div",{className:"space-y-4",children:[ue.locked>0&&e.jsxs("div",{className:"flex items-center p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(t,{name:"AlertTriangle",size:20,className:"text-red-600 mr-3"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-red-800",children:[ue.locked," compte(s) bloqu√©(s)"]}),e.jsx("p",{className:"text-sm text-red-700",children:"Des comptes ont √©t√© bloqu√©s suite √† des tentatives de connexion √©chou√©es"})]})]}),m.filter(r=>r.login_attempts>3).length>0&&e.jsxs("div",{className:"flex items-center p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx(t,{name:"AlertCircle",size:20,className:"text-orange-600 mr-3"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-orange-800",children:[m.filter(r=>r.login_attempts>3).length," compte(s) avec tentatives suspectes"]}),e.jsx("p",{className:"text-sm text-orange-700",children:"Plusieurs tentatives de connexion √©chou√©es d√©tect√©es"})]})]}),ue.locked===0&&m.filter(r=>r.login_attempts>3).length===0&&e.jsxs("div",{className:"flex items-center p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(t,{name:"Shield",size:20,className:"text-green-600 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"Aucune alerte de s√©curit√©"}),e.jsx("p",{className:"text-sm text-green-700",children:"Tous les comptes fonctionnent normalement"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Politique de mots de passe"}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(t,{name:"Shield",size:20,className:"text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Exigences de s√©curit√©"}),e.jsxs("ul",{className:"text-sm text-blue-700 mt-2 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Minimum 8 caract√®res"}),e.jsx("li",{children:"‚Ä¢ Au moins une lettre majuscule et minuscule"}),e.jsx("li",{children:"‚Ä¢ Au moins un chiffre"}),e.jsx("li",{children:"‚Ä¢ Au moins un caract√®re sp√©cial (!@#$%^&*)"}),e.jsx("li",{children:"‚Ä¢ G√©n√©ration automatique recommand√©e"})]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Param√®tres de s√©curit√©"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Blocage automatique"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Bloquer les comptes apr√®s 5 tentatives √©chou√©es"})]}),e.jsxs(F,{variant:"outline",size:"sm",children:[e.jsx(t,{name:"Settings",size:14,className:"mr-2"}),"Configurer"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Expiration des mots de passe"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Forcer le changement de mot de passe tous les 90 jours"})]}),e.jsxs(F,{variant:"outline",size:"sm",children:[e.jsx(t,{name:"Settings",size:14,className:"mr-2"}),"Configurer"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Journalisation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Enregistrer toutes les connexions et actions"})]}),e.jsxs(F,{variant:"outline",size:"sm",children:[e.jsx(t,{name:"FileText",size:14,className:"mr-2"}),"Voir logs"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actions globales"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(F,{variant:"outline",className:"flex items-center justify-center p-4 text-orange-600 border-orange-200 hover:bg-orange-50",onClick:()=>{alert("Fonction de d√©blocage global")},children:[e.jsx(t,{name:"Unlock",size:16,className:"mr-2"}),"D√©bloquer tous les comptes"]}),e.jsxs(F,{variant:"outline",className:"flex items-center justify-center p-4 text-blue-600 border-blue-200 hover:bg-blue-50",onClick:()=>{alert("Fonction de notification globale")},children:[e.jsx(t,{name:"Bell",size:16,className:"mr-2"}),"Forcer changement mot de passe"]})]})]})]}),Fe=()=>e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Cr√©er un nouveau compte"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-4 flex items-center",children:[e.jsx(t,{name:"User",size:16,className:"mr-2"}),"Informations g√©n√©rales"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ne,{label:"Nom complet *",value:s.fullName,onChange:r=>d(l=>({...l,fullName:r.target.value})),placeholder:"Nom et pr√©nom"}),s.role!=="student"&&e.jsx(ne,{label:["parent","teacher","secretary"].includes(s.role)?"Email (optionnel)":"Email *",type:"email",value:s.email,onChange:r=>d(l=>({...l,email:r.target.value})),placeholder:["parent","teacher","secretary"].includes(s.role)?"email@exemple.com (si disponible)":"email@exemple.com"}),s.role==="student"&&e.jsx(ie,{label:"R√¥le *",value:s.role,onChange:r=>{d(l=>({...l,role:r,specialty:"",selectedClasses:[],selectedSubjects:[],weeklyHours:"",permissions:[],department:"",classId:"",dateOfBirth:"",parentName:"",parentPhone:"",parentEmail:"",selectedChildren:[],profession:""}))},options:_e})]}),s.role!=="student"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(ne,{label:"T√©l√©phone *",value:s.phone,onChange:r=>d(l=>({...l,phone:r.target.value})),placeholder:"+237 6XX XXX XXX",className:["parent","teacher","secretary"].includes(s.role)?"border-orange-300":""}),e.jsx(ie,{label:"R√¥le *",value:s.role,onChange:r=>{d(l=>({...l,role:r,specialty:"",selectedClasses:[],selectedSubjects:[],weeklyHours:"",permissions:[],department:"",classId:"",dateOfBirth:"",parentName:"",parentPhone:"",parentEmail:"",selectedChildren:[],profession:"",address:""}))},options:_e})]}),s.role==="student"&&e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(t,{name:"Info",size:16,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Pour les √©l√®ves :"})," L'email sera g√©n√©r√© automatiquement pour les √©l√®ves du secondaire (format: matricule@ecole.edutrack.cm). Les √©l√®ves du primaire n'auront pas de compte de connexion."]})]})}),["teacher","secretary"].includes(s.role)&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(t,{name:"Info",size:16,className:"text-green-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("strong",{children:"Email optionnel :"})," Si l'",s.role==="teacher"?"enseignant":"la secr√©taire"," n'a pas d'email personnel, un email technique sera g√©n√©r√© automatiquement (format: ",s.role==="teacher"?"enseignant":"secretaire","[t√©l√©phone]@edutrack.cm).",e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Le t√©l√©phone est obligatoire pour g√©n√©rer l'email si n√©cessaire."})]})]})})]}),s.role==="teacher"&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-4 flex items-center",children:[e.jsx(t,{name:"BookOpen",size:16,className:"mr-2 text-blue-600"}),"Informations professionnelles (Enseignant)"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sp√©cialit√© / Mati√®re principale *"}),e.jsxs("select",{value:s.specialty,onChange:r=>{r.target.value==="add_new"?ve(!0):d(l=>({...l,specialty:r.target.value}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:ae,children:[e.jsx("option",{value:"",children:"S√©lectionnez une mati√®re"}),re.map(r=>e.jsx("option",{value:r.label,children:r.label},r.value)),e.jsx("option",{value:"add_new",className:"text-blue-600 font-semibold",children:"‚ûï Ajouter une nouvelle mati√®re..."})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Ajouter une nouvelle mati√®re"}),e.jsx(ne,{label:"Nom de la mati√®re",value:ge,onChange:r=>we(r.target.value),placeholder:"Ex: Philosophie, √âconomie...",autoFocus:!0}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx(F,{variant:"outline",onClick:()=>{ve(!1),we("")},disabled:be,className:"flex-1",children:"Annuler"}),e.jsx(F,{onClick:ze,disabled:be||!ge.trim(),className:"flex-1 bg-blue-600 hover:bg-blue-700",children:be?"Ajout...":"Ajouter"})]})]})})]}),e.jsx(ne,{label:"Date d'embauche",type:"date",value:s.hireDate,onChange:r=>d(l=>({...l,hireDate:r.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Classes assign√©es"}),e.jsx("select",{multiple:!0,value:s.selectedClasses,onChange:r=>{const l=Array.from(r.target.selectedOptions,f=>f.value);d(f=>({...f,selectedClasses:l}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",style:{minHeight:"120px"},disabled:ae||D.length===0,children:ae?e.jsx("option",{disabled:!0,children:"Chargement des classes..."}):D.length===0?e.jsx("option",{disabled:!0,children:"Aucune classe disponible. Cr√©ez des classes d'abord."}):D.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:D.length>0?"Maintenez Ctrl/Cmd pour s√©lectionner plusieurs":`Cr√©ez des classes dans "Gestion des classes" d'abord`})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Mati√®res enseign√©es"}),e.jsxs("button",{type:"button",onClick:()=>ve(!0),className:"text-xs text-blue-600 hover:text-blue-700 font-medium flex items-center",children:[e.jsx(t,{name:"Plus",size:14,className:"mr-1"}),"Ajouter"]})]}),e.jsx("select",{multiple:!0,value:s.selectedSubjects,onChange:r=>{const l=Array.from(r.target.selectedOptions,f=>f.value);d(f=>({...f,selectedSubjects:l}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",style:{minHeight:"120px"},disabled:ae||re.length===0,children:ae?e.jsx("option",{disabled:!0,children:"Chargement des mati√®res..."}):re.length===0?e.jsx("option",{disabled:!0,children:'Aucune mati√®re disponible. Ajoutez-en une avec le bouton "Ajouter".'}):re.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:re.length>0?"Maintenez Ctrl/Cmd pour s√©lectionner plusieurs":'Cliquez sur "Ajouter" pour cr√©er une mati√®re'})]})]}),e.jsx(ne,{label:"Heures hebdomadaires",type:"number",value:s.weeklyHours,onChange:r=>d(l=>({...l,weeklyHours:r.target.value})),placeholder:"Ex: 18",min:"1",max:"40"}),s.selectedClasses.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsxs("strong",{children:["Classes s√©lectionn√©es (",s.selectedClasses.length,"):"]})," ",s.selectedClasses.map(r=>{var l;return(l=D.find(f=>f.value===r))==null?void 0:l.label}).join(", ")]})}),s.selectedSubjects.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsxs("strong",{children:["Mati√®res s√©lectionn√©es (",s.selectedSubjects.length,"):"]})," ",s.selectedSubjects.map(r=>{var l;return(l=re.find(f=>f.value===r))==null?void 0:l.label}).join(", ")]})})]})]}),s.role==="secretary"&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-4 flex items-center",children:[e.jsx(t,{name:"Briefcase",size:16,className:"mr-2 text-purple-600"}),"Informations professionnelles (Secr√©taire)"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ne,{label:"D√©partement",value:s.department,onChange:r=>d(l=>({...l,department:r.target.value})),placeholder:"Ex: Administration, P√©dagogie..."}),e.jsx(ne,{label:"Date d'embauche",type:"date",value:s.hireDate,onChange:r=>d(l=>({...l,hireDate:r.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions accord√©es"}),e.jsx("div",{className:"space-y-2",children:Se.map(r=>e.jsxs("label",{className:"flex items-center space-x-2 p-2 hover:bg-gray-50 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.permissions.includes(r.value),onChange:l=>{l.target.checked?d(f=>({...f,permissions:[...f.permissions,r.value]})):d(f=>({...f,permissions:f.permissions.filter(p=>p!==r.value)}))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:r.label})]},r.value))})]}),s.permissions.length>0&&e.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-purple-800",children:[e.jsxs("strong",{children:["Permissions accord√©es (",s.permissions.length,"):"]})," ",s.permissions.map(r=>{var l;return(l=Se.find(f=>f.value===r))==null?void 0:l.label}).join(", ")]})})]})]}),s.role==="student"&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-4 flex items-center",children:[e.jsx(t,{name:"GraduationCap",size:16,className:"mr-2 text-green-600"}),"Informations scolaires (√âl√®ve)"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(ie,{label:"Classe *",value:s.classId,onChange:r=>d(l=>({...l,classId:r})),options:[{value:"",label:"S√©lectionnez une classe"},...D],disabled:ae}),s.classId&&e.jsxs("div",{className:`mt-2 inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${s.schoolLevel==="secondary"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:[e.jsx(t,{name:s.schoolLevel==="secondary"?"CheckCircle":"Info",size:14,className:"mr-1"}),s.schoolLevel==="secondary"?e.jsxs("span",{children:[e.jsx("strong",{children:"Secondaire"})," - Compte personnel sera cr√©√© (matricule + email)"]}):e.jsxs("span",{children:[e.jsx("strong",{children:"Primaire"})," - Pas de compte personnel (g√©r√© par le parent)"]})]})]}),e.jsx(ne,{label:"Date de naissance",type:"date",value:s.dateOfBirth,onChange:r=>d(l=>({...l,dateOfBirth:r.target.value}))})]}),e.jsxs("h5",{className:"text-sm font-medium text-gray-700 mt-6 mb-2 flex items-center",children:[e.jsx(t,{name:"Users",size:14,className:"mr-2 text-orange-600"}),"Lier √† un parent existant *"]}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"S√©lectionnez le parent ou tuteur responsable de cet √©l√®ve. Le parent doit avoir √©t√© cr√©√© au pr√©alable."}),j.length===0&&!ae?e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(t,{name:"AlertTriangle",size:16,className:"text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Aucun parent disponible"}),e.jsx("p",{className:"mt-1",children:"Vous devez d'abord cr√©er un compte PARENT avant de pouvoir inscrire un √©l√®ve."}),e.jsxs("p",{className:"mt-2",children:[e.jsx("strong",{children:"Comment faire :"}),e.jsx("br",{}),'1. S√©lectionnez le r√¥le "Parent" ci-dessus',e.jsx("br",{}),"2. Cr√©ez le compte du parent",e.jsx("br",{}),"3. Revenez cr√©er l'√©l√®ve et s√©lectionnez ce parent"]})]})]})}):e.jsxs("div",{children:[e.jsx(ie,{label:"Parent/Tuteur *",value:s.parentId||"",onChange:r=>d(l=>({...l,parentId:r})),options:[{value:"",label:"S√©lectionnez un parent"},...j.map(r=>({value:r.id,label:`${r.full_name} - ${r.email||r.phone||"Pas de contact"}`}))],disabled:ae,helperText:"Le parent recevra les informations de l'√©l√®ve. Pour le secondaire, il recevra aussi les identifiants de connexion."}),!s.parentId&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(t,{name:"Info",size:16,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Conseil :"}),` Si le parent n'appara√Æt pas dans la liste, cr√©ez d'abord son compte avec le r√¥le "Parent", puis revenez cr√©er l'√©l√®ve.`]})]})})]})]})]}),s.role==="parent"&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-4 flex items-center",children:[e.jsx(t,{name:"Users",size:16,className:"mr-2 text-orange-600"}),"Informations compl√©mentaires (Parent)"]}),e.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(t,{name:"Info",size:16,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Comment √ßa fonctionne :"}),e.jsxs("ol",{className:"mt-2 ml-4 list-decimal space-y-1",children:[e.jsxs("li",{children:["Cr√©ez d'abord le compte du parent (nom, ",e.jsx("strong",{className:"text-orange-700",children:"t√©l√©phone obligatoire"}),", email optionnel, mot de passe)"]}),e.jsx("li",{children:"Ensuite, cr√©ez les comptes des √©l√®ves et s√©lectionnez ce parent"}),e.jsx("li",{children:"Le lien parent-enfant sera √©tabli automatiquement"})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-300",children:[e.jsxs("p",{className:"text-xs text-blue-700 font-medium mb-1",children:[e.jsx(t,{name:"Phone",size:12,className:"inline mr-1"}),"T√©l√©phone obligatoire - Email optionnel"]}),e.jsxs("p",{className:"text-xs text-blue-600 ml-4",children:["‚Ä¢ Le t√©l√©phone est le moyen de contact principal",e.jsx("br",{}),"‚Ä¢ Si le parent n'a pas d'email, un email technique sera g√©n√©r√© automatiquement",e.jsx("br",{}),"‚Ä¢ Format : parent[t√©l√©phone]@edutrack.cm",e.jsx("br",{}),"‚Ä¢ Le parent utilisera cet email + son mot de passe pour se connecter"]})]})]})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ne,{label:"Profession (optionnel)",value:s.profession,onChange:r=>d(l=>({...l,profession:r.target.value})),placeholder:"Ex: Enseignant, M√©decin, Commer√ßant..."}),e.jsx(ne,{label:"Adresse *",value:s.address,onChange:r=>d(l=>({...l,address:r.target.value})),placeholder:"Quartier, Ville",required:!0})]})})]}),s.role!=="student"&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-4 flex items-center",children:[e.jsx(t,{name:"Lock",size:16,className:"mr-2"}),"Informations de connexion"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx(ne,{label:"Mot de passe *",type:u?"text":"password",value:s.password,onChange:r=>d(l=>({...l,password:r.target.value})),placeholder:"Minimum 8 caract√®res",helperText:"Lettres, chiffres et caract√®res sp√©ciaux recommand√©s"}),e.jsx("button",{type:"button",onClick:()=>x(!u),className:"absolute right-3 top-9 text-gray-500 hover:text-gray-700 transition-colors",title:u?"Masquer le mot de passe":"Afficher le mot de passe",children:e.jsx(t,{name:u?"EyeOff":"Eye",size:18})})]}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsxs(F,{type:"button",variant:"outline",size:"sm",onClick:xe,children:[e.jsx(t,{name:"Shuffle",size:14,className:"mr-2"}),"G√©n√©rer automatiquement"]}),e.jsxs(F,{type:"button",variant:"ghost",size:"sm",onClick:()=>{s.password&&(navigator.clipboard.writeText(s.password),alert("Mot de passe copi√© dans le presse-papiers"))},disabled:!s.password,children:[e.jsx(t,{name:"Copy",size:14,className:"mr-2"}),"Copier"]})]})]}),e.jsx(ie,{label:"Statut",value:s.status,onChange:r=>d(l=>({...l,status:r})),options:[{value:"active",label:"Actif"},{value:"inactive",label:"Inactif"}]})]})]}),e.jsxs("div",{className:"border-t pt-6 flex justify-end space-x-4",children:[e.jsx(F,{variant:"outline",onClick:()=>{d({fullName:"",email:"",phone:"",role:"student",password:"",status:"active",specialty:"",hireDate:new Date().toISOString().split("T")[0],selectedClasses:[],selectedSubjects:[],weeklyHours:"",permissions:[],department:"",classId:"",dateOfBirth:"",parentName:"",parentPhone:"",parentEmail:"",selectedChildren:[],profession:""}),$("overview")},children:"Annuler"}),e.jsxs(F,{onClick:Te,className:"bg-blue-600 hover:bg-blue-700",disabled:E,children:[e.jsx(t,{name:"UserPlus",size:16,className:"mr-2"}),E?"Cr√©ation...":"Cr√©er le compte"]})]})]})]})});return q?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-2 px-4","aria-label":"Sous-menu Gestion des comptes",children:Ae.map(r=>e.jsxs("button",{onClick:()=>$(r.id),className:`flex items-center space-x-2 px-4 py-3 text-sm border-b-2 transition-all duration-200 ${T===r.id?"border-blue-600 text-blue-600 font-semibold":"border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300"}`,children:[e.jsx(t,{name:r.icon,size:18}),e.jsx("span",{children:r.label})]},r.id))})}),e.jsx("div",{className:"p-6",children:ce()})]})}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Chargement..."})]})})};class es{static async checkUserPermissions(){try{console.log("üîç Diagnostic des permissions utilisateur...");const{data:T,error:$}=await B.auth.getUser();if($||!T)return{success:!1,error:"Utilisateur non authentifi√©",authUser:null,userDetails:null};console.log("‚úÖ Utilisateur authentifi√©:",T.user.email);const{data:_,error:y}=await B.from("users").select("*").eq("id",T.user.id).single();y&&console.warn("‚ö†Ô∏è Erreur acc√®s table users:",y),console.log("üë§ Utilisateur dans table users:",_?"‚úÖ Pr√©sent":"‚ùå Absent");const L=[{name:"users",query:()=>B.from("users").select("id").eq("id",T.user.id)},{name:"schools",query:()=>B.from("schools").select("id").limit(1)},{name:"students",query:()=>B.from("students").select("id").limit(1)},{name:"teachers",query:()=>B.from("teachers").select("id").limit(1)},{name:"classes",query:()=>B.from("classes").select("id").limit(1)}],w={};for(const P of L)try{const{data:I,error:u}=await P.query();w[P.name]={accessible:!u,error:(u==null?void 0:u.message)||null},console.log(`üìã ${P.name}: ${u?"‚ùå Acc√®s refus√©":"‚úÖ Acc√®s OK"}`)}catch(I){w[P.name]={accessible:!1,error:I.message},console.log(`üìã ${P.name}: ‚ùå Erreur - ${I.message}`)}let M=null,o=null;try{const{data:P,error:I}=await B.from("schools").select("id, name, status, director_user_id").eq("director_user_id",T.user.id);M=P,o=I,I?console.warn("üè´ Erreur acc√®s √©coles directeur:",I):console.log(`üè´ √âcoles du directeur: ${(P==null?void 0:P.length)||0} trouv√©e(s)`)}catch(P){o=P,console.warn("üè´ Exception acc√®s √©coles:",P)}return{success:!0,authUser:T.user,tableUser:_,tableAccess:w,schools:M,schoolError:o,summary:{authenticated:!0,userInTable:!!_,tablesAccessible:Object.values(w).filter(P=>P.accessible).length,totalTables:L.length}}}catch(T){return console.error("‚ùå Erreur diagnostic permissions:",T),{success:!1,error:T.message,authUser:null,userDetails:null}}}static async repairUserPermissions(T,$,_={}){var y;try{console.log("üîß R√©paration des permissions pour:",$);const{data:L,error:w}=await B.from("users").upsert({id:T,email:$,full_name:_.full_name||$.split("@")[0],role:_.role||"student",phone:_.phone||"",is_active:!0,active:!0,photo:"/assets/images/no_image.png",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(w)throw console.error("‚ùå Erreur r√©paration utilisateur:",w),new Error(`Erreur cr√©ation utilisateur: ${w.message}`);if(console.log("‚úÖ Utilisateur r√©par√©:",L),_.role==="principal"){const{data:M,error:o}=await B.from("schools").select("id, name").eq("director_user_id",T);o?console.warn("‚ö†Ô∏è Erreur v√©rification √©cole:",o):!M||M.length===0?console.log("üÜï Aucune √©cole trouv√©e pour ce directeur"):console.log("üè´ √âcole existante:",(y=M[0])==null?void 0:y.name)}return{success:!0,user:L}}catch(L){return console.error("‚ùå Erreur r√©paration permissions:",L),{success:!1,error:L.message}}}static async runFullDiagnostic(){console.log("üöÄ Lancement diagnostic complet base de donn√©es...");const T={timestamp:new Date().toISOString(),steps:{}};return T.steps.permissions=await this.checkUserPermissions(),console.log("‚úÖ Diagnostic termin√©"),T}}const ys=()=>{var P,I,u;const[C,T]=h.useState(null),[$,_]=h.useState(!1),[y,L]=h.useState(!1),w=async()=>{_(!0);try{const x=await es.runFullDiagnostic();T(x)}catch(x){console.error("Erreur diagnostic:",x)}finally{_(!1)}},M=async()=>{var x,S;L(!0);try{if((S=(x=C==null?void 0:C.steps)==null?void 0:x.permissions)!=null&&S.authUser){const a=C.steps.permissions.authUser;(await es.repairUserPermissions(a.id,a.email,a.user_metadata||{})).success&&await w()}}catch(a){console.error("Erreur r√©paration:",a)}finally{L(!1)}};if(h.useEffect(()=>{w()},[]),$&&!C)return e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3",children:"Diagnostic en cours..."})]});const o=(P=C==null?void 0:C.steps)==null?void 0:P.permissions;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 rounded-2xl shadow-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"Activity",size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Diagnostic Base de Donn√©es"}),e.jsx("p",{className:"text-purple-100 text-sm",children:"V√©rification de l'int√©grit√© du syst√®me"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:w,disabled:$,className:"px-4 py-2 bg-white/20 backdrop-blur-sm text-white rounded-xl hover:bg-white/30 disabled:opacity-50 border border-white/30 transition-all shadow-md hover:shadow-lg flex items-center font-semibold",children:[e.jsx(t,{name:"RefreshCw",size:16,className:"mr-2"}),"Actualiser"]}),o&&!((I=o==null?void 0:o.summary)!=null&&I.userInTable)&&e.jsxs("button",{onClick:M,disabled:y,className:"px-4 py-2 bg-green-500 text-white rounded-xl hover:bg-green-600 disabled:opacity-50 transition-all shadow-md hover:shadow-lg flex items-center font-semibold",children:[e.jsx(t,{name:"Wrench",size:16,className:"mr-2"}),y?"R√©paration...":"R√©parer"]})]})]})}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"User",size:20,className:"text-white"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Statut Authentification"})]}),o!=null&&o.authUser?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Email:"}),e.jsx("span",{className:"font-medium",children:o.authUser.email})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"ID:"}),e.jsx("span",{className:"font-mono text-sm",children:o.authUser.id})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"R√¥le:"}),e.jsx("span",{className:"font-medium",children:((u=o.authUser.user_metadata)==null?void 0:u.role)||"Non d√©fini"})]}),e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx(t,{name:"CheckCircle",size:16,className:"mr-2"}),e.jsx("span",{children:"Authentifi√© avec succ√®s"})]})]}):e.jsxs("div",{className:"text-red-600 flex items-center",children:[e.jsx(t,{name:"XCircle",size:16,className:"mr-2"}),e.jsx("span",{children:"Non authentifi√©"})]})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-emerald-600 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"Database",size:20,className:"text-white"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Table Utilisateurs"})]}),o!=null&&o.tableUser?e.jsxs("div",{className:"space-y-2 text-green-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(t,{name:"CheckCircle",size:16,className:"mr-2"}),e.jsx("span",{children:"Pr√©sent dans la table users"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Nom:"}),e.jsx("span",{className:"font-medium",children:o.tableUser.full_name})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"R√¥le:"}),e.jsx("span",{className:"font-medium",children:o.tableUser.role})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx(t,{name:"XCircle",size:16,className:"mr-2"}),e.jsx("span",{children:"Absent de la table users"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:`Cela peut causer des probl√®mes d'acc√®s aux donn√©es. Utilisez le bouton "R√©parer" pour corriger.`})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(t,{name:"Table",size:16,className:"mr-2"}),"Acc√®s aux Tables"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:(o==null?void 0:o.tableAccess)&&Object.entries(o.tableAccess).map(([x,S])=>e.jsxs("div",{className:`p-3 rounded-lg border ${S.accessible?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(t,{name:S.accessible?"CheckCircle":"XCircle",size:16,className:`mr-2 ${S.accessible?"text-green-600":"text-red-600"}`}),e.jsx("span",{className:"font-medium capitalize",children:x})]}),!S.accessible&&S.error&&e.jsx("p",{className:"text-xs text-gray-600 mt-1 truncate",children:S.error})]},x))})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(t,{name:"School",size:16,className:"mr-2"}),"√âcoles"]}),o!=null&&o.schoolError?e.jsxs("div",{className:"text-red-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(t,{name:"XCircle",size:16,className:"mr-2"}),e.jsxs("span",{children:["Erreur d'acc√®s: ",o.schoolError.message]})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Cela est souvent d√ª √† des probl√®mes de permissions RLS (Row Level Security)."})]}):o!=null&&o.schools?e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[o.schools.length," √©cole(s) trouv√©e(s) pour ce directeur"]}),o.schools.map(x=>e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded",children:[e.jsx("div",{className:"font-medium",children:x.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["ID: ",x.id]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Statut: ",x.status]})]},x.id))]}):e.jsxs("div",{className:"text-gray-600",children:[e.jsx(t,{name:"Info",size:16,className:"inline mr-2"}),e.jsx("span",{children:"Aucune √©cole trouv√©e"})]})]}),(o==null?void 0:o.summary)&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"R√©sum√©"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-white p-3 rounded",children:[e.jsx("div",{className:"text-blue-600 font-medium",children:o.summary.authenticated?"‚úÖ Authentifi√©":"‚ùå Non authentifi√©"}),e.jsx("div",{className:"text-gray-600 text-xs",children:"Statut"})]}),e.jsxs("div",{className:"bg-white p-3 rounded",children:[e.jsx("div",{className:"text-blue-600 font-medium",children:o.summary.userInTable?"‚úÖ Pr√©sent":"‚ùå Absent"}),e.jsx("div",{className:"text-gray-600 text-xs",children:"Table users"})]}),e.jsxs("div",{className:"bg-white p-3 rounded",children:[e.jsxs("div",{className:"text-blue-600 font-medium",children:[o.summary.tablesAccessible,"/",o.summary.totalTables," tables"]}),e.jsx("div",{className:"text-gray-600 text-xs",children:"Acc√®s OK"})]})]})]})]})},ws=()=>{const[C,T]=h.useState("pending"),[$]=h.useState("2024-2025"),[_]=h.useState("2025-2026"),[y,L]=h.useState(!0),[w,M]=h.useState([]),[o,P]=h.useState({totalDemandes:0,enAttente:0,approuvees:0,refusees:0,enRevision:0}),[I,u]=h.useState(!1),[x,S]=h.useState({request_type:"nouvelle_inscription",student_first_name:"",student_last_name:"",parent_name:"",parent_phone:"",requested_class:"",priority:"normal"}),{user:a}=fe();h.useEffect(()=>{(async()=>{var d;if((d=a==null?void 0:a.schoolData)!=null&&d.id){L(!0),a.id&&a.schoolData.id&&pe.setUserContext(a.id,a.schoolData.id);try{const{data:D,error:H}=await pe.getEnrollmentRequests(a.schoolData.id,{status:"en_attente"});H||M(D||[]);const{data:re,error:n}=await pe.getEnrollmentStats(a.schoolData.id);n||P(re||{totalDemandes:0,enAttente:0,approuvees:0,refusees:0,enRevision:0})}catch(D){console.error("Erreur lors du chargement des donn√©es d'inscription:",D),M([]),P({totalDemandes:0,enAttente:0,approuvees:0,refusees:0,enRevision:0})}L(!1)}})()},[a]);const[b]=h.useState({ce1_to_ce2:{total:0,approved:0,pending:0},ce2_to_cm1:{total:0,approved:0,pending:0},cm1_to_cm2:{total:0,approved:0,pending:0},cm2_graduates:{total:0,approved:0,pending:0}}),q=s=>{const d={en_attente:{label:"En attente",className:"bg-warning/10 text-warning"},approuve:{label:"Approuv√©",className:"bg-success/10 text-success"},refuse:{label:"Refus√©",className:"bg-error/10 text-error"},en_revision:{label:"En r√©vision",className:"bg-blue/10 text-blue"}},D=d[s]||d.en_attente;return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-caption font-caption-normal ${D.className}`,children:D.label})},G=s=>{const d={urgent:{label:"Urgent",className:"bg-error/10 text-error"},normal:{label:"Normal",className:"bg-muted text-muted-foreground"}},D=d[s]||d.normal;return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-caption font-caption-normal ${D.className}`,children:D.label})},m=async s=>{var H;const{data:d,error:D}=await pe.updateEnrollmentRequest(s,{status:"approuvee"});if(!D){M(n=>n.filter(j=>j.id!==s));const{data:re}=await pe.getEnrollmentStats((H=a==null?void 0:a.schoolData)==null?void 0:H.id);P(re||o)}},N=async s=>{var re;const d=prompt("Raison du refus (optionnel):"),{data:D,error:H}=await pe.updateEnrollmentRequest(s,{status:"refusee",validation_notes:d});if(!H){M(j=>j.filter(X=>X.id!==s));const{data:n}=await pe.getEnrollmentStats((re=a==null?void 0:a.schoolData)==null?void 0:re.id);P(n||o)}},E=async()=>{var D,H;if(!x.student_first_name||!x.student_last_name||!x.requested_class){alert("Veuillez remplir tous les champs obligatoires");return}L(!0);const{data:s,error:d}=await pe.createEnrollmentRequest({...x,school_id:(D=a==null?void 0:a.schoolData)==null?void 0:D.id,submitted_by:a==null?void 0:a.id});if(!d&&s){M(n=>[s,...n]);const{data:re}=await pe.getEnrollmentStats((H=a==null?void 0:a.schoolData)==null?void 0:H.id);P(re||o),S({request_type:"nouvelle_inscription",student_first_name:"",student_last_name:"",parent_name:"",parent_phone:"",requested_class:"",priority:"normal"}),u(!1),alert("Demande cr√©√©e avec succ√®s !")}else alert("Erreur lors de la cr√©ation: "+((d==null?void 0:d.message)||"Erreur inconnue"));L(!1)},R=[{id:"pending",label:"Demandes en attente",icon:"Clock"},{id:"transitions",label:"Passages de classe",icon:"TrendingUp"},{id:"approved",label:"Valid√©es",icon:"CheckCircle"},{id:"settings",label:"Configuration ann√©e",icon:"Settings"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 rounded-2xl shadow-xl p-6 text-white",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center shadow-md",children:e.jsx(t,{name:"Calendar",size:24,className:"text-white"})}),e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold",children:"Validation Ann√©e Scolaire"})})]}),e.jsxs("p",{className:"text-blue-100 text-sm ml-14",children:["D√©cisions et approbations pour ",$," ‚Üí ",_]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:o.enAttente>0?e.jsx("div",{className:"bg-white/20 backdrop-blur-sm px-4 py-2 rounded-xl border border-white/30 shadow-md",children:e.jsxs("span",{className:"text-sm font-semibold text-white",children:["‚ö†Ô∏è ",o.enAttente," demandes en attente"]})}):e.jsx("div",{className:"bg-white/20 backdrop-blur-sm px-4 py-2 rounded-xl border border-white/30 shadow-md",children:e.jsx("span",{className:"text-sm font-semibold text-white",children:"‚úÖ Aucune demande en attente"})})})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-md border-2 border-gray-200 p-2",children:e.jsx("nav",{className:"flex flex-wrap gap-2",children:R.map(s=>e.jsxs("button",{onClick:()=>T(s.id),className:`flex items-center space-x-2 px-4 py-3 rounded-xl font-semibold text-sm transition-all duration-300 ${C===s.id?"bg-gradient-to-br from-blue-600 to-indigo-600 text-white shadow-lg scale-105":"bg-gray-50 text-gray-700 hover:bg-gray-100 border border-gray-200 hover:border-blue-300 hover:shadow-md"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${C===s.id?"bg-white/20 backdrop-blur-sm":"bg-white shadow-sm"}`,children:e.jsx(t,{name:s.icon,size:16,className:C===s.id?"text-white":"text-blue-600"})}),e.jsx("span",{children:s.label}),s.id==="pending"&&o.enAttente>0&&e.jsx("span",{className:`text-xs rounded-full px-2 py-1 font-bold ${C===s.id?"bg-amber-500 text-white":"bg-amber-100 text-amber-800"}`,children:o.enAttente})]},s.id))})}),C==="pending"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 border-2 border-amber-200 rounded-2xl p-5 shadow-lg hover:shadow-xl transition-shadow",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl flex items-center justify-center shadow-md",children:e.jsx(t,{name:"Clock",size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-amber-900",children:o.enAttente}),e.jsx("p",{className:"text-sm font-medium text-amber-700",children:"En attente"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-2xl p-5 shadow-lg hover:shadow-xl transition-shadow",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-600 to-emerald-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx(t,{name:"CheckCircle",size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-green-900",children:o.approuvees}),e.jsx("p",{className:"text-sm font-medium text-green-700",children:"Approuv√©es"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl p-5 shadow-lg hover:shadow-xl transition-shadow",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center shadow-md",children:e.jsx(t,{name:"Eye",size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:o.enRevision}),e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"En r√©vision"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-red-50 to-pink-50 border-2 border-red-200 rounded-2xl p-5 shadow-lg hover:shadow-xl transition-shadow",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-500 to-pink-500 rounded-xl flex items-center justify-center shadow-md",children:e.jsx(t,{name:"XCircle",size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-red-900",children:o.refusees}),e.jsx("p",{className:"text-sm font-medium text-red-700",children:"Refus√©es"})]})]})})]}),e.jsx("div",{className:"space-y-4",children:w.filter(s=>s.status==="en_attente").length===0?e.jsx("div",{className:"bg-card border border-border rounded-lg p-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-50 rounded-full flex items-center justify-center",children:e.jsx(t,{name:"CheckCircle",size:32,className:"text-green-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-heading-medium text-lg text-text-primary mb-2",children:"Aucune demande en attente"}),e.jsx("p",{className:"text-sm text-text-secondary max-w-md",children:"Il n'y a actuellement aucune demande de validation en attente. Les nouvelles demandes appara√Ætront ici."})]}),isProduction&&e.jsxs(F,{variant:"outline",onClick:()=>u(!0),children:[e.jsx(t,{name:"Plus",size:16,className:"mr-2"}),"Ajouter une demande manuelle"]})]})}):w.filter(s=>s.status==="en_attente").map(s=>{var d,D;return e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(t,{name:s.request_type==="nouvelle_inscription"?"UserPlus":s.request_type==="redoublement"?"RotateCcw":"ArrowRight",size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary",children:[s.student_first_name," ",s.student_last_name,((d=s.student)==null?void 0:d.first_name)&&` (${s.student.first_name} ${s.student.last_name})`]}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["Parent: ",s.parent_name||"Non renseign√©"]}),e.jsx("p",{className:"text-sm text-text-secondary",children:s.request_type==="nouvelle_inscription"?`Demande d'inscription en ${s.requested_class}`:s.request_type==="redoublement"?`Redoublement ${s.current_class} ‚Üí ${s.requested_class}`:`Transfert vers ${s.requested_class}`})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[G(s.priority),q(s.status)]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-text-primary mb-2",children:"Informations"}),e.jsxs("div",{className:"space-y-1 text-sm text-text-secondary",children:[e.jsxs("p",{children:["Soumis par: ",((D=s.submitted_by_user)==null?void 0:D.full_name)||"Syst√®me"]}),e.jsxs("p",{children:["Date: ",new Date(s.submitted_date).toLocaleDateString("fr-FR")]}),s.reason&&e.jsxs("p",{children:["Motif: ",s.reason]}),s.teacher_recommendation&&e.jsxs("p",{children:["Avis enseignant: ",s.teacher_recommendation]}),s.previous_school&&e.jsxs("p",{children:["√âcole pr√©c√©dente: ",s.previous_school]})]})]}),s.documents&&Array.isArray(s.documents)&&s.documents.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-text-primary mb-2",children:"Documents fournis"}),e.jsx("div",{className:"space-y-1",children:s.documents.map((H,re)=>e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-text-secondary",children:[e.jsx(t,{name:H.uploaded?"FileCheck":"FileX",size:14,className:H.uploaded?"text-success":"text-warning"}),e.jsx("span",{children:typeof H=="string"?H:H.name})]},re))})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(F,{variant:"outline",size:"sm",children:[e.jsx(t,{name:"Eye",size:14,className:"mr-1"}),"Voir dossier complet"]}),e.jsxs(F,{variant:"outline",size:"sm",children:[e.jsx(t,{name:"MessageCircle",size:14,className:"mr-1"}),"Demander info"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>N(s.id),className:"text-error hover:text-error",children:[e.jsx(t,{name:"X",size:14,className:"mr-1"}),"Refuser"]}),e.jsxs(F,{size:"sm",onClick:()=>m(s.id),children:[e.jsx(t,{name:"Check",size:14,className:"mr-1"}),"Approuver"]})]})]})]},s.id)})})]}),C==="transitions"&&e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"bg-card border border-border rounded-lg p-8",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(t,{name:"TrendingUp",size:32,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary mb-2",children:"Passages de Classe - En D√©veloppement"}),e.jsx("p",{className:"text-sm text-text-secondary max-w-2xl",children:"Cette fonctionnalit√© permettra de g√©rer automatiquement les passages de classe en fonction des r√©sultats scolaires et des recommandations des enseignants."}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:[e.jsx("p",{children:"üìã Fonctionnalit√©s pr√©vues :"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-left inline-block",children:[e.jsx("li",{children:"‚Ä¢ Calcul automatique des passages selon les moyennes"}),e.jsx("li",{children:"‚Ä¢ Validation des redoublements"}),e.jsx("li",{children:"‚Ä¢ G√©n√©ration des listes de classes pour l'ann√©e suivante"}),e.jsx("li",{children:"‚Ä¢ Notifications aux parents"})]})]}),e.jsx("div",{className:"mt-4 px-4 py-2 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700",children:["üí° En attendant, utilisez l'onglet ",e.jsx("strong",{children:'"Demandes en attente"'})," pour g√©rer les inscriptions et redoublements manuellement."]})})]})]})})}),C==="approved"&&e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"bg-card border border-border rounded-lg p-8",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(t,{name:"CheckCircle",size:32,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary mb-2",children:"Demandes Valid√©es"}),e.jsxs("p",{className:"text-sm text-text-secondary max-w-2xl",children:["Vous avez ",e.jsxs("strong",{children:[o.approuvees||0," demande(s) approuv√©e(s)"]}),".",e.jsx("br",{}),"L'historique complet des validations sera bient√¥t disponible ici."]})]}),o.approuvees>0&&e.jsxs(F,{variant:"outline",children:[e.jsx(t,{name:"Download",size:16,className:"mr-2"}),"Exporter la liste (",o.approuvees,")"]})]})})}),C==="settings"&&e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"bg-card border border-border rounded-lg p-8",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(t,{name:"Settings",size:32,className:"text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-text-primary mb-2",children:"Configuration Ann√©e Scolaire - En D√©veloppement"}),e.jsx("p",{className:"text-sm text-text-secondary max-w-2xl",children:"Cette fonctionnalit√© permettra de configurer les param√®tres de l'ann√©e scolaire et de g√©rer la transition entre les ann√©es acad√©miques."}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:[e.jsx("p",{children:"‚öôÔ∏è Param√®tres pr√©vus :"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-left inline-block",children:[e.jsx("li",{children:"‚Ä¢ Dates de d√©but et fin d'ann√©e scolaire"}),e.jsx("li",{children:"‚Ä¢ Configuration des trimestres/semestres"}),e.jsx("li",{children:"‚Ä¢ G√©n√©ration automatique des listes de classe"}),e.jsx("li",{children:"‚Ä¢ Archivage de l'ann√©e pr√©c√©dente"}),e.jsx("li",{children:"‚Ä¢ Migration des donn√©es √©l√®ves"})]})]}),e.jsx("div",{className:"mt-4 px-4 py-2 bg-purple-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-purple-700",children:"üí° Pour l'instant, contactez l'administrateur syst√®me pour modifier les param√®tres de l'ann√©e scolaire dans la base de donn√©es."})})]})]})})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Nouvelle demande d'inscription"}),e.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(t,{name:"X",size:24})})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type de demande *"}),e.jsxs("select",{value:x.request_type,onChange:s=>S({...x,request_type:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"nouvelle_inscription",children:"Nouvelle inscription"}),e.jsx("option",{value:"redoublement",children:"Redoublement"}),e.jsx("option",{value:"transfert",children:"Transfert"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pr√©nom de l'√©l√®ve *"}),e.jsx("input",{type:"text",value:x.student_first_name,onChange:s=>S({...x,student_first_name:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: Marie"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom de l'√©l√®ve *"}),e.jsx("input",{type:"text",value:x.student_last_name,onChange:s=>S({...x,student_last_name:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: Talla"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom du parent/tuteur"}),e.jsx("input",{type:"text",value:x.parent_name,onChange:s=>S({...x,parent_name:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: Joseph Talla"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"T√©l√©phone du parent"}),e.jsx("input",{type:"tel",value:x.parent_phone,onChange:s=>S({...x,parent_phone:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: 237 6XX XX XX XX"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Classe demand√©e *"}),e.jsx("input",{type:"text",value:x.requested_class,onChange:s=>S({...x,requested_class:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: CE1, 6√®me, 2nde..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priorit√©"}),e.jsxs("select",{value:x.priority,onChange:s=>S({...x,priority:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"normal",children:"Normale"}),e.jsx("option",{value:"urgent",children:"Urgente"}),e.jsx("option",{value:"faible",children:"Faible"})]})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-end space-x-3",children:[e.jsx(F,{variant:"outline",onClick:()=>u(!1),disabled:y,children:"Annuler"}),e.jsx(F,{onClick:E,disabled:y,children:y?"Cr√©ation...":"Cr√©er la demande"})]})]})})]})},Is=()=>{var _e,Se,Ee,Ae,ze,Pe,ke,$e,Le,De,Te;const C=ss(),T=He(),[$,_]=h.useState(!1),[y,L]=h.useState("overview"),[w,M]=h.useState(new Date),[o,P]=h.useState(!1),[I,u]=h.useState(()=>{const c=localStorage.getItem("edutrack_diagnostic_mode");return c?parseInt(c):0}),[x,S]=h.useState(()=>localStorage.getItem("edutrack_diagnostic_mode")==="7"),[a,b]=h.useState(!1),[q,G]=h.useState(""),[m,N]=h.useState(!1),[E,R]=h.useState(""),[s,d]=h.useState(""),{user:D}=xs("principal"),{data:H,refresh:re,user:n}=fe(),j=D||n,X=H.schoolDetails,ae=(_e=C.state)==null?void 0:_e.school,he=j==null?void 0:j.schoolData,i=X||he||ae;h.useEffect(()=>{console.log("üèõÔ∏è PrincipalDashboard - √âtat actuel:"),console.log("  - Session Principal:",(D==null?void 0:D.email)||"Non trouv√©e"),console.log("  - Utilisateur actif:",j==null?void 0:j.email),console.log("  - Utilisateur:",n),n?(console.log("  üìã D√©tails utilisateur:"),console.log("    ‚Ä¢ Email:",n.email),console.log("    ‚Ä¢ ID:",n.id),console.log("    ‚Ä¢ Role:",n.role||"Non d√©fini"),console.log("    ‚Ä¢ Donn√©es √©cole:",n.schoolData?"‚úÖ Pr√©sentes":"‚ùå Absentes"),n.schoolData&&(console.log("      - Nom:",n.schoolData.name),console.log("      - ID:",n.schoolData.id),console.log("      - Directeur User ID:",n.schoolData.director_user_id),console.log("      - Type:",n.schoolData.type)),console.log("    ‚Ä¢ Auth Supabase:",n.auth?"‚úÖ Actif":"‚ùå Inactif"),console.log("    ‚Ä¢ DB User:",n.dbUser?"‚úÖ Pr√©sent":"‚ùå Absent")):console.log("  ‚ö†Ô∏è Aucun utilisateur d√©tect√©"),X?console.log("‚úÖ Donn√©es √©cole depuis SUPABASE (PRIORIT√â):",X):he?console.log("‚úÖ Donn√©es √©cole depuis hook (FALLBACK 1):",he):ae?console.log("‚úÖ Donn√©es √©cole depuis location.state (FALLBACK 2):",ae):console.log("‚ùå Aucune donn√©e √©cole disponible"),i&&(console.log("üè´ √âcole active:",i.name),console.log("üéì Type:",i.type),console.log("üìö Classes disponibles:",i.available_classes),console.log("üìä Statut:",i.status),console.log("üë§ Directeur User ID:",i.director_user_id))},[i,n]),h.useEffect(()=>{const W=new URLSearchParams(C.search).get("tab");if(W==="analytics"){T("/principal-dashboard?tab=overview",{replace:!0});return}W&&["overview","school-year","school-info","actions","system","accounts","debug"].includes(W)?L(W):L("overview")},[C.search,T]),h.useEffect(()=>{const c=setInterval(()=>{M(new Date)},1e3);return()=>clearInterval(c)},[]),h.useEffect(()=>{const c=W=>{W.target.closest("[data-mobile-menu]")||P(!1)};if(o)return document.addEventListener("click",c),()=>document.removeEventListener("click",c)},[o]);const ve=()=>{_(!$)},ge=c=>{T(c==="overview"?"/principal-dashboard":`/principal-dashboard?tab=${c}`)},we=()=>{const c=I+1;c===7?(S(!0),localStorage.setItem("edutrack_diagnostic_mode","7"),b(!0),u(7),setTimeout(()=>{b(!1)},5e3),console.log("üîß Mode diagnostic activ√©")):c>7?(S(!1),localStorage.removeItem("edutrack_diagnostic_mode"),u(0),console.log("üîß Mode diagnostic d√©sactiv√©")):(u(c),console.log(`üîß Clics vers mode diagnostic: ${c}/7`))},be=H.metrics||[],de=[{id:"overview",label:"Tableau de Bord",icon:"LayoutDashboard",description:"Vue d'ensemble"},{id:"actions",label:"Actions Rapides",icon:"Zap",description:"Outils de gestion"},{id:"school-year",label:"Validation Ann√©e",icon:"Calendar",description:"Passage ann√©e scolaire"},{id:"school-info",label:"Mon √âtablissement",icon:"School",description:"Informations √©cole"},{id:"accounts",label:"Gestion Comptes",icon:"UserCheck",description:"Personnel & acc√®s"},...x?[{id:"system",label:"√âtat Syst√®me",icon:"Settings",description:"Param√®tres & statut"}]:[],...y==="debug"?[{id:"debug",label:"Diagnostic",icon:"Bug",description:"Outils techniques"}]:[]],ue=async c=>{const W=c.trim();if(!W)return R("Nom de classe invalide"),!1;const oe=(i==null?void 0:i.available_classes)||[];if(oe.includes(W))return R("Cette classe existe d√©j√† dans votre √©tablissement"),!1;N(!0),R(""),d("");try{const{supabase:me}=await ts(async()=>{const{supabase:ee}=await import("./services-CdXttHtG.js").then(xe=>xe.a);return{supabase:ee}},__vite__mapDeps([0,1])),v=[...oe,W],{error:J}=await me.from("schools").update({available_classes:v}).eq("id",i.id);if(J)throw J;console.log(`‚úÖ Classe "${W}" ajout√©e √† schools.available_classes`);const{data:Z,error:Ne}=await me.from("academic_years").select("id").eq("school_id",i.id).eq("is_current",!0).maybeSingle();if(Ne&&console.warn("Erreur r√©cup√©ration ann√©e acad√©mique:",Ne),Z!=null&&Z.id){const xe=(ye=>{const Be=ye.toLowerCase();return["6√®me","6eme","5√®me","5eme","4√®me","4eme","3√®me","3eme","2nde","2de","seconde","1√®re","1ere","premi√®re","premiere","tle","terminale","terminal"].some(Fe=>Be.includes(Fe))?"secondary":"primary"})(W),{error:ce}=await me.from("classes").insert({school_id:i.id,academic_year_id:Z.id,name:W,level:xe});ce?ce.code!=="23505"&&console.warn("Erreur cr√©ation classe dans table classes:",ce):console.log(`‚úÖ Classe "${W}" cr√©√©e dans la table classes (niveau: ${xe})`)}else console.warn("‚ö†Ô∏è Aucune ann√©e acad√©mique courante trouv√©e - classe non cr√©√©e dans la table classes");return d(`Classe "${W}" ajout√©e avec succ√®s !`),setTimeout(()=>{re(),d("")},2e3),!0}catch(me){return console.error("Erreur lors de l'ajout de la classe:",me),R("Erreur lors de l'ajout de la classe. Veuillez r√©essayer."),!1}finally{N(!1)}},Ce=async()=>{const c=q.trim();if(!c){R("Veuillez saisir un nom de classe");return}if(c.length<2){R("Le nom de classe doit contenir au moins 2 caract√®res");return}if(c.length>50){R("Le nom de classe ne peut pas d√©passer 50 caract√®res");return}await ue(c)&&G("")},Re=async c=>{if(window.confirm(`√ätes-vous s√ªr de vouloir supprimer la classe "${c}" ?

‚ö†Ô∏è Attention : Cette action supprimera la classe de votre liste. Si des √©l√®ves sont d√©j√† inscrits dans cette classe, v√©rifiez qu'ils ont √©t√© r√©affect√©s avant de continuer.`))try{if(N(!0),R(""),!(i!=null&&i.id)){R("Erreur : Donn√©es de l'√©cole non disponibles");return}const oe=i.available_classes||[];if(!oe.includes(c)){R("Cette classe n'existe pas dans votre liste");return}const me=oe.filter(J=>J!==c),{error:v}=await B.from("schools").update({available_classes:me}).eq("id",i.id);if(v){console.error("Erreur Supabase lors de la suppression:",v),R("Erreur lors de la suppression de la classe. Veuillez r√©essayer.");return}await re(),console.log(`‚úÖ Classe "${c}" supprim√©e avec succ√®s`)}catch(oe){console.error("Erreur lors de la suppression de la classe:",oe),R("Erreur lors de la suppression de la classe. Veuillez r√©essayer.")}finally{N(!1)}},Ue=()=>{var c,W,oe,me;switch(y){case"overview":return e.jsxs("div",{className:"space-y-4 sm:space-y-6 lg:space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:be==null?void 0:be.slice(0,4).map((v,J)=>e.jsx(hs,{title:v==null?void 0:v.title,value:v==null?void 0:v.value,change:v==null?void 0:v.change,changeType:v==null?void 0:v.changeType,icon:v==null?void 0:v.icon,description:v==null?void 0:v.description,trend:v==null?void 0:v.trend},J))}),e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-gray-200 shadow-lg p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"TrendingUp",size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performances Acad√©miques"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Moyennes et pr√©sences par classe"})]})]}),e.jsxs("div",{className:"hidden lg:flex items-center space-x-2",children:[e.jsxs("button",{className:"px-3 py-1.5 text-xs font-medium bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors flex items-center space-x-1",children:[e.jsx(t,{name:"Filter",size:14}),e.jsx("span",{children:"Filtrer"})]}),e.jsxs("button",{className:"px-3 py-1.5 text-xs font-medium bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center space-x-1",children:[e.jsx(t,{name:"Download",size:14}),e.jsx("span",{children:"Export"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 min-h-[250px] border border-blue-200",children:e.jsx(gs,{})}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 min-h-[250px] border border-green-200",children:e.jsx(ps,{})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-gray-200 shadow-lg p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-emerald-600 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"CreditCard",size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Suivi des Paiements"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Frais scolaires & redevances"})]})]}),e.jsx("div",{className:"hidden lg:flex items-center space-x-2",children:e.jsx("span",{className:"px-3 py-1.5 text-xs font-semibold bg-green-100 text-green-700 rounded-lg",children:"Mois en cours"})})]}),e.jsx("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-4 min-h-[200px] border border-amber-200",children:e.jsx(fs,{})})]})]});case"school-year":return e.jsx(ws,{});case"actions":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx("button",{onClick:()=>T("/principal-dashboard?tab=accounts&subtab=create"),className:"group p-5 bg-gradient-to-br from-blue-50 to-indigo-50 hover:from-blue-100 hover:to-indigo-100 border-2 border-blue-200 hover:border-blue-400 rounded-2xl transition-all duration-300 text-left hover:shadow-xl hover:scale-105",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform",children:e.jsx(t,{name:"UserPlus",size:24,className:"text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-blue-900 text-base mb-1",children:"Cr√©er un Compte"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Ajouter enseignant ou secr√©taire"})]})]})}),e.jsx("button",{onClick:()=>T("/notification-management"),className:"group p-5 bg-gradient-to-br from-green-50 to-emerald-50 hover:from-green-100 hover:to-emerald-100 border-2 border-green-200 hover:border-green-400 rounded-2xl transition-all duration-300 text-left hover:shadow-xl hover:scale-105",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-green-600 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform",children:e.jsx(t,{name:"Bell",size:24,className:"text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-green-900 text-base mb-1",children:"Envoyer Message"}),e.jsx("p",{className:"text-sm text-green-700",children:"Notifier √©l√®ves, parents ou personnel"})]})]})}),e.jsx("button",{onClick:()=>T("/report-generation"),className:"group p-5 bg-gradient-to-br from-purple-50 to-pink-50 hover:from-purple-100 hover:to-pink-100 border-2 border-purple-200 hover:border-purple-400 rounded-2xl transition-all duration-300 text-left hover:shadow-xl hover:scale-105 sm:col-span-2 lg:col-span-1",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform",children:e.jsx(t,{name:"FileBarChart",size:24,className:"text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-purple-900 text-base mb-1",children:"G√©n√©rer Rapport"}),e.jsx("p",{className:"text-sm text-purple-700",children:"Statistiques et analyses d√©taill√©es"})]})]})})]}),e.jsx(bs,{})]});case"system":return e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-gray-200 shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"Settings",size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"√âtat du Syst√®me"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Statut technique et param√®tres"})]})]}),e.jsx(js,{})]});case"accounts":return e.jsx(Ns,{});case"school-info":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-gray-200 shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"Building2",size:20,className:"text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"üèõÔ∏è Informations de l'√âtablissement"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:"üè´"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Nom de l'√©tablissement"}),e.jsx("div",{className:"font-medium",children:(i==null?void 0:i.name)||"Non d√©fini"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:"üéì"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Type d'√©tablissement"}),e.jsx("div",{className:"font-medium",children:(i==null?void 0:i.type)||"Non d√©fini"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:"üìç"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Adresse"}),e.jsx("div",{className:"font-medium",children:(i==null?void 0:i.address)||"Non d√©finie"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center",children:"üåç"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Localisation"}),e.jsx("div",{className:"font-medium",children:i!=null&&i.city?`${i.city}, ${i.country||""}`:"Non d√©finie"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center",children:"üë§"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Directeur"}),e.jsx("div",{className:"font-medium",children:(i==null?void 0:i.director_name)||((c=i==null?void 0:i.users)==null?void 0:c.full_name)||"Non d√©fini"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center",children:"üìû"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"T√©l√©phone"}),e.jsx("div",{className:"font-medium",children:(i==null?void 0:i.phone)||"Non d√©fini"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center",children:"üî¢"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Code √©tablissement"}),e.jsx("div",{className:"font-medium",children:(i==null?void 0:i.code)||"Non d√©fini"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-teal-100 rounded-lg flex items-center justify-center",children:"‚ö°"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Statut"}),e.jsx("div",{className:`font-medium px-2 py-1 rounded text-xs inline-block ${(i==null?void 0:i.status)==="active"?"bg-green-100 text-green-800":(i==null?void 0:i.status)==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:(i==null?void 0:i.status)==="active"?"‚úÖ Actif":(i==null?void 0:i.status)==="pending"?"‚è≥ En attente":(i==null?void 0:i.status)||"Non d√©fini"})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-gray-200 shadow-lg p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-600 to-emerald-600 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"BookOpen",size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"üìö Classes de l'√âcole"}),e.jsx("p",{className:"text-xs text-gray-500",children:"G√©rez les classes de votre √©tablissement"})]})]}),e.jsxs("button",{className:"px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:from-blue-700 hover:to-indigo-700 hover:scale-105 transition-all shadow-md hover:shadow-lg text-sm font-semibold flex items-center space-x-2",children:[e.jsx(t,{name:"Plus",size:16}),e.jsx("span",{children:"Ajouter une classe"})]})]}),i!=null&&i.available_classes&&i.available_classes.length>0?e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-700 mb-4 flex items-center",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"}),"üéØ Vos Classes Actives (",i.available_classes.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:i.available_classes.map((v,J)=>e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-4 text-center hover:from-green-100 hover:to-emerald-100 hover:scale-105 hover:shadow-lg transition-all group relative",children:[e.jsx("div",{className:"text-green-900 font-bold text-lg mb-1",children:v}),e.jsx("div",{className:"text-xs text-green-600 font-medium mb-2",children:"Pr√™te √† utiliser"}),e.jsxs("div",{className:"mt-2 flex justify-center space-x-1",children:[e.jsx("button",{className:"p-2 text-green-600 hover:bg-green-200 rounded-lg transition-colors",title:"Voir les √©l√®ves",children:e.jsx(t,{name:"Users",size:14})}),e.jsx("button",{className:"p-2 text-green-600 hover:bg-green-200 rounded-lg transition-colors",title:"Param√®tres de la classe",children:e.jsx(t,{name:"Settings",size:14})}),e.jsx("button",{onClick:()=>Re(v),disabled:m,className:"p-2 text-red-600 hover:bg-red-100 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Supprimer cette classe",children:e.jsx(t,{name:"Trash2",size:14})})]})]},J))})]}):e.jsx("div",{className:"mb-6 bg-gradient-to-r from-amber-50 via-yellow-50 to-orange-50 border-2 border-amber-300 rounded-2xl p-6 shadow-md",children:e.jsxs("div",{className:"text-center text-amber-900",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl flex items-center justify-center mx-auto mb-3 shadow-md",children:e.jsx(t,{name:"AlertTriangle",size:32,className:"text-white"})}),e.jsx("div",{className:"font-bold text-lg mb-1",children:"Aucune classe active"}),e.jsx("div",{className:"text-sm text-amber-700",children:"Configurez vos classes pour commencer"})]})}),(i==null?void 0:i.type)&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-md font-medium text-gray-700 mb-3 flex items-center",children:["üí° Classes Sugg√©r√©es pour votre ",i.type,e.jsx("span",{className:"ml-2 text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:i.type})]}),(()=>{const v=i.available_classes||[];let J=[],Z="";const ee=(ce=>ce?ce.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim():"")(i.type);ee==="maternelle"||ee.includes("maternelle")?(Z="Cycle pr√©scolaire (3-6 ans)",J=["Petite Section","Moyenne Section","Grande Section","PS A","PS B","MS A","MS B","GS A","GS B"]):ee==="primaire"||ee.includes("primaire")?(Z="Cycle primaire (6-11 ans)",J=["CP","CE1","CE2","CM1","CM2","CP A","CP B","CE1 A","CE1 B","CE2 A","CE2 B","CM1 A","CM1 B","CM2 A","CM2 B"]):ee==="college"||ee.includes("college")?(Z="Cycle secondaire 1er degr√© (11-15 ans)",J=["6√®me","5√®me","4√®me","3√®me","6√®me A","6√®me B","6√®me C","5√®me A","5√®me B","5√®me C","4√®me A","4√®me B","4√®me C","3√®me A","3√®me B","3√®me C"]):ee==="lycee"||ee.includes("lycee")?(Z="Cycle secondaire 2nd degr√© (15-18 ans)",J=["2nde","1√®re","Terminale","2nde A","2nde C","2nde D","1√®re A","1√®re C","1√®re D","1√®re L","1√®re S","Terminale A","Terminale C","Terminale D","Terminale L","Terminale S","Terminale Ti"]):ee==="college_lycee"?(Z="√âtablissement complet - Coll√®ge et Lyc√©e (6√®me - Terminale)",J=["6√®me","5√®me","4√®me","3√®me","6√®me A","6√®me B","5√®me A","5√®me B","4√®me A","4√®me B","3√®me A","3√®me B","2nde","1√®re","Terminale","2nde A","2nde C","1√®re A","1√®re C","1√®re D","1√®re L","1√®re S","Terminale A","Terminale C","Terminale D","Terminale L","Terminale S"]):ee==="formation_professionnelle"||ee.includes("technique")||ee.includes("professionnel")?(Z="Enseignement technique et professionnel",J=["CAP 1√®re ann√©e","CAP 2√®me ann√©e","BEP 1√®re ann√©e","BEP 2√®me ann√©e","BAC Pro 1√®re","BAC Pro 2√®me","BAC Pro Terminale","BTS 1√®re ann√©e","BTS 2√®me ann√©e","CAP √âlectricit√©","CAP M√©canique","CAP Menuiserie","CAP Couture","BEP √âlectronique","BEP Informatique","BEP Comptabilit√©","BAC Pro √âlectricit√©","BAC Pro M√©canique Auto","BAC Pro Secr√©tariat"]):ee==="universite"||ee.includes("universite")||ee.includes("superieur")||ee.includes("institut")?(Z="Enseignement sup√©rieur",J=["Licence 1","Licence 2","Licence 3","Master 1","Master 2","Doctorat","L1 Informatique","L1 Math√©matiques","L1 √âconomie","L1 Gestion","L2 Informatique","L2 Math√©matiques","L2 √âconomie","L2 Gestion","L3 Informatique","L3 Math√©matiques","L3 √âconomie","L3 Gestion","M1 Informatique","M1 Finance","M2 Informatique","M2 Finance"]):(Z="Classes g√©n√©rales",J=["6√®me","5√®me","4√®me","3√®me","2nde","1√®re","Terminale"]);const xe=J.filter(ce=>!v.includes(ce));return e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-xs text-gray-600 italic",children:Z}),xe.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:xe.slice(0,12).map((ce,ye)=>e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-center hover:bg-blue-100 transition-colors cursor-pointer group",children:[e.jsx("div",{className:"text-blue-800 font-medium",children:ce}),e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"Appropri√©e"}),e.jsx("div",{className:"mt-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:()=>ue(ce),disabled:m,className:"px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed",children:"+ Ajouter"})})]},ye))}):e.jsxs("div",{className:"text-center text-gray-500 py-4",children:[e.jsx(t,{name:"CheckCircle",size:20,className:"mx-auto mb-2 text-green-500"}),e.jsxs("div",{className:"text-sm",children:["Toutes les classes appropri√©es pour un ",i.type," sont configur√©es !"]})]})]})})()]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"Plus",size:20,className:"text-white"})}),e.jsx("h4",{className:"text-md font-semibold text-blue-900",children:"üé® Classe Personnalis√©e"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"text",placeholder:"Ex: Ti, 1√®re Anglophone, BTS Comptabilit√©...",className:"flex-1 px-4 py-3 border-2 border-blue-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-sm",value:q,onChange:v=>G(v.target.value),onKeyPress:v=>v.key==="Enter"&&Ce()}),e.jsx("button",{onClick:Ce,disabled:!q.trim()||m,className:"px-5 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:from-blue-700 hover:to-indigo-700 hover:scale-105 transition-all shadow-md hover:shadow-lg disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center space-x-2 font-semibold",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Ajout..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{name:"Plus",size:16}),e.jsx("span",{children:"Cr√©er"})]})})]}),e.jsx("div",{className:"text-xs text-blue-700 mt-2 font-medium",children:"üí° Cr√©ez des classes avec des noms sp√©cifiques √† votre √©tablissement"}),E&&e.jsxs("div",{className:"mt-3 text-sm text-red-700 bg-gradient-to-r from-red-50 to-pink-50 border-2 border-red-200 rounded-xl px-4 py-2 shadow-sm",children:["‚ùå ",E]}),s&&e.jsxs("div",{className:"mt-3 text-sm text-green-700 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl px-4 py-2 shadow-sm",children:["‚úÖ ",s]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-gray-200 shadow-lg p-6 hover:shadow-xl transition-shadow\\n",children:["              ",e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl flex items-center justify-center mr-3 shadow-md",children:e.jsx(t,{name:"BarChart3",size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"üìä Aper√ßu Rapide"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Statistiques g√©n√©rales de l'√©tablissement"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-5 rounded-xl border-2 border-blue-200 hover:shadow-lg hover:scale-105 transition-all",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-800 mb-1",children:((W=be.find(v=>v.title==="√âl√®ves"))==null?void 0:W.value)||0}),e.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"√âl√®ves inscrits"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 p-5 rounded-xl border-2 border-green-200 hover:shadow-lg hover:scale-105 transition-all",children:[e.jsx("div",{className:"text-3xl font-bold text-green-800 mb-1",children:((oe=H==null?void 0:H.schoolStats)==null?void 0:oe.teachers)||0}),e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Enseignants"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 p-5 rounded-xl border-2 border-purple-200 hover:shadow-lg hover:scale-105 transition-all",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-800 mb-1",children:((me=i==null?void 0:i.available_classes)==null?void 0:me.length)||0}),e.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"Classes actives"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-red-50 p-5 rounded-xl border-2 border-orange-200 hover:shadow-lg hover:scale-105 transition-all",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-800 mb-1",children:(()=>{var ee;const v=(ee=i==null?void 0:i.type)==null?void 0:ee.toLowerCase().trim(),J=(i==null?void 0:i.available_classes)||[];let Z=[];return v==="primaire"||v==="√©cole primaire"?Z=["CP","CE1","CE2","CM1","CM2","CP A","CP B","CE1 A","CE1 B","CE2 A","CE2 B","CM1 A","CM1 B","CM2 A","CM2 B"]:v==="coll√®ge"||v==="college"?Z=["6√®me","5√®me","4√®me","3√®me","6√®me A","6√®me B","6√®me C","5√®me A","5√®me B","5√®me C","4√®me A","4√®me B","4√®me C","3√®me A","3√®me B","3√®me C"]:v==="lyc√©e"||v==="lycee"?Z=["2nde","1√®re","Terminale","2nde A","2nde C","2nde D","1√®re A","1√®re C","1√®re D","1√®re L","1√®re S","Terminale A","Terminale C","Terminale D","Terminale L","Terminale S","Terminale Ti"]:v!=null&&v.includes("technique")||v!=null&&v.includes("professionnel")?Z=["CAP 1√®re ann√©e","CAP 2√®me ann√©e","BEP 1√®re ann√©e","BEP 2√®me ann√©e","BAC Pro 1√®re","BAC Pro 2√®me","BAC Pro Terminale","BTS 1√®re ann√©e","BTS 2√®me ann√©e","CAP √âlectricit√©","CAP M√©canique","CAP Menuiserie","CAP Couture","BEP √âlectronique","BEP Informatique","BEP Comptabilit√©","BAC Pro √âlectricit√©","BAC Pro M√©canique Auto","BAC Pro Secr√©tariat"]:v!=null&&v.includes("maternelle")?Z=["Petite Section","Moyenne Section","Grande Section","PS A","PS B","MS A","MS B","GS A","GS B"]:v!=null&&v.includes("sup√©rieur")||v!=null&&v.includes("universit√©")?Z=["Licence 1","Licence 2","Licence 3","Master 1","Master 2","L1 Informatique","L1 Math√©matiques","L1 √âconomie","L2 Informatique","L2 Math√©matiques","L2 √âconomie","L3 Informatique","L3 Math√©matiques","L3 √âconomie"]:Z=["6√®me","5√®me","4√®me","3√®me","2nde","1√®re","Terminale"],Z.filter(xe=>!J.includes(xe)).length})()}),e.jsx("div",{className:"text-sm text-orange-600",children:"Classes sugg√©r√©es"})]})]})]})]});case"debug":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"üîç Debug Utilisateur"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Utilisateur connect√©:"})," ",n?"‚úÖ Oui":"‚ùå Non"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Email:"})," ",(n==null?void 0:n.email)||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ID utilisateur:"})," ",(n==null?void 0:n.id)||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"√âcole d√©tect√©e:"})," ",n!=null&&n.schoolData?"‚úÖ Oui":"‚ùå Non"]})]})}),(n==null?void 0:n.schoolData)&&e.jsxs("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded",children:[e.jsx("h4",{className:"font-medium text-green-900 mb-2",children:"üìä Donn√©es √âcole"}),e.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Nom:"})," ",n.schoolData.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ID:"})," ",n.schoolData.id]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",n.schoolData.type||"Non d√©fini"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Statut:"})," ",n.schoolData.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Adresse:"})," ",n.schoolData.address||"Non d√©finie"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Ville:"})," ",n.schoolData.city||"Non d√©finie"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Pays:"})," ",n.schoolData.ceountry||"Non d√©fini"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Classes:"})," ",n.schoolData.available_classes?n.schoolData.available_classes.join(", "):"Non d√©finies"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Code √©cole:"})," ",n.schoolData.code||"Non d√©fini"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Directeur User ID:"})," ",n.schoolData.director_user_id]})]})]}),ae&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"üìä Donn√©es √âcole (location.state)"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Nom:"})," ",ae.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ID:"})," ",ae.id]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Statut:"})," ",ae.status]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Diagnostic de la Base de Donn√©es"}),e.jsx(ys,{})]})]});default:return null}};return e.jsxs(e.Fragment,{children:[e.jsxs(as,{children:[e.jsx("title",{children:"Tableau de bord Principal - EduTrack CM"}),e.jsx("meta",{name:"description",content:"Tableau de bord principal pour la supervision et l'administration de l'√©cole avec analyses en temps r√©el"})]}),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/30",children:[e.jsx(ls,{userRole:"principal",userName:(i==null?void 0:i.director_name)||(i==null?void 0:i.directorName)||((Se=i==null?void 0:i.users)==null?void 0:Se.full_name)||((Ae=(Ee=n==null?void 0:n.schoolData)==null?void 0:Ee.users)==null?void 0:Ae.full_name)||(n==null?void 0:n.full_name)||((ze=n==null?void 0:n.email)==null?void 0:ze.split("@")[0])||"Directeur",isCollapsed:$,onToggleSidebar:ve}),e.jsx(ns,{userRole:"principal",isCollapsed:$,onToggle:ve}),e.jsx("main",{className:`pt-20 sm:pt-16 transition-all duration-300 ${$?"lg:ml-16":"lg:ml-64"} overflow-x-hidden min-h-screen`,children:e.jsx("div",{className:"px-2 sm:px-4 lg:px-6 py-2 sm:py-3 space-y-2 sm:space-y-3 w-full",children:e.jsxs("div",{className:"max-w-full w-full overflow-x-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 rounded-2xl shadow-xl p-8 text-white mb-8 animate-fadeIn",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"inline-flex items-center px-3 py-1 bg-white/20 backdrop-blur-sm rounded-full text-xs font-medium mb-3",children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"}),"En ligne"]}),e.jsxs("h1",{className:"font-heading font-heading-bold text-4xl mb-2",children:["Bienvenue, ",(i==null?void 0:i.director_name)||(i==null?void 0:i.directorName)||((Pe=i==null?void 0:i.users)==null?void 0:Pe.full_name)||(($e=(ke=n==null?void 0:n.schoolData)==null?void 0:ke.users)==null?void 0:$e.full_name)||(n==null?void 0:n.full_name)||((Le=n==null?void 0:n.email)==null?void 0:Le.split("@")[0])||"Directeur"," üëã"]}),e.jsxs("p",{className:"font-body font-body-normal text-blue-100 text-lg",children:["Tableau de Bord Principal ‚Ä¢ ",e.jsx("span",{onClick:we,className:"cursor-pointer select-none",title:"Cliquez 7 fois pour activer le mode diagnostic",children:(i==null?void 0:i.name)||"√âtablissement"})]})]}),e.jsx("div",{className:"flex flex-col lg:flex-row items-start lg:items-center gap-3",children:e.jsxs("div",{className:"text-right bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20",children:[e.jsx("p",{className:"font-body font-body-semibold text-sm mb-1",children:(De=new Date)==null?void 0:De.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-blue-200 flex items-center justify-end",children:[e.jsx(t,{name:"Calendar",size:14,className:"mr-1"}),"Ann√©e scolaire 2025-2026"]})]})})]})}),e.jsx("div",{className:"mb-8 hidden sm:block",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-md border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-1 h-8 bg-gradient-to-b from-blue-600 to-indigo-600 rounded-full mr-3"}),e.jsx("h2",{className:"font-heading font-heading-bold text-xl text-text-primary",children:"Modules de Gestion"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:de==null?void 0:de.map(c=>{const W=oe=>{switch(oe){case"personnel":return e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full ml-1 flex-shrink-0",title:"25 membres actifs"});case"system":return e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full ml-1 flex-shrink-0",title:"1 alerte mineure"});case"school-year":return e.jsx("div",{className:"w-2 h-2 bg-warning rounded-full ml-1 flex-shrink-0",title:"3 demandes en attente"});default:return null}};return e.jsxs("button",{onClick:()=>ge(c==null?void 0:c.id),className:`group relative overflow-hidden rounded-xl px-5 py-3 transition-all duration-300 ${y===(c==null?void 0:c.id)?"bg-gradient-to-br from-blue-600 to-indigo-600 text-white shadow-lg scale-105":"bg-gray-50 hover:bg-gray-100 border border-gray-200 hover:border-blue-300 hover:shadow-md hover:scale-102 text-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${y===(c==null?void 0:c.id)?"bg-white/20 backdrop-blur-sm":"bg-white group-hover:bg-blue-50 shadow-sm"}`,children:e.jsx(t,{name:c==null?void 0:c.icon,size:20,className:y===(c==null?void 0:c.id)?"text-white":"text-blue-600"})}),e.jsx("span",{className:`font-body font-body-semibold text-sm whitespace-nowrap ${y===(c==null?void 0:c.id)?"text-white":"text-gray-900"}`,children:c==null?void 0:c.label}),W(c==null?void 0:c.id)]}),y===(c==null?void 0:c.id)&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-white rounded-full"})]},c==null?void 0:c.id)})})]})}),e.jsx("div",{className:"mb-6 sm:hidden",children:e.jsxs("div",{className:"relative","data-mobile-menu":!0,children:[e.jsx("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 pointer-events-none",children:e.jsx(t,{name:"Layers",size:18,className:"text-blue-600"})}),e.jsxs("button",{onClick:()=>P(!o),className:"w-full flex items-center justify-between pl-12 pr-4 py-3 bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl text-sm font-semibold text-text-primary transition-all",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:(Te=de==null?void 0:de.find(c=>c.id===y))==null?void 0:Te.label}),(y==="system"&&!0||y==="school-year"&&!0)&&e.jsx("div",{className:"w-2 h-2 bg-warning rounded-full"})]}),e.jsx(t,{name:o?"ChevronUp":"ChevronDown",size:18,className:"text-blue-600"})]}),o&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-2xl shadow-2xl z-50 animate-fadeIn",children:e.jsx("div",{className:"py-2",children:de==null?void 0:de.map(c=>{const W=c.id==="personnel"||c.id==="system"||c.id==="school-year";return e.jsxs("button",{onClick:()=>{ge(c==null?void 0:c.id),P(!1)},className:`w-full flex items-center justify-between px-4 py-3 mx-2 my-1 rounded-xl text-sm transition-all duration-300 ${y===(c==null?void 0:c.id)?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-md font-semibold":"text-gray-600 hover:bg-blue-50 hover:text-blue-700"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${y===(c==null?void 0:c.id)?"bg-white/20":"bg-blue-100"}`,children:e.jsx(t,{name:c==null?void 0:c.icon,size:16,className:y===(c==null?void 0:c.id)?"text-white":"text-blue-600"})}),e.jsx("span",{className:"font-body font-body-semibold",children:c==null?void 0:c.label})]}),W&&e.jsx("div",{className:"w-2 h-2 bg-amber-400 rounded-full flex-shrink-0 animate-pulse"})]},c==null?void 0:c.id)})})})]})}),a&&e.jsx("div",{className:"mb-6 bg-gradient-to-r from-purple-50 via-indigo-50 to-blue-50 border-2 border-purple-300 p-5 rounded-2xl shadow-lg animate-fadeIn",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-xl flex items-center justify-center shadow-md flex-shrink-0",children:e.jsx(t,{name:"Settings",size:24,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-purple-900 mb-1",children:"üîß Mode Diagnostic Activ√©"}),e.jsx("p",{className:"text-xs text-purple-700",children:`L'onglet "√âtat Syst√®me" est maintenant accessible. Cliquez √† nouveau sur le nom de l'√©cole pour d√©sactiver.`})]}),e.jsx("button",{onClick:()=>b(!1),className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-purple-200 transition-colors flex-shrink-0",children:e.jsx(t,{name:"X",size:16,className:"text-purple-600"})})]})}),e.jsx("div",{className:"transition-all duration-state",children:Ue()}),e.jsx("div",{className:"mt-12 pt-6 border-t border-gray-200",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-50 via-indigo-50 to-purple-50 rounded-2xl p-5 shadow-sm border border-blue-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 bg-white px-3 py-2 rounded-lg shadow-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Syst√®me Op√©rationnel"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["EduTrack CM ¬© ",new Date().getFullYear()," - Tous droits r√©serv√©s"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 bg-white px-3 py-2 rounded-lg shadow-sm",children:[e.jsx(t,{name:"Activity",size:14,className:"text-green-500"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Temps r√©el"})]}),e.jsxs("div",{className:"flex items-center space-x-2 bg-white px-3 py-2 rounded-lg shadow-sm",children:[e.jsx(t,{name:"Clock",size:14,className:"text-blue-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:w==null?void 0:w.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})})]})]})]})})})]})})})]})]})};export{Is as default};
//# sourceMappingURL=index-DSOPo4fZ.js.map
