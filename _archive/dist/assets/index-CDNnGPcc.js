import{u as V,j as s}from"./contexts-fbpOeTmm.js";import{r as g}from"./react-vendor-CFDIsUAY.js";import{u as B}from"./useDashboardData-CL9BpvNP.js";import{p as $,F as O,q as z,g as I,r as D,B as H,E as J,D as K}from"./ui-vendor-BrXTGbgA.js";import"./services-CdXttHtG.js";import"./supabase-CIvuJI4W.js";import"./productionDataService-T6uUAzM-.js";const se=()=>{var v,y,N,f,w;const{user:i,userProfile:a}=V(),{data:c,loading:T}=B(),[b,u]=g.useState(!1),[r,h]=g.useState({class_name:"",subject:"",search:"",uploaded_by:""}),[E,p]=g.useState(!1),[n,d]=g.useState({title:"",subject:"",class_name:"",description:"",visibility:"student"}),j=(c==null?void 0:c.documents)||[],m=((v=c==null?void 0:c.classes)==null?void 0:v.map(e=>e.name))||[],o=(c==null?void 0:c.subjects)||["MathÃ©matiques","FranÃ§ais","Anglais","Sciences"],x=(j==null?void 0:j.filter(e=>{var t,l,_,C,k,F,U,A;if((a==null?void 0:a.role)==="student"){if((e==null?void 0:e.visibility)==="class"&&(e==null?void 0:e.class_name)!==(a==null?void 0:a.current_class)||(e==null?void 0:e.visibility)==="student"&&(e==null?void 0:e.student_id)!==(a==null?void 0:a.id)||(e==null?void 0:e.visibility)==="parent")return!1}else if((a==null?void 0:a.role)==="parent"){if((e==null?void 0:e.visibility)==="student"&&!((t=a==null?void 0:a.children)!=null&&t.includes(e==null?void 0:e.student_id))||(e==null?void 0:e.visibility)==="class"&&!((l=a==null?void 0:a.children_classes)!=null&&l.includes(e==null?void 0:e.class_name)))return!1}else if((a==null?void 0:a.role)==="teacher"&&(e==null?void 0:e.uploaded_by)!==(a==null?void 0:a.full_name)&&!((_=a==null?void 0:a.assigned_classes)!=null&&_.includes(e==null?void 0:e.class_name)))return!1;if(r!=null&&r.class_name&&(e==null?void 0:e.class_name)!==(r==null?void 0:r.class_name)||r!=null&&r.subject&&(e==null?void 0:e.subject)!==(r==null?void 0:r.subject)||r!=null&&r.uploaded_by&&(e==null?void 0:e.uploaded_by)!==(r==null?void 0:r.uploaded_by))return!1;if(r!=null&&r.search){const S=(C=r==null?void 0:r.search)==null?void 0:C.toLowerCase();if(!((F=(k=e==null?void 0:e.title)==null?void 0:k.toLowerCase())!=null&&F.includes(S))&&!((A=(U=e==null?void 0:e.description)==null?void 0:U.toLowerCase())!=null&&A.includes(S)))return!1}return!0}))||[],L=async e=>{if(e==null||e.preventDefault(),!(!(n!=null&&n.title)||!(n!=null&&n.subject))){u(!0);try{await new Promise(t=>setTimeout(t,2e3)),alert(`âœ… Document "${n==null?void 0:n.title}" uploadÃ© avec succÃ¨s dans la base de donnÃ©es !`),d({title:"",subject:"",class_name:"",description:"",visibility:"student"}),p(!1),u(!1)}catch(t){alert(`âŒ Erreur lors de l'upload: ${t.message}`),u(!1)}}},R=e=>{console.log("Real download:",e==null?void 0:e.title),alert(`ğŸ“¥ TÃ©lÃ©chargement de "${e==null?void 0:e.title}" depuis le stockage...`)},q=e=>{console.log("Real preview:",e==null?void 0:e.title),alert(`ğŸ‘ï¸ Ouverture de "${e==null?void 0:e.title}" depuis le stockage...`)},G=e=>{var t;return(t=new Date(e))==null?void 0:t.toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"})},M=e=>e||"N/A";return T?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"mt-4 text-gray-600",children:"Chargement des documents..."})]})}):s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Centre de Gestion des Documents"}),s.jsx("p",{className:"text-gray-600",children:(a==null?void 0:a.role)==="teacher"?`Uploadez et gÃ©rez vos documents pour ${((y=i==null?void 0:i.schoolData)==null?void 0:y.name)||"votre Ã©tablissement"}`:(a==null?void 0:a.role)==="student"?`AccÃ©dez aux documents de vos cours Ã  ${((N=i==null?void 0:i.schoolData)==null?void 0:N.name)||"votre Ã©tablissement"}`:(a==null?void 0:a.role)==="parent"?`Consultez les documents de vos enfants Ã  ${((f=i==null?void 0:i.schoolData)==null?void 0:f.name)||"votre Ã©tablissement"}`:`GÃ©rez les documents de ${((w=i==null?void 0:i.schoolData)==null?void 0:w.name)||"votre Ã©tablissement"}`})]}),(a==null?void 0:a.role)==="teacher"&&s.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:s.jsx("div",{className:"p-6",children:E?s.jsxs("form",{onSubmit:L,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Titre du document"}),s.jsx("input",{type:"text",value:n==null?void 0:n.title,onChange:e=>d(t=>{var l;return{...t,title:(l=e==null?void 0:e.target)==null?void 0:l.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"MatiÃ¨re"}),s.jsxs("select",{value:n==null?void 0:n.subject,onChange:e=>d(t=>{var l;return{...t,subject:(l=e==null?void 0:e.target)==null?void 0:l.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[s.jsx("option",{value:"",children:"SÃ©lectionner une matiÃ¨re"}),o==null?void 0:o.map(e=>s.jsx("option",{value:e,children:e},e))]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Classe"}),s.jsxs("select",{value:n==null?void 0:n.class_name,onChange:e=>d(t=>{var l;return{...t,class_name:(l=e==null?void 0:e.target)==null?void 0:l.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"SÃ©lectionner une classe"}),m==null?void 0:m.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"VisibilitÃ©"}),s.jsxs("select",{value:n==null?void 0:n.visibility,onChange:e=>d(t=>{var l;return{...t,visibility:(l=e==null?void 0:e.target)==null?void 0:l.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"student",children:"Ã‰tudiants seulement"}),s.jsx("option",{value:"class",children:"Toute la classe"}),s.jsx("option",{value:"parent",children:"Parents aussi"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),s.jsx("textarea",{value:n==null?void 0:n.description,onChange:e=>d(t=>{var l;return{...t,description:(l=e==null?void 0:e.target)==null?void 0:l.value}}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Description du document..."})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("button",{type:"submit",disabled:b,className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors",children:[b?s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):s.jsx($,{className:"w-4 h-4 mr-2"}),b?"Upload en cours...":"Uploader"]}),s.jsx("button",{type:"button",onClick:()=>p(!1),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Annuler"})]})]}):s.jsxs("button",{onClick:()=>p(!0),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[s.jsx($,{className:"w-5 h-5 mr-2"}),"Uploader un document"]})})}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx(O,{className:"w-5 h-5 text-gray-600 mr-2"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Filtrer les documents"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx("div",{children:s.jsx("input",{type:"text",placeholder:"Rechercher...",value:r==null?void 0:r.search,onChange:e=>h(t=>{var l;return{...t,search:(l=e==null?void 0:e.target)==null?void 0:l.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})}),s.jsxs("select",{value:r==null?void 0:r.class_name,onChange:e=>h(t=>{var l;return{...t,class_name:(l=e==null?void 0:e.target)==null?void 0:l.value}}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Toutes les classes"}),m==null?void 0:m.map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsxs("select",{value:r==null?void 0:r.subject,onChange:e=>h(t=>{var l;return{...t,subject:(l=e==null?void 0:e.target)==null?void 0:l.value}}),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Toutes les matiÃ¨res"}),o==null?void 0:o.map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsx("button",{onClick:()=>h({class_name:"",subject:"",search:"",uploaded_by:""}),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"RÃ©initialiser"})]})]})}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-6",children:["Documents (",x==null?void 0:x.length,")"]}),(x==null?void 0:x.length)===0?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun document trouvÃ©"}),s.jsx("p",{className:"text-gray-600",children:r!=null&&r.search||r!=null&&r.class_name||r!=null&&r.subject?"Essayez de modifier vos filtres de recherche.":"Il n'y a pas encore de documents disponibles pour votre profil."})]}):s.jsx("div",{className:"space-y-4",children:x==null?void 0:x.map(e=>s.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[s.jsx(z,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),s.jsx("h4",{className:"text-lg font-medium text-gray-900",children:e==null?void 0:e.title}),s.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${(e==null?void 0:e.subject)==="Administration"?"bg-purple-100 text-purple-800":(e==null?void 0:e.subject)==="Finance"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:e==null?void 0:e.subject})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm text-gray-600 mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(I,{className:"w-4 h-4 mr-1"}),G(e==null?void 0:e.uploaded_at)]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(D,{className:"w-4 h-4 mr-1"}),e==null?void 0:e.uploaded_by]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(H,{className:"w-4 h-4 mr-1"}),(e==null?void 0:e.class_name)||"N/A"]}),s.jsx("div",{className:"text-gray-500",children:M(e==null?void 0:e.file_size)})]}),(e==null?void 0:e.description)&&s.jsx("p",{className:"text-sm text-gray-600 mb-3",children:e==null?void 0:e.description})]}),s.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[s.jsxs("button",{onClick:()=>q(e),className:"flex items-center px-3 py-1 text-sm text-blue-600 border border-blue-200 rounded hover:bg-blue-50 transition-colors",children:[s.jsx(J,{className:"w-4 h-4 mr-1"}),"Voir"]}),s.jsxs("button",{onClick:()=>R(e),className:"flex items-center px-3 py-1 text-sm text-green-600 border border-green-200 rounded hover:bg-green-50 transition-colors",children:[s.jsx(K,{className:"w-4 h-4 mr-1"}),"TÃ©lÃ©charger"]})]})]})},e==null?void 0:e.id))})]})}),s.jsxs("div",{className:"bg-green-50 rounded-lg p-6 mt-6",children:[s.jsx("h4",{className:"text-lg font-medium text-green-900 mb-3",children:"ContrÃ´le d'accÃ¨s basÃ© sur les rÃ´les"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-2 text-green-800",children:"ğŸ‘¨â€ğŸ« Enseignants"}),s.jsx("p",{className:"text-green-700",children:"Uploadent des documents rÃ©els vers le stockage Supabase"})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-2 text-green-800",children:"ğŸ‘¨â€ğŸ“ Ã‰tudiants"}),s.jsx("p",{className:"text-green-700",children:"AccÃ¨dent aux vrais documents de leurs classes depuis la base de donnÃ©es"})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-2 text-green-800",children:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Parents"}),s.jsx("p",{className:"text-green-700",children:"Consultent les vrais documents et communications de leurs enfants"})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium mb-2 text-green-800",children:"ğŸ‘¨â€ğŸ’¼ Admin"}),s.jsx("p",{className:"text-green-700",children:"Gestion complÃ¨te des documents rÃ©els de l'Ã©tablissement"})]})]})]})]})})};export{se as default};
//# sourceMappingURL=index-CDNnGPcc.js.map
