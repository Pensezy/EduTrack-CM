import{j as e,u as Ee}from"./contexts-fbpOeTmm.js";import{r as E,i as Ae}from"./react-vendor-CFDIsUAY.js";import{H as Te,S as qe}from"./Sidebar-Q0ML3SY6.js";import{I as d}from"./index-BPV3rumr.js";import{s as J}from"./services-CdXttHtG.js";import{d as Me,b as $e,c as Pe,g as Ue,e as He,f as Le}from"./grading-CH75oUbS.js";import"./purify.es-B9ZVCkUG.js";import{d as ye}from"./documentService-BNZuJcP9.js";import"./ui-vendor-BrXTGbgA.js";import"./supabase-CIvuJI4W.js";import"./pdf-vendor-wz8qypYI.js";const _e=({classes:t,selectedClass:i,onClassSelect:N})=>e.jsxs("div",{className:"bg-card rounded-lg shadow-card border border-border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"font-heading font-heading-semibold text-xl text-card-foreground",children:"Mes Classes Assign√©es"}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-primary/10 rounded-lg",children:[e.jsx(d,{name:"Users",size:16,className:"text-primary"}),e.jsxs("span",{className:"font-caption font-caption-semibold text-sm text-primary",children:[t==null?void 0:t.length," classe",(t==null?void 0:t.length)>1?"s":""," assign√©e",(t==null?void 0:t.length)>1?"s":""]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t==null?void 0:t.map(g=>{var A,q,k,C,a,M,R;const l=(i==null?void 0:i.id)===(g==null?void 0:g.id);return e.jsxs("div",{onClick:()=>N(g),className:`relative p-4 rounded-lg border-2 transition-all duration-300 cursor-pointer group ${l?"border-primary bg-primary/5 shadow-md":"border-border hover:border-primary/50 hover:bg-primary/2"}`,children:[l&&e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-primary rounded-full flex items-center justify-center",children:e.jsx(d,{name:"Check",size:14,className:"text-white"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:g==null?void 0:g.name}),e.jsx("span",{className:"px-2 py-1 bg-success/10 text-success rounded text-xs font-caption font-caption-semibold",children:g==null?void 0:g.subject})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{name:"GraduationCap",size:14,className:"text-muted-foreground"}),e.jsxs("span",{className:"font-body font-body-normal text-sm text-muted-foreground",children:["Niveau: ",g==null?void 0:g.level]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{name:"School",size:14,className:"text-muted-foreground"}),e.jsx("span",{className:"font-body font-body-normal text-sm text-muted-foreground truncate",children:g==null?void 0:g.school})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{name:"Users",size:14,className:"text-muted-foreground"}),e.jsxs("span",{className:"font-body font-body-normal text-sm text-muted-foreground",children:[g==null?void 0:g.students," √©l√®ves"]})]})]}),e.jsxs("div",{className:"pt-3 border-t border-border",children:[e.jsx("h4",{className:"font-caption font-caption-semibold text-xs text-muted-foreground mb-2",children:"Charge horaire:"}),e.jsx("div",{className:"space-y-1",children:Array.isArray(g==null?void 0:g.schedule)?e.jsxs(e.Fragment,{children:[(q=(A=g==null?void 0:g.schedule)==null?void 0:A.slice(0,2))==null?void 0:q.map((_,$)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"font-caption font-caption-normal text-muted-foreground",children:_==null?void 0:_.day}),e.jsx("span",{className:"font-caption font-caption-semibold text-primary",children:_==null?void 0:_.time})]},$)),((k=g==null?void 0:g.schedule)==null?void 0:k.length)>2&&e.jsxs("div",{className:"text-xs text-center text-muted-foreground",children:["+",((C=g==null?void 0:g.schedule)==null?void 0:C.length)-2," autre",((a=g==null?void 0:g.schedule)==null?void 0:a.length)-2>1?"s":""]})]}):(M=g==null?void 0:g.schedule)!=null&&M.weekly_hours?e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"font-caption font-caption-normal text-muted-foreground",children:"Heures par semaine"}),e.jsxs("span",{className:"font-caption font-caption-semibold text-primary",children:[(R=g==null?void 0:g.schedule)==null?void 0:R.weekly_hours,"h"]})]}):e.jsx("div",{className:"text-xs text-center text-muted-foreground",children:"Horaire non d√©fini"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-3 border-t border-border",children:[e.jsxs("div",{className:"text-center p-2 bg-muted/20 rounded",children:[e.jsx("div",{className:"font-heading font-heading-bold text-sm text-success",children:g!=null&&g.average?`${g.average.toFixed(1)}/20`:"N/A"}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Moy. classe"})]}),e.jsxs("div",{className:"text-center p-2 bg-muted/20 rounded",children:[e.jsx("div",{className:"font-heading font-heading-bold text-sm text-primary",children:g!=null&&g.attendanceRate?`${g.attendanceRate}%`:"N/A"}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Pr√©sence"})]})]})]})]},g==null?void 0:g.id)})}),(t==null?void 0:t.length)===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(d,{name:"Users",size:48,className:"text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"font-body font-body-normal text-muted-foreground",children:"Aucune classe assign√©e pour le moment"}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-muted-foreground mt-2",children:"Contactez l'administration pour recevoir vos assignations de classes"})]})]}),ke=({classes:t,selectedClass:i})=>{var C,a,M,R,_,$;if(!i)return null;const N=()=>t==null?void 0:t.reduce((o,h)=>o+(h==null?void 0:h.students),0),g=()=>(t==null?void 0:t.reduce((o,h)=>{var b,r,y;return Array.isArray(h==null?void 0:h.schedule)?o+((b=h==null?void 0:h.schedule)==null?void 0:b.length)*1.5:(r=h==null?void 0:h.schedule)!=null&&r.weekly_hours?o+((y=h==null?void 0:h.schedule)==null?void 0:y.weekly_hours):o},0))||0,l=()=>{var b,r,y,j;const o=(b=new Date)==null?void 0:b.toLocaleDateString("fr-FR",{weekday:"long"}),h=((r=o==null?void 0:o.charAt(0))==null?void 0:r.toUpperCase())+((y=o==null?void 0:o.slice(1))==null?void 0:y.toLowerCase());return Array.isArray(i==null?void 0:i.schedule)?((j=i==null?void 0:i.schedule)==null?void 0:j.filter(S=>{var v;return((v=S==null?void 0:S.day)==null?void 0:v.toLowerCase())===(h==null?void 0:h.toLowerCase())}))||[]:[]},q=(()=>{var r,y,j,S;const o=new Date,h=o==null?void 0:o.toLocaleDateString("fr-FR",{weekday:"long"}),b=(o==null?void 0:o.getHours())*60+(o==null?void 0:o.getMinutes());for(const v of t||[])if(Array.isArray(v==null?void 0:v.schedule)){for(const G of v==null?void 0:v.schedule)if((G==null?void 0:G.day)===h){const[x,z]=(S=(j=(y=(r=G==null?void 0:G.time)==null?void 0:r.split("-"))==null?void 0:y[0])==null?void 0:j.split(":"))==null?void 0:S.map(Number);if(x*60+z>b)return{class:v,slot:G}}}return null})(),k=l();return e.jsxs("div",{className:"bg-gradient-to-r from-success/5 to-primary/5 rounded-lg border border-primary/10 p-3 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{className:"mb-3 sm:mb-4 lg:mb-0",children:[e.jsxs("h2",{className:"font-heading font-heading-bold text-lg sm:text-xl lg:text-2xl text-card-foreground mb-1 sm:mb-2",children:["Classe s√©lectionn√©e: ",i==null?void 0:i.name]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-body font-body-normal text-muted-foreground",children:[e.jsx("span",{className:"font-body-semibold",children:"Mati√®re:"})," ",i==null?void 0:i.subject]}),e.jsxs("p",{className:"font-body font-body-normal text-muted-foreground",children:[e.jsx("span",{className:"font-body-semibold",children:"Niveau:"})," ",i==null?void 0:i.level]}),e.jsxs("p",{className:"font-body font-body-normal text-muted-foreground",children:[e.jsx("span",{className:"font-body-semibold",children:"√âcole:"})," ",i==null?void 0:i.school]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-3 lg:gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-2 sm:p-3 lg:p-4 shadow-sm border border-border text-center",children:[e.jsx(d,{name:"Users",size:18,className:"mx-auto mb-2 text-primary"}),e.jsx("div",{className:"font-heading font-heading-bold text-xl text-primary",children:N()}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground mt-1",children:"Total √©l√®ves"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-2 sm:p-3 lg:p-4 shadow-sm border border-border text-center",children:[e.jsx(d,{name:"GraduationCap",size:18,className:"mx-auto mb-2 text-success"}),e.jsx("div",{className:"font-heading font-heading-bold text-xl text-success",children:t==null?void 0:t.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground mt-1",children:"Classes assign√©es"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-2 sm:p-3 lg:p-4 shadow-sm border border-border text-center",children:[e.jsx(d,{name:"Clock",size:18,className:"mx-auto mb-2 text-warning"}),e.jsxs("div",{className:"font-heading font-heading-bold text-xl text-warning",children:[g(),"h"]}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground mt-1",children:"Heures/semaine"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-2 sm:p-3 lg:p-4 shadow-sm border border-border text-center",children:[e.jsx(d,{name:"User",size:18,className:"mx-auto mb-2 text-accent-foreground"}),e.jsx("div",{className:"font-heading font-heading-bold text-xl text-accent-foreground",children:i==null?void 0:i.students}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground mt-1",children:"√âl√®ves classe"})]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-2 gap-3 sm:p-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{name:"Calendar",size:18,className:"text-primary"}),e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"Programme d'aujourd'hui"})]}),(k==null?void 0:k.length)>0?e.jsx("div",{className:"space-y-2",children:k==null?void 0:k.map((o,h)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-primary/5 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-body font-body-semibold text-sm text-card-foreground",children:o==null?void 0:o.time}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:o==null?void 0:o.room})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-caption font-caption-semibold text-xs text-primary",children:i==null?void 0:i.name}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:i==null?void 0:i.subject})]})]},h))}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(d,{name:"Calendar",size:32,className:"text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:"Pas de cours aujourd'hui pour cette classe"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(d,{name:"Clock",size:18,className:"text-success"}),e.jsx("h3",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"Prochain cours"})]}),q?e.jsxs("div",{className:"p-3 bg-success/5 rounded-lg border border-success/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-heading font-heading-semibold text-lg text-success",children:(C=q==null?void 0:q.slot)==null?void 0:C.time}),e.jsx("span",{className:"px-2 py-1 bg-success/10 text-success rounded text-xs font-caption font-caption-semibold",children:(a=q==null?void 0:q.slot)==null?void 0:a.day})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-body font-body-semibold text-sm text-card-foreground",children:[(M=q==null?void 0:q.class)==null?void 0:M.name," - ",(R=q==null?void 0:q.class)==null?void 0:R.subject]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:["üìç ",(_=q==null?void 0:q.slot)==null?void 0:_.room]}),e.jsxs("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:["üë• ",($=q==null?void 0:q.class)==null?void 0:$.students," √©l√®ves"]})]})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(d,{name:"CheckCircle",size:32,className:"text-success mx-auto mb-2"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:"Plus de cours aujourd'hui"})]})]})]})]})},Se=({classData:t,students:i,onGradeAdded:N})=>{var m,c,f;const[g,l]=E.useState(null),[A,q]=E.useState("secondaire"),[k,C]=E.useState("1"),[a,M]=E.useState({student:"",type:"",grade:"",max_grade:"20",coefficient:"1",description:"",sequence:"1",trimester:"1",date:(f=(c=(m=new Date)==null?void 0:m.toISOString())==null?void 0:c.split("T"))==null?void 0:f[0]}),[R,_]=E.useState(!1),[$,o]=E.useState(!1);E.useEffect(()=>{(async()=>{if(t!=null&&t.school_id){const{data:p,error:B}=await J.from("schools").select("type").eq("id",t.school_id).single();!B&&p&&q(p.type||"secondaire")}})()},[t]),E.useEffect(()=>{const n=parseInt(a.sequence);let p="1";n===1||n===2?p="1":n===3||n===4?p="2":(n===5||n===6)&&(p="3"),M(B=>({...B,trimester:p}))},[a.sequence]);const h=()=>A==="maternelle"?[{value:"observation",label:"üé® Observation en classe",color:"text-blue-600"},{value:"activite",label:"üéØ Activit√© pratique",color:"text-green-600"},{value:"participation",label:"‚úã Participation",color:"text-purple-600"},{value:"autonomie",label:"üåü Autonomie",color:"text-orange-600"}]:A==="primaire"?[{value:"evaluation_continue",label:"üìù √âvaluation continue",color:"text-blue-600"},{value:"composition",label:"üìö Composition",color:"text-red-600"},{value:"exercice",label:"‚úèÔ∏è Exercice",color:"text-green-600"},{value:"interrogation",label:"‚ùì Interrogation √©crite",color:"text-purple-600"},{value:"oral",label:"üó£Ô∏è Interrogation orale",color:"text-indigo-600"}]:[{value:"evaluation_sequence",label:"üìã √âvaluation de s√©quence",color:"text-blue-600"},{value:"devoir",label:"üìù Devoir surveill√©",color:"text-purple-600"},{value:"composition",label:"üìö Composition trimestrielle",color:"text-red-600"},{value:"interrogation_ecrite",label:"‚úçÔ∏è Interrogation √©crite",color:"text-green-600"},{value:"tp",label:"üî¨ Travaux Pratiques (TP)",color:"text-cyan-600"},{value:"tpe",label:"üë• Travaux Pratiques Encadr√©s (TPE)",color:"text-orange-600"},{value:"expose",label:"üé§ Expos√©",color:"text-pink-600"}],b=[{value:"1",label:"S√©quence 1"},{value:"2",label:"S√©quence 2"},{value:"3",label:"S√©quence 3"},{value:"4",label:"S√©quence 4"},{value:"5",label:"S√©quence 5"},{value:"6",label:"S√©quence 6"}],r=[{value:"1",label:"1er Trimestre (S√©q. 1-2)"},{value:"2",label:"2√®me Trimestre (S√©q. 3-4)"},{value:"3",label:"3√®me Trimestre (S√©q. 5-6)"}],y=[{value:"1",label:"Coefficient 1"},{value:"2",label:"Coefficient 2"},{value:"3",label:"Coefficient 3"},{value:"4",label:"Coefficient 4"},{value:"5",label:"Coefficient 5"},{value:"6",label:"Coefficient 6"}],j=n=>n>=16?"text-success":n>=14?"text-primary":n>=12?"text-warning":"text-error",S=n=>n>=16?"bg-success/10":n>=14?"bg-primary/10":n>=12?"bg-warning/10":"bg-error/10",v=async n=>{var u,w,U;if(n==null||n.preventDefault(),!a.student||!a.type||!a.grade){alert("Veuillez remplir tous les champs obligatoires (√©l√®ve, type, note)");return}const p=parseFloat(a.grade),B=parseFloat(a.max_grade);if(isNaN(p)||p<0||p>B){alert(`La note doit √™tre entre 0 et ${B}`);return}let s=a.trimester;a.sequence==="1"||a.sequence==="2"?s="1":a.sequence==="3"||a.sequence==="4"?s="2":s="3",o(!0);try{const K=i.find(H=>H.id===a.student),{data:xe,error:P}=await J.from("grades").insert({student_id:a.student,school_id:(t==null?void 0:t.school_id)||(K==null?void 0:K.school_id),academic_year_id:t==null?void 0:t.academic_year_id,class_id:K==null?void 0:K.class_id,subject_id:t==null?void 0:t.subject_id,teacher_id:t==null?void 0:t.teacher_id,grade:p,max_grade:B,grade_type:a.type,coefficient:parseFloat(a.coefficient),description:a.description||null,sequence:parseInt(a.sequence),trimester:parseInt(s),date:a.date}).select();if(P){console.error("Erreur enregistrement note:",P),alert("Erreur lors de l'enregistrement de la note: "+P.message);return}console.log("‚úÖ Note enregistr√©e:",xe),M({student:"",type:"",grade:"",max_grade:"20",coefficient:"1",description:"",sequence:k,trimester:s,date:(U=(w=(u=new Date)==null?void 0:u.toISOString())==null?void 0:w.split("T"))==null?void 0:U[0]}),N&&N(),alert("Note enregistr√©e avec succ√®s!")}catch(K){console.error("Exception enregistrement note:",K),alert("Une erreur est survenue lors de l'enregistrement")}finally{o(!1)}},G=()=>{console.log("Bulk grade entry for class:",t==null?void 0:t.name),_(!1),alert("Saisie group√©e initialis√©e!")},x=n=>{var s;if(!((s=n==null?void 0:n.recentGrades)!=null&&s.length))return 0;let p=0,B=0;return n.recentGrades.forEach(u=>{const w=u.coefficient||1,U=u.grade/(u.max_grade||20)*20;p+=U*w,B+=w}),B>0?p/B:0},z=h();return e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border-2 border-gray-200 p-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4 mb-6 border-2 border-indigo-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-bold text-2xl text-gray-900 mb-1",children:"üìä Saisie des Notes"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t==null?void 0:t.name," - ",t==null?void 0:t.subject]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("select",{value:k,onChange:n=>{C(n.target.value),M({...a,sequence:n.target.value})},className:"px-4 py-2 bg-white border-2 border-indigo-300 rounded-lg font-bold text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:b.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))}),e.jsx("div",{className:"px-4 py-2 bg-white rounded-lg border-2 border-purple-300 shadow-md",children:e.jsxs("span",{className:"font-bold text-sm text-purple-700",children:[i==null?void 0:i.length," √©l√®ve",(i==null?void 0:i.length)>1?"s":""]})})]})]})}),R&&e.jsx("div",{className:"mb-6 p-4 bg-success/5 border border-success/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-lg text-card-foreground mb-2",children:"Saisie group√©e d'√©valuation"}),e.jsxs("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:["Cr√©er une √©valuation pour toute la classe ",t==null?void 0:t.name," en ",t==null?void 0:t.subject]})]}),e.jsx("button",{onClick:G,className:"px-4 py-2 bg-success text-white hover:bg-success/90 rounded-lg transition-colors",children:"D√©marrer"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"Nouvelle Note"}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"√âl√®ve *"}),e.jsxs("select",{value:a==null?void 0:a.student,onChange:n=>{var p;return M({...a,student:(p=n==null?void 0:n.target)==null?void 0:p.value})},className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background",required:!0,children:[e.jsx("option",{value:"",children:"S√©lectionner un √©l√®ve"}),i==null?void 0:i.map(n=>e.jsxs("option",{value:n==null?void 0:n.id,children:[n==null?void 0:n.name," (",n==null?void 0:n.matricule,")"]},n==null?void 0:n.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Type d'√©valuation *"}),e.jsxs("select",{value:a==null?void 0:a.type,onChange:n=>{var p;return M({...a,type:(p=n==null?void 0:n.target)==null?void 0:p.value})},className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background",required:!0,children:[e.jsx("option",{value:"",children:"Choisir le type"}),z==null?void 0:z.map(n=>e.jsx("option",{value:n==null?void 0:n.value,children:n==null?void 0:n.label},n==null?void 0:n.value))]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Note *"}),e.jsx("input",{type:"number",min:"0",max:a.max_grade,step:"0.25",value:a==null?void 0:a.grade,onChange:n=>{var p;return M({...a,grade:(p=n==null?void 0:n.target)==null?void 0:p.value})},className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background",placeholder:"15.5",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Sur"}),e.jsx("input",{type:"number",min:"10",max:"100",value:a==null?void 0:a.max_grade,onChange:n=>{var p;return M({...a,max_grade:(p=n==null?void 0:n.target)==null?void 0:p.value})},className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background",placeholder:"20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Coef."}),e.jsx("select",{value:a==null?void 0:a.coefficient,onChange:n=>{var p;return M({...a,coefficient:(p=n==null?void 0:n.target)==null?void 0:p.value})},className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background",children:y==null?void 0:y.map(n=>e.jsx("option",{value:n==null?void 0:n.value,children:n==null?void 0:n.value},n==null?void 0:n.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"S√©quence *"}),e.jsx("select",{value:a==null?void 0:a.sequence,onChange:n=>{var p;return M({...a,sequence:(p=n==null?void 0:n.target)==null?void 0:p.value})},className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background",required:!0,children:b.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Trimestre"}),e.jsx("select",{value:a==null?void 0:a.trimester,onChange:n=>{var p;return M({...a,trimester:(p=n==null?void 0:n.target)==null?void 0:p.value})},className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background",disabled:!0,children:r.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Description"}),e.jsx("input",{type:"text",value:a==null?void 0:a.description,onChange:n=>{var p;return M({...a,description:(p=n==null?void 0:n.target)==null?void 0:p.value})},className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background",placeholder:"Contr√¥le chapitre 5 - Fonctions"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Date de l'√©valuation"}),e.jsx("input",{type:"date",value:a==null?void 0:a.date,onChange:n=>{var p;return M({...a,date:(p=n==null?void 0:n.target)==null?void 0:p.value})},className:"w-full px-4 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background"})]}),e.jsxs("button",{type:"submit",disabled:$,className:"w-full bg-primary text-white font-body font-body-semibold py-3 px-4 rounded-lg hover:bg-primary/90 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(d,{name:"Save",size:16}),$?"Enregistrement...":"Enregistrer la Note"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"√âl√®ves & Notes R√©centes"}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:i==null?void 0:i.map(n=>{var B,s,u,w,U,K,xe,P;const p=x(n);return e.jsxs("div",{className:`border border-border rounded-lg p-4 transition-all cursor-pointer ${(g==null?void 0:g.id)===(n==null?void 0:n.id)?"border-primary bg-primary/5":"hover:border-primary/50"}`,onClick:()=>l((g==null?void 0:g.id)===(n==null?void 0:n.id)?null:n),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-indigo-600 flex items-center justify-center text-white font-bold text-sm shadow-md border-2 border-white",children:((s=(B=n==null?void 0:n.name)==null?void 0:B.charAt(0))==null?void 0:s.toUpperCase())||"E"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-heading font-heading-semibold text-sm text-card-foreground",children:n==null?void 0:n.name}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:n==null?void 0:n.matricule})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`font-heading font-heading-bold text-lg ${j(p)}`,children:[p==null?void 0:p.toFixed(1),"/20"]}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Moyenne"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h6",{className:"font-caption font-caption-semibold text-xs text-muted-foreground",children:"Derni√®res notes:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(w=(u=n==null?void 0:n.recentGrades)==null?void 0:u.slice(0,3))==null?void 0:w.map((H,W)=>e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-caption font-caption-semibold ${S(H==null?void 0:H.grade)} ${j(H==null?void 0:H.grade)}`,children:[H==null?void 0:H.grade,"/20 (",H==null?void 0:H.type,")"]},W))})]}),(g==null?void 0:g.id)===(n==null?void 0:n.id)&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-border",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-body font-body-semibold text-muted-foreground",children:"Pr√©sences:"}),e.jsxs("p",{className:"font-body font-body-normal text-card-foreground",children:[(U=n==null?void 0:n.attendance)==null?void 0:U.present," pr√©sent, ",(K=n==null?void 0:n.attendance)==null?void 0:K.absent," absent"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-body font-body-semibold text-muted-foreground",children:"Retards:"}),e.jsxs("p",{className:"font-body font-body-normal text-card-foreground",children:[(xe=n==null?void 0:n.attendance)==null?void 0:xe.late," retard",((P=n==null?void 0:n.attendance)==null?void 0:P.late)>1?"s":""]})]})]}),e.jsx("button",{onClick:H=>{H==null||H.stopPropagation(),M({...a,student:n==null?void 0:n.id})},className:"mt-3 w-full bg-primary/10 text-primary hover:bg-primary/20 py-2 px-3 rounded-lg transition-colors",children:"Attribuer une note"})]})]},n==null?void 0:n.id)})}),(i==null?void 0:i.length)===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(d,{name:"Users",size:48,className:"text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"font-body font-body-normal text-muted-foreground",children:"Aucun √©l√®ve dans cette classe"})]})]})]})]})},Be=({classData:t,students:i=[]})=>{const N=(t==null?void 0:t.school_type)||"secondaire",g=Me(N),l=$e(N),A=l==="primaire"||l==="maternelle"?10:20,q=i.map(b=>{const r=b.recentGrades||[],y=r&&r.length>0?Pe(r.map(v=>({grade:v.grade,max_grade:v.max_grade||A,coefficient:v.coefficient||1})),{schoolType:N,targetScale:A}):0,j=Ue(y,N),S=He(y,null,N);return{...b,avg:y,mention:j.mention,code:j.code||j.grade||j.letter,honorMention:S}}),k=q.map(b=>b.avg),C=q.map(b=>{const r=Le(b.avg,k);return{...b,rank:r.rank,rankSuffix:r.suffix}}).sort((b,r)=>b.rank-r.rank),a=C.length>0?(C.reduce((b,r)=>b+r.avg,0)/C.length).toFixed(2):"0.00",M=C.length>0?Math.max(...C.map(b=>b.avg)):0,R=C.length>0?Math.min(...C.map(b=>b.avg)):0,_=C.filter(b=>b.avg>=A/2).length,$=C.length-_,o=b=>{if(!b)return"text-gray-500";const r=b.toLowerCase();return r.includes("tr√®s bien")||r.includes("excellent")?"text-green-600":r.includes("bien")||r.includes("very good")||r.includes("good")?"text-blue-600":r.includes("assez")||r.includes("credit")||r.includes("fair")?"text-yellow-600":r.includes("passable")||r.includes("pass")?"text-orange-500":"text-red-600"},h=b=>{if(!b)return null;const r={"F√©licitations du Conseil":"bg-yellow-400 text-yellow-900",Encouragements:"bg-blue-400 text-blue-900","Tableau d'Honneur":"bg-green-400 text-green-900","Avertissement Travail":"bg-red-400 text-red-900"};return e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded text-xs font-semibold ${r[b]||"bg-gray-200"}`,children:b})};return e.jsxs("div",{className:"bg-white rounded-2xl shadow p-6 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-bold text-xl",children:"Synth√®se des Notes"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t==null?void 0:t.name," ‚Äî ",t==null?void 0:t.subject,e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-indigo-100 text-indigo-700 rounded text-xs",children:[g==="anglophone"?"Syst√®me Anglophone":"Syst√®me Francophone"," ‚Ä¢ Sur ",A]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Moyenne de la classe"}),e.jsxs("div",{className:"font-heading font-bold text-2xl",children:[a,"/",A]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-surface rounded-lg border border-border",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"√âl√®ves"}),e.jsx("div",{className:"font-bold text-lg",children:C.length})]}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"text-sm text-green-700",children:["Admis (‚â•",A/2,")"]}),e.jsx("div",{className:"font-bold text-lg text-green-700",children:_})]}),e.jsxs("div",{className:"p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("div",{className:"text-sm text-red-700",children:"Non admis"}),e.jsx("div",{className:"font-bold text-lg text-red-700",children:$})]}),e.jsxs("div",{className:"p-4 bg-surface rounded-lg border border-border",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Meilleure"}),e.jsxs("div",{className:"font-bold text-lg",children:[M,"/",A]})]}),e.jsxs("div",{className:"p-4 bg-surface rounded-lg border border-border",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Plus basse"}),e.jsxs("div",{className:"font-bold text-lg",children:[R,"/",A]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading font-semibold mb-3",children:"Classement des √©l√®ves"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Rang"}),e.jsx("th",{className:"text-left py-2 px-3",children:"√âl√®ve"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Matricule"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Moyenne"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Mention"})]})}),e.jsx("tbody",{children:C.map(b=>e.jsxs("tr",{className:"border-b border-border hover:bg-gray-50",children:[e.jsxs("td",{className:"py-2 px-3 font-semibold",children:[b.rank,e.jsx("sup",{children:b.rankSuffix})]}),e.jsxs("td",{className:"py-2 px-3",children:[e.jsx("span",{className:"font-medium",children:b.name}),h(b.honorMention)]}),e.jsx("td",{className:"py-2 px-3 text-muted-foreground",children:b.matricule}),e.jsxs("td",{className:"py-2 px-3 text-right font-bold",children:[b.avg,"/",A]}),e.jsxs("td",{className:`py-2 px-3 font-semibold ${o(b.mention)}`,children:[g==="anglophone"&&b.code?`${b.code} ‚Äî `:"",b.mention]})]},b.id))})]})})]})]})},Oe=({classData:t,students:i=[],onConductSaved:N})=>{const[g,l]=E.useState({}),[A,q]=E.useState("1"),[k,C]=E.useState(!1),[a,M]=E.useState(!1),R=[{id:"assiduity",label:"Assiduit√©",icon:"üìÖ",max:20},{id:"punctuality",label:"Ponctualit√©",icon:"‚è∞",max:20},{id:"discipline",label:"Discipline",icon:"üìã",max:20},{id:"respect",label:"Respect",icon:"ü§ù",max:20},{id:"participation",label:"Participation",icon:"‚úã",max:20},{id:"presentation",label:"Tenue/Pr√©sentation",icon:"üëî",max:20}],_=[{value:"excellent",label:"Excellent",color:"bg-green-500"},{value:"tres_bien",label:"Tr√®s bien",color:"bg-blue-500"},{value:"bien",label:"Bien",color:"bg-cyan-500"},{value:"assez_bien",label:"Assez bien",color:"bg-yellow-500"},{value:"passable",label:"Passable",color:"bg-orange-500"},{value:"insuffisant",label:"Insuffisant",color:"bg-red-500"}];E.useEffect(()=>{(async()=>{if(t!=null&&t.class_id){M(!0);try{const{data:y,error:j}=await J.from("student_conduct").select("*").eq("class_id",t.class_id).eq("sequence",parseInt(A));if(j){console.warn("Erreur chargement conduite:",j);return}const S={};(y||[]).forEach(v=>{S[v.student_id]={id:v.id,assiduity:v.assiduity||0,punctuality:v.punctuality||0,discipline:v.discipline||0,respect:v.respect||0,participation:v.participation||0,presentation:v.presentation||0,appreciation:v.appreciation||"",comment:v.comment||""}}),l(S)}catch(y){console.error("Erreur:",y)}finally{M(!1)}}})()},[t,A]);const $=(r,y,j)=>{l(S=>({...S,[r]:{...S[r]||{},[y]:j}}))},o=r=>{const y=g[r];return y?(R.map(v=>y[v.id]||0).reduce((v,G)=>v+G,0)/R.length).toFixed(2):0},h=r=>{const y=parseFloat(r);return y>=18?{label:"Excellent",color:"text-green-600"}:y>=16?{label:"Tr√®s bien",color:"text-blue-600"}:y>=14?{label:"Bien",color:"text-cyan-600"}:y>=12?{label:"Assez bien",color:"text-yellow-600"}:y>=10?{label:"Passable",color:"text-orange-500"}:{label:"Insuffisant",color:"text-red-600"}},b=async()=>{C(!0);try{const r=Object.entries(g).map(([j,S])=>({id:S.id||void 0,student_id:j,class_id:t.class_id,school_id:t.school_id,sequence:parseInt(A),trimester:Math.ceil(parseInt(A)/2),assiduity:S.assiduity||0,punctuality:S.punctuality||0,discipline:S.discipline||0,respect:S.respect||0,participation:S.participation||0,presentation:S.presentation||0,average:parseFloat(o(j)),appreciation:S.appreciation||null,comment:S.comment||null})),{error:y}=await J.from("student_conduct").upsert(r,{onConflict:["student_id","class_id","sequence"]});if(y)throw y;alert("Notes de conduite enregistr√©es avec succ√®s!"),N&&N()}catch(r){console.error("Erreur sauvegarde conduite:",r),alert("Erreur lors de l'enregistrement")}finally{C(!1)}};return e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-bold text-xl flex items-center gap-2",children:"üìã Notes de Vie Scolaire"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t==null?void 0:t.name," ‚Äî √âvaluation du comportement"]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("select",{value:A,onChange:r=>q(r.target.value),className:"px-4 py-2 border border-border rounded-lg bg-background",children:[1,2,3,4,5,6].map(r=>e.jsxs("option",{value:r,children:["S√©quence ",r]},r))})})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-6 p-4 bg-gray-50 rounded-lg",children:R.map(r=>e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-2xl",children:r.icon}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.label})]},r.id))}),a?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(d,{name:"Loader2",className:"animate-spin mx-auto mb-2",size:32}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4 max-h-[500px] overflow-y-auto",children:i.map(r=>{var S,v,G;const y=o(r.id),j=h(y);return e.jsxs("div",{className:"border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center font-bold",children:((S=r.name)==null?void 0:S.charAt(0))||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:r.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.matricule})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-lg",children:[y,"/20"]}),e.jsx("p",{className:`text-xs font-semibold ${j.color}`,children:j.label})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-2 mb-3",children:R.map(x=>{var z;return e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-muted-foreground",children:[x.icon," ",x.label]}),e.jsx("input",{type:"number",min:"0",max:x.max,step:"0.5",value:((z=g[r.id])==null?void 0:z[x.id])||"",onChange:m=>$(r.id,x.id,parseFloat(m.target.value)||0),className:"w-full px-2 py-1 border border-border rounded text-center text-sm",placeholder:"0"})]},x.id)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Appr√©ciation"}),e.jsxs("select",{value:((v=g[r.id])==null?void 0:v.appreciation)||"",onChange:x=>$(r.id,"appreciation",x.target.value),className:"w-full px-3 py-1.5 border border-border rounded text-sm",children:[e.jsx("option",{value:"",children:"-- S√©lectionner --"}),_.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Observation"}),e.jsx("input",{type:"text",value:((G=g[r.id])==null?void 0:G.comment)||"",onChange:x=>$(r.id,"comment",x.target.value),className:"w-full px-3 py-1.5 border border-border rounded text-sm",placeholder:"Observation du prof principal..."})]})]})]},r.id)})}),i.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(d,{name:"Users",size:48,className:"text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucun √©l√®ve dans cette classe"})]}),e.jsx("div",{className:"mt-6 pt-4 border-t border-border flex justify-end",children:e.jsxs("button",{onClick:b,disabled:k,className:"px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 disabled:opacity-50 flex items-center gap-2",children:[k?e.jsx(d,{name:"Loader2",className:"animate-spin",size:16}):e.jsx(d,{name:"Save",size:16}),"Enregistrer les notes de conduite"]})})]})]})},Ce=({classData:t,documents:i})=>{const[N,g]=E.useState(!1),[l,A]=E.useState({title:"",type:"",visibility:"students",description:""}),[q,k]=E.useState(!1),C=[{value:"course",label:"Cours",icon:"BookOpen",color:"text-primary"},{value:"exercise",label:"Exercices",icon:"Edit",color:"text-success"},{value:"correction",label:"Corrig√©",icon:"CheckCircle",color:"text-warning"},{value:"evaluation",label:"√âvaluation",icon:"FileText",color:"text-error"},{value:"resource",label:"Ressource",icon:"Folder",color:"text-accent-foreground"}],a=[{value:"private",label:"Priv√© (moi seul)",icon:"Lock",description:"Visible uniquement par vous"},{value:"students",label:"√âl√®ves seulement",icon:"UserCheck",description:"Visible par les √©l√®ves de la classe"},{value:"students_parents",label:"√âl√®ves et Parents",icon:"Users",description:"Visible par les √©l√®ves ET leurs parents"}],M=s=>{const u=C==null?void 0:C.find(w=>(w==null?void 0:w.value)===s||(w==null?void 0:w.value)===(s==null?void 0:s.toLowerCase()));return u||{value:"resource",label:"Document",icon:"File",color:"text-muted-foreground"}},R=s=>{var w,U;switch((U=(w=s==null?void 0:s.split("."))==null?void 0:w.pop())==null?void 0:U.toLowerCase()){case"pdf":return e.jsx(d,{name:"File",size:16,className:"text-error"});case"doc":case"docx":return e.jsx(d,{name:"FileText",size:16,className:"text-primary"});case"ppt":case"pptx":return e.jsx(d,{name:"Presentation",size:16,className:"text-warning"});case"jpg":case"jpeg":case"png":return e.jsx(d,{name:"Image",size:16,className:"text-success"});default:return e.jsx(d,{name:"File",size:16,className:"text-muted-foreground"})}},_=s=>(s==null?void 0:s.file_size)??(s==null?void 0:s.fileSize)??null,$=s=>{if(!s||isNaN(s))return"Non renseign√©";const u=Number(s);return u<1024?`${u} o`:u<1024*1024?`${(u/1024).toFixed(0)} KB`:`${(u/(1024*1024)).toFixed(1)} MB`},o=s=>(s==null?void 0:s.created_at)??(s==null?void 0:s.upload_date)??(s==null?void 0:s.uploadDate)??null,h=s=>{if(!s)return"Non renseign√©";const u=new Date(s);return isNaN(u.getTime())?"Non renseign√©":u.toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})},b=s=>{s==null||s.preventDefault(),k(!0)},r=s=>{s==null||s.preventDefault(),k(!1)},y=s=>{var w;s==null||s.preventDefault(),k(!1);const u=Array.from(((w=s==null?void 0:s.dataTransfer)==null?void 0:w.files)||[]);u.length>0&&S(u[0])},[j,S]=E.useState(null),[v,G]=E.useState(!1),[x,z]=E.useState(null),m=E.useRef(null),c=s=>{var w,U;const u=(U=(w=s==null?void 0:s.target)==null?void 0:w.files)==null?void 0:U[0];console.log("handleFileChange called, file:",u),u&&S(u)},f=async s=>{if(s==null||s.preventDefault(),!j)return alert("Veuillez s√©lectionner un fichier √† t√©l√©charger.");if(!(l!=null&&l.title)||!(l!=null&&l.type))return alert("Veuillez renseigner le titre et le type du document.");G(!0);try{const u={title:l==null?void 0:l.title,description:l==null?void 0:l.description,document_type:l==null?void 0:l.type,class_name:(t==null?void 0:t.name)||(t==null?void 0:t.id),class_id:t==null?void 0:t.id,visibility:l==null?void 0:l.visibility,subject:(l==null?void 0:l.type)||(t==null?void 0:t.name)},{data:w,error:U}=await ye.uploadTeacherDocument(u,j);if(U){console.error("Upload error:",U);const K=typeof U=="string"?U:(U==null?void 0:U.message)||"erreur inconnue";z(K),alert("Erreur lors du t√©l√©chargement : "+K)}else z(null),alert("Document t√©l√©charg√© avec succ√®s!"),window.location.reload()}catch(u){console.error(u),alert("Erreur inattendue lors du t√©l√©chargement.")}finally{G(!1),A({title:"",type:"",visibility:"students",description:""}),S(null),g(!1)}},n=async s=>{if(!s){alert("ID du document manquant");return}if(window.confirm("√ätes-vous s√ªr de vouloir supprimer ce document ?")){console.log("üóëÔ∏è Suppression document:",s);try{const{data:u,error:w}=await ye.deleteDocument(s);console.log("üóëÔ∏è R√©sultat suppression:",{data:u,error:w}),w?alert("Erreur lors de la suppression : "+w):(alert("Document supprim√© !"),window.location.reload())}catch(u){console.error("‚ùå Exception suppression:",u),alert("Erreur inattendue lors de la suppression: "+u.message)}}},p=async s=>{if(!s){alert("ID du document manquant");return}console.log("üì• T√©l√©chargement document:",s);try{const{data:u,error:w}=await ye.downloadDocument(s,"download");if(console.log("üì• R√©sultat t√©l√©chargement:",{data:u,error:w}),w||!(u!=null&&u.url)){alert("Erreur lors du t√©l√©chargement : "+(w||"URL manquante"));return}const U=document.createElement("a");U.href=u.url,U.download=u.fileName||"document",U.target="_blank",document.body.appendChild(U),U.click(),document.body.removeChild(U)}catch(u){console.error("‚ùå Exception t√©l√©chargement:",u),alert("Erreur inattendue lors du t√©l√©chargement: "+u.message)}},B=async s=>{if(!s){alert("ID du document manquant");return}console.log("üëÅÔ∏è Visualisation document:",s);try{const{data:u,error:w}=await ye.downloadDocument(s,"view");if(console.log("üëÅÔ∏è R√©sultat visualisation:",{data:u,error:w}),w||!(u!=null&&u.url)){alert("Erreur lors de l'ouverture : "+(w||"URL manquante"));return}window.open(u.url,"_blank","noopener,noreferrer")}catch(u){console.error("‚ùå Exception visualisation:",u),alert("Erreur inattendue lors de l'ouverture: "+u.message)}};return e.jsxs("div",{className:"bg-card rounded-lg shadow-card border border-border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-heading font-heading-semibold text-xl text-card-foreground",children:["Documents - ",t==null?void 0:t.name]}),e.jsxs("button",{onClick:()=>g(!N),className:"px-4 py-2 bg-primary text-white hover:bg-primary/90 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(d,{name:"Upload",size:16}),e.jsx("span",{className:"font-caption font-caption-semibold text-sm",children:"T√©l√©charger"})]})]}),x&&e.jsxs("div",{className:"mt-4 p-3 border rounded-lg bg-error/5 border-error text-error",children:[e.jsxs("div",{className:"font-body font-body-semibold",children:["Erreur de stockage : ",x]}),e.jsxs("div",{className:"text-sm mt-1",children:["V√©rifiez que le bucket nomm√© ",e.jsx("strong",{children:"documents"})," existe dans votre projet Supabase (Dashboard ‚Üí Storage ‚Üí Buckets)."]}),e.jsxs("div",{className:"text-sm mt-1",children:["Si le bucket porte un autre nom, mettez √† jour la variable dans ",e.jsx("strong",{children:"src/services/documentService.js"})," (ligne d'appel √† ",e.jsx("code",{children:"supabase.storage.from('documents')"}),")."]}),e.jsxs("div",{className:"text-sm mt-1",children:["Documentation Supabase Storage: ",e.jsx("a",{className:"underline",href:"https://supabase.com/docs/guides/storage",target:"_blank",rel:"noreferrer",children:"https://supabase.com/docs/guides/storage"})]})]}),N&&e.jsx("div",{className:"mb-6 p-4 bg-primary/5 border border-primary/20 rounded-lg",children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Titre du document *"}),e.jsx("input",{type:"text",value:l==null?void 0:l.title,onChange:s=>{var u;return A({...l,title:(u=s==null?void 0:s.target)==null?void 0:u.value})},className:"w-full px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background",placeholder:"Chapitre 3 - Trigonom√©trie",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Type de document *"}),e.jsxs("select",{value:l==null?void 0:l.type,onChange:s=>{var u;return A({...l,type:(u=s==null?void 0:s.target)==null?void 0:u.value})},className:"w-full px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background",required:!0,children:[e.jsx("option",{value:"",children:"Choisir le type"}),C==null?void 0:C.map(s=>e.jsx("option",{value:s==null?void 0:s.value,children:s==null?void 0:s.label},s==null?void 0:s.value))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Visibilit√©"}),e.jsx("div",{className:"space-y-2",children:a==null?void 0:a.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-border rounded-lg cursor-pointer hover:bg-muted/20",children:[e.jsx("input",{type:"radio",name:"visibility",value:s==null?void 0:s.value,checked:(l==null?void 0:l.visibility)===(s==null?void 0:s.value),onChange:u=>{var w;return A({...l,visibility:(w=u==null?void 0:u.target)==null?void 0:w.value})},className:"text-primary focus:ring-primary"}),e.jsx(d,{name:s==null?void 0:s.icon,size:16,className:"text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-body font-body-semibold text-sm text-card-foreground",children:s==null?void 0:s.label}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:s==null?void 0:s.description})]})]},s==null?void 0:s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Description"}),e.jsx("textarea",{value:l==null?void 0:l.description,onChange:s=>{var u;return A({...l,description:(u=s==null?void 0:s.target)==null?void 0:u.value})},className:"w-full px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background h-20 resize-none",placeholder:"Description du contenu du document..."})]}),e.jsxs("div",{onDragOver:b,onDragLeave:r,onDrop:y,onClick:()=>{var s;console.log("Drop zone clicked - opening file picker"),(s=m.current)==null||s.click()},tabIndex:0,onKeyDown:s=>{var u;(s.key==="Enter"||s.key===" ")&&((u=m.current)==null||u.click())},role:"button","aria-label":"Zone de d√©p√¥t ou ouvrir le s√©lecteur de fichiers",className:`border-2 border-dashed rounded-lg p-6 text-center transition-all ${q?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:[e.jsx(d,{name:"Upload",size:32,className:"text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-muted-foreground mb-2",children:"Glissez-d√©posez votre fichier ici ou"}),e.jsxs("label",{className:"inline-block px-4 py-2 bg-primary/10 text-primary hover:bg-primary/20 rounded-lg cursor-pointer transition-colors",onClick:()=>{var s;return(s=m.current)==null?void 0:s.click()},children:[e.jsx("input",{ref:m,type:"file",style:{display:"none"},accept:".pdf,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png",onChange:c}),"Parcourir les fichiers"]}),j?e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:["Fichier s√©lectionn√©: ",j==null?void 0:j.name," ‚Äî ",((j==null?void 0:j.size)/1024).toFixed(0)," KB"]}):e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Aucun fichier s√©lectionn√©"}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground mt-2",children:"PDF, Word, PowerPoint, Images (max 10MB)"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"submit",disabled:!j||v,className:`flex-1 bg-primary text-white font-body font-body-semibold py-2 px-4 rounded-lg hover:bg-primary/90 transition-colors ${!j||v?"opacity-50 cursor-not-allowed":""}`,children:v?"T√©l√©chargement...":"T√©l√©charger le Document"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"px-4 py-2 border border-border text-muted-foreground hover:bg-muted/20 rounded-lg transition-colors",children:"Annuler"})]})]})}),e.jsxs("div",{className:"space-y-3",children:[i==null?void 0:i.map(s=>{var w,U;const u=M((s==null?void 0:s.type)||(s==null?void 0:s.document_type));return e.jsx("div",{className:"border border-border rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(d,{name:u==null?void 0:u.icon,size:20,className:u==null?void 0:u.color})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-lg text-card-foreground truncate",children:s==null?void 0:s.title}),e.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[e.jsx("button",{onClick:()=>p(s==null?void 0:s.id),className:"p-2 text-primary hover:bg-primary/10 rounded-lg transition-colors",title:"T√©l√©charger",children:e.jsx(d,{name:"Download",size:16})}),e.jsx("button",{onClick:()=>B(s==null?void 0:s.id),className:"p-2 text-accent hover:bg-accent/10 rounded-lg transition-colors",title:"Visualiser",children:e.jsx(d,{name:"Eye",size:16})}),e.jsx("button",{onClick:()=>n(s==null?void 0:s.id),className:"p-2 text-error hover:bg-error/10 rounded-lg transition-colors",title:"Supprimer",children:e.jsx(d,{name:"Trash2",size:16})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-caption font-caption-semibold bg-primary/10 ${u==null?void 0:u.color}`,children:u==null?void 0:u.label}),e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-caption font-caption-semibold flex items-center gap-1 ${(s==null?void 0:s.visibility)==="school"||s!=null&&s.is_public?"bg-success/10 text-success":(s==null?void 0:s.visibility)==="private"?"bg-warning/10 text-warning":"bg-primary/10 text-primary"}`,children:[e.jsx(d,{name:(s==null?void 0:s.visibility)==="private"?"Lock":s!=null&&s.is_public?"Users":"UserCheck",size:12}),(s==null?void 0:s.visibility)==="school"||s!=null&&s.is_public?"√âl√®ves + Parents":(s==null?void 0:s.visibility)==="private"?"Priv√© (vous seul)":"√âl√®ves seulement"]}),((w=s==null?void 0:s.uploader)==null?void 0:w.full_name)&&e.jsxs("span",{className:"px-2 py-1 rounded text-xs font-caption font-caption-normal bg-muted/20 text-muted-foreground flex items-center gap-1",children:[e.jsx(d,{name:"User",size:12}),"Par ",(U=s==null?void 0:s.uploader)==null?void 0:U.full_name]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("div",{className:"flex items-center gap-4 text-muted-foreground",children:e.jsxs("span",{className:"flex items-center gap-1",children:[R((s==null?void 0:s.file_name)||(s==null?void 0:s.title)),$(_(s))]})}),e.jsx("span",{className:"font-caption font-caption-normal text-muted-foreground",children:h(o(s))})]})]})]})},s==null?void 0:s.id)}),(i==null?void 0:i.length)===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(d,{name:"FileText",size:48,className:"text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"font-body font-body-normal text-muted-foreground mb-2",children:"Aucun document t√©l√©charg√© pour cette classe"}),e.jsx("p",{className:"font-caption font-caption-normal text-sm text-muted-foreground",children:'Cliquez sur "T√©l√©charger" pour ajouter vos premiers documents'})]})]}),e.jsxs("div",{className:"mt-6 p-3 bg-muted/10 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(d,{name:"HardDrive",size:14,className:"text-primary"}),e.jsx("span",{className:"font-caption font-caption-semibold text-sm text-primary",children:"Espace de stockage"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-caption font-caption-normal text-muted-foreground",children:`${((i==null?void 0:i.reduce((u,w)=>u+(parseFloat((w==null?void 0:w.file_size)??(w==null?void 0:w.fileSize)??0)||0),0))/(1024*1024)).toFixed(1)} MB utilis√©s sur 500 MB`}),e.jsxs("span",{className:"font-caption font-caption-normal text-muted-foreground",children:[i==null?void 0:i.length," document",(i==null?void 0:i.length)>1?"s":""]})]})]})]})},ze=({classData:t,students:i})=>{var G,x,z;const[N,g]=E.useState((z=(x=(G=new Date)==null?void 0:G.toISOString())==null?void 0:x.split("T"))==null?void 0:z[0]),[l,A]=E.useState({}),[q,k]=E.useState(!1),[C,a]=E.useState(!1),[M,R]=E.useState(!1),_=[{value:"present",label:"Pr√©sent(e)",icon:"Check",color:"text-success",bg:"bg-success"},{value:"absent",label:"Absent(e)",icon:"X",color:"text-error",bg:"bg-error"},{value:"late",label:"En retard",icon:"Clock",color:"text-warning",bg:"bg-warning"},{value:"excused",label:"Excus√©(e)",icon:"FileText",color:"text-primary",bg:"bg-primary"}],$=(m,c)=>{A(f=>{var n;return{...f,[N]:{...f==null?void 0:f[N],[m]:{...((n=f==null?void 0:f[N])==null?void 0:n[m])||{},status:c}}}})},o=m=>{var c,f;return((f=(c=l==null?void 0:l[N])==null?void 0:c[m])==null?void 0:f.status)||"present"},h=m=>(_==null?void 0:_.find(c=>(c==null?void 0:c.value)===m))||(_==null?void 0:_[0]),b=()=>{const m=(l==null?void 0:l[N])||{},c=Object.keys(m).map(f=>{const n=m[f];return{id:(n==null?void 0:n.id)||void 0,student_id:f,class_id:(t==null?void 0:t.class_id)||(t==null?void 0:t.id),school_id:t==null?void 0:t.school_id,teacher_id:t==null?void 0:t.teacher_id,date:N,status:n.status,justification:n.justification||null}});if(c.length===0){alert("Aucune modification √† enregistrer");return}R(!0),(async()=>{try{const{data:f,error:n}=await J.from("attendances").upsert(c,{onConflict:["student_id","date","class_id"]}).select();if(n)throw n;const p={...l||{}};p[N]=p[N]||{},(f||[]).forEach(B=>{p[N][String(B.student_id)]={id:B.id,status:B.status,justification:B.justification}}),A(p),alert("Pr√©sences enregistr√©es avec succ√®s!")}catch(f){console.error("Erreur enregistrement pr√©sences:",f),alert("Erreur lors de l'enregistrement des pr√©sences.")}finally{R(!1)}})()},r=()=>{const m={};i==null||i.forEach(c=>{m[c==null?void 0:c.id]="present"}),A(c=>({...c,[N]:m}))},j=(()=>{var f,n;const m=(l==null?void 0:l[N])||{},c={present:0,absent:0,late:0,excused:0,total:(i==null?void 0:i.length)||0};return(f=Object.values(m))==null||f.forEach(p=>{const B=(p==null?void 0:p.status)||"present";c[B]=((c==null?void 0:c[B])||0)+1}),((n=Object.keys(m))==null?void 0:n.length)===0&&(c.present=c==null?void 0:c.total),c})();E.useEffect(()=>{if(!t||!t.class_id)return;(async()=>{a(!0);try{const{data:c,error:f}=await J.from("attendances").select("id, student_id, status, justification, date").eq("class_id",t.class_id).eq("date",N);if(f){console.warn("Erreur chargement pr√©sences:",f),a(!1);return}const n={};(c||[]).forEach(p=>{n[String(p.student_id)]={id:p.id,status:p.status,justification:p.justification}}),A(p=>({...p,[N]:n}))}catch(c){console.error("Erreur chargement pr√©sences:",c)}finally{a(!1)}})()},[t,N]);const S=m=>{var c;return(c=new Date(m))==null?void 0:c.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})},v=()=>(j==null?void 0:j.total)===0?0:(((j==null?void 0:j.present)+(j==null?void 0:j.excused))/(j==null?void 0:j.total)*100).toFixed(1);return e.jsxs("div",{className:"bg-card rounded-lg shadow-card border border-border p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("h3",{className:"font-heading font-heading-semibold text-xl text-card-foreground",children:["Gestion des Pr√©sences - ",t==null?void 0:t.name]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"date",value:N,onChange:m=>{var c;return g((c=m==null?void 0:m.target)==null?void 0:c.value)},className:"px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background"}),e.jsxs("button",{onClick:()=>k(!q),className:"px-4 py-2 bg-primary/10 text-primary hover:bg-primary/20 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(d,{name:"Zap",size:16}),e.jsx("span",{className:"font-caption font-caption-semibold text-sm",children:"Saisie rapide"})]})]})]}),e.jsx("div",{className:"mb-6 p-4 bg-primary/5 border border-primary/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:S(N)}),e.jsxs("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:["Cours de ",t==null?void 0:t.subject," ‚Ä¢ ",j==null?void 0:j.total," √©l√®ves"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-heading font-heading-bold text-2xl text-success",children:[v(),"%"]}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Taux de pr√©sence"})]})]})}),q&&e.jsx("div",{className:"mb-6 p-4 bg-success/5 border border-success/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-lg text-card-foreground mb-2",children:"Saisie rapide des pr√©sences"}),e.jsx("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:"Marquer tous les √©l√®ves pr√©sents, puis ajuster individuellement si n√©cessaire"})]}),e.jsxs("button",{onClick:r,className:"px-4 py-2 bg-success text-white hover:bg-success/90 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(d,{name:"CheckCircle",size:16}),"Tous pr√©sents"]})]})}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:_==null?void 0:_.map(m=>e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-border text-center",children:[e.jsx(d,{name:m==null?void 0:m.icon,size:20,className:`mx-auto mb-2 ${m==null?void 0:m.color}`}),e.jsx("div",{className:`font-heading font-heading-bold text-xl ${m==null?void 0:m.color}`,children:(j==null?void 0:j[m==null?void 0:m.value])||0}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:m==null?void 0:m.label})]},m==null?void 0:m.value))}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto mb-6",children:i==null?void 0:i.map(m=>{const c=o(m==null?void 0:m.id);return h(c),e.jsxs("div",{className:"border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:m==null?void 0:m.photo,alt:m==null?void 0:m.name,className:"w-12 h-12 rounded-full object-cover border-2 border-border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:m==null?void 0:m.name}),e.jsx("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:m==null?void 0:m.matricule})]}),e.jsx("div",{className:"flex items-center gap-2",children:_==null?void 0:_.map(f=>e.jsx("button",{onClick:()=>$(m==null?void 0:m.id,f==null?void 0:f.value),className:`p-2 rounded-lg transition-all ${c===(f==null?void 0:f.value)?`${f==null?void 0:f.bg} text-white shadow-md`:`${f==null?void 0:f.color} hover:bg-${f==null?void 0:f.value}/10 border border-border`}`,title:f==null?void 0:f.label,children:e.jsx(d,{name:f==null?void 0:f.icon,size:16})},f==null?void 0:f.value))})]}),(c==="absent"||c==="excused")&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border",children:e.jsx("input",{type:"text",placeholder:c==="absent"?"Raison de l'absence (optionnel)":"Justification",className:"w-full px-3 py-2 text-sm border border-border rounded focus:outline-none focus:ring-1 focus:ring-primary/50"})})]},m==null?void 0:m.id)})}),(i==null?void 0:i.length)===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(d,{name:"Users",size:48,className:"text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"font-body font-body-normal text-muted-foreground",children:"Aucun √©l√®ve dans cette classe"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx(d,{name:"Info",size:14,className:"inline mr-1"}),"Les pr√©sences sont automatiquement notifi√©es aux parents par SMS"]}),e.jsxs("button",{onClick:b,className:"px-6 py-3 bg-primary text-white font-body font-body-semibold rounded-lg hover:bg-primary/90 transition-colors flex items-center gap-2",children:[e.jsx(d,{name:"Save",size:16}),"Enregistrer les Pr√©sences"]})]})]})},Re=({classData:t,students:i})=>{const[N,g]=E.useState([]),[l,A]=E.useState({type:"note",title:"",message:"",priority:"medium"}),[q,k]=E.useState(!1),C=[{value:"note",label:"Nouvelle note",icon:"BookOpen",color:"text-success"},{value:"absence",label:"Absence",icon:"Calendar",color:"text-error"},{value:"behavior",label:"Comportement",icon:"User",color:"text-warning"},{value:"reminder",label:"Rappel",icon:"Bell",color:"text-primary"},{value:"general",label:"Information g√©n√©rale",icon:"MessageSquare",color:"text-accent-foreground"}],a=[{value:"low",label:"Faible",color:"text-success"},{value:"medium",label:"Moyenne",color:"text-warning"},{value:"high",label:"Haute",color:"text-error"}],M=o=>{g(h=>h!=null&&h.includes(o)?h==null?void 0:h.filter(b=>b!==o):[...h,o])},R=()=>{(N==null?void 0:N.length)===(i==null?void 0:i.length)?g([]):g((i==null?void 0:i.map(o=>o==null?void 0:o.id))||[])},_=o=>{if(o==null||o.preventDefault(),(N==null?void 0:N.length)===0){alert("Veuillez s√©lectionner au moins un destinataire");return}console.log("Sending message:",{recipients:N,message:l,class:t==null?void 0:t.name}),A({type:"note",title:"",message:"",priority:"medium"}),g([]),k(!1),alert(`Message envoy√© √† ${N==null?void 0:N.length} parent(s) !`)},$=(o,h)=>{const b={good_behavior:{title:"Comportement exemplaire",message:`${h==null?void 0:h.name} a fait preuve d'un comportement exemplaire aujourd'hui en cours de ${t==null?void 0:t.subject}.`},homework_missing:{title:"Devoir manquant",message:`${h==null?void 0:h.name} n'a pas rendu le devoir de ${t==null?void 0:t.subject} qui √©tait attendu aujourd'hui.`},excellent_work:{title:"Excellent travail",message:`${h==null?void 0:h.name} a fourni un excellent travail en ${t==null?void 0:t.subject}. F√©licitations !`}},r=b==null?void 0:b[o];console.log("Sending quick notification:",{recipient:h==null?void 0:h.id,...r,class:t==null?void 0:t.name}),alert(`Message "${r==null?void 0:r.title}" envoy√© au parent de ${h==null?void 0:h.name} !`)};return e.jsxs("div",{className:"bg-card rounded-lg shadow-card border border-border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-xl text-card-foreground",children:"Communication Parentale"}),e.jsxs("button",{onClick:()=>k(!q),className:"px-4 py-2 bg-primary text-white hover:bg-primary/90 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(d,{name:"MessageSquare",size:16}),e.jsx("span",{className:"font-caption font-caption-semibold text-sm",children:"Nouveau message"})]})]}),q&&e.jsx("div",{className:"mb-6 p-4 bg-primary/5 border border-primary/20 rounded-lg",children:e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Type de message *"}),e.jsx("select",{value:l==null?void 0:l.type,onChange:o=>{var h;return A({...l,type:(h=o==null?void 0:o.target)==null?void 0:h.value})},className:"w-full px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background",required:!0,children:C==null?void 0:C.map(o=>e.jsx("option",{value:o==null?void 0:o.value,children:o==null?void 0:o.label},o==null?void 0:o.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Priorit√©"}),e.jsx("select",{value:l==null?void 0:l.priority,onChange:o=>{var h;return A({...l,priority:(h=o==null?void 0:o.target)==null?void 0:h.value})},className:"w-full px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background",children:a==null?void 0:a.map(o=>e.jsx("option",{value:o==null?void 0:o.value,children:o==null?void 0:o.label},o==null?void 0:o.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Objet *"}),e.jsx("input",{type:"text",value:l==null?void 0:l.title,onChange:o=>{var h;return A({...l,title:(h=o==null?void 0:o.target)==null?void 0:h.value})},className:"w-full px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background",placeholder:"Objet du message...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-body font-body-semibold text-sm text-card-foreground mb-2",children:"Message *"}),e.jsx("textarea",{value:l==null?void 0:l.message,onChange:o=>{var h;return A({...l,message:(h=o==null?void 0:o.target)==null?void 0:h.value})},className:"w-full px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 bg-background h-24 resize-none",placeholder:"Votre message aux parents...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"font-body font-body-semibold text-sm text-card-foreground",children:["Destinataires * (",N==null?void 0:N.length," s√©lectionn√©",(N==null?void 0:N.length)>1?"s":"",")"]}),e.jsx("button",{type:"button",onClick:R,className:"px-3 py-1 text-sm bg-primary/10 text-primary hover:bg-primary/20 rounded transition-colors",children:(N==null?void 0:N.length)===(i==null?void 0:i.length)?"D√©s√©lectionner tout":"S√©lectionner tout"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto border border-border rounded-lg",children:i==null?void 0:i.map(o=>e.jsxs("label",{className:"flex items-center gap-3 p-3 hover:bg-muted/20 cursor-pointer border-b border-border last:border-b-0",children:[e.jsx("input",{type:"checkbox",checked:N==null?void 0:N.includes(o==null?void 0:o.id),onChange:()=>M(o==null?void 0:o.id),className:"text-primary focus:ring-primary"}),e.jsx("img",{src:o==null?void 0:o.photo,alt:o==null?void 0:o.name,className:"w-8 h-8 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-body font-body-semibold text-sm text-card-foreground",children:o==null?void 0:o.name}),e.jsx("div",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:o==null?void 0:o.matricule})]})]},o==null?void 0:o.id))})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"submit",className:"flex-1 bg-primary text-white font-body font-body-semibold py-3 px-4 rounded-lg hover:bg-primary/90 transition-colors flex items-center justify-center gap-2",children:[e.jsx(d,{name:"Send",size:16}),"Envoyer le Message"]}),e.jsx("button",{type:"button",onClick:()=>k(!1),className:"px-4 py-3 border border-border text-muted-foreground hover:bg-muted/20 rounded-lg transition-colors",children:"Annuler"})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:"Actions Rapides par √âl√®ve"}),i==null?void 0:i.map(o=>{var h,b,r;return e.jsxs("div",{className:"border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("img",{src:o==null?void 0:o.photo,alt:o==null?void 0:o.name,className:"w-12 h-12 rounded-full object-cover border-2 border-border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:o==null?void 0:o.name}),e.jsx("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:o==null?void 0:o.matricule})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"font-heading font-heading-bold text-success",children:[((b=(h=o==null?void 0:o.recentGrades)==null?void 0:h[0])==null?void 0:b.grade)||0,"/20"]}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Derni√®re note"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-heading font-heading-bold text-primary",children:((r=o==null?void 0:o.attendance)==null?void 0:r.present)||0}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Pr√©sences"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>$("good_behavior",o),className:"px-3 py-2 bg-success/10 text-success hover:bg-success/20 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(d,{name:"ThumbsUp",size:14}),e.jsx("span",{className:"font-caption font-caption-semibold text-xs",children:"F√©liciter"})]}),e.jsxs("button",{onClick:()=>$("homework_missing",o),className:"px-3 py-2 bg-warning/10 text-warning hover:bg-warning/20 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(d,{name:"AlertCircle",size:14}),e.jsx("span",{className:"font-caption font-caption-semibold text-xs",children:"Devoir manquant"})]}),e.jsxs("button",{onClick:()=>$("excellent_work",o),className:"px-3 py-2 bg-primary/10 text-primary hover:bg-primary/20 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(d,{name:"Award",size:14}),e.jsx("span",{className:"font-caption font-caption-semibold text-xs",children:"Excellent travail"})]}),e.jsxs("button",{onClick:()=>{g([o==null?void 0:o.id]),k(!0)},className:"px-3 py-2 bg-accent/10 text-accent-foreground hover:bg-accent/20 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(d,{name:"MessageSquare",size:14}),e.jsx("span",{className:"font-caption font-caption-semibold text-xs",children:"Message perso"})]})]})]},o==null?void 0:o.id)}),(i==null?void 0:i.length)===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(d,{name:"Users",size:48,className:"text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"font-body font-body-normal text-muted-foreground",children:"Aucun √©l√®ve dans cette classe"})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-accent/5 border border-accent/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(d,{name:"MessageSquare",size:16,className:"text-accent-foreground mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-body font-body-semibold text-accent-foreground mb-1",children:"Notifications SMS automatiques"}),e.jsx("p",{className:"font-body font-body-normal text-muted-foreground",children:"Tous les messages envoy√©s via cette interface sont √©galement transmis aux parents par SMS. Les accus√©s de r√©ception sont track√©s."})]})]})})]})},Ge=({schedule:t,teacherName:i})=>{var h,b,r,y,j,S,v,G;const N=x=>{switch(x){case"course":return e.jsx(d,{name:"BookOpen",size:16,className:"text-primary"});case"evaluation":return e.jsx(d,{name:"FileText",size:16,className:"text-error"});case"tp":return e.jsx(d,{name:"Laptop",size:16,className:"text-success"});case"meeting":return e.jsx(d,{name:"Users",size:16,className:"text-warning"});default:return e.jsx(d,{name:"Calendar",size:16,className:"text-muted-foreground"})}},g=x=>{switch(x){case"course":return"bg-primary/10 border-primary/20";case"evaluation":return"bg-error/10 border-error/20";case"tp":return"bg-success/10 border-success/20";case"meeting":return"bg-warning/10 border-warning/20";default:return"bg-muted/10 border-border"}},l=x=>{switch(x){case"course":return"Cours";case"evaluation":return"√âvaluation";case"tp":return"Travaux Pratiques";case"meeting":return"R√©union";default:return"Activit√©"}},A=x=>x==null?void 0:x.replace("-"," - "),q=x=>{const z=new Date(x),m=new Date;if((z==null?void 0:z.toDateString())===(m==null?void 0:m.toDateString()))return"Aujourd'hui";const f=new Date(m);return f==null||f.setDate((m==null?void 0:m.getDate())+1),(z==null?void 0:z.toDateString())===(f==null?void 0:f.toDateString())?"Demain":z==null?void 0:z.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})},k=x=>{var z,m;return((z=new Date(x))==null?void 0:z.toDateString())===((m=new Date)==null?void 0:m.toDateString())},C=()=>{const x=new Date;return(x==null?void 0:x.getHours())*60+(x==null?void 0:x.getMinutes())},a=x=>{var f;const[z]=x==null?void 0:x.split("-"),[m,c]=(f=z==null?void 0:z.split(":"))==null?void 0:f.map(Number);return m*60+c},M=x=>{var p;if(!k(x==null?void 0:x.date))return!1;const z=C(),[m,c]=(p=x==null?void 0:x.time)==null?void 0:p.split("-"),f=a(m+":00"),n=a(c+":00");return z>=f&&z<=n},_=(()=>{var m;const x=C(),z=(m=new Date)==null?void 0:m.toDateString();return t==null?void 0:t.find(c=>{var n,p,B;return((n=new Date(c.date))==null?void 0:n.toDateString())!==z?!1:a(((B=(p=c==null?void 0:c.time)==null?void 0:p.split("-"))==null?void 0:B[0])+":00")>x})})(),$=t==null?void 0:t.find(x=>M(x)),o=(t==null?void 0:t.reduce((x,z)=>{var c;const m=z==null?void 0:z.date;return x!=null&&x[m]||(x[m]=[]),(c=x==null?void 0:x[m])==null||c.push(z),x},{}))||{};return e.jsxs("div",{className:"bg-card rounded-lg shadow-card border border-border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"font-heading font-heading-semibold text-xl text-card-foreground",children:"Mon Planning de la Semaine"}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-primary/10 rounded-lg",children:[e.jsx(d,{name:"Calendar",size:16,className:"text-primary"}),e.jsxs("span",{className:"font-caption font-caption-semibold text-sm text-primary",children:[t==null?void 0:t.length," cours cette semaine"]})]})]}),($||_)&&e.jsx("div",{className:`mb-6 p-4 rounded-lg border ${$?"bg-success/5 border-success/20":"bg-primary/5 border-primary/20"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${$?"bg-success/10":"bg-primary/10"}`,children:$?e.jsx(d,{name:"PlayCircle",size:20,className:"text-success"}):e.jsx(d,{name:"Clock",size:20,className:"text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-heading font-heading-semibold text-lg ${$?"text-success":"text-primary"}`,children:$?"Cours en cours":"Prochain cours"}),e.jsx("div",{className:"mt-1",children:($||_)&&e.jsxs("div",{children:[e.jsxs("p",{className:"font-body font-body-semibold text-card-foreground",children:[(h=$||_)==null?void 0:h.className," - ",(b=$||_)==null?void 0:b.topic]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(d,{name:"Clock",size:14}),A((r=$||_)==null?void 0:r.time)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(d,{name:"MapPin",size:14}),(y=$||_)==null?void 0:y.room]})]})]})})]}),$&&e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-heading font-heading-bold text-success text-lg",children:"EN COURS"})})]})}),e.jsxs("div",{className:"space-y-6",children:[(j=Object.entries(o))==null?void 0:j.map(([x,z])=>{var m;return e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-3 mb-4 ${k(x)?"text-primary":"text-muted-foreground"}`,children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-lg",children:q(x)}),k(x)&&e.jsx("span",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-xs font-caption font-caption-semibold",children:"Aujourd'hui"}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsx("div",{className:"space-y-3",children:(m=z==null?void 0:z.sort((c,f)=>a(c==null?void 0:c.time)-a(f==null?void 0:f.time)))==null?void 0:m.map(c=>e.jsxs("div",{className:`border rounded-lg p-4 transition-all ${g(c==null?void 0:c.type)} ${M(c)?"ring-2 ring-success shadow-md":"hover:shadow-sm"}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[N(c==null?void 0:c.type),e.jsx("div",{children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-caption font-caption-semibold ${(c==null?void 0:c.type)==="course"?"bg-primary/10 text-primary":(c==null?void 0:c.type)==="evaluation"?"bg-error/10 text-error":(c==null?void 0:c.type)==="tp"?"bg-success/10 text-success":"bg-warning/10 text-warning"}`,children:l(c==null?void 0:c.type)})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h5",{className:"font-heading font-heading-semibold text-lg text-card-foreground",children:[c==null?void 0:c.className," - ",c==null?void 0:c.topic]}),e.jsx("p",{className:"font-body font-body-normal text-sm text-muted-foreground",children:c==null?void 0:c.subject})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-heading font-heading-bold text-lg text-card-foreground",children:A(c==null?void 0:c.time)}),e.jsxs("p",{className:"font-caption font-caption-normal text-sm text-muted-foreground",children:["üìç ",c==null?void 0:c.room]})]})]}),M(c)&&e.jsx("div",{className:"mt-3 pt-3 border-t border-success/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-body font-body-semibold text-success",children:["Cours en cours - ",c==null?void 0:c.className]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"px-3 py-1 bg-success/10 text-success hover:bg-success/20 rounded-lg transition-colors",children:[e.jsx(d,{name:"Users",size:12,className:"inline mr-1"}),"Liste classe"]}),e.jsxs("button",{className:"px-3 py-1 bg-primary/10 text-primary hover:bg-primary/20 rounded-lg transition-colors",children:[e.jsx(d,{name:"Calendar",size:12,className:"inline mr-1"}),"Pr√©sences"]})]})]})})]},c==null?void 0:c.id))})]},x)}),(t==null?void 0:t.length)===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(d,{name:"Calendar",size:64,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("h4",{className:"font-heading font-heading-semibold text-xl text-card-foreground mb-2",children:"Aucun cours programm√©"}),e.jsx("p",{className:"font-body font-body-normal text-muted-foreground",children:"Votre planning de la semaine est vide."})]})]}),(t==null?void 0:t.length)>0&&e.jsxs("div",{className:"mt-8 pt-6 border-t border-border",children:[e.jsx("h4",{className:"font-heading font-heading-semibold text-lg text-card-foreground mb-4",children:"R√©sum√© de la semaine"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-primary/5 rounded-lg",children:[e.jsx("div",{className:"font-heading font-heading-bold text-xl text-primary",children:(S=t==null?void 0:t.filter(x=>(x==null?void 0:x.type)==="course"))==null?void 0:S.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Cours"})]}),e.jsxs("div",{className:"text-center p-3 bg-error/5 rounded-lg",children:[e.jsx("div",{className:"font-heading font-heading-bold text-xl text-error",children:(v=t==null?void 0:t.filter(x=>(x==null?void 0:x.type)==="evaluation"))==null?void 0:v.length}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"√âvaluations"})]}),e.jsxs("div",{className:"text-center p-3 bg-success/5 rounded-lg",children:[e.jsxs("div",{className:"font-heading font-heading-bold text-xl text-success",children:[(t==null?void 0:t.length)*1.5,"h"]}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Total heures"})]}),e.jsxs("div",{className:"text-center p-3 bg-warning/5 rounded-lg",children:[e.jsx("div",{className:"font-heading font-heading-bold text-xl text-warning",children:(G=new Set(t==null?void 0:t.map(x=>x.className)))==null?void 0:G.size}),e.jsx("p",{className:"font-caption font-caption-normal text-xs text-muted-foreground",children:"Classes diff."})]})]})]})]})},Ie=({teacherId:t})=>{var C;const[i,N]=E.useState(null),[g,l]=E.useState(null),[A,q]=E.useState(!0);if(E.useEffect(()=>{t&&(async()=>{var M;q(!0);try{const{data:R,error:_}=await J.from("teacher_assignments").select(`
            id,
            school_id,
            class_name,
            subject_name,
            schedule,
            start_date,
            end_date,
            is_active,
            schools!teacher_assignments_school_id_fkey (
              id,
              name,
              type
            )
          `).eq("teacher_id",t).eq("is_active",!0);if(_)throw _;if(!R||R.length===0){N(null),q(!1);return}const $=new Map;let o=0,h=0;for(const y of R){const j=y.school_id,S=((M=y.schedule)==null?void 0:M.weekly_hours)||0;o+=S,$.has(j)||$.set(j,{schoolId:j,school:y.schools,classes:[],subjects:new Set,weeklyHours:0,assignedClasses:[],startDate:y.start_date,endDate:y.end_date,isActive:y.is_active});const v=$.get(j);v.weeklyHours+=S,v.subjects.add(y.subject_name);const{data:G}=await J.from("students").select("id").eq("school_id",j).eq("is_active",!0).or(`class_name.eq.${y.class_name},current_class.eq.${y.class_name}`),x=(G==null?void 0:G.length)||0;h+=x,v.assignedClasses.push({name:y.class_name,studentsCount:x,subject:y.subject_name,weeklyHours:S}),v.classes.push(y.class_name)}const b=Array.from($.values()).map(y=>({...y,subjects:Array.from(y.subjects),classes:[...new Set(y.classes)],assignmentType:y.weeklyHours>15?"principal":"secondaire",position:"Enseignant"})),r={totalSchools:b.length,totalWeeklyHours:o,totalStudents:h,availableHours:Math.max(0,40-o),assignments:b};N(r),b.length>0&&l(b[0].schoolId)}catch(R){console.error("Erreur lors du chargement des donn√©es enseignant:",R)}finally{q(!1)}})()},[t]),A)return e.jsx("div",{className:"bg-gradient-to-br from-white to-gray-50 rounded-2xl border-2 border-gray-200 p-8 shadow-lg",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-6 bg-gradient-to-r from-gray-200 to-gray-300 rounded-xl w-1/3"}),e.jsx("div",{className:"h-12 bg-gradient-to-r from-gray-200 to-gray-300 rounded-xl w-2/3"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"h-24 bg-gradient-to-br from-gray-200 to-gray-300 rounded-xl"}),e.jsx("div",{className:"h-24 bg-gradient-to-br from-gray-200 to-gray-300 rounded-xl"}),e.jsx("div",{className:"h-24 bg-gradient-to-br from-gray-200 to-gray-300 rounded-xl"})]})]})});if(!i||i.totalSchools===0)return e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl border-2 border-blue-200 p-8 text-center shadow-lg",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-md",children:e.jsx(d,{name:"School",size:32,className:"text-white"})}),e.jsx("h3",{className:"font-heading font-bold text-xl text-gray-900 mb-2",children:"Affectation unique"}),e.jsx("p",{className:"text-gray-600",children:"Vous √™tes actuellement affect√© √† un seul √©tablissement"})]});const k=i.assignments.find(a=>a.schoolId===g);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 rounded-2xl border-2 border-purple-200 p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(d,{name:"Building",size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading font-bold text-2xl text-gray-900",children:"Multi-√âtablissements"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Votre activit√© r√©partie sur plusieurs √©coles"})]})]})}),e.jsxs("div",{className:"text-right bg-white rounded-xl p-4 shadow-md border-2 border-purple-200",children:[e.jsx("div",{className:"text-4xl font-display font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:i.totalSchools}),e.jsxs("div",{className:"text-xs text-gray-600 font-medium",children:["√âtablissement",i.totalSchools>1?"s":""]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-xl p-5 border-2 border-blue-200 shadow-md hover:shadow-xl transition-all hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2.5 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-600 shadow-md",children:e.jsx(d,{name:"Clock",size:20,className:"text-white"})}),e.jsx("span",{className:"font-bold text-sm text-gray-700",children:"Charge totale"})]}),e.jsxs("div",{className:"text-3xl font-display font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent",children:[i.totalWeeklyHours,e.jsx("span",{className:"text-xl",children:"h"})]}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"par semaine"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-xl p-5 border-2 border-green-200 shadow-md hover:shadow-xl transition-all hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2.5 rounded-xl bg-gradient-to-br from-green-500 to-emerald-600 shadow-md",children:e.jsx(d,{name:"Users",size:20,className:"text-white"})}),e.jsx("span",{className:"font-bold text-sm text-gray-700",children:"Total √©l√®ves"})]}),e.jsx("div",{className:"text-3xl font-display font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent",children:i.totalStudents}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"√† encadrer"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-xl p-5 border-2 border-orange-200 shadow-md hover:shadow-xl transition-all hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2.5 rounded-xl bg-gradient-to-br from-orange-500 to-amber-600 shadow-md",children:e.jsx(d,{name:"TrendingUp",size:20,className:"text-white"})}),e.jsx("span",{className:"font-bold text-sm text-gray-700",children:"Disponibilit√©"})]}),e.jsxs("div",{className:`text-3xl font-display font-bold bg-clip-text text-transparent ${i.availableHours>10?"bg-gradient-to-r from-green-600 to-emerald-600":i.availableHours>5?"bg-gradient-to-r from-orange-600 to-amber-600":"bg-gradient-to-r from-red-600 to-rose-600"}`,children:[i.availableHours,e.jsx("span",{className:"text-xl",children:"h"})]}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"restantes"})]})]})]}),i.assignments.length>1&&e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-gray-200 p-6 shadow-lg",children:[e.jsxs("h4",{className:"font-heading font-bold text-lg text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(d,{name:"MapPin",size:20,className:"text-indigo-600"}),"S√©lectionner un √©tablissement"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.assignments.map(a=>{var M;return e.jsxs("button",{onClick:()=>l(a.schoolId),className:`group text-left p-4 rounded-xl border-2 transition-all shadow-md hover:shadow-xl hover:scale-105 ${g===a.schoolId?"border-indigo-500 bg-gradient-to-br from-indigo-50 to-purple-50 shadow-indigo-200":"border-gray-200 bg-white hover:border-indigo-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center shadow-md ${g===a.schoolId?"bg-gradient-to-br from-indigo-500 to-purple-600":"bg-gradient-to-br from-gray-400 to-gray-500"}`,children:e.jsx(d,{name:"School",size:20,className:"text-white"})}),e.jsx("h5",{className:"font-bold text-sm text-gray-900 group-hover:text-indigo-600 transition-colors",children:((M=a.school)==null?void 0:M.name)||"√âcole"})]}),a.assignmentType==="principal"&&e.jsx("span",{className:"bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-xs px-2.5 py-1 rounded-full font-bold shadow-md",children:"Principal"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(d,{name:"BookOpen",size:14,className:"text-indigo-600"}),e.jsxs("span",{className:"text-gray-700 font-medium",children:[a.classes.length," classe",a.classes.length>1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(d,{name:"Clock",size:14,className:"text-blue-600"}),e.jsxs("span",{className:"text-gray-700 font-medium",children:[a.weeklyHours,"h/semaine"]})]})]})]},a.schoolId)})})]}),k&&e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-gray-200 overflow-hidden shadow-xl",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-heading font-bold text-2xl mb-2 flex items-center gap-2",children:[e.jsx(d,{name:"School",size:28}),((C=k.school)==null?void 0:C.name)||"√âcole"]}),e.jsx("p",{className:"text-indigo-100 text-sm",children:k.position})]}),e.jsxs("div",{className:"text-right bg-white/20 backdrop-blur rounded-xl p-4 border border-white/30",children:[e.jsxs("div",{className:"text-3xl font-display font-bold",children:[k.weeklyHours,"h"]}),e.jsx("div",{className:"text-xs text-indigo-100",children:"par semaine"})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"font-bold text-base text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(d,{name:"BookOpen",size:18,className:"text-indigo-600"}),"Mati√®res enseign√©es"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:k.subjects.map((a,M)=>e.jsx("span",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white text-sm px-4 py-2 rounded-full font-medium shadow-md hover:shadow-lg transition-all hover:scale-105",children:a},M))})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-bold text-base text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(d,{name:"Users",size:18,className:"text-green-600"}),"Classes assign√©es (",k.assignedClasses.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:k.assignedClasses.map((a,M)=>e.jsx("div",{className:"group bg-gradient-to-br from-gray-50 to-white rounded-xl p-4 border-2 border-gray-200 shadow-md hover:shadow-xl hover:border-green-300 transition-all hover:scale-105",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"font-bold text-sm text-gray-900 mb-1",children:a.name}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(d,{name:"Users",size:12,className:"text-green-600"}),a.studentsCount," √©l√®ve",a.studentsCount>1?"s":""]}),a.weeklyHours>0&&e.jsxs("span",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(d,{name:"Clock",size:12,className:"text-blue-600"}),a.weeklyHours,"h/sem"]})]})]}),e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center shadow-md group-hover:scale-110 transition-transform",children:e.jsx(d,{name:"GraduationCap",size:20,className:"text-white"})})]})},M))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-5 shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center shadow-md",children:e.jsx(d,{name:"CheckCircle",size:18,className:"text-white"})}),e.jsx("span",{className:"font-bold text-base text-gray-900",children:"R√©sum√© de l'assignation"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[e.jsx("span",{className:"text-gray-600 text-xs block mb-1",children:"D√©but"}),e.jsx("span",{className:"text-gray-900 font-bold",children:new Date(k.startDate).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[e.jsx("span",{className:"text-gray-600 text-xs block mb-1",children:"Fin"}),e.jsx("span",{className:"text-gray-900 font-bold",children:new Date(k.endDate).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[e.jsx("span",{className:"text-gray-600 text-xs block mb-1",children:"Type"}),e.jsx("span",{className:"text-gray-900 font-bold capitalize",children:k.assignmentType})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:[e.jsx("span",{className:"text-gray-600 text-xs block mb-1",children:"Statut"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${k.isActive?"bg-green-500":"bg-gray-400"}`}),e.jsx("span",{className:`font-bold ${k.isActive?"text-green-600":"text-gray-600"}`,children:k.isActive?"Actif":"Inactif"})]})]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-gray-200 p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h5",{className:"font-bold text-base text-gray-900 flex items-center gap-2",children:[e.jsx(d,{name:"Activity",size:20,className:"text-blue-600"}),"Charge de travail globale"]}),e.jsx("span",{className:`text-xs font-bold px-3 py-1.5 rounded-full shadow-md ${i.totalWeeklyHours>30?"bg-gradient-to-r from-red-500 to-rose-600 text-white":i.totalWeeklyHours>20?"bg-gradient-to-r from-orange-500 to-amber-600 text-white":"bg-gradient-to-r from-green-500 to-emerald-600 text-white"}`,children:i.totalWeeklyHours>30?"‚ö†Ô∏è √âlev√©e":i.totalWeeklyHours>20?"‚ö° Mod√©r√©e":"‚úÖ L√©g√®re"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Heures enseign√©es"}),e.jsxs("span",{className:"font-bold text-gray-900",children:[i.totalWeeklyHours,"h ",e.jsx("span",{className:"text-gray-400",children:"/"})," 40h"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden shadow-inner",children:e.jsx("div",{className:`h-4 rounded-full transition-all duration-500 shadow-md ${i.totalWeeklyHours>30?"bg-gradient-to-r from-red-500 to-rose-600":i.totalWeeklyHours>20?"bg-gradient-to-r from-orange-500 to-amber-600":"bg-gradient-to-r from-green-500 to-emerald-600"}`,style:{width:`${Math.min(i.totalWeeklyHours/40*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-gray-500 font-medium",children:[e.jsx("span",{children:"0h"}),e.jsx("span",{children:"20h"}),e.jsx("span",{children:"40h (max)"})]})]}),i.totalWeeklyHours>35&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(d,{name:"AlertTriangle",size:16,className:"text-red-600 mt-0.5"}),e.jsxs("p",{className:"text-xs text-red-700",children:[e.jsx("strong",{children:"Attention :"})," Votre charge de travail d√©passe le maximum recommand√©. Pensez √† prendre du repos !"]})]})]})]})]})},rr=()=>{var w,U,K,xe;const[t]=Ae(),i=t.get("tab")||"dashboard",[N,g]=E.useState(!1),[l,A]=E.useState(null),[q,k]=E.useState(null),[C,a]=E.useState("entry"),[M,R]=E.useState(null),[_,$]=E.useState(new Date),[o,h]=E.useState("single"),{user:b}=Ee(),[r,y]=E.useState(null),[j,S]=E.useState(!0),[v,G]=E.useState({}),[x,z]=E.useState({}),[m,c]=E.useState([]);console.log("üè´ TeacherDashboard RENDER:",{hasUser:!!b,userId:b==null?void 0:b.id,userEmail:b==null?void 0:b.email,teacherDataName:r==null?void 0:r.name,classesInTeacherData:(w=r==null?void 0:r.assignedClasses)==null?void 0:w.map(P=>P.name)});const f=P=>{const W=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"].indexOf(P);if(W===-1)return new Date().toISOString().split("T")[0];const ne=new Date,ie=ne.getDay(),te=(W-ie+7)%7||7,ae=new Date(ne);return ae.setDate(ne.getDate()+te),ae.toISOString().split("T")[0]};E.useEffect(()=>{(async()=>{var H,W,ne,ie,te,ae;if(console.log("üîç TeacherDashboard - Chargement des donn√©es..."),console.log("  - user:",b),!b||!b.id){console.log("‚ö†Ô∏è Pas d'utilisateur connect√©"),S(!1);return}try{console.log("‚úÖ Chargement des donn√©es r√©elles..."),console.log("  - User ID:",b.id),console.log("  - School ID:",b.current_school_id),S(!0);const{data:F,error:be}=await J.from("teachers").select(`
            id,
            user_id,
            first_name,
            last_name,
            specialty,
            hire_date,
            is_active,
            users!teachers_user_id_fkey (
              id,
              email,
              full_name,
              phone,
              current_school_id
            ),
            schools!teachers_school_id_fkey (
              id,
              name,
              code
            )
          `).eq("user_id",b.id).eq("is_active",!0).single();if(be)throw console.error("‚ùå Erreur chargement enseignant:",be),be;console.log("‚úÖ Infos enseignant charg√©es:",F);const{data:ge,error:pe}=await J.from("academic_years").select("id, name, start_date, end_date").eq("school_id",F.school_id).eq("is_current",!0).single();pe?console.warn("‚ö†Ô∏è Ann√©e acad√©mique non trouv√©e:",pe):console.log("‚úÖ Ann√©e acad√©mique actuelle:",ge);const{data:Z,error:he}=await J.from("teacher_assignments").select(`
            id,
            class_id,
            subject_id,
            class_name,
            subject_name,
            school_id,
            schedule,
            is_active,
            classes!teacher_assignments_class_id_fkey (
              id,
              name,
              level,
              section
            ),
            subjects!teacher_assignments_subject_id_fkey (
              id,
              name,
              code
            ),
            schools!teacher_assignments_school_id_fkey (
              id,
              name
            )
          `).eq("teacher_id",F.id).eq("is_active",!0);if(he)throw console.error("‚ùå Erreur chargement assignations:",he),he;console.log("‚úÖ Assignations charg√©es:",(Z==null?void 0:Z.length)||0);const de={};if(Z&&Z.length>0)for(const T of Z){const I=T.class_id,X=T.class_name,re=T.school_id;let O=[];if(I){const{data:L,error:Q}=await J.from("students").select(`
                  id,
                  matricule,
                  user_id,
                  class_id,
                  users!students_user_id_fkey (
                    id,
                    full_name,
                    email,
                    phone
                  )
                `).eq("class_id",I).eq("is_active",!0);Q?console.error("Erreur chargement √©l√®ves par class_id:",Q):O=L||[]}else if(X&&re){console.log(`üîç Recherche √©l√®ves pour classe: ${X}, √©cole: ${re}`);const{data:L,error:Q}=await J.from("students").select(`
                  id,
                  matricule,
                  user_id,
                  class_name,
                  current_class,
                  school_id,
                  users!students_user_id_fkey (
                    id,
                    full_name,
                    email,
                    phone
                  )
                `).eq("school_id",re).eq("is_active",!0);Q?console.error("‚ùå Erreur chargement √©l√®ves par class_name:",Q):(O=(L||[]).filter(D=>D.class_name===X||D.current_class===X),console.log(`‚úÖ ${O.length} √©l√®ve(s) trouv√©(s) pour "${X}" sur ${(L==null?void 0:L.length)||0} √©l√®ves de l'√©cole`))}else{console.log("‚ÑπÔ∏è Assignation sans class_id ni class_name:",T),de[T.id]=[];continue}const Y=(O==null?void 0:O.map(L=>L.id))||[],{data:ue,error:fe}=await J.from("grades").select("student_id, grade, evaluation_type, created_at, subject_name").in("student_id",Y).order("created_at",{ascending:!1}).limit(100);fe&&console.warn("Erreur chargement notes:",fe);const{data:ve,error:je}=await J.from("attendances").select("student_id, status").in("student_id",Y);je&&console.warn("Erreur chargement pr√©sences:",je);const se=new Map;(ue||[]).forEach(L=>{se.has(L.student_id)||se.set(L.student_id,[]),se.get(L.student_id).push(L)});const oe=new Map;(ve||[]).forEach(L=>{oe.has(L.student_id)||oe.set(L.student_id,{present:0,absent:0,late:0});const Q=oe.get(L.student_id);L.status==="present"?Q.present++:L.status==="absent"?Q.absent++:L.status==="late"&&Q.late++}),O&&(de[T.id]=O.map(L=>{var D,ee,we;const Q=se.get(L.id)||[],le=oe.get(L.id)||{present:0,absent:0,late:0};return{id:L.id,name:((D=L.users)==null?void 0:D.full_name)||"√âl√®ve",matricule:L.matricule,email:(ee=L.users)==null?void 0:ee.email,phone:(we=L.users)==null?void 0:we.phone,recentGrades:Q.slice(0,5).map(Ne=>({subject:Ne.subject_name||T.subject_name,grade:Ne.grade,date:new Date(Ne.created_at).toLocaleDateString("fr-FR"),type:Ne.evaluation_type||"√âvaluation"})),attendance:le}}))}console.log("‚úÖ √âl√®ves charg√©s pour",Object.keys(de).length,"assignations");const ce={id:F.id,name:((H=F.users)==null?void 0:H.full_name)||`${F.first_name} ${F.last_name}`,email:(W=F.users)==null?void 0:W.email,phone:(ne=F.users)==null?void 0:ne.phone,specialty:F.specialty,school:((ie=F.schools)==null?void 0:ie.name)||"√âtablissement non renseign√©",employeeId:`ENS-${F.id.substring(0,8)}`,assignedClasses:(Z||[]).map(T=>{var O,Y,ue,fe,ve,je;const I=de[T.id]||[];let X=null;if(I.length>0){const se=I.filter(oe=>oe.recentGrades&&oe.recentGrades.length>0);se.length>0&&(X=se.reduce((L,Q)=>{const le=Q.recentGrades.reduce((D,ee)=>D+ee.grade,0)/Q.recentGrades.length;return L+le},0)/se.length)}let re=null;if(I.length>0){const se=I.reduce((le,D)=>{var ee;return le+(((ee=D.attendance)==null?void 0:ee.present)||0)},0),oe=I.reduce((le,D)=>{var ee;return le+(((ee=D.attendance)==null?void 0:ee.absent)||0)},0),L=I.reduce((le,D)=>{var ee;return le+(((ee=D.attendance)==null?void 0:ee.late)||0)},0),Q=se+oe+L;Q>0&&(re=Math.round(se/Q*100))}return{id:T.id,name:T.class_name||((O=T.classes)==null?void 0:O.name)||"Classe",level:((Y=T.classes)==null?void 0:Y.level)||T.class_name||"Non d√©fini",section:((ue=T.classes)==null?void 0:ue.section)||"",school:((fe=T.schools)==null?void 0:fe.name)||((ve=F.schools)==null?void 0:ve.name)||"√âcole",subject:T.subject_name||((je=T.subjects)==null?void 0:je.name)||"Mati√®re",students:I.length,schedule:T.schedule||{weekly_hours:0},average:X,attendanceRate:re,school_id:T.school_id||F.school_id,subject_id:T.subject_id,class_id:T.class_id,teacher_id:F.id,academic_year_id:(ge==null?void 0:ge.id)||null}})};console.log("‚úÖ Donn√©es format√©es:",ce);const me=[];Z&&Z.length>0&&Z.forEach(T=>{T.schedule&&Array.isArray(T.schedule)&&T.schedule.forEach(I=>{var X,re;me.push({id:`schedule-${T.id}-${I.day}`,className:T.class_name||((X=T.classes)==null?void 0:X.name),subject:T.subject_name||((re=T.subjects)==null?void 0:re.name),day:I.day,time:I.time,room:I.room,date:f(I.day),type:"course"})})}),console.log("‚úÖ Emploi du temps g√©n√©r√©:",me.length,"cr√©neaux");const V={};try{const{data:T}=await J.from("users").select("id").eq("email",b.email).single(),I=(T==null?void 0:T.id)||b.id;console.log("üìÑ Chargement documents pour user ID:",I);const{data:X,error:re}=await J.from("documents").select("*").eq("uploaded_by",I).order("created_at",{ascending:!1});re?console.warn("‚ö†Ô∏è Erreur chargement documents:",re):X&&X.length>0&&(console.log("‚úÖ Documents charg√©s:",X.length),X.forEach(O=>{const Y=O.class_name||"general";V[Y]||(V[Y]=[]),V[Y].push({id:O.id,title:O.title,type:O.document_type,document_type:O.document_type,file_name:O.file_name,file_path:O.file_path,file_size:O.file_size,mime_type:O.mime_type,visibility:O.visibility,is_public:O.is_public,created_at:O.created_at,uploadedAt:O.created_at,class_name:O.class_name})}),Z&&Z.length>0&&Z.forEach(O=>{var ue;const Y=O.class_name||((ue=O.classes)==null?void 0:ue.name);Y&&V[Y]&&(V[O.class_id]=V[Y])}))}catch(T){console.warn("‚ö†Ô∏è Erreur lors du chargement des documents:",T)}console.log("‚úÖ Documents organis√©s par classe:",Object.keys(V)),y(ce),G(de),z(V),c(me),console.log("üéØ DONN√âES R√âELLES D√âFINIES:"),console.log("  - Nombre de classes:",(te=ce.assignedClasses)==null?void 0:te.length),console.log("  - Classes:",(ae=ce.assignedClasses)==null?void 0:ae.map(T=>T.name)),console.log("  - Nom enseignant:",ce.name)}catch(F){console.error("‚ùå Erreur chargement donn√©es enseignant:",F)}finally{S(!1)}})()},[b]),E.useEffect(()=>{const P=setInterval(()=>{$(new Date)},1e3);return()=>clearInterval(P)},[]);const n=P=>{console.log("üìå Classe s√©lectionn√©e:",P),A(P),k(P==null?void 0:P.subject)},p=()=>{const P=_==null?void 0:_.getHours();return P<12?"Bonjour":P<18?"Bon apr√®s-midi":"Bonsoir"},B=()=>{var P;return(P=r==null?void 0:r.assignedClasses)==null?void 0:P.reduce((H,W)=>H+(W==null?void 0:W.students),0)},s=()=>{const P=new Date,H=new Date(P);return H==null||H.setDate((P==null?void 0:P.getDate())-(P==null?void 0:P.getDay())+1),m==null?void 0:m.filter(W=>{const ie=new Date(W==null?void 0:W.date)-H,te=Math.ceil(ie/(1e3*60*60*24));return te>=0&&te<7})},u=()=>{var P,H,W,ne,ie,te,ae,F,be,ge,pe,Z,he,de,ce;switch(console.log("üñºÔ∏è RENDER TAB - teacherData:",{hasData:!!r,name:r==null?void 0:r.name,classCount:(P=r==null?void 0:r.assignedClasses)==null?void 0:P.length,classes:r==null?void 0:r.assignedClasses}),i){case"classes":return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"font-heading font-heading-bold text-2xl text-card-foreground",children:"Mes Classes"}),r!=null&&r.assignedClasses&&((H=r==null?void 0:r.assignedClasses)==null?void 0:H.length)>0?e.jsxs(e.Fragment,{children:[e.jsx(_e,{classes:r==null?void 0:r.assignedClasses,selectedClass:l,onClassSelect:n}),l&&e.jsx(ke,{classes:r==null?void 0:r.assignedClasses,selectedClass:l})]}):e.jsxs("div",{className:"bg-card rounded-lg border border-border p-8 text-center",children:[e.jsx(d,{name:"GraduationCap",size:48,className:"mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"Aucune classe assign√©e pour le moment"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Contactez votre directeur pour obtenir vos affectations"})]})]});case"grades":return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"font-heading font-heading-bold text-2xl text-card-foreground",children:"Gestion des Notes"}),r!=null&&r.assignedClasses&&((W=r==null?void 0:r.assignedClasses)==null?void 0:W.length)>0?l?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 flex-wrap",children:[e.jsxs("button",{onClick:()=>a("entry"),className:`px-4 py-2 rounded-md flex items-center gap-2 ${C==="entry"?"bg-indigo-600 text-white":"bg-white border border-border hover:bg-gray-50"}`,children:[e.jsx(d,{name:"Edit3",size:16}),"Saisie"]}),e.jsxs("button",{onClick:()=>a("summary"),className:`px-4 py-2 rounded-md flex items-center gap-2 ${C==="summary"?"bg-indigo-600 text-white":"bg-white border border-border hover:bg-gray-50"}`,children:[e.jsx(d,{name:"BarChart2",size:16}),"Synth√®se"]}),e.jsxs("button",{onClick:()=>a("conduct"),className:`px-4 py-2 rounded-md flex items-center gap-2 ${C==="conduct"?"bg-indigo-600 text-white":"bg-white border border-border hover:bg-gray-50"}`,children:[e.jsx(d,{name:"UserCheck",size:16}),"Vie Scolaire"]})]}),C==="entry"&&e.jsx(Se,{classData:l,students:(v==null?void 0:v[l==null?void 0:l.id])||[],onGradeAdded:()=>{(async()=>{S(!0);try{window.location.reload()}catch(T){console.error("Erreur rechargement:",T)}})()}}),C==="summary"&&e.jsx(Be,{classData:l,students:(v==null?void 0:v[l==null?void 0:l.id])||[]}),C==="conduct"&&e.jsx(Oe,{classData:l,students:(v==null?void 0:v[l==null?void 0:l.id])||[]})]}):e.jsxs("div",{className:"bg-card rounded-lg border border-border p-8 text-center",children:[e.jsx(d,{name:"BookOpen",size:48,className:"mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"S√©lectionnez une classe pour g√©rer les notes"})]}):e.jsxs("div",{className:"bg-card rounded-lg border border-border p-8 text-center",children:[e.jsx(d,{name:"BookOpen",size:48,className:"mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"Aucune classe assign√©e pour le moment"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Contactez votre directeur pour obtenir vos affectations"})]})]});case"attendance":return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"font-heading font-heading-bold text-2xl text-card-foreground",children:"Gestion des Pr√©sences"}),r!=null&&r.assignedClasses&&((ne=r==null?void 0:r.assignedClasses)==null?void 0:ne.length)>0?l?e.jsx(ze,{classData:l,students:(v==null?void 0:v[l==null?void 0:l.id])||[]}):e.jsxs("div",{className:"bg-card rounded-lg border border-border p-8 text-center",children:[e.jsx(d,{name:"Calendar",size:48,className:"mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"S√©lectionnez une classe pour g√©rer les pr√©sences"})]}):e.jsxs("div",{className:"bg-card rounded-lg border border-border p-8 text-center",children:[e.jsx(d,{name:"Calendar",size:48,className:"mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"Aucune classe assign√©e pour le moment"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Contactez votre directeur pour obtenir vos affectations"})]})]});case"documents":const me=l?(x==null?void 0:x[l==null?void 0:l.id])||(x==null?void 0:x[l==null?void 0:l.name])||[]:[];return console.log("üìÑ Documents pour la classe:",l==null?void 0:l.name,"‚Üí",me==null?void 0:me.length,"documents"),console.log("üìÑ documentsData keys:",Object.keys(x||{})),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"font-heading font-heading-bold text-2xl text-card-foreground",children:"Mes Documents"}),r!=null&&r.assignedClasses&&((ie=r==null?void 0:r.assignedClasses)==null?void 0:ie.length)>0?l?e.jsx(Ce,{classData:l,documents:me}):e.jsxs("div",{className:"bg-card rounded-lg border border-border p-8 text-center",children:[e.jsx(d,{name:"Files",size:48,className:"mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"S√©lectionnez une classe pour g√©rer les documents"})]}):e.jsxs("div",{className:"bg-card rounded-lg border border-border p-8 text-center",children:[e.jsx(d,{name:"Files",size:48,className:"mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-text-secondary",children:"Aucune classe assign√©e pour le moment"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Contactez votre directeur pour obtenir vos affectations"})]})]});case"account":return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-indigo-600 to-purple-600 rounded-2xl shadow-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-3xl",children:"üë§"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-display font-bold text-2xl",children:"Mon Profil Enseignant"}),e.jsx("p",{className:"text-indigo-100 text-sm mt-1",children:"Informations personnelles et professionnelles"})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl border-2 border-gray-200 shadow-lg p-8",children:[e.jsxs("div",{className:"flex items-start space-x-6 mb-8",children:[e.jsx("div",{className:"w-28 h-28 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center flex-shrink-0 shadow-lg",children:e.jsx(d,{name:"User",size:56,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-display font-bold text-3xl text-gray-900 mb-3",children:(r==null?void 0:r.name)||"Nom non disponible"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-blue-100",children:e.jsx(d,{name:"Mail",size:18,className:"text-blue-600"})}),e.jsx("span",{className:"font-body-medium text-gray-700",children:(r==null?void 0:r.email)||"Email non renseign√©"})]}),(r==null?void 0:r.phone)&&e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-green-100",children:e.jsx(d,{name:"Phone",size:18,className:"text-green-600"})}),e.jsx("span",{className:"font-body-medium text-gray-700",children:r.phone})]}),e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-purple-100",children:e.jsx(d,{name:"Hash",size:18,className:"text-purple-600"})}),e.jsxs("span",{className:"font-body-medium text-gray-700",children:["Matricule: ",(r==null?void 0:r.employeeId)||"Non attribu√©"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl shadow-md",children:[e.jsx(d,{name:"CheckCircle",size:22}),e.jsx("span",{className:"font-body-bold",children:"Actif"})]})]}),e.jsxs("div",{className:"border-t-2 border-gray-100 pt-8",children:[e.jsxs("h4",{className:"font-body-bold text-xl text-gray-900 mb-6 flex items-center gap-2",children:[e.jsx(d,{name:"Briefcase",size:24,className:"text-indigo-600"}),"Informations professionnelles"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-4 sm:mb-6",children:[(r==null?void 0:r.specialty)&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-5 border-2 border-blue-200 shadow-md hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 shadow-md",children:e.jsx(d,{name:"BookOpen",size:20,className:"text-white"})}),e.jsx("div",{className:"text-sm font-body-bold text-gray-600",children:"Sp√©cialit√©"})]}),e.jsx("div",{className:"font-body-bold text-lg text-gray-900",children:r.specialty})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-5 border-2 border-purple-200 shadow-md hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-purple-500 to-pink-600 shadow-md",children:e.jsx(d,{name:"School",size:20,className:"text-white"})}),e.jsx("div",{className:"text-sm font-body-bold text-gray-600",children:"√âtablissement"})]}),e.jsx("div",{className:"font-body-bold text-lg text-gray-900",children:(r==null?void 0:r.school)||((ae=(te=r==null?void 0:r.assignedClasses)==null?void 0:te[0])==null?void 0:ae.school)||"Non renseign√©"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-5 border-2 border-green-200 shadow-md hover:shadow-xl transition-all hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2.5 rounded-xl bg-gradient-to-br from-green-500 to-emerald-600 shadow-md",children:e.jsx(d,{name:"GraduationCap",size:22,className:"text-white"})}),e.jsx("div",{className:"text-sm font-body-bold text-gray-600",children:"Classes assign√©es"})]}),e.jsx("div",{className:"text-4xl font-display font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent",children:((F=r==null?void 0:r.assignedClasses)==null?void 0:F.length)||0})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 rounded-2xl p-5 border-2 border-orange-200 shadow-md hover:shadow-xl transition-all hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2.5 rounded-xl bg-gradient-to-br from-orange-500 to-amber-600 shadow-md",children:e.jsx(d,{name:"Users",size:22,className:"text-white"})}),e.jsx("div",{className:"text-sm font-body-bold text-gray-600",children:"Total √©l√®ves"})]}),e.jsx("div",{className:"text-4xl font-display font-bold bg-gradient-to-r from-orange-600 to-amber-600 bg-clip-text text-transparent",children:B()||0})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-5 border-2 border-blue-200 shadow-md hover:shadow-xl transition-all hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2.5 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 shadow-md",children:e.jsx(d,{name:"Clock",size:22,className:"text-white"})}),e.jsx("div",{className:"text-sm font-body-bold text-gray-600",children:"Heures / semaine"})]}),e.jsxs("div",{className:"text-4xl font-display font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:[((be=r==null?void 0:r.assignedClasses)==null?void 0:be.reduce((V,T)=>{var I;return V+(((I=T.schedule)==null?void 0:I.weekly_hours)||0)},0))||0,e.jsx("span",{className:"text-2xl",children:"h"})]})]})]})]}),(r==null?void 0:r.assignedClasses)&&r.assignedClasses.length>0&&e.jsxs("div",{className:"border-t-2 border-gray-100 pt-8 mt-8",children:[e.jsxs("h4",{className:"font-body-bold text-xl text-gray-900 mb-6 flex items-center gap-2",children:[e.jsx(d,{name:"BookOpen",size:24,className:"text-green-600"}),"Mes classes et mati√®res"]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:r.assignedClasses.map((V,T)=>{var I;return e.jsx("div",{className:"group bg-gradient-to-br from-gray-50 to-white rounded-2xl p-5 border-2 border-gray-200 shadow-md hover:shadow-xl hover:scale-102 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center shadow-md group-hover:scale-110 transition-transform",children:e.jsx("span",{className:"font-display font-bold text-white text-lg",children:T+1})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-display font-bold text-lg text-gray-900",children:V.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"px-3 py-1 bg-indigo-100 text-indigo-700 rounded-lg font-body-bold",children:V.subject}),V.level&&V.level!=="Non d√©fini"&&e.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-lg font-body-bold",children:V.level})]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-orange-50 rounded-xl border border-orange-200",children:[e.jsx(d,{name:"Users",size:18,className:"text-orange-600"}),e.jsxs("span",{className:"font-body-bold text-orange-700",children:[V.students," √©l√®ve",V.students>1?"s":""]})]}),((I=V.schedule)==null?void 0:I.weekly_hours)>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-blue-50 rounded-xl border border-blue-200",children:[e.jsx(d,{name:"Clock",size:18,className:"text-blue-600"}),e.jsxs("span",{className:"font-body-bold text-blue-700",children:[V.schedule.weekly_hours,"h/sem"]})]})]})]})},V.id)})})]})]})]});default:return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-br from-green-600 to-emerald-600 rounded-2xl shadow-xl p-6 text-white mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-14 h-14 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center text-3xl",children:"üéì"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-green-100 text-sm",children:[p(),","]}),e.jsx("h2",{className:"font-display font-bold text-2xl",children:(r==null?void 0:r.name)||"Enseignant"}),e.jsxs("p",{className:"text-green-100 text-sm mt-1",children:[(r==null?void 0:r.specialty)||"Mati√®re"," ‚Ä¢ ",((ge=r==null?void 0:r.assignedClasses)==null?void 0:ge.length)||0," classe",((pe=r==null?void 0:r.assignedClasses)==null?void 0:pe.length)>1?"s":""]})]})]}),e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("p",{className:"text-green-100 text-sm",children:_.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}),e.jsx("p",{className:"font-display font-bold text-2xl",children:_.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})})]})]})}),(!(r!=null&&r.assignedClasses)||((Z=r==null?void 0:r.assignedClasses)==null?void 0:Z.length)===0)&&e.jsxs("div",{className:"bg-white border-2 border-blue-200 rounded-2xl shadow-lg p-12 text-center",children:[e.jsx("div",{className:"inline-flex p-4 rounded-full bg-gradient-to-br from-blue-100 to-indigo-200 mb-4",children:e.jsx(d,{name:"GraduationCap",size:48,className:"text-blue-600"})}),e.jsx("h3",{className:"text-2xl font-display font-bold text-gray-900 mb-2",children:"Aucune classe assign√©e"}),e.jsx("p",{className:"text-gray-600 font-body-medium mb-6 max-w-md mx-auto",children:"Vous n'avez pas encore de classes assign√©es. Contactez votre directeur d'√©tablissement pour obtenir vos affectations de cours."}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl p-6 inline-block",children:[e.jsx("p",{className:"text-sm text-gray-800 font-body-bold mb-3",children:"üí° Conseil : Une fois vos classes assign√©es, vous pourrez :"}),e.jsxs("ul",{className:"text-sm text-gray-700 text-left space-y-2",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"G√©rer les notes de vos √©l√®ves"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Suivre les pr√©sences"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Partager des documents p√©dagogiques"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Communiquer avec les √©l√®ves et parents"]})]})]})]}),(r==null?void 0:r.assignedClasses)&&((he=r==null?void 0:r.assignedClasses)==null?void 0:he.length)>0&&e.jsx("div",{className:"bg-white rounded-2xl border-2 border-gray-200 shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-body-bold text-lg text-gray-900 mb-1 flex items-center gap-2",children:[e.jsx(d,{name:"Layout",size:20,className:"text-green-600"}),"Mode d'affichage"]}),e.jsx("p",{className:"text-sm text-gray-600 font-body-medium",children:"Choisissez entre vue √©tablissement unique ou multi-√©tablissements"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>h("single"),className:`px-6 py-3 rounded-xl text-sm font-bold transition-all shadow-md hover:shadow-lg ${o==="single"?"bg-gradient-to-r from-green-600 to-emerald-600 text-white":"bg-white text-gray-600 hover:bg-gray-50 border-2 border-gray-200"}`,children:[e.jsx(d,{name:"School",size:18,className:"mr-2 inline"}),"Vue Simple"]}),e.jsxs("button",{onClick:()=>h("multi-school"),className:`px-6 py-3 rounded-xl text-sm font-bold transition-all shadow-md hover:shadow-lg ${o==="multi-school"?"bg-gradient-to-r from-purple-600 to-pink-600 text-white":"bg-white text-gray-600 hover:bg-gray-50 border-2 border-gray-200"}`,children:[e.jsx(d,{name:"Building",size:18,className:"mr-2 inline"}),"Multi-√âtablissements"]})]})]})}),o==="multi-school"&&(r==null?void 0:r.assignedClasses)&&((de=r==null?void 0:r.assignedClasses)==null?void 0:de.length)>0&&e.jsx(Ie,{teacherId:r==null?void 0:r.id}),o==="single"&&(r==null?void 0:r.assignedClasses)&&((ce=r==null?void 0:r.assignedClasses)==null?void 0:ce.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx(_e,{classes:r==null?void 0:r.assignedClasses,selectedClass:l,onClassSelect:n}),e.jsx(ke,{classes:r==null?void 0:r.assignedClasses,selectedClass:l}),l&&e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2 space-y-6",children:[e.jsx(Se,{classData:l,students:(v==null?void 0:v[l==null?void 0:l.id])||[],onGradeAdded:()=>{window.location.reload()}}),e.jsx(ze,{classData:l,students:(v==null?void 0:v[l==null?void 0:l.id])||[]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{classData:l,documents:(x==null?void 0:x[l==null?void 0:l.id])||(x==null?void 0:x[l==null?void 0:l.name])||[]}),e.jsx(Re,{classData:l,students:(v==null?void 0:v[l==null?void 0:l.id])||[]})]})]}),e.jsx(Ge,{schedule:s(),teacherName:r==null?void 0:r.name})]})]})}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Te,{userRole:"teacher",userName:(r==null?void 0:r.name)||"Enseignant",onToggleSidebar:()=>g(!N)}),e.jsx(qe,{userRole:"teacher",isCollapsed:N,onToggle:()=>g(!N)}),e.jsx("main",{className:`pt-20 sm:pt-16 transition-all duration-300 ${N?"lg:ml-16":"lg:ml-64"}`,children:e.jsxs("div",{className:"px-2 sm:px-4 lg:px-6 py-3 sm:py-4 space-y-3 sm:space-y-4 w-full overflow-x-hidden",children:[j&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-200 border-t-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-blue-900 text-sm font-semibold",children:"Chargement..."})]}),!j&&r&&e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg p-3 sm:p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-white/20 rounded-lg flex items-center justify-center text-lg sm:text-xl flex-shrink-0",children:"üë©‚Äçüè´"}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h1",{className:"text-sm sm:text-base font-bold truncate",children:[p(),", ",((U=r==null?void 0:r.name)==null?void 0:U.split(" ")[0])||(r==null?void 0:r.name)]}),e.jsx("p",{className:"text-xs text-green-100",children:_==null?void 0:_.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})})]})]}),((K=r==null?void 0:r.assignedClasses)==null?void 0:K.length)>0&&e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"bg-white/20 rounded px-2 py-1 text-center",children:[e.jsx("div",{className:"text-sm sm:text-base font-bold",children:(xe=r==null?void 0:r.assignedClasses)==null?void 0:xe.length}),e.jsx("div",{className:"text-xs",children:"Classes"})]}),e.jsxs("div",{className:"bg-white/20 rounded px-2 py-1 text-center",children:[e.jsx("div",{className:"text-sm sm:text-base font-bold",children:B()}),e.jsx("div",{className:"text-xs",children:"√âl√®ves"})]})]})]})}),!j&&r&&u(),!j&&!r&&e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-amber-50 border-2 border-yellow-300 rounded-2xl p-8 text-center shadow-lg",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-yellow-500 to-amber-600 flex items-center justify-center shadow-md",children:e.jsx(d,{name:"AlertTriangle",size:40,className:"text-white"})}),e.jsx("h3",{className:"text-2xl font-display font-bold text-yellow-900 mb-3",children:"Aucune donn√©e disponible"}),e.jsx("p",{className:"text-yellow-700 font-body-medium text-lg",children:"Veuillez contacter votre directeur pour configurer votre compte enseignant."})]})]})})]})};export{rr as default};
//# sourceMappingURL=index-C4tejHYV.js.map
