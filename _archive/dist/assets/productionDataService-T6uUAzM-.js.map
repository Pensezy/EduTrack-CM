{"version":3,"file":"productionDataService-T6uUAzM-.js","sources":["../../src/services/productionDataService.js"],"sourcesContent":["import { supabase } from \"../lib/supabase\";\r\n\r\nexport const productionDataService = {\r\n  currentSchoolId: null,\r\n  currentUserId: null,\r\n\r\n  setUserContext(userId, schoolId) {\r\n    this.currentUserId = userId;\r\n    this.currentSchoolId = schoolId;\r\n    console.log(\"Contexte utilisateur defini: User=\" + userId + \", School=\" + schoolId);\r\n  },\r\n\r\n  ensureContext() {\r\n    if (!this.currentUserId || !this.currentSchoolId) {\r\n      throw new Error(\"Contexte utilisateur non defini\");\r\n    }\r\n  },\r\n\r\n  async getDashboardMetrics(schoolId = null) {\r\n    try {\r\n      this.ensureContext();\r\n      const targetSchoolId = schoolId || this.currentSchoolId;\r\n\r\n      console.log(\"Recuperation des metriques pour l'ecole: \" + targetSchoolId);\r\n\r\n      const [studentsCount, teachersCount, classesCount] = await Promise.allSettled([\r\n        supabase.from(\"students\").select(\"id\", { count: \"exact\" }).eq(\"school_id\", targetSchoolId).eq(\"is_active\", true),\r\n        supabase.from(\"teachers\").select(\"id\", { count: \"exact\" }).eq(\"school_id\", targetSchoolId).eq(\"is_active\", true),\r\n        supabase.from(\"classes\").select(\"id\", { count: \"exact\" }).eq(\"school_id\", targetSchoolId)\r\n      ]);\r\n\r\n      // Gestion robuste des erreurs 403 et autres\r\n      let students = 0;\r\n      let teachers = 0;\r\n      let classes = 0;\r\n\r\n      if (studentsCount.status === \"fulfilled\" && !studentsCount.value.error) {\r\n        students = studentsCount.value.count || 0;\r\n      } else if (studentsCount.status === \"fulfilled\" && studentsCount.value.error) {\r\n        console.warn('‚ö†Ô∏è Erreur students:', studentsCount.value.error.message);\r\n      }\r\n\r\n      if (teachersCount.status === \"fulfilled\" && !teachersCount.value.error) {\r\n        teachers = teachersCount.value.count || 0;\r\n      } else if (teachersCount.status === \"fulfilled\" && teachersCount.value.error) {\r\n        console.warn('‚ö†Ô∏è Erreur teachers:', teachersCount.value.error.message);\r\n      }\r\n\r\n      if (classesCount.status === \"fulfilled\" && !classesCount.value.error) {\r\n        classes = classesCount.value.count || 0;\r\n      } else if (classesCount.status === \"fulfilled\" && classesCount.value.error) {\r\n        console.warn('‚ö†Ô∏è Erreur classes:', classesCount.value.error.message);\r\n      }\r\n\r\n      const metrics = [\r\n        { title: \"Eleves\", value: students, icon: \"Users\", trend: null },\r\n        { title: \"Presence Moyenne\", value: 0, unit: \"%\", icon: \"Calendar\", trend: null },\r\n        { title: \"Moyenne Generale\", value: 0, unit: \"/20\", icon: \"BookOpen\", trend: null },\r\n        { title: \"Recettes\", value: 0, unit: \"FCFA\", icon: \"DollarSign\", trend: null }\r\n      ];\r\n\r\n      console.log(\"Metriques recuperees:\", metrics);\r\n      return { data: metrics, error: null };\r\n\r\n    } catch (error) {\r\n      console.error(\"Erreur recuperation metriques:\", error);\r\n      return {\r\n        data: [\r\n          { title: \"Eleves\", value: 0, icon: \"Users\", trend: null },\r\n          { title: \"Presence Moyenne\", value: 0, unit: \"%\", icon: \"Calendar\", trend: null },\r\n          { title: \"Moyenne Generale\", value: 0, unit: \"/20\", icon: \"BookOpen\", trend: null },\r\n          { title: \"Recettes\", value: 0, unit: \"FCFA\", icon: \"DollarSign\", trend: null }\r\n        ],\r\n        error: null\r\n      };\r\n    }\r\n  },\r\n\r\n  async getClassAverages() {\r\n    try {\r\n      this.ensureContext();\r\n      return { data: [], error: null };\r\n    } catch (error) {\r\n      return { data: [], error };\r\n    }\r\n  },\r\n\r\n  async getAttendanceData() {\r\n    try {\r\n      this.ensureContext();\r\n      return { data: [], error: null };\r\n    } catch (error) {\r\n      return { data: [], error };\r\n    }\r\n  },\r\n\r\n  async getPaymentData() {\r\n    try {\r\n      this.ensureContext();\r\n      return { data: [], error: null };\r\n    } catch (error) {\r\n      return { data: [], error };\r\n    }\r\n  },\r\n\r\n  async getPersonnel() {\r\n    try {\r\n      this.ensureContext();\r\n      const targetSchoolId = this.currentSchoolId;\r\n      \r\n      console.log('üîç R√©cup√©ration du personnel pour l\\'√©cole:', targetSchoolId);\r\n\r\n      // R√©cup√©rer les enseignants\r\n      const { data: teachersData, error: teachersError } = await supabase\r\n        .from('teachers')\r\n        .select(`\r\n          id,\r\n          user_id,\r\n          first_name,\r\n          last_name,\r\n          specialty,\r\n          hire_date,\r\n          is_active,\r\n          school_id,\r\n          users:user_id (\r\n            id,\r\n            email,\r\n            phone,\r\n            full_name\r\n          )\r\n        `)\r\n        .eq('school_id', targetSchoolId);\r\n\r\n      if (teachersError) {\r\n        console.error('Erreur r√©cup√©ration enseignants:', teachersError);\r\n      }\r\n\r\n      // R√©cup√©rer les secr√©taires\r\n      const { data: secretariesData, error: secretariesError } = await supabase\r\n        .from('secretaries')\r\n        .select(`\r\n          id,\r\n          user_id,\r\n          first_name,\r\n          last_name,\r\n          hire_date,\r\n          is_active,\r\n          school_id,\r\n          users:user_id (\r\n            id,\r\n            email,\r\n            phone,\r\n            full_name\r\n          )\r\n        `)\r\n        .eq('school_id', targetSchoolId);\r\n\r\n      if (secretariesError) {\r\n        console.error('Erreur r√©cup√©ration secr√©taires:', secretariesError);\r\n      }\r\n\r\n      const personnel = [];\r\n\r\n      // Transformer les donn√©es des enseignants\r\n      if (teachersData && teachersData.length > 0) {\r\n        teachersData.forEach(teacher => {\r\n          const experienceYears = teacher.hire_date \r\n            ? Math.floor((new Date() - new Date(teacher.hire_date)) / (1000 * 60 * 60 * 24 * 365))\r\n            : 0;\r\n\r\n          personnel.push({\r\n            id: teacher.id,\r\n            name: teacher.users?.full_name || `${teacher.first_name} ${teacher.last_name}`,\r\n            email: teacher.users?.email || 'Non renseign√©',\r\n            phone: teacher.users?.phone || 'Non renseign√©',\r\n            subject: teacher.specialty || 'Non sp√©cifi√©',\r\n            type: 'teacher',\r\n            status: teacher.is_active ? 'active' : 'inactive',\r\n            experience: `${experienceYears} an${experienceYears > 1 ? 's' : ''}`,\r\n            hireDate: teacher.hire_date,\r\n            evaluation: 4.5 // Valeur par d√©faut, peut √™tre am√©lior√©e plus tard\r\n          });\r\n        });\r\n      }\r\n\r\n      // Transformer les donn√©es des secr√©taires\r\n      if (secretariesData && secretariesData.length > 0) {\r\n        secretariesData.forEach(secretary => {\r\n          const experienceYears = secretary.hire_date \r\n            ? Math.floor((new Date() - new Date(secretary.hire_date)) / (1000 * 60 * 60 * 24 * 365))\r\n            : 0;\r\n\r\n          personnel.push({\r\n            id: secretary.id,\r\n            name: secretary.users?.full_name || `${secretary.first_name} ${secretary.last_name}`,\r\n            email: secretary.users?.email || 'Non renseign√©',\r\n            phone: secretary.users?.phone || 'Non renseign√©',\r\n            role: 'Secr√©taire',\r\n            type: 'secretary',\r\n            status: secretary.is_active ? 'active' : 'inactive',\r\n            experience: `${experienceYears} an${experienceYears > 1 ? 's' : ''}`,\r\n            hireDate: secretary.hire_date,\r\n            permissions: ['student_management', 'document_management'] // Permissions par d√©faut\r\n          });\r\n        });\r\n      }\r\n\r\n      console.log('‚úÖ Personnel r√©cup√©r√©:', personnel.length, 'membres');\r\n      console.log('  - Enseignants:', personnel.filter(p => p.type === 'teacher').length);\r\n      console.log('  - Secr√©taires:', personnel.filter(p => p.type === 'secretary').length);\r\n\r\n      return { data: personnel, error: null };\r\n\r\n    } catch (error) {\r\n      console.error('‚ùå Erreur r√©cup√©ration personnel:', error);\r\n      return { data: [], error };\r\n    }\r\n  },\r\n\r\n  async getStudents() {\r\n    try {\r\n      this.ensureContext();\r\n      return { data: [], error: null };\r\n    } catch (error) {\r\n      return { data: [], error };\r\n    }\r\n  },\r\n\r\n  async getSchoolStats() {\r\n    try {\r\n      this.ensureContext();\r\n      \r\n      console.log(\"üìä R√©cup√©ration des statistiques de l'√©cole:\", this.currentSchoolId);\r\n      \r\n      // R√©cup√©rer les vraies statistiques depuis Supabase\r\n      const [studentsResult, teachersResult, classesResult] = await Promise.all([\r\n        supabase\r\n          .from(\"students\")\r\n          .select(\"id\", { count: \"exact\" })\r\n          .eq(\"school_id\", this.currentSchoolId)\r\n          .eq(\"is_active\", true),\r\n        supabase\r\n          .from(\"teachers\")\r\n          .select(\"id\", { count: \"exact\" })\r\n          .eq(\"school_id\", this.currentSchoolId)\r\n          .eq(\"is_active\", true),\r\n        supabase\r\n          .from(\"classes\")\r\n          .select(\"id\", { count: \"exact\" })\r\n          .eq(\"school_id\", this.currentSchoolId)\r\n      ]);\r\n\r\n      const totalStudents = studentsResult.count || 0;\r\n      const totalTeachers = teachersResult.count || 0;\r\n      const totalClasses = classesResult.count || 0;\r\n      \r\n      console.log(\"‚úÖ Statistiques r√©cup√©r√©es:\", { totalStudents, totalTeachers, totalClasses });\r\n      \r\n      return {\r\n        data: {\r\n          totalStudents,\r\n          totalTeachers,\r\n          classes: totalClasses,\r\n          totalRevenue: 0 // √Ä impl√©menter plus tard\r\n        },\r\n        error: null\r\n      };\r\n    } catch (error) {\r\n      console.error(\"‚ùå Erreur lors de la r√©cup√©ration des statistiques:\", error);\r\n      return {\r\n        data: {\r\n          totalStudents: 0,\r\n          totalTeachers: 0,\r\n          classes: 0,\r\n          totalRevenue: 0\r\n        },\r\n        error\r\n      };\r\n    }\r\n  },\r\n\r\n  async getSchoolDetails(schoolId = null, userId = null) {\r\n    try {\r\n      // Si on a un schoolId sp√©cifique, on l'utilise directement\r\n      if (schoolId) {\r\n        console.log(\"Recuperation des details de l'ecole par ID: \" + schoolId);\r\n\r\n        const { data: schoolData, error: schoolError } = await supabase\r\n          .from(\"schools\")\r\n          .select(\"*, users!director_user_id (id, full_name, email)\")\r\n          .eq(\"id\", schoolId)\r\n          .single();\r\n\r\n        if (schoolError) {\r\n          console.error(\"Erreur recuperation ecole par ID:\", schoolError);\r\n          // Ne pas throw, retourner null pour permettre au syst√®me de continuer\r\n          return { data: null, error: schoolError };\r\n        }\r\n\r\n        console.log(\"Details ecole recuperes par ID:\", schoolData);\r\n        return { data: schoolData, error: null };\r\n      }\r\n      \r\n      // Si on a un userId, chercher l'√©cole par directeur\r\n      if (userId) {\r\n        console.log(\"Recherche ecole par directeur: \" + userId);\r\n\r\n        const { data: schoolData, error: schoolError } = await supabase\r\n          .from(\"schools\")\r\n          .select(\"*, users!director_user_id (id, full_name, email)\")\r\n          .eq(\"director_user_id\", userId)\r\n          .single();\r\n\r\n        if (schoolError) {\r\n          console.error(\"Erreur recherche ecole par directeur:\", schoolError);\r\n          // Si c'est une erreur 403 (forbidden), logger mais ne pas bloquer\r\n          if (schoolError.code === '403' || schoolError.message?.includes('403')) {\r\n            console.warn('‚ö†Ô∏è Erreur 403 (permissions) lors de la recherche √©cole - continuer sans donn√©es');\r\n          }\r\n          return { data: null, error: schoolError };\r\n        }\r\n\r\n        console.log(\"Ecole trouvee par directeur:\", schoolData);\r\n        return { data: schoolData, error: null };\r\n      }\r\n\r\n      // Fallback: utiliser le contexte existant\r\n      this.ensureContext();\r\n      const targetSchoolId = this.currentSchoolId;\r\n\r\n      console.log(\"Recuperation des details de l'ecole (contexte): \" + targetSchoolId);\r\n\r\n      const { data: schoolData, error: schoolError } = await supabase\r\n        .from(\"schools\")\r\n        .select(\"*, users!director_user_id (id, full_name, email)\")\r\n        .eq(\"id\", targetSchoolId)\r\n        .single();\r\n\r\n      if (schoolError) {\r\n        console.error(\"Erreur recuperation ecole (contexte):\", schoolError);\r\n        // Ne pas throw, retourner null\r\n        return { data: null, error: schoolError };\r\n      }\r\n\r\n      console.log(\"Details ecole recuperes (contexte):\", schoolData);\r\n      return { data: schoolData, error: null };\r\n\r\n    } catch (error) {\r\n      console.error(\"Erreur recuperation details ecole:\", error);\r\n      return { data: null, error };\r\n    }\r\n  },\r\n\r\n  async getClasses(schoolId = null) {\r\n    try {\r\n      this.ensureContext();\r\n      const targetSchoolId = schoolId || this.currentSchoolId;\r\n\r\n      console.log(\"Recuperation des classes pour l'ecole: \" + targetSchoolId);\r\n\r\n      // R√©cup√©rer les classes depuis le champ available_classes de l'√©cole\r\n      const { data: schoolData, error: schoolError } = await supabase\r\n        .from(\"schools\")\r\n        .select(\"available_classes, type\")\r\n        .eq(\"id\", targetSchoolId)\r\n        .single();\r\n\r\n      if (schoolError) {\r\n        console.error(\"Erreur recuperation ecole pour classes:\", schoolError);\r\n        throw schoolError;\r\n      }\r\n\r\n      // Convertir available_classes (array) en format attendu par les composants\r\n      const availableClasses = schoolData.available_classes || [];\r\n      const classesData = availableClasses.map((className, index) => ({\r\n        id: `class_${index}`,\r\n        name: className,\r\n        level: className.replace(/[^0-9]/g, '') || className, // Extraire le niveau (6, 5, 4, 3...)\r\n        section: className.replace(/[0-9]/g, '').replace('√®me', '').trim() || null, // Extraire la section (A, B...)\r\n        capacity: 30, // Capacit√© par d√©faut\r\n        is_active: true,\r\n        created_at: new Date().toISOString()\r\n      }));\r\n\r\n      console.log(\"Classes recuperees depuis available_classes:\", classesData);\r\n      return { data: classesData, error: null };\r\n\r\n    } catch (error) {\r\n      console.error(\"Erreur recuperation classes:\", error);\r\n      return { data: [], error };\r\n    }\r\n  },\r\n\r\n  // ==========================================\r\n  // GESTION DES DEMANDES D'INSCRIPTION\r\n  // ==========================================\r\n\r\n  /**\r\n   * R√©cup√®re les demandes d'inscription/redoublement\r\n   */\r\n  async getEnrollmentRequests(schoolId = null, filters = {}) {\r\n    try {\r\n      this.ensureContext();\r\n      const targetSchoolId = schoolId || this.currentSchoolId;\r\n\r\n      console.log(\"üîç R√©cup√©ration des demandes d'inscription pour l'√©cole:\", targetSchoolId);\r\n\r\n      let query = supabase\r\n        .from(\"enrollment_requests\")\r\n        .select(`\r\n          id,\r\n          school_id,\r\n          academic_year_id,\r\n          request_type,\r\n          student_id,\r\n          student_first_name,\r\n          student_last_name,\r\n          student_date_of_birth,\r\n          student_gender,\r\n          parent_name,\r\n          parent_phone,\r\n          parent_email,\r\n          parent_address,\r\n          current_class,\r\n          requested_class,\r\n          reason,\r\n          teacher_recommendation,\r\n          previous_school,\r\n          documents,\r\n          status,\r\n          priority,\r\n          submitted_by,\r\n          submitted_date,\r\n          reviewed_by,\r\n          reviewed_date,\r\n          validation_notes,\r\n          created_at,\r\n          updated_at,\r\n          submitted_by_user:submitted_by(full_name, email),\r\n          reviewed_by_user:reviewed_by(full_name, email),\r\n          student:students(first_name, last_name, date_of_birth)\r\n        `)\r\n        .eq(\"school_id\", targetSchoolId)\r\n        .order(\"submitted_date\", { ascending: false });\r\n\r\n      // Appliquer les filtres\r\n      if (filters.status) {\r\n        query = query.eq(\"status\", filters.status);\r\n      }\r\n      if (filters.priority) {\r\n        query = query.eq(\"priority\", filters.priority);\r\n      }\r\n      if (filters.request_type) {\r\n        query = query.eq(\"request_type\", filters.request_type);\r\n      }\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      console.log(`‚úÖ ${data?.length || 0} demandes d'inscription r√©cup√©r√©es`);\r\n      return { data: data || [], error: null };\r\n\r\n    } catch (error) {\r\n      console.error(\"‚ùå Erreur r√©cup√©ration demandes d'inscription:\", error);\r\n      return { data: [], error };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * R√©cup√®re les statistiques des demandes\r\n   */\r\n  async getEnrollmentStats(schoolId = null) {\r\n    try {\r\n      this.ensureContext();\r\n      const targetSchoolId = schoolId || this.currentSchoolId;\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"enrollment_requests\")\r\n        .select(\"status, priority, request_type\")\r\n        .eq(\"school_id\", targetSchoolId);\r\n\r\n      if (error) throw error;\r\n\r\n      const stats = {\r\n        totalDemandes: data?.length || 0,\r\n        enAttente: data?.filter(r => r.status === 'en_attente').length || 0,\r\n        enRevision: data?.filter(r => r.status === 'en_revision').length || 0,\r\n        approuvees: data?.filter(r => r.status === 'approuvee').length || 0,\r\n        refusees: data?.filter(r => r.status === 'refusee').length || 0,\r\n        urgentes: data?.filter(r => r.priority === 'urgent').length || 0,\r\n        nouvelles: data?.filter(r => r.request_type === 'nouvelle_inscription').length || 0,\r\n        redoublements: data?.filter(r => r.request_type === 'redoublement').length || 0,\r\n        transferts: data?.filter(r => r.request_type === 'transfert').length || 0\r\n      };\r\n\r\n      return { data: stats, error: null };\r\n\r\n    } catch (error) {\r\n      console.error(\"Erreur r√©cup√©ration stats demandes:\", error);\r\n      return { \r\n        data: {\r\n          totalDemandes: 0,\r\n          enAttente: 0,\r\n          enRevision: 0,\r\n          approuvees: 0,\r\n          refusees: 0,\r\n          urgentes: 0,\r\n          nouvelles: 0,\r\n          redoublements: 0,\r\n          transferts: 0\r\n        }, \r\n        error \r\n      };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Cr√©e une nouvelle demande d'inscription\r\n   */\r\n  async createEnrollmentRequest(requestData) {\r\n    try {\r\n      this.ensureContext();\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"enrollment_requests\")\r\n        .insert({\r\n          ...requestData,\r\n          school_id: requestData.school_id || this.currentSchoolId,\r\n          submitted_by: requestData.submitted_by || this.currentUserId,\r\n          submitted_date: new Date().toISOString()\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      console.log(\"Demande cr√©√©e:\", data.id);\r\n      return { data, error: null };\r\n\r\n    } catch (error) {\r\n      console.error(\"Erreur cr√©ation demande:\", error);\r\n      return { data: null, error };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Met √† jour le statut d'une demande (validation/refus)\r\n   */\r\n  async updateEnrollmentRequest(requestId, updates) {\r\n    try {\r\n      this.ensureContext();\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"enrollment_requests\")\r\n        .update({\r\n          ...updates,\r\n          reviewed_by: updates.reviewed_by || this.currentUserId,\r\n          reviewed_date: new Date().toISOString()\r\n        })\r\n        .eq(\"id\", requestId)\r\n        .eq(\"school_id\", this.currentSchoolId)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      console.log(\"Demande mise √† jour:\", requestId);\r\n      return { data, error: null };\r\n\r\n    } catch (error) {\r\n      console.error(\"Erreur mise √† jour demande:\", error);\r\n      return { data: null, error };\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Supprime une demande (uniquement si annul√©e)\r\n   */\r\n  async deleteEnrollmentRequest(requestId) {\r\n    try {\r\n      this.ensureContext();\r\n\r\n      const { error } = await supabase\r\n        .from(\"enrollment_requests\")\r\n        .delete()\r\n        .eq(\"id\", requestId)\r\n        .eq(\"school_id\", this.currentSchoolId)\r\n        .eq(\"status\", \"annulee\");\r\n\r\n      if (error) throw error;\r\n\r\n      console.log(\"Demande supprim√©e:\", requestId);\r\n      return { data: true, error: null };\r\n\r\n    } catch (error) {\r\n      console.error(\"Erreur suppression demande:\", error);\r\n      return { data: false, error };\r\n    }\r\n  }\r\n};\r\n\r\nexport default productionDataService;"],"names":["productionDataService","userId","schoolId","targetSchoolId","studentsCount","teachersCount","classesCount","supabase","students","teachers","classes","metrics","error","teachersData","teachersError","secretariesData","secretariesError","personnel","teacher","experienceYears","_a","_b","_c","secretary","p","studentsResult","teachersResult","classesResult","totalStudents","totalTeachers","totalClasses","schoolData","schoolError","classesData","className","index","filters","query","data","r","requestData","requestId","updates"],"mappings":"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"}