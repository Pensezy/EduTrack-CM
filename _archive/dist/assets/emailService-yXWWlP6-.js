class b{constructor(t=0,s="Network Error"){this.status=t,this.text=s}}const C=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},a={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:C()},y=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},V=(e,t="https://api.emailjs.com")=>{if(!e)return;const s=y(e);a.publicKey=s.publicKey,a.blockHeadless=s.blockHeadless,a.storageProvider=s.storageProvider,a.blockList=s.blockList,a.limitRate=s.limitRate,a.origin=s.origin||t},P=async(e,t,s={})=>{const r=await fetch(a.origin+e,{method:"POST",headers:s,body:t}),o=await r.text(),n=new b(r.status,o);if(r.ok)return n;throw n},E=(e,t,s)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!s||typeof s!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},N=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},R=e=>e.webdriver||!e.languages||e.languages.length===0,j=()=>new b(451,"Unavailable For Headless Browser"),O=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},q=e=>{var t;return!((t=e.list)!=null&&t.length)||!e.watchVariable},x=(e,t)=>e instanceof FormData?e.get(t):e[t],I=(e,t)=>{if(q(e))return!1;O(e.list,e.watchVariable);const s=x(t,e.watchVariable);return typeof s!="string"?!1:e.list.includes(s)},F=()=>new b(403,"Forbidden"),J=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},A=async(e,t,s)=>{const r=Number(await s.get(e)||0);return t-Date.now()+r},D=async(e,t,s)=>{if(!t.throttle||!s)return!1;J(t.throttle,t.id);const r=t.id||e;return await A(r,t.throttle,s)>0?!0:(await s.set(r,Date.now().toString()),!1)},H=()=>new b(429,"Too Many Requests"),B=async(e,t,s,r)=>{const o=y(r),n=o.publicKey||a.publicKey,p=o.blockHeadless||a.blockHeadless,i=o.storageProvider||a.storageProvider,m={...a.blockList,...o.blockList},u={...a.limitRate,...o.limitRate};return p&&R(navigator)?Promise.reject(j()):(E(n,e,t),N(s),s&&I(m,s)?Promise.reject(F()):await D(location.pathname,u,i)?Promise.reject(H()):P("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:n,service_id:e,template_id:t,template_params:s}),{"Content-type":"application/json"}))},M=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},$=e=>typeof e=="string"?document.querySelector(e):e,z=async(e,t,s,r)=>{const o=y(r),n=o.publicKey||a.publicKey,p=o.blockHeadless||a.blockHeadless,i=a.storageProvider||o.storageProvider,m={...a.blockList,...o.blockList},u={...a.limitRate,...o.limitRate};if(p&&R(navigator))return Promise.reject(j());const f=$(s);E(n,e,t),M(f);const c=new FormData(f);return I(m,c)?Promise.reject(F()):await D(location.pathname,u,i)?Promise.reject(H()):(c.append("lib_version","4.4.1"),c.append("service_id",e),c.append("template_id",t),c.append("user_id",n),P("/api/v1.0/email/send-form",c))},w={init:V,send:B,sendForm:z,EmailJSResponseStatus:b},g={serviceId:"service_tuqh99q",templateId:"template_2cxezde",publicKey:"kFe4QRr9OaQAf8VXZ"},U=()=>{w.init(g.publicKey)},Y=async({recipientEmail:e,recipientName:t,role:s,email:r,password:o,schoolName:n,principalName:p,hasPersonalEmail:i=!0,staffName:m="",phone:u="",studentName:f="",matricule:c="",parentName:h="",parentPhone:v="",isStudent:K=!1})=>{var _,k,S,T,L;try{console.log("üìß Tentative d'envoi d'email..."),console.log("  - Destinataire:",e),console.log("  - R√¥le:",s),console.log("  - √âcole:",n),console.log("  - Email personnel:",i?"OUI":"NON (envoi au directeur)"),!g.publicKey||g.publicKey,console.log("‚úì Configuration EmailJS d√©tect√©e"),console.log("  - Service ID:",g.serviceId),console.log("  - Template ID:",g.templateId);const l={to_email:e,to_name:t,role:s,login_email:r,login_password:o,school_name:n,principal_name:p,login_url:`${window.location.origin}/staff-login`,current_year:new Date().getFullYear(),has_personal_email:i?"yes":"no",staff_name:m||"",staff_phone:u||"",is_student:K?"yes":"no",student_name:f||"",matricule:c||"",parent_name:h||"",parent_phone:v||""};console.log("üì§ Envoi de l'email via EmailJS..."),console.log("   Type:",i?"Direct √† l'utilisateur":"Au directeur pour transmission");const d=await w.send(g.serviceId,g.templateId,l,g.publicKey);if(console.log("üì¨ R√©ponse EmailJS:",d),d.status===200)return console.log("‚úÖ Email envoy√© avec succ√®s √†",e),{success:!0,message:"Email envoy√© avec succ√®s",details:{recipient:e,sentToPrincipal:!i,timestamp:new Date().toISOString(),status:d.status}};throw console.error("‚ùå √âchec de l'envoi - Status:",d.status),new Error(`√âchec de l'envoi de l'email (Status: ${d.status})`)}catch(l){console.error("‚ùå Erreur lors de l'envoi de l'email:",l),console.error("  - Type d'erreur:",l.name),console.error("  - Message:",l.message),console.error("  - D√©tails:",l.text||"Aucun d√©tail suppl√©mentaire");let d=l.message;return(_=l.message)!=null&&_.includes("Invalid email")?d="L'adresse email est invalide":(k=l.message)!=null&&k.includes("Failed to fetch")||(S=l.message)!=null&&S.includes("Network")?d="Erreur de connexion Internet. V√©rifiez votre connexion.":((T=l.message)!=null&&T.includes("Service ID")||(L=l.message)!=null&&L.includes("Template ID"))&&(d="Configuration EmailJS incorrecte. V√©rifiez vos cl√©s dans le fichier .env"),{success:!1,error:d,technicalError:l.message,fallback:!0,credentials:{email:r,password:o}}}},Q=()=>!0,G=async({title:e,message:t,target:s,priority:r,type:o,schoolName:n,senderName:p,recipients:i=[]})=>{try{if(console.log("üìß Envoi de notification en masse..."),console.log("  - Titre:",e),console.log("  - Destinataires:",s),console.log("  - Nombre d'emails:",i.length),Q(),i.length===0)return console.log("‚ÑπÔ∏è Aucun email sp√©cifique - notification sauvegard√©e uniquement"),{success:!0,message:"Notification enregistr√©e (pas d'emails sp√©cifiques)",sentCount:0,totalCount:0};const m={notification_title:e,notification_message:t,priority:r,type:o,school_name:n,sender_name:p,target_group:s,current_year:new Date().getFullYear()};let u=0,f=0;const c=Math.min(i.length,10);for(let h=0;h<c;h++)try{(await w.send(g.serviceId,"template_notification",{...m,to_email:i[h].email,to_name:i[h].name||"Utilisateur"},g.publicKey)).status===200&&u++}catch(v){console.error(`‚ùå Erreur envoi √† ${i[h].email}:`,v.message),f++}return console.log(`‚úÖ Notification envoy√©e: ${u}/${c} emails`),{success:u>0,message:`${u} email(s) envoy√©(s) sur ${c}`,sentCount:u,failedCount:f,totalCount:i.length}}catch(m){return console.error("‚ùå Erreur lors de l'envoi de la notification:",m),{success:!1,error:m.message,sentCount:0,totalCount:i.length}}};U();export{G as a,Q as i,Y as s};
//# sourceMappingURL=emailService-yXWWlP6-.js.map
