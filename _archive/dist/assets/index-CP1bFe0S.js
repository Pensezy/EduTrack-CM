import{u as B,j as e}from"./contexts-fbpOeTmm.js";import{r as u}from"./react-vendor-CFDIsUAY.js";import{H as E}from"./Helmet-B3bMicap.js";import{H as P,S as R}from"./Sidebar-Q0ML3SY6.js";import{I as t,B as i}from"./index-BPV3rumr.js";import{u as T}from"./useDashboardData-CL9BpvNP.js";import"./services-CdXttHtG.js";import"./supabase-CIvuJI4W.js";import"./charts-vendor-i33Lw0zL.js";import"./ui-vendor-BrXTGbgA.js";import"./productionDataService-T6uUAzM-.js";const Q=()=>{var j,b,v,N;const[o,D]=u.useState(!1),[d,c]=u.useState(!1),[g,m]=u.useState(0),{user:s}=B(),{data:r,loading:S}=T(),h=()=>{D(!o)};console.log("üîç User data in data-backup:",s),console.log("üîç User role:",s==null?void 0:s.role),console.log("üîç User full_name:",s==null?void 0:s.full_name),console.log("üîç User name:",s==null?void 0:s.name),console.log("üîç User email:",s==null?void 0:s.email);const p=()=>{var a,n;if(s!=null&&s.full_name&&s.full_name!=="")return s.full_name;if(s!=null&&s.name&&s.name!=="")return s.name;if((a=s==null?void 0:s.schoolData)!=null&&a.principal_name&&s.schoolData.principal_name!=="")return s.schoolData.principal_name;if(s!=null&&s.first_name&&(s!=null&&s.last_name))return`${s.first_name} ${s.last_name}`;if((n=s==null?void 0:s.user_metadata)!=null&&n.full_name)return s.user_metadata.full_name;if(s!=null&&s.email){const l=s.email.split("@")[0];return l.charAt(0).toUpperCase()+l.slice(1)}return"Utilisateur"},C=(r==null?void 0:r.backupHistory)||[{id:1,date:new Date().toISOString(),type:"manual",size:"1.2 GB",status:"completed",duration:"5 min"}],w=[{title:"Derni√®re sauvegarde",value:(r==null?void 0:r.lastBackup)||"Jamais",status:"success",icon:"CheckCircle"},{title:"Taille totale",value:(r==null?void 0:r.totalBackupSize)||"0 GB",status:"info",icon:"HardDrive"},{title:"Sauvegardes r√©ussies",value:(r==null?void 0:r.backupSuccessRate)||"100%",status:"success",icon:"TrendingUp"},{title:"R√©tention",value:(r==null?void 0:r.retentionPeriod)||"30 jours",status:"info",icon:"Calendar"}],z=()=>{c(!0),m(0);const n=setInterval(()=>{m(l=>{var y;return l>=100?(c(!1),alert(`‚úÖ Sauvegarde termin√©e avec succ√®s pour ${((y=s==null?void 0:s.schoolData)==null?void 0:y.name)||"votre √©tablissement"} !`),100):l+10})},800);setTimeout(()=>{clearInterval(n),c(!1),m(0)},8e3)},x=a=>{var n,l;console.log(`Export des donn√©es de ${(n=s==null?void 0:s.schoolData)==null?void 0:n.name} au format ${a.toUpperCase()}`),alert(`üìä Export des donn√©es de ${((l=s==null?void 0:s.schoolData)==null?void 0:l.name)||"votre √©tablissement"} au format ${a.toUpperCase()}...`)},k=()=>{var a;alert(`‚öôÔ∏è Configuration de l'auto-sauvegarde pour ${((a=s==null?void 0:s.schoolData)==null?void 0:a.name)||"votre √©tablissement"}

Acc√®s aux param√®tres :
‚Ä¢ Planification automatique
‚Ä¢ Configuration des notifications
‚Ä¢ Gestion de la r√©tention
‚Ä¢ Surveillance des sauvegardes`)},_=()=>{alert(`üîÑ Actualisation de l'historique des sauvegardes

R√©cup√©ration des derni√®res sauvegardes depuis Supabase...`)},$=()=>{var a;alert(`üìú Historique complet des sauvegardes

Acc√®s √† l'historique complet de ${((a=s==null?void 0:s.schoolData)==null?void 0:a.name)||"votre √©tablissement"} depuis Supabase.

Options disponibles :
‚Ä¢ Filtres avanc√©s
‚Ä¢ Recherche par p√©riode
‚Ä¢ D√©tails des sauvegardes
‚Ä¢ Export des rapports`)},H=a=>{switch(a){case"completed":return"CheckCircle";case"failed":return"XCircle";case"in_progress":return"Clock";default:return"Circle"}},f=a=>{switch(a){case"completed":return"text-green-500";case"failed":return"text-red-500";case"in_progress":return"text-yellow-500";default:return"text-gray-500"}},I=a=>{switch(a){case"completed":return"Termin√©e";case"failed":return"√âchou√©e";case"in_progress":return"En cours";default:return"Inconnue"}},U=a=>new Date(a).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs(e.Fragment,{children:[e.jsxs(E,{children:[e.jsx("title",{children:"Sauvegarde et Donn√©es - EduTrack CM"}),e.jsx("meta",{name:"description",content:"G√©rer les sauvegardes et l'export des donn√©es"})]}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(P,{userRole:"principal",userName:p(),isCollapsed:o,onToggleSidebar:h}),e.jsxs("div",{className:"flex pt-16",children:[e.jsx(R,{userRole:"principal",isCollapsed:o,onToggle:h}),e.jsxs("main",{className:`flex-1 transition-all duration-300 ${o?"lg:ml-20":"lg:ml-64"} p-6`,children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(t,{name:"Database",size:20,className:"text-primary"})}),e.jsx("h1",{className:"text-2xl font-heading font-heading-bold text-foreground",children:"Sauvegarde et Donn√©es"})]})}),e.jsxs("p",{className:"text-muted-foreground",children:["G√©rer les sauvegardes et l'exportation des donn√©es de ",((j=s==null?void 0:s.schoolData)==null?void 0:j.name)||"votre √©tablissement"]}),S&&e.jsxs("div",{className:"mt-4 flex items-center text-sm text-muted-foreground",children:[e.jsx(t,{name:"Loader2",size:16,className:"mr-2 animate-spin"}),"Chargement des donn√©es..."]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 bg-gray-100 p-2 rounded",children:["üë§ Utilisateur connect√©: ",e.jsx("strong",{children:p()}),(s==null?void 0:s.role)&&` | R√¥le: ${s.role}`,((b=s==null?void 0:s.schoolData)==null?void 0:b.name)&&` | √âcole: ${s.schoolData.name}`]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:w.map((a,n)=>e.jsx("div",{className:"bg-card border border-border rounded-lg p-6 shadow-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a.title}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:a.value})]}),e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${a.status==="success"?"bg-green-100":a.status==="warning"?"bg-yellow-100":"bg-blue-100"}`,children:e.jsx(t,{name:a.icon,size:20,className:a.status==="success"?"text-green-600":a.status==="warning"?"text-yellow-600":"text-blue-600"})})]})},n))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(t,{name:"Database",size:20,className:"text-primary"}),e.jsx("h2",{className:"text-lg font-heading font-heading-semibold text-card-foreground",children:"Sauvegarde Manuelle"})]}),d&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-foreground",children:"Sauvegarde en cours..."}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[g,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${g}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{onClick:z,disabled:d,className:"h-12",children:d?e.jsxs(e.Fragment,{children:[e.jsx(t,{name:"Loader2",size:16,className:"mr-2 animate-spin"}),"Sauvegarde..."]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{name:"Download",size:16,className:"mr-2"}),"Sauvegarder maintenant"]})}),e.jsxs(i,{variant:"outline",className:"h-12",onClick:k,children:[e.jsx(t,{name:"Settings",size:16,className:"mr-2"}),"Configurer auto-sauvegarde"]})]}),e.jsx("div",{className:"mt-6 p-4 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(t,{name:"Info",size:16,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground text-sm mb-1",children:"Information sur la sauvegarde"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["La sauvegarde inclut toutes les donn√©es de ",((v=s==null?void 0:s.schoolData)==null?void 0:v.name)||"votre √©tablissement"," : √©l√®ves, enseignants, notes, documents et param√®tres. Les sauvegardes sont crypt√©es et stock√©es de mani√®re s√©curis√©e dans Supabase."]})]})]})})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(t,{name:"Download",size:20,className:"text-primary"}),e.jsx("h2",{className:"text-lg font-heading font-heading-semibold text-card-foreground",children:"Export de Donn√©es"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(i,{variant:"outline",onClick:()=>x("excel"),className:"h-12 flex-col space-y-1",children:[e.jsx(t,{name:"FileSpreadsheet",size:20,className:"text-green-600"}),e.jsx("span",{className:"text-sm",children:"Excel"})]}),e.jsxs(i,{variant:"outline",onClick:()=>x("pdf"),className:"h-12 flex-col space-y-1",children:[e.jsx(t,{name:"FileText",size:20,className:"text-red-600"}),e.jsx("span",{className:"text-sm",children:"PDF"})]}),e.jsxs(i,{variant:"outline",onClick:()=>x("csv"),className:"h-12 flex-col space-y-1",children:[e.jsx(t,{name:"Database",size:20,className:"text-blue-600"}),e.jsx("span",{className:"text-sm",children:"CSV"})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 border border-green-200 bg-green-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-foreground text-sm mb-2",children:"Donn√©es acad√©miques"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Notes, pr√©sences, bulletins"})]}),e.jsxs("div",{className:"p-3 border border-green-200 bg-green-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-foreground text-sm mb-2",children:"Donn√©es administratives"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Personnel, finances, rapports"})]})]})]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-lg p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-heading font-heading-semibold text-card-foreground",children:"Historique"}),e.jsx(i,{variant:"ghost",size:"sm",onClick:_,children:e.jsx(t,{name:"RefreshCw",size:14})})]}),e.jsx("div",{className:"space-y-4",children:C.map(a=>e.jsxs("div",{className:"p-3 border border-border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:f(a.status),children:e.jsx(t,{name:H(a.status),size:16})}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:a.type==="automatic"?"Auto":"Manuel"})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.size})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:U(a.date)}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:f(a.status),children:I(a.status)}),a.status==="completed"&&e.jsx("span",{className:"text-muted-foreground",children:a.duration})]})]},a.id))}),e.jsx("div",{className:"mt-6 pt-4 border-t border-border",children:e.jsxs(i,{variant:"ghost",size:"sm",className:"w-full",onClick:$,children:[e.jsx(t,{name:"History",size:14,className:"mr-2"}),"Voir tout l'historique"]})})]})]}),e.jsx("div",{className:"mt-8 rounded-lg p-6 bg-green-50 border border-green-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(t,{name:"Database",size:20,className:"text-green-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-green-800",children:"Mode Production Actif"}),e.jsxs("p",{className:"text-sm text-green-700 mb-3",children:["Vous utilisez les vraies donn√©es de ",((N=s==null?void 0:s.schoolData)==null?void 0:N.name)||"votre √©tablissement",". Les sauvegardes et exports concernent vos donn√©es r√©elles stock√©es dans Supabase. Toutes les op√©rations sont authentiques et s√©curis√©es."]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsxs("p",{className:"text-xs text-green-800",children:[e.jsx(t,{name:"Shield",size:14,className:"inline mr-1"}),"S√©curit√© : Toutes les sauvegardes sont crypt√©es et les exports respectent la confidentialit√© des donn√©es."]})})]})]})})]})]})]})]})};export{Q as default};
//# sourceMappingURL=index-CP1bFe0S.js.map
