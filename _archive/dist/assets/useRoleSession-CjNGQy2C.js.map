{"version":3,"file":"useRoleSession-CjNGQy2C.js","sources":["../../src/hooks/useRoleSession.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\n\r\n/**\r\n * Hook pour charger la session utilisateur spÃ©cifique Ã  un rÃ´le\r\n * Ã‰vite les conflits quand plusieurs comptes sont connectÃ©s sur la mÃªme machine\r\n * \r\n * @param {string} expectedRole - Le rÃ´le attendu pour cette page ('principal', 'student', 'teacher', 'parent', 'secretary')\r\n * @returns {object} { user, loading, error }\r\n */\r\nexport const useRoleSession = (expectedRole) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const loadSession = () => {\r\n      try {\r\n        // 1. Essayer de charger la session spÃ©cifique au rÃ´le\r\n        const roleSessionKey = `edutrack-session-${expectedRole}`;\r\n        const roleSession = localStorage.getItem(roleSessionKey);\r\n        \r\n        if (roleSession) {\r\n          const sessionData = JSON.parse(roleSession);\r\n          console.log(`âœ… Session ${expectedRole} trouvÃ©e:`, sessionData.email);\r\n          setUser(sessionData);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n        \r\n        // 2. Fallback : vÃ©rifier la session globale\r\n        const globalSession = localStorage.getItem('edutrack-user');\r\n        if (globalSession) {\r\n          const sessionData = JSON.parse(globalSession);\r\n          \r\n          // VÃ©rifier que le rÃ´le correspond\r\n          if (sessionData.role === expectedRole) {\r\n            console.log(`âœ… Session globale utilisÃ©e pour ${expectedRole}:`, sessionData.email);\r\n            setUser(sessionData);\r\n          } else {\r\n            console.warn(`âš ï¸ RÃ´le incompatible. Attendu: ${expectedRole}, TrouvÃ©: ${sessionData.role}`);\r\n            setError(`Session incompatible. Veuillez vous connecter en tant que ${expectedRole}.`);\r\n          }\r\n        } else {\r\n          console.log(`â„¹ï¸ Aucune session trouvÃ©e pour ${expectedRole}`);\r\n          setError('Aucune session active');\r\n        }\r\n        \r\n        setLoading(false);\r\n      } catch (err) {\r\n        console.error('âŒ Erreur chargement session:', err);\r\n        setError('Erreur de chargement de session');\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadSession();\r\n\r\n    // Ã‰couter les changements de session\r\n    const handleSessionChange = (e) => {\r\n      if (e.detail?.role === expectedRole) {\r\n        console.log(`ðŸ”„ Mise Ã  jour session ${expectedRole}`);\r\n        setUser(e.detail.user);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('edutrack-user-changed', handleSessionChange);\r\n    return () => window.removeEventListener('edutrack-user-changed', handleSessionChange);\r\n  }, [expectedRole]);\r\n\r\n  return { user, loading, error };\r\n};\r\n\r\nexport default useRoleSession;\r\n"],"names":["useRoleSession","expectedRole","user","setUser","useState","loading","setLoading","error","setError","useEffect","roleSessionKey","roleSession","sessionData","globalSession","err","handleSessionChange","e","_a"],"mappings":"0CASY,MAACA,EAAkBC,GAAiB,CAC9C,KAAM,CAACC,EAAMC,CAAO,EAAIC,EAAAA,SAAS,IAAI,EAC/B,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EACrC,CAACG,EAAOC,CAAQ,EAAIJ,EAAAA,SAAS,IAAI,EAEvCK,OAAAA,EAAAA,UAAU,IAAM,EACM,IAAM,CACxB,GAAI,CAEF,MAAMC,EAAiB,oBAAoBT,CAAY,GACjDU,EAAc,aAAa,QAAQD,CAAc,EAEvD,GAAIC,EAAa,CACf,MAAMC,EAAc,KAAK,MAAMD,CAAW,EAC1C,QAAQ,IAAI,aAAaV,CAAY,YAAaW,EAAY,KAAK,EACnET,EAAQS,CAAW,EACnBN,EAAW,EAAK,EAChB,MACF,CAGA,MAAMO,EAAgB,aAAa,QAAQ,eAAe,EAC1D,GAAIA,EAAe,CACjB,MAAMD,EAAc,KAAK,MAAMC,CAAa,EAGxCD,EAAY,OAASX,GACvB,QAAQ,IAAI,mCAAmCA,CAAY,IAAKW,EAAY,KAAK,EACjFT,EAAQS,CAAW,IAEnB,QAAQ,KAAK,kCAAkCX,CAAY,aAAaW,EAAY,IAAI,EAAE,EAC1FJ,EAAS,6DAA6DP,CAAY,GAAG,EAEzF,MACE,QAAQ,IAAI,kCAAkCA,CAAY,EAAE,EAC5DO,EAAS,uBAAuB,EAGlCF,EAAW,EAAK,CAClB,OAASQ,EAAK,CACZ,QAAQ,MAAM,+BAAgCA,CAAG,EACjDN,EAAS,iCAAiC,EAC1CF,EAAW,EAAK,CAClB,CACF,KAKA,MAAMS,EAAuBC,GAAM,SAC7BC,EAAAD,EAAE,SAAF,YAAAC,EAAU,QAAShB,IACrB,QAAQ,IAAI,0BAA0BA,CAAY,EAAE,EACpDE,EAAQa,EAAE,OAAO,IAAI,EAEzB,EAEA,cAAO,iBAAiB,wBAAyBD,CAAmB,EAC7D,IAAM,OAAO,oBAAoB,wBAAyBA,CAAmB,CACtF,EAAG,CAACd,CAAY,CAAC,EAEV,CAAE,KAAAC,EAAM,QAAAG,EAAS,MAAAE,EAC1B"}