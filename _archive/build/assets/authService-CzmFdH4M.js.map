{"version":3,"file":"authService-CzmFdH4M.js","sources":["../../src/services/authService.js"],"sourcesContent":["// Service de connexion\r\n// Utilise Supabase pour l'authentification et la gestion des donn√©es\r\n\r\nimport { supabase } from '../lib/supabase.js';\r\n\r\n/**\r\n * Service de connexion pour directeur d'√©tablissement\r\n */\r\nexport const loginDirector = async (email, password) => {\r\n  try {\r\n    // 1. Authentification avec Supabase Auth\r\n    const { data: authData, error: authError } = await supabase.auth.signInWithPassword({\r\n      email,\r\n      password\r\n    });\r\n\r\n    if (authError) {\r\n      // Am√©liorer les messages d'erreur de Supabase\r\n      console.error('Erreur d\\'authentification Supabase:', authError);\r\n      \r\n      let friendlyMessage = authError.message;\r\n      \r\n      switch (authError.message) {\r\n        case 'Invalid login credentials':\r\n          friendlyMessage = 'Email ou mot de passe incorrect';\r\n          break;\r\n        case 'Email not confirmed':\r\n          friendlyMessage = 'Votre email n\\'a pas encore √©t√© confirm√©. V√©rifiez votre bo√Æte mail.';\r\n          break;\r\n        case 'Too many requests':\r\n          friendlyMessage = 'Trop de tentatives de connexion. Veuillez patienter quelques minutes.';\r\n          break;\r\n        case 'User not found':\r\n          friendlyMessage = 'Aucun compte trouv√© avec cette adresse email';\r\n          break;\r\n        default:\r\n          if (authError.message?.includes('invalid credentials')) {\r\n            friendlyMessage = 'Email ou mot de passe incorrect';\r\n          } else if (authError.message?.includes('network')) {\r\n            friendlyMessage = 'Probl√®me de connexion internet. V√©rifiez votre connexion.';\r\n          }\r\n      }\r\n      \r\n      throw new Error(friendlyMessage);\r\n    }\r\n\r\n    if (!authData.user) {\r\n      throw new Error('Erreur d\\'authentification - aucun utilisateur retourn√©');\r\n    }\r\n\r\n    console.log('‚úÖ Connexion r√©ussie pour:', authData.user.email);\r\n\r\n    // 2. Mettre √† jour la date de derni√®re connexion\r\n    const { error: updateLoginError } = await supabase\r\n      .from('users')\r\n      .update({ \r\n        last_login: new Date().toISOString(),\r\n        login_attempts: 0, // R√©initialiser les tentatives √©chou√©es\r\n        updated_at: new Date().toISOString()\r\n      })\r\n      .eq('id', authData.user.id);\r\n\r\n    if (updateLoginError) {\r\n      console.warn('‚ö†Ô∏è Erreur mise √† jour last_login:', updateLoginError);\r\n      // Ne pas bloquer la connexion pour cette erreur\r\n    } else {\r\n      console.log('‚úÖ Date de derni√®re connexion mise √† jour');\r\n    }\r\n\r\n    // 3. Donn√©es d'√©cole g√©r√©es automatiquement - pas besoin de finalisation manuelle\r\n\r\n    // 4. R√©cup√©rer les donn√©es de l'√©cole\r\n    console.log('üîç Recherche √©cole pour utilisateur:', {\r\n      userId: authData.user.id,\r\n      userEmail: authData.user.email,\r\n      metadata: authData.user.user_metadata\r\n    });\r\n\r\n    const { data: schoolData, error: schoolError } = await supabase\r\n      .from('schools')\r\n      .select(`\r\n        id,\r\n        name,\r\n        code,\r\n        type,\r\n        director_name,\r\n        phone,\r\n        email,\r\n        address,\r\n        city,\r\n        country,\r\n        website,\r\n        logo,\r\n        description,\r\n        available_classes,\r\n        settings,\r\n        status,\r\n        director_user_id,\r\n        created_at,\r\n        updated_at\r\n      `)\r\n      .eq('director_user_id', authData.user.id)\r\n      .single();\r\n\r\n    console.log('üè´ R√©sultat requ√™te √©cole:', {\r\n      schoolData,\r\n      schoolError,\r\n      userId: authData.user.id\r\n    });\r\n\r\n    if (schoolError) {\r\n      console.error('‚ùå Erreur lors de la recherche √©cole:', schoolError);\r\n      \r\n      // Debug : lister toutes les √©coles pour voir ce qui existe\r\n      const { data: allSchools, error: debugError } = await supabase\r\n        .from('schools')\r\n        .select('id, name, director_user_id, director_name, status');\r\n      \r\n      console.log('üîç DEBUG - Toutes les √©coles dans la base:', allSchools);\r\n      console.log('üîç DEBUG - Erreur de la requ√™te debug:', debugError);\r\n      console.log('üîç DEBUG - ID utilisateur recherch√©:', authData.user.id);\r\n      \r\n      // Si PGRST116 (aucune ligne), tenter de trouver l'√©cole via current_school_id\r\n      if (schoolError.code === 'PGRST116' && allSchools && allSchools.length > 0) {\r\n        console.log('üîÑ Tentative de r√©cup√©ration via current_school_id...');\r\n        \r\n        // R√©cup√©rer les donn√©es utilisateur pour avoir current_school_id\r\n        const { data: userData, error: userError } = await supabase\r\n          .from('users')\r\n          .select('current_school_id, full_name, email')\r\n          .eq('id', authData.user.id)\r\n          .single();\r\n        \r\n        console.log('üë§ Donn√©es utilisateur:', userData, userError);\r\n        \r\n        if (userData?.current_school_id) {\r\n          // Essayer de r√©cup√©rer l'√©cole via current_school_id\r\n          const { data: schoolByCurrentId, error: schoolByIdError } = await supabase\r\n            .from('schools')\r\n            .select(`\r\n              id,\r\n              name,\r\n              code,\r\n              type,\r\n              director_name,\r\n              phone,\r\n              email,\r\n              address,\r\n              city,\r\n              country,\r\n              website,\r\n              logo,\r\n              description,\r\n              available_classes,\r\n              settings,\r\n              status,\r\n              director_user_id,\r\n              created_at,\r\n              updated_at\r\n            `)\r\n            .eq('id', userData.current_school_id)\r\n            .single();\r\n          \r\n          console.log('üè´ √âcole trouv√©e via current_school_id:', schoolByCurrentId, schoolByIdError);\r\n          \r\n          if (schoolByCurrentId && !schoolByIdError) {\r\n            // V√©rifier si director_user_id est null ou incorrect\r\n            if (!schoolByCurrentId.director_user_id || schoolByCurrentId.director_user_id !== authData.user.id) {\r\n              console.warn('‚ö†Ô∏è director_user_id incorrect ou manquant, correction en cours...');\r\n              \r\n              // Corriger le director_user_id\r\n              const { error: updateError } = await supabase\r\n                .from('schools')\r\n                .update({ director_user_id: authData.user.id })\r\n                .eq('id', userData.current_school_id);\r\n              \r\n              if (updateError) {\r\n                console.error('‚ùå Erreur correction director_user_id:', updateError);\r\n              } else {\r\n                console.log('‚úÖ director_user_id corrig√© avec succ√®s');\r\n                schoolByCurrentId.director_user_id = authData.user.id;\r\n              }\r\n            }\r\n            \r\n            // Utiliser cette √©cole pour continuer la connexion\r\n            return {\r\n              success: true,\r\n              user: authData.user,\r\n              school: schoolByCurrentId\r\n            };\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Gestion sp√©cifique des erreurs\r\n      if (schoolError.code === 'PGRST116') {\r\n        throw new Error('Aucune √©cole associ√©e √† ce compte. V√©rifiez que votre compte a bien √©t√© cr√©√© comme directeur d\\'√©tablissement.');\r\n      }\r\n      throw new Error(`Erreur de r√©cup√©ration des donn√©es: ${schoolError.message}`);\r\n    }\r\n\r\n    if (!schoolData) {\r\n      throw new Error('Aucune √©cole trouv√©e pour ce compte');\r\n    }\r\n\r\n    // 3. V√©rifier le statut du compte\r\n    if (schoolData.status === 'pending') {\r\n      throw new Error('Votre compte est en attente de validation par l\\'administrateur');\r\n    }\r\n\r\n    if (schoolData.status === 'suspended') {\r\n      throw new Error('Votre compte a √©t√© suspendu. Contactez l\\'administrateur.');\r\n    }\r\n\r\n    if (schoolData.status !== 'active') {\r\n      throw new Error(`Statut du compte: ${schoolData.status}. Contactez l\\'administrateur.`);\r\n    }\r\n\r\n    // 4. R√©cup√©rer les donn√©es utilisateur\r\n    const { data: userData, error: userError } = await supabase\r\n      .from('users')\r\n      .select(`\r\n        id,\r\n        email,\r\n        full_name,\r\n        phone,\r\n        role,\r\n        current_school_id,\r\n        is_active,\r\n        created_at,\r\n        updated_at\r\n      `)\r\n      .eq('id', authData.user.id)\r\n      .single();\r\n\r\n    // Si l'utilisateur n'existe pas dans la table users, on continue quand m√™me\r\n    // (peut arriver si l'enregistrement n'a pas encore √©t√© cr√©√©)\r\n    if (userError && userError.code !== 'PGRST116') {\r\n      console.warn('Utilisateur non trouv√© dans la table users:', userError.message);\r\n    }\r\n\r\n    // 5. Retourner les donn√©es compl√®tes\r\n    return {\r\n      success: true,\r\n      user: authData.user,\r\n      school: {\r\n        id: schoolData.id,\r\n        name: schoolData.name,\r\n        code: schoolData.code,\r\n        type: schoolData.type,\r\n        directorName: schoolData.director_name,\r\n        phone: schoolData.phone,\r\n        email: schoolData.email,\r\n        address: schoolData.address,\r\n        city: schoolData.city,\r\n        country: schoolData.country,\r\n        website: schoolData.website,\r\n        logo: schoolData.logo,\r\n        description: schoolData.description,\r\n        availableClasses: schoolData.available_classes,\r\n        settings: schoolData.settings,\r\n        status: schoolData.status,\r\n        directorUserId: schoolData.director_user_id,\r\n        createdAt: schoolData.created_at,\r\n        updatedAt: schoolData.updated_at\r\n      },\r\n      profile: userData ? {\r\n        id: userData.id,\r\n        email: userData.email,\r\n        fullName: userData.full_name,\r\n        phone: userData.phone,\r\n        role: userData.role,\r\n        currentSchoolId: userData.current_school_id,\r\n        isActive: userData.is_active,\r\n        createdAt: userData.created_at,\r\n        updatedAt: userData.updated_at\r\n      } : null\r\n    };\r\n\r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      error: error.message || 'Erreur lors de la connexion',\r\n      user: null,\r\n      school: null,\r\n      profile: null\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * Service de d√©connexion\r\n */\r\nexport const logoutDirector = async () => {\r\n  try {\r\n    const { error } = await supabase.auth.signOut();\r\n    if (error) throw error;\r\n    \r\n    return { success: true };\r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      error: error.message || 'Erreur lors de la d√©connexion'\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * V√©rifier si un utilisateur est connect√© et r√©cup√©rer ses donn√©es\r\n */\r\nexport const getCurrentDirector = async () => {\r\n  try {\r\n    const { data: { user }, error } = await supabase.auth.getUser();\r\n    \r\n    if (error || !user) {\r\n      return { success: false, user: null, school: null };\r\n    }\r\n\r\n    // R√©cup√©rer les donn√©es de l'√©cole\r\n    const { data: schoolData, error: schoolError } = await supabase\r\n      .from('schools')\r\n      .select('*')\r\n      .eq('director_user_id', user.id)\r\n      .single();\r\n\r\n    if (schoolError || !schoolData) {\r\n      return { success: false, user: null, school: null };\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      user,\r\n      school: schoolData\r\n    };\r\n\r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      user: null,\r\n      school: null,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\nexport const handlePostConfirmation = async (user) => {\r\n  try {\r\n    console.log('üîê Post-confirmation handler for user:', user);\r\n    \r\n    // 1. Ensure user exists in users table\r\n    const { data: userData, error: userError } = await supabase\r\n      .from('users')\r\n      .upsert({\r\n        id: user.id,\r\n        email: user.email,\r\n        full_name: user.user_metadata?.full_name || user.email.split('@')[0],\r\n        role: user.user_metadata?.role || 'student',\r\n        is_active: true,\r\n        active: true,\r\n        photo: '/assets/images/no_image.png',\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString()\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (userError) {\r\n      console.error('‚ùå Error ensuring user in users table:', userError);\r\n      // Don't throw error, continue with process\r\n    } else {\r\n      console.log('‚úÖ User ensured in users table:', userData);\r\n    }\r\n\r\n    // 2. Check if user is a principal and has a school\r\n    if (user.user_metadata?.role === 'principal') {\r\n      try {\r\n        const { data: schools, error: schoolError } = await supabase\r\n          .from('schools')\r\n          .select('id, name, status')\r\n          .eq('director_user_id', user.id);\r\n\r\n        if (schoolError) {\r\n          console.warn('‚ö†Ô∏è Error checking existing schools:', schoolError);\r\n        } else if (schools && schools.length > 0) {\r\n          console.log('üè´ Existing school found:', schools[0]);\r\n        } else {\r\n          console.log('üÜï No existing school found for principal');\r\n        }\r\n      } catch (err) {\r\n        console.warn('‚ö†Ô∏è Exception checking schools:', err);\r\n      }\r\n    }\r\n\r\n    return { success: true, user: userData || user };\r\n  } catch (error) {\r\n    console.error('‚ùå Error in post-confirmation handler:', error);\r\n    // Don't block the process even if there are errors\r\n    return { success: true, user }; // Still return success to allow login\r\n  }\r\n};\r\n\r\n// Enhanced login function with better error handling\r\nexport const loginWithPin = async (identifier, pin) => {\r\n  try {\r\n    console.log('üîê Login attempt for:', identifier);\r\n    \r\n    // First, verify PIN using RPC\r\n    const { data: verificationData, error: verificationError } = await supabase\r\n      .rpc('verify_pin', {\r\n        identifier,\r\n        pin_input: pin\r\n      });\r\n\r\n    if (verificationError || !verificationData || verificationData.length === 0) {\r\n      throw new Error('Identifiant ou code PIN incorrect');\r\n    }\r\n\r\n    // Get user data from verification\r\n    const verifiedUser = verificationData[0];\r\n    \r\n    // Ensure user exists in users table\r\n    const { data: userData, error: userError } = await supabase\r\n      .from('users')\r\n      .upsert({\r\n        id: verifiedUser.user_id,\r\n        email: verifiedUser.user_email,\r\n        full_name: verifiedUser.user_full_name,\r\n        role: verifiedUser.user_role,\r\n        phone: verifiedUser.user_phone || '',\r\n        is_active: true,\r\n        active: true,\r\n        photo: '/assets/images/no_image.png',\r\n        last_login: new Date().toISOString(), // Ajouter la date de connexion\r\n        login_attempts: 0, // R√©initialiser les tentatives\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString()\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (userError) {\r\n      console.warn('‚ö†Ô∏è Warning: Could not ensure user in users table:', userError);\r\n      // Continue anyway as we have the verified data\r\n    } else {\r\n      console.log('‚úÖ Date de derni√®re connexion mise √† jour (PIN login)');\r\n    }\r\n\r\n    // Build authenticated user object\r\n    const authenticatedUser = {\r\n      id: verifiedUser.user_id,\r\n      email: verifiedUser.user_email,\r\n      full_name: verifiedUser.user_full_name,\r\n      role: verifiedUser.user_role,\r\n      phone: verifiedUser.user_phone || '',\r\n      ...(userData || {})\r\n    };\r\n\r\n    console.log('‚úÖ Login successful for:', authenticatedUser.email);\r\n    return { success: true, user: authenticatedUser };\r\n\r\n  } catch (error) {\r\n    console.error('‚ùå Login error:', error);\r\n    return { \r\n      success: false, \r\n      user: null,\r\n      error: error.message || 'Erreur de connexion'\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * Connexion pour les √©tudiants (sans Supabase Auth)\r\n * Les √©tudiants ont seulement une entr√©e dans la table users\r\n */\r\nexport const loginStudent = async (email, password) => {\r\n  try {\r\n    console.log('üîê Tentative de connexion √©tudiant pour:', email);\r\n    \r\n    // V√©rifier les identifiants dans la table users\r\n    const { data: userData, error: userError } = await supabase\r\n      .from('users')\r\n      .select('*')\r\n      .eq('email', email)\r\n      .eq('role', 'student')\r\n      .eq('is_active', true)\r\n      .single();\r\n\r\n    if (userError || !userData) {\r\n      throw new Error('Email ou mot de passe incorrect');\r\n    }\r\n\r\n    // V√©rifier le mot de passe (stock√© en clair pour l'instant)\r\n    if (userData.password_hash !== password) {\r\n      throw new Error('Email ou mot de passe incorrect');\r\n    }\r\n\r\n    // Mettre √† jour la date de derni√®re connexion\r\n    await supabase\r\n      .from('users')\r\n      .update({ \r\n        last_login: new Date().toISOString(),\r\n        login_attempts: 0,\r\n        updated_at: new Date().toISOString()\r\n      })\r\n      .eq('id', userData.id);\r\n\r\n    console.log('‚úÖ Connexion √©tudiant r√©ussie pour:', userData.email);\r\n\r\n    return {\r\n      success: true,\r\n      user: userData\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error('‚ùå Erreur connexion √©tudiant:', error);\r\n    return {\r\n      success: false,\r\n      user: null,\r\n      error: error.message || 'Erreur de connexion'\r\n    };\r\n  }\r\n};\r\n\r\n"],"names":["loginDirector","email","password","authData","authError","supabase","friendlyMessage","_a","_b","updateLoginError","schoolData","schoolError","allSchools","debugError","userData","userError","schoolByCurrentId","schoolByIdError","updateError","error"],"mappings":"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"}